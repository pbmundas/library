---
layout: default
title:  Reconnaissance
category: Threat-Hunting-Queries  # This becomes a main topic in sidebar
---

## Reconnaissance

### T1595: Active Scanning
### T1595.001: Scanning IP Blocks

| Hypothesis | Description | Data Sources | Hunting Queries |
|-----------|-------------|--------------|-----------------|
| 1. High-Volume IP Block Scanning from Single Source | Adversaries perform large-scale IP block scanning to identify live hosts, as seen in Volt Typhoon pre-exploitation. High risk in environments with limited network monitoring. | - Network Traffic (DS0003: Zeek Conn)<br>- Firewall Logs | - **Splunk**: `index=network sourcetype=zeek_conn dest_port IN (80,443,3389) \| stats count by src_ip, dest_ip \| where count > 100 \| sort -count` (Detects high connection attempts to multiple IPs).<br>- **KQL**: `DeviceNetworkEvents \| where RemotePort in (80, 443, 3389) \| summarize ConnectionCount=count() by DeviceIP, RemoteIP \| where ConnectionCount > 100 \| sort by ConnectionCount desc`.<br>- **ELK**: `FROM logs-zeek.conn-* \| WHERE destination.port IN [80, 443, 3389] \| STATS COUNT() BY source.ip, destination.ip HAVING COUNT() > 100 \| SORT COUNT() DESC`. |
| 2. IP Block Scanning with Anomalous Timing | Scanning occurs outside business hours, indicating reconnaissance, as in APT41. | - Network Traffic (DS0003: Zeek Conn)<br>- Metrics | - **Splunk**: `index=network sourcetype=zeek_conn dest_port IN (80,443) \| timechart span=1h count by src_ip \| where count > avg(count)*3 AND _time < "08:00" OR _time > "18:00"`.<br>- **KQL**: `DeviceNetworkEvents \| where RemotePort in (80, 443) \| summarize HourlyCount=count() by bin(Timestamp, 1h), DeviceIP \| where HourlyCount > avg(HourlyCount) * 3 and (hour(Timestamp) < 8 or hour(Timestamp) > 18)`.<br>- **ELK**: `FROM logs-zeek.conn-* \| WHERE destination.port IN [80, 443] \| STATS COUNT() BY date_histogram(@timestamp, '1h'), source.ip \| WHERE COUNT() > AVG(COUNT()) * 3 AND (HOUR(@timestamp) < 8 OR HOUR(@timestamp) > 18)`. |
| 3. IP Block Scanning Targeting Cloud Infrastructure | Adversaries scan cloud-hosted IP ranges, as in 2025 cloud-focused attacks. | - Cloud Audit Logs (AWS CloudTrail)<br>- Network Traffic | - **Splunk**: `index=cloud sourcetype=aws:cloudtrail eventName="DescribeInstances" AND src_ip NOT IN (trusted_ips) \| stats count by src_ip, eventName \| where count > 50`.<br>- **KQL**: `AWSCloudTrail \| where EventName == "DescribeInstances" and SourceIP !in (trustedIPs) \| summarize count() by SourceIP, EventName \| where count_ > 50`.<br>- **ELK**: `FROM logs-aws.cloudtrail-* \| WHERE event.action = 'DescribeInstances' AND source.ip NOT IN ['trusted_ips'] \| STATS COUNT() BY source.ip, event.action HAVING COUNT() > 50`. |
| 4. IP Block Scanning from Known Malicious IPs | Scanning from IPs associated with known threat actors, as in Volt Typhoon. | - Network Traffic (DS0003: Zeek Conn)<br>- Threat Intelligence | - **Splunk**: `index=network sourcetype=zeek_conn src_ip IN (threat_intel_ips) AND dest_port IN (80,443,3389) \| stats count by src_ip, dest_ip \| where count > 10`.<br>- **KQL**: `DeviceNetworkEvents \| where DeviceIP in (threatIntelIPs) and RemotePort in (80, 443, 3389) \| summarize count() by DeviceIP, RemoteIP \| where count_ > 10`.<br>- **ELK**: `FROM logs-zeek.conn-* \| WHERE source.ip IN ['threat_intel_ips'] AND destination.port IN [80, 443, 3389] \| STATS COUNT() BY source.ip, destination.ip HAVING COUNT() > 10`. |
| 5. IP Block Scanning with Low TTL | Adversaries use low TTL packets to evade detection during IP block scans, as in APT29. | - Network Traffic (DS0003: Zeek Conn)<br>- Packet Analysis | - **Splunk**: `index=network sourcetype=zeek_conn ttl < 64 AND dest_port IN (80,443) \| stats count by src_ip, dest_ip \| where count > 50`.<br>- **KQL**: `DeviceNetworkEvents \| where AdditionalFields.TTL < 64 and RemotePort in (80, 443) \| summarize count() by DeviceIP, RemoteIP \| where count_ > 50`.<br>- **ELK**: `FROM logs-zeek.conn-* \| WHERE network.ttl < 64 AND destination.port IN [80, 443] \| STATS COUNT() BY source.ip, destination.ip HAVING COUNT() > 50`. |
| 6. IP Block Scanning in Linux Environments | Scanning targeting Linux servers, as in Turla campaigns. | - Network Traffic (DS0003: Zeek Conn)<br>- Linux Logs | - **Splunk**: `index=linux sourcetype=auditd syscall="connect" AND dest_port IN (22,80,443) AND src_ip NOT IN (trusted_ips) \| stats count by src_ip, dest_ip \| where count > 20`.<br>- **KQL**: `DeviceNetworkEvents \| where RemotePort in (22, 80, 443) and DeviceIP !in (trustedIPs) \| summarize count() by DeviceIP, RemoteIP \| where count_ > 20`.<br>- **ELK**: `FROM logs-auditd-* \| WHERE syscall.name = "connect" AND destination.port IN [22, 80, 443] AND source.ip NOT IN ['trusted_ips'] \| STATS COUNT() BY source.ip, destination.ip HAVING COUNT() > 20`. |
| 7. IP Block Scanning with Suspicious User Agents | Scanning with non-standard user agents, as in Cobalt Strike reconnaissance. | - Network Traffic (DS0003: Zeek HTTP)<br>- Proxy Logs | - **Splunk**: `index=network sourcetype=zeek_http user_agent NOT IN (known_agents) AND dest_port IN (80,443) \| stats count by src_ip, user_agent \| where count > 10`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "HTTP" and AdditionalFields.UserAgent !in (knownAgents) and RemotePort in (80, 443) \| summarize count() by DeviceIP, AdditionalFields.UserAgent \| where count_ > 10`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE http.user_agent NOT IN ['known_agents'] AND destination.port IN [80, 443] \| STATS COUNT() BY source.ip, http.user_agent HAVING COUNT() > 10`. |
| 8. IP Block Scanning with Rapid Sequential Ports | Adversaries scan sequential ports across IP blocks, as in Volt Typhoon. | - Network Traffic (DS0003: Zeek Conn)<br>- Firewall Logs | - **Splunk**: `index=network sourcetype=zeek_conn \| stats count by src_ip, dest_ip, dest_port \| where count > 50 AND max(dest_port) - min(dest_port) < 10`.<br>- **KQL**: `DeviceNetworkEvents \| summarize count(), max(RemotePort), min(RemotePort) by DeviceIP, RemoteIP \| where count_ > 50 and (max_RemotePort - min_RemotePort) < 10`.<br>- **ELK**: `FROM logs-zeek.conn-* \| STATS COUNT(), MAX(destination.port), MIN(destination.port) BY source.ip, destination.ip HAVING COUNT() > 50 AND (MAX(destination.port) - MIN(destination.port)) < 10`. |
| 9. IP Block Scanning with High Failure Rates | Scanning with high connection failure rates, indicating reconnaissance, as in APT41. | - Network Traffic (DS0003: Zeek Conn)<br>- Firewall Logs | - **Splunk**: `index=network sourcetype=zeek_conn conn_state="REJ" AND dest_port IN (80,443,3389) \| stats count by src_ip, dest_ip \| where count > 50`.<br>- **KQL**: `DeviceNetworkEvents \| where AdditionalFields.ConnectionState == "REJ" and RemotePort in (80, 443, 3389) \| summarize count() by DeviceIP, RemoteIP \| where count_ > 50`.<br>- **ELK**: `FROM logs-zeek.conn-* \| WHERE network.connection.state = 'REJ' AND destination.port IN [80, 443, 3389] \| STATS COUNT() BY source.ip, destination.ip HAVING COUNT() > 50`. |
| 10. IP Block Scanning Targeting Internal Networks | Internal hosts scanning IP blocks, indicating compromised insider, as in FIN7. | - Network Traffic (DS0003: Zeek Conn)<br>- Endpoint Logs | - **Splunk**: `index=network sourcetype=zeek_conn src_ip IN (internal_ips) AND dest_ip IN (internal_ips) AND dest_port IN (80,443) \| stats count by src_ip, dest_ip \| where count > 50`.<br>- **KQL**: `DeviceNetworkEvents \| where DeviceIP in (internalIPs) and RemoteIP in (internalIPs) and RemotePort in (80, 443) \| summarize count() by DeviceIP, RemoteIP \| where count_ > 50`.<br>- **ELK**: `FROM logs-zeek.conn-* \| WHERE source.ip IN ['internal_ips'] AND destination.ip IN ['internal_ips'] AND destination.port IN [80, 443] \| STATS COUNT() BY source.ip, destination.ip HAVING COUNT() > 50`. |

### T1595.002: Vulnerability Scanning

| Hypothesis | Description | Data Sources | Hunting Queries |
|-----------|-------------|--------------|-----------------|
| 1. Vulnerability Scanning with Known Tools | Adversaries use tools like Nessus or OpenVAS for vulnerability scanning, as in Volt Typhoon. | - Network Traffic (DS0003: Zeek HTTP)<br>- Proxy Logs | - **Splunk**: `index=network sourcetype=zeek_http user_agent IN ("*Nessus*", "*OpenVAS*") \| stats count by src_ip, user_agent \| where count > 10`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "HTTP" and AdditionalFields.UserAgent has_any ("Nessus", "OpenVAS") \| summarize count() by DeviceIP, AdditionalFields.UserAgent \| where count_ > 10`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE http.user_agent : ("*Nessus*" OR "*OpenVAS*") \| STATS COUNT() BY source.ip, http.user_agent HAVING COUNT() > 10`. |
| 2. Vulnerability Scanning with Specific Ports | Scanning targets specific ports associated with vulnerabilities (e.g., 445 for SMB), as in APT41. | - Network Traffic (DS0003: Zeek Conn)<br>- Firewall Logs | - **Splunk**: `index=network sourcetype=zeek_conn dest_port IN (445,1433,3306) \| stats count by src_ip, dest_port \| where count > 50`.<br>- **KQL**: `DeviceNetworkEvents \| where RemotePort in (445, 1433, 3306) \| summarize count() by DeviceIP, RemotePort \| where count_ > 50`.<br>- **ELK**: `FROM logs-zeek.conn-* \| WHERE destination.port IN [445, 1433, 3306] \| STATS COUNT() BY source.ip, destination.port HAVING COUNT() > 50`. |
| 3. Vulnerability Scanning in Cloud Environments | Adversaries scan cloud services for misconfigurations, as in 2025 trends. | - Cloud Audit Logs (AWS CloudTrail)<br>- Network Traffic | - **Splunk**: `index=cloud sourcetype=aws:cloudtrail eventName IN ("DescribeSecurityGroups", "DescribeInstances") AND src_ip NOT IN (trusted_ips) \| stats count by src_ip, eventName \| where count > 50`.<br>- **KQL**: `AWSCloudTrail \| where EventName in ("DescribeSecurityGroups", "DescribeInstances") and SourceIP !in (trustedIPs) \| summarize count() by SourceIP, EventName \| where count_ > 50`.<br>- **ELK**: `FROM logs-aws.cloudtrail-* \| WHERE event.action IN ['DescribeSecurityGroups', 'DescribeInstances'] AND source.ip NOT IN ['trusted_ips'] \| STATS COUNT() BY source.ip, event.action HAVING COUNT() > 50`. |
| 4. Vulnerability Scanning with High Failure Rates | Scanning with high failure rates, indicating probing for vulnerabilities, as in APT29. | - Network Traffic (DS0003: Zeek Conn)<br>- Firewall Logs | - **Splunk**: `index=network sourcetype=zeek_conn conn_state="REJ" AND dest_port IN (445,1433) \| stats count by src_ip, dest_port \| where count > 50`.<br>- **KQL**: `DeviceNetworkEvents \| where AdditionalFields.ConnectionState == "REJ" and RemotePort in (445, 1433) \| summarize count() by DeviceIP, RemotePort \| where count_ > 50`.<br>- **ELK**: `FROM logs-zeek.conn-* \| WHERE network.connection.state = 'REJ' AND destination.port IN [445, 1433] \| STATS COUNT() BY source.ip, destination.port HAVING COUNT() > 50`. |
| 5. Vulnerability Scanning from Compromised Endpoints | Compromised internal hosts perform vulnerability scans, as in FIN7. | - Process Creation (DS0009: Sysmon ID 1)<br>- Network Traffic | - **Splunk**: `index=endpoint sourcetype=sysmon EventCode=1 CommandLine IN ("*nmap*", "*nessus*") \| join host [search index=network sourcetype=zeek_conn dest_port IN (445,1433)] \| stats count by host, CommandLine, dest_port \| where count > 10`.<br>- **KQL**: `DeviceProcessEvents \| where ProcessCommandLine has_any ("nmap", "nessus") \| join kind=inner (DeviceNetworkEvents \| where RemotePort in (445, 1433)) on DeviceName \| summarize count() by DeviceName, ProcessCommandLine, RemotePort \| where count_ > 10`.<br>- **ELK**: `FROM logs-endpoint.process-* \| WHERE process.command_line : ("*nmap*" OR "*nessus*") \| JOIN logs-zeek.conn-* ON host.name WHERE destination.port IN [445, 1433] \| STATS COUNT() BY host.name, process.command_line, destination.port HAVING COUNT() > 10`. |
| 6. Vulnerability Scanning with Suspicious Headers | Scanning with custom HTTP headers, as in Cobalt Strike reconnaissance. | - Network Traffic (DS0003: Zeek HTTP)<br>- Proxy Logs | - **Splunk**: `index=network sourcetype=zeek_http header IN ("*X-Scan*", "*Custom-Scan*") \| stats count by src_ip, header \| where count > 10`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "HTTP" and AdditionalFields.Header has_any ("X-Scan", "Custom-Scan") \| summarize count() by DeviceIP, AdditionalFields.Header \| where count_ > 10`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE http.header : ("*X-Scan*" OR "*Custom-Scan*") \| STATS COUNT() BY source.ip, http.header HAVING COUNT() > 10`. |
| 7. Vulnerability Scanning in Linux Environments | Scanning targeting Linux services (e.g., SSH, Apache), as in Turla. | - Network Traffic (DS0003: Zeek Conn)<br>- Linux Logs | - **Splunk**: `index=linux sourcetype=auditd syscall="connect" AND dest_port IN (22,80,443) AND src_ip NOT IN (trusted_ips) \| stats count by src_ip, dest_port \| where count > 20`.<br>- **KQL**: `DeviceNetworkEvents \| where RemotePort in (22, 80, 443) and DeviceIP !in (trustedIPs) \| summarize count() by DeviceIP, RemotePort \| where count_ > 20`.<br>- **ELK**: `FROM logs-auditd-* \| WHERE syscall.name = "connect" AND destination.port IN [22, 80, 443] AND source.ip NOT IN ['trusted_ips'] \| STATS COUNT() BY source.ip, destination.port HAVING COUNT() > 20`. |
| 8. Vulnerability Scanning with Rapid Sequential IPs | Scanning targets sequential IPs for vulnerabilities, as in Volt Typhoon. | - Network Traffic (DS0003: Zeek Conn)<br>- Firewall Logs | - **Splunk**: `index=network sourcetype=zeek_conn dest_port IN (445,1433) \| stats count by src_ip, dest_ip \| where count > 50 AND max(dest_ip) - min(dest_ip) < 10`.<br>- **KQL**: `DeviceNetworkEvents \| where RemotePort in (445, 1433) \| summarize count(), max(RemoteIP), min(RemoteIP) by DeviceIP \| where count_ > 50 and (max_RemoteIP - min_RemoteIP) < 10`.<br>- **ELK**: `FROM logs-zeek.conn-* \| WHERE destination.port IN [445, 1433] \| STATS COUNT(), MAX(destination.ip), MIN(destination.ip) BY source.ip HAVING COUNT() > 50 AND (MAX(destination.ip) - MIN(destination.ip)) < 10`. |
| 9. Vulnerability Scanning with High Entropy Payloads | Scanning with high-entropy payloads, indicating exploit attempts, as in APT41. | - Network Traffic (DS0003: Zeek HTTP)<br>- Packet Analysis | - **Splunk**: `index=network sourcetype=zeek_http payload_entropy > 7 AND dest_port IN (80,443) \| stats count by src_ip, uri \| where count > 10`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "HTTP" and AdditionalFields.PayloadEntropy > 7 and RemotePort in (80, 443) \| summarize count() by DeviceIP, RemoteUrl \| where count_ > 10`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE http.payload.entropy > 7 AND destination.port IN [80, 443] \| STATS COUNT() BY source.ip, http.uri HAVING COUNT() > 10`. |
| 10. Vulnerability Scanning Targeting Internal Hosts | Internal hosts performing vulnerability scans, indicating compromise, as in FIN7. | - Network Traffic (DS0003: Zeek Conn)<br>- Endpoint Logs | - **Splunk**: `index=network sourcetype=zeek_conn src_ip IN (internal_ips) AND dest_port IN (445,1433) \| stats count by src_ip, dest_ip \| where count > 50`.<br>- **KQL**: `DeviceNetworkEvents \| where DeviceIP in (internalIPs) and RemotePort in (445, 1433) \| summarize count() by DeviceIP, RemoteIP \| where count_ > 50`.<br>- **ELK**: `FROM logs-zeek.conn-* \| WHERE source.ip IN ['internal_ips'] AND destination.port IN [445, 1433] \| STATS COUNT() BY source.ip, destination.ip HAVING COUNT() > 50`. |

### T1595.003: Wordlist Scanning

| Hypothesis | Description | Data Sources | Hunting Queries |
|-----------|-------------|--------------|-----------------|
| 1. Wordlist Scanning for Directory Enumeration | Adversaries use wordlist scanning to enumerate directories, as in Volt Typhoon. | - Network Traffic (DS0003: Zeek HTTP)<br>- Web Server Logs | - **Splunk**: `index=network sourcetype=zeek_http uri IN ("*admin*", "*login*", "*wp-admin*") AND status_code=404 \| stats count by src_ip, uri \| where count > 50`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "HTTP" and RemoteUrl has_any ("admin", "login", "wp-admin") and AdditionalFields.StatusCode == 404 \| summarize count() by DeviceIP, RemoteUrl \| where count_ > 50`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE http.uri : ("*admin*" OR "*login*" OR "*wp-admin*") AND http.status = 404 \| STATS COUNT() BY source.ip, http.uri HAVING COUNT() > 50`. |
| 2. Wordlist Scanning with Rapid Requests | High-frequency wordlist scanning, indicating automated tools, as in APT41. | - Network Traffic (DS0003: Zeek HTTP)<br>- Metrics | - **Splunk**: `index=network sourcetype=zeek_http \| timechart span=1m count by src_ip \| where count > 100`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "HTTP" \| summarize MinuteCount=count() by bin(Timestamp, 1m), DeviceIP \| where MinuteCount > 100`.<br>- **ELK**: `FROM logs-zeek.http-* \| STATS COUNT() BY date_histogram(@timestamp, '1m'), source.ip \| WHERE COUNT() > 100`. |
| 3. Wordlist Scanning Targeting Cloud Applications | Scanning cloud-hosted apps (e.g., S3 buckets), as in 2025 trends. | - Cloud Audit Logs (AWS CloudTrail)<br>- Network Traffic | - **Splunk**: `index=cloud sourcetype=aws:cloudtrail eventName="ListBuckets" AND src_ip NOT IN (trusted_ips) \| stats count by src_ip, eventName \| where count > 50`.<br>- **KQL**: `AWSCloudTrail \| where EventName == "ListBuckets" and SourceIP !in (trustedIPs) \| summarize count() by SourceIP, EventName \| where count_ > 50`.<br>- **ELK**: `FROM logs-aws.cloudtrail-* \| WHERE event.action = 'ListBuckets' AND source.ip NOT IN ['trusted_ips'] \| STATS COUNT() BY source.ip, event.action HAVING COUNT() > 50`. |
| 4. Wordlist Scanning with Suspicious User Agents | Wordlist scanning with non-standard user agents, as in Cobalt Strike. | - Network Traffic (DS0003: Zeek HTTP)<br>- Proxy Logs | - **Splunk**: `index=network sourcetype=zeek_http user_agent NOT IN (known_agents) AND uri IN ("*admin*", "*login*") \| stats count by src_ip, user_agent \| where count > 20`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "HTTP" and AdditionalFields.UserAgent !in (knownAgents) and RemoteUrl has_any ("admin", "login") \| summarize count() by DeviceIP, AdditionalFields.UserAgent \| where count_ > 20`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE http.user_agent NOT IN ['known_agents'] AND http.uri : ("*admin*" OR "*login*") \| STATS COUNT() BY source.ip, http.user_agent HAVING COUNT() > 20`. |
| 5. Wordlist Scanning from Compromised Endpoints | Compromised internal hosts perform wordlist scanning, as in FIN7. | - Process Creation (DS0009: Sysmon ID 1)<br>- Network Traffic | - **Splunk**: `index=endpoint sourcetype=sysmon EventCode=1 CommandLine IN ("*curl*", "*wget*") \| join host [search index=network sourcetype=zeek_http uri IN ("*admin*", "*login*")] \| stats count by host, CommandLine, uri \| where count > 10`.<br>- **KQL**: `DeviceProcessEvents \| where ProcessCommandLine has_any ("curl", "wget") \| join kind=inner (DeviceNetworkEvents \| where Protocol == "HTTP" and RemoteUrl has_any ("admin", "login")) on DeviceName \| summarize count() by DeviceName, ProcessCommandLine, RemoteUrl \| where count_ > 10`.<br>- **ELK**: `FROM logs-endpoint.process-* \| WHERE process.command_line : ("*curl*" OR "*wget*") \| JOIN logs-zeek.http-* ON host.name WHERE http.uri : ("*admin*" OR "*login*") \| STATS COUNT() BY host.name, process.command_line, http.uri HAVING COUNT() > 10`. |
| 6. Wordlist Scanning in Linux Environments | Wordlist scanning targeting Linux web servers, as in Turla. | - Network Traffic (DS0003: Zeek HTTP)<br>- Linux Logs | - **Splunk**: `index=linux sourcetype=auditd syscall="connect" AND dest_port IN (80,443) AND uri IN ("*admin*", "*login*") \| stats count by src_ip, uri \| where count > 20`.<br>- **KQL**: `DeviceNetworkEvents \| where RemotePort in (80, 443) and RemoteUrl has_any ("admin", "login") \| summarize count() by DeviceIP, RemoteUrl \| where count_ > 20`.<br>- **ELK**: `FROM logs-auditd-* \| WHERE syscall.name = "connect" AND destination.port IN [80, 443] AND http.uri : ("*admin*" OR "*login*") \| STATS COUNT() BY source.ip, http.uri HAVING COUNT() > 20`. |
| 7. Wordlist Scanning with High 404 Rates | Wordlist scanning generating high 404 errors, as in APT41. | - Network Traffic (DS0003: Zeek HTTP)<br>- Web Server Logs | - **Splunk**: `index=network sourcetype=zeek_http status_code=404 \| stats count by src_ip, uri \| where count > 50`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "HTTP" and AdditionalFields.StatusCode == 404 \| summarize count() by DeviceIP, RemoteUrl \| where count_ > 50`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE http.status = 404 \| STATS COUNT() BY source.ip, http.uri HAVING COUNT() > 50`. |
| 8. Wordlist Scanning with Sequential URIs | Scanning with sequential URI patterns, as in Volt Typhoon. | - Network Traffic (DS0003: Zeek HTTP)<br>- Web Server Logs | - **Splunk**: `index=network sourcetype=zeek_http uri IN ("*admin*", "*login*") \| stats count by src_ip, uri \| where count > 50 AND uri MATCHES "[0-9]"`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "HTTP" and RemoteUrl has_any ("admin", "login") \| summarize count() by DeviceIP, RemoteUrl \| where count_ > 50 and RemoteUrl matches regex "[0-9]"`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE http.uri : ("*admin*" OR "*login*") \| STATS COUNT() BY source.ip, http.uri HAVING COUNT() > 50 AND http.uri MATCHES '[0-9]'`. |
| 9. Wordlist Scanning Targeting CMS Platforms | Scanning targeting CMS platforms (e.g., WordPress), as in APT29. | - Network Traffic (DS0003: Zeek HTTP)<br>- Web Server Logs | - **Splunk**: `index=network sourcetype=zeek_http uri IN ("*wp-admin*", "*drupal*") AND status_code=404 \| stats count by src_ip, uri \| where count > 50`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "HTTP" and RemoteUrl has_any ("wp-admin", "drupal") and AdditionalFields.StatusCode == 404 \| summarize count() by DeviceIP, RemoteUrl \| where count_ > 50`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE http.uri : ("*wp-admin*" OR "*drupal*") AND http.status = 404 \| STATS COUNT() BY source.ip, http.uri HAVING COUNT() > 50`. |
| 10. Wordlist Scanning with Anomalous Timing | Wordlist scanning outside business hours, as in 2025 trends. | - Network Traffic (DS0003: Zeek HTTP)<br>- Metrics | - **Splunk**: `index=network sourcetype=zeek_http uri IN ("*admin*", "*login*") \| timechart span=1h count by src_ip \| where count > avg(count)*3 AND (_time < "08:00" OR _time > "18:00")`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "HTTP" and RemoteUrl has_any ("admin", "login") \| summarize HourlyCount=count() by bin(Timestamp, 1h), DeviceIP \| where HourlyCount > avg(HourlyCount) * 3 and (hour(Timestamp) < 8 or hour(Timestamp) > 18)`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE http.uri : ("*admin*" OR "*login*") \| STATS COUNT() BY date_histogram(@timestamp, '1h'), source.ip \| WHERE COUNT() > AVG(COUNT()) * 3 AND (HOUR(@timestamp) < 8 OR HOUR(@timestamp) > 18)`. |

### T1595.004: Visual Reconnaissance

| Hypothesis | Description | Data Sources | Hunting Queries |
|-----------|-------------|--------------|-----------------|
| 1. Visual Reconnaissance via Screenshot Tools | Adversaries use screenshot tools for visual reconnaissance, as in Volt Typhoon. | - Process Creation (DS0009: Sysmon ID 1)<br>- Endpoint Logs | - **Splunk**: `index=endpoint sourcetype=sysmon EventCode=1 CommandLine IN ("*msscreen*", "*snippingtool*") \| stats count by host, CommandLine \| where count > 5`.<br>- **KQL**: `DeviceProcessEvents \| where ProcessCommandLine has_any ("msscreen", "snippingtool") \| summarize count() by DeviceName, ProcessCommandLine \| where count_ > 5`.<br>- **ELK**: `FROM logs-endpoint.process-* \| WHERE process.command_line : ("*msscreen*" OR "*snippingtool*") \| STATS COUNT() BY host.name, process.command_line HAVING COUNT() > 5`. |
| 2. Visual Reconnaissance via Browser Automation | Adversaries use browser automation tools (e.g., Selenium) for visual reconnaissance, as in APT41. | - Process Creation (DS0009: Sysmon ID 1)<br>- Network Traffic | - **Splunk**: `index=endpoint sourcetype=sysmon EventCode=1 CommandLine IN ("*selenium*", "*puppeteer*") \| join host [search index=network sourcetype=zeek_http] \| stats count by host, CommandLine, uri \| where count > 10`.<br>- **KQL**: `DeviceProcessEvents \| where ProcessCommandLine has_any ("selenium", "puppeteer") \| join kind=inner (DeviceNetworkEvents \| where Protocol == "HTTP") on DeviceName \| summarize count() by DeviceName, ProcessCommandLine, RemoteUrl \| where count_ > 10`.<br>- **ELK**: `FROM logs-endpoint.process-* \| WHERE process.command_line : ("*selenium*" OR "*puppeteer*") \| JOIN logs-zeek.http-* ON host.name \| STATS COUNT() BY host.name, process.command_line, http.uri HAVING COUNT() > 10`. |
| 3. Visual Reconnaissance in Cloud Environments | Adversaries access cloud consoles for visual reconnaissance, as in 2025 trends. | - Cloud Audit Logs (AWS CloudTrail)<br>- Authentication Logs | - **Splunk**: `index=cloud sourcetype=aws:cloudtrail eventName="ConsoleLogin" AND userIdentity NOT IN (authorized_users) \| stats count by src_ip, userIdentity \| where count > 5`.<br>- **KQL**: `AWSCloudTrail \| where EventName == "ConsoleLogin" and Caller !in (authorizedUsers) \| summarize count() by SourceIP, Caller \| where count_ > 5`.<br>- **ELK**: `FROM logs-aws.cloudtrail-* \| WHERE event.action = 'ConsoleLogin' AND user.identity NOT IN ['authorized_users'] \| STATS COUNT() BY source.ip, user.identity HAVING COUNT() > 5`. |
| 4. Visual Reconnaissance via RDP Sessions | Adversaries use RDP for visual reconnaissance, as in FIN7. | - Network Traffic (DS0003: Zeek Conn)<br>- Windows Logs | - **Splunk**: `index=windows sourcetype=WinEventLog:Security EventCode=4624 AND LogonType=10 AND src_ip NOT IN (trusted_ips) \| stats count by src_ip, dest_host \| where count > 5`.<br>- **KQL**: `SecurityEvent \| where EventID == 4624 and LogonType == 10 and SourceIP !in (trustedIPs) \| summarize count() by SourceIP, TargetServerName \| where count_ > 5`.<br>- **ELK**: `FROM logs-windows.security-* \| WHERE event.code = '4624' AND winlog.logon.type = '10' AND source.ip NOT IN ['trusted_ips'] \| STATS COUNT() BY source.ip, winlog.event_data.TargetServerName HAVING COUNT() > 5`. |
| 5. Visual Reconnaissance via Screen Recording | Adversaries use screen recording tools, as in APT29. | - Process Creation (DS0009: Sysmon ID 1)<br>- Endpoint Logs | - **Splunk**: `index=endpoint sourcetype=sysmon EventCode=1 CommandLine IN ("*obs*", "*camtasia*") \| stats count by host, CommandLine \| where count > 5`.<br>- **KQL**: `DeviceProcessEvents \| where ProcessCommandLine has_any ("obs", "camtasia") \| summarize count() by DeviceName, ProcessCommandLine \| where count_ > 5`.<br>- **ELK**: `FROM logs-endpoint.process-* \| WHERE process.command_line : ("*obs*" OR "*camtasia*") \| STATS COUNT() BY host.name, process.command_line HAVING COUNT() > 5`. |
| 6. Visual Reconnaissance in Linux Environments | Adversaries use Linux screenshot tools (e.g., gnome-screenshot), as in Turla. | - Process Creation (Linux Auditd)<br>- Linux Logs | - **Splunk**: `index=linux sourcetype=auditd exe IN ("*gnome-screenshot*", "*scrot*") \| stats count by host, exe \| where count > 5`.<br>- **KQL**: `LinuxAuditd \| where ProcessName has_any ("gnome-screenshot", "scrot") \| summarize count() by HostName, ProcessName \| where count_ > 5`.<br>- **ELK**: `FROM logs-auditd-* \| WHERE process.exe : ("*gnome-screenshot*" OR "*scrot*") \| STATS COUNT() BY host.name, process.exe HAVING COUNT() > 5`. |
| 7. Visual Reconnaissance with Anomalous Timing | Visual reconnaissance outside business hours, as in 2025 trends. | - Process Creation (DS0009: Sysmon ID 1)<br>- Metrics | - **Splunk**: `index=endpoint sourcetype=sysmon EventCode=1 CommandLine IN ("*msscreen*", "*snippingtool*") \| timechart span=1h count by host \| where count > avg(count)*3 AND (_time < "08:00" OR _time > "18:00")`.<br>- **KQL**: `DeviceProcessEvents \| where ProcessCommandLine has_any ("msscreen", "snippingtool") \| summarize HourlyCount=count() by bin(Timestamp, 1h), DeviceName \| where HourlyCount > avg(HourlyCount) * 3 and (hour(Timestamp) < 8 or hour(Timestamp) > 18)`.<br>- **ELK**: `FROM logs-endpoint.process-* \| WHERE process.command_line : ("*msscreen*" OR "*snippingtool*") \| STATS COUNT() BY date_histogram(@timestamp, '1h'), host.name \| WHERE COUNT() > AVG(COUNT()) * 3 AND (HOUR(@timestamp) < 8 OR HOUR(@timestamp) > 18)`. |
| 8. Visual Reconnaissance via Web Scraping | Adversaries use web scraping tools for visual reconnaissance, as in APT41. | - Network Traffic (DS0003: Zeek HTTP)<br>- Proxy Logs | - **Splunk**: `index=network sourcetype=zeek_http user_agent IN ("*Scrapy*", "*BeautifulSoup*") \| stats count by src_ip, user_agent \| where count > 10`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "HTTP" and AdditionalFields.UserAgent has_any ("Scrapy", "BeautifulSoup") \| summarize count() by DeviceIP, AdditionalFields.UserAgent \| where count_ > 10`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE http.user_agent : ("*Scrapy*" OR "*BeautifulSoup*") \| STATS COUNT() BY source.ip, http.user_agent HAVING COUNT() > 10`. |
| 9. Visual Reconnaissance via Remote Access Tools | Adversaries use RATs for visual reconnaissance, as in Cobalt Strike. | - Process Creation (DS0009: Sysmon ID 1)<br>- Network Traffic | - **Splunk**: `index=endpoint sourcetype=sysmon EventCode=1 CommandLine IN ("*teamviewer*", "*anydesk*") \| join host [search index=network sourcetype=zeek_conn] \| stats count by host, CommandLine, dest_ip \| where count > 5`.<br>- **KQL**: `DeviceProcessEvents \| where ProcessCommandLine has_any ("teamviewer", "anydesk") \| join kind=inner (DeviceNetworkEvents) on DeviceName \| summarize count() by DeviceName, ProcessCommandLine, RemoteIP \| where count_ > 5`.<br>- **ELK**: `FROM logs-endpoint.process-* \| WHERE process.command_line : ("*teamviewer*" OR "*anydesk*") \| JOIN logs-zeek.conn-* ON host.name \| STATS COUNT() BY host.name, process.command_line, destination.ip HAVING COUNT() > 5`. |
| 10. Visual Reconnaissance with Suspicious Network Traffic | Visual reconnaissance generating suspicious network patterns, as in APT29. | - Network Traffic (DS0003: Zeek HTTP)<br>- Proxy Logs | - **Splunk**: `index=network sourcetype=zeek_http uri IN ("*screenshot*", "*capture*") \| stats count by src_ip, uri \| where count > 10`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "HTTP" and RemoteUrl has_any ("screenshot", "capture") \| summarize count() by DeviceIP, RemoteUrl \| where count_ > 10`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE http.uri : ("*screenshot*" OR "*capture*") \| STATS COUNT() BY source.ip, http.uri HAVING COUNT() > 10`. |

### T1592: Gather Victim Host Information
### T1592.001: Hardware

| Hypothesis | Description | Data Sources | Hunting Queries |
|-----------|-------------|--------------|-----------------|
| 1. Unauthorized Hardware Enumeration | Adversaries enumerate hardware details (e.g., CPU, memory) using tools like `systeminfo`, as in Volt Typhoon. High risk in environments with limited endpoint monitoring. | - Process Creation (DS0009: Sysmon ID 1)<br>- Windows Logs | - **Splunk**: `index=endpoint sourcetype=sysmon EventCode=1 CommandLine IN ("*systeminfo*", "*wmic bios*") \| stats count by host, CommandLine \| where count > 5`.<br>- **KQL**: `DeviceProcessEvents \| where ProcessCommandLine has_any ("systeminfo", "wmic bios") \| summarize count() by DeviceName, ProcessCommandLine \| where count_ > 5`.<br>- **ELK**: `FROM logs-endpoint.process-* \| WHERE process.command_line : ("*systeminfo*" OR "*wmic bios*") \| STATS COUNT() BY host.name, process.command_line HAVING COUNT() > 5`. |
| 2. Hardware Enumeration in Linux Environments | Adversaries use Linux commands (e.g., `lscpu`, `dmidecode`) for hardware reconnaissance, as in Turla. | - Process Creation (Linux Auditd)<br>- Linux Logs | - **Splunk**: `index=linux sourcetype=auditd exe IN ("*lscpu*", "*dmidecode*") \| stats count by host, exe \| where count > 5`.<br>- **KQL**: `LinuxAuditd \| where ProcessName has_any ("lscpu", "dmidecode") \| summarize count() by HostName, ProcessName \| where count_ > 5`.<br>- **ELK**: `FROM logs-auditd-* \| WHERE process.exe : ("*lscpu*" OR "*dmidecode*") \| STATS COUNT() BY host.name, process.exe HAVING COUNT() > 5`. |
| 3. Hardware Enumeration via Cloud APIs | Adversaries query cloud APIs for hardware details, as in 2025 cloud-focused attacks. | - Cloud Audit Logs (AWS CloudTrail)<br>- Network Traffic | - **Splunk**: `index=cloud sourcetype=aws:cloudtrail eventName IN ("DescribeInstanceTypes", "DescribeInstances") AND userIdentity NOT IN (authorized_users) \| stats count by src_ip, eventName \| where count > 10`.<br>- **KQL**: `AWSCloudTrail \| where EventName in ("DescribeInstanceTypes", "DescribeInstances") and Caller !in (authorizedUsers) \| summarize count() by SourceIP, EventName \| where count_ > 10`.<br>- **ELK**: `FROM logs-aws.cloudtrail-* \| WHERE event.action IN ['DescribeInstanceTypes', 'DescribeInstances'] AND user.identity NOT IN ['authorized_users'] \| STATS COUNT() BY source.ip, event.action HAVING COUNT() > 10`. |
| 4. Hardware Enumeration with Suspicious Timing | Hardware enumeration outside business hours, indicating reconnaissance, as in APT41. | - Process Creation (DS0009: Sysmon ID 1)<br>- Metrics | - **Splunk**: `index=endpoint sourcetype=sysmon EventCode=1 CommandLine IN ("*systeminfo*", "*wmic bios*") \| timechart span=1h count by host \| where count > avg(count)*3 AND (_time < "08:00" OR _time > "18:00")`.<br>- **KQL**: `DeviceProcessEvents \| where ProcessCommandLine has_any ("systeminfo", "wmic bios") \| summarize HourlyCount=count() by bin(Timestamp, 1h), DeviceName \| where HourlyCount > avg(HourlyCount) * 3 and (hour(Timestamp) < 8 or hour(Timestamp) > 18)`.<br>- **ELK**: `FROM logs-endpoint.process-* \| WHERE process.command_line : ("*systeminfo*" OR "*wmic bios*") \| STATS COUNT() BY date_histogram(@timestamp, '1h'), host.name \| WHERE COUNT() > AVG(COUNT()) * 3 AND (HOUR(@timestamp) < 8 OR HOUR(@timestamp) > 18)`. |
| 5. Hardware Enumeration from Compromised Endpoints | Compromised endpoints run hardware enumeration commands, as in FIN7. | - Process Creation (DS0009: Sysmon ID 1)<br>- Network Traffic | - **Splunk**: `index=endpoint sourcetype=sysmon EventCode=1 CommandLine IN ("*systeminfo*", "*wmic bios*") \| join host [search index=network sourcetype=zeek_conn] \| stats count by host, CommandLine, dest_ip \| where count > 5`.<br>- **KQL**: `DeviceProcessEvents \| where ProcessCommandLine has_any ("systeminfo", "wmic bios") \| join kind=inner (DeviceNetworkEvents) on DeviceName \| summarize count() by DeviceName, ProcessCommandLine, RemoteIP \| where count_ > 5`.<br>- **ELK**: `FROM logs-endpoint.process-* \| WHERE process.command_line : ("*systeminfo*" OR "*wmic bios*") \| JOIN logs-zeek.conn-* ON host.name \| STATS COUNT() BY host.name, process.command_line, destination.ip HAVING COUNT() > 5`. |
| 6. Hardware Enumeration via PowerShell | Adversaries use PowerShell for hardware enumeration, as in APT29. | - Process Creation (DS0009: Sysmon ID 1)<br>- Windows Logs | - **Splunk**: `index=endpoint sourcetype=sysmon EventCode=1 CommandLine IN ("*Get-WmiObject*", "*Win32_Processor*") \| stats count by host, CommandLine \| where count > 5`.<br>- **KQL**: `DeviceProcessEvents \| where ProcessCommandLine has_any ("Get-WmiObject", "Win32_Processor") \| summarize count() by DeviceName, ProcessCommandLine \| where count_ > 5`.<br>- **ELK**: `FROM logs-endpoint.process-* \| WHERE process.command_line : ("*Get-WmiObject*" OR "*Win32_Processor*") \| STATS COUNT() BY host.name, process.command_line HAVING COUNT() > 5`. |
| 7. Hardware Enumeration with Network Correlation | Hardware enumeration followed by suspicious network activity, as in Volt Typhoon. | - Process Creation (DS0009: Sysmon ID 1)<br>- Network Traffic | - **Splunk**: `index=endpoint sourcetype=sysmon EventCode=1 CommandLine IN ("*systeminfo*", "*wmic bios*") \| join host [search index=network sourcetype=zeek_http user_agent NOT IN (known_agents)] \| stats count by host, CommandLine, user_agent \| where count > 5`.<br>- **KQL**: `DeviceProcessEvents \| where ProcessCommandLine has_any ("systeminfo", "wmic bios") \| join kind=inner (DeviceNetworkEvents \| where Protocol == "HTTP" and AdditionalFields.UserAgent !in (knownAgents)) on DeviceName \| summarize count() by DeviceName, ProcessCommandLine, AdditionalFields.UserAgent \| where count_ > 5`.<br>- **ELK**: `FROM logs-endpoint.process-* \| WHERE process.command_line : ("*systeminfo*" OR "*wmic bios*") \| JOIN logs-zeek.http-* ON host.name WHERE http.user_agent NOT IN ['known_agents'] \| STATS COUNT() BY host.name, process.command_line, http.user_agent HAVING COUNT() > 5`. |
| 8. Hardware Enumeration in Cloud Instances | Adversaries enumerate cloud instance hardware, as in 2025 trends. | - Cloud Audit Logs (AWS CloudTrail)<br>- Endpoint Logs | - **Splunk**: `index=cloud sourcetype=aws:cloudtrail eventName="DescribeInstanceAttribute" AND userIdentity NOT IN (authorized_users) \| stats count by src_ip, userIdentity \| where count > 10`.<br>- **KQL**: `AWSCloudTrail \| where EventName == "DescribeInstanceAttribute" and Caller !in (authorizedUsers) \| summarize count() by SourceIP, Caller \| where count_ > 10`.<br>- **ELK**: `FROM logs-aws.cloudtrail-* \| WHERE event.action = 'DescribeInstanceAttribute' AND user.identity NOT IN ['authorized_users'] \| STATS COUNT() BY source.ip, user.identity HAVING COUNT() > 10`. |
| 9. Hardware Enumeration via Remote Access Tools | Adversaries use RATs to gather hardware info, as in Cobalt Strike. | - Process Creation (DS0009: Sysmon ID 1)<br>- Network Traffic | - **Splunk**: `index=endpoint sourcetype=sysmon EventCode=1 CommandLine IN ("*teamviewer*", "*anydesk*") \| join host [search index=network sourcetype=zeek_conn] \| stats count by host, CommandLine, dest_ip \| where count > 5`.<br>- **KQL**: `DeviceProcessEvents \| where ProcessCommandLine has_any ("teamviewer", "anydesk") \| join kind=inner (DeviceNetworkEvents) on DeviceName \| summarize count() by DeviceName, ProcessCommandLine, RemoteIP \| where count_ > 5`.<br>- **ELK**: `FROM logs-endpoint.process-* \| WHERE process.command_line : ("*teamviewer*" OR "*anydesk*") \| JOIN logs-zeek.conn-* ON host.name \| STATS COUNT() BY host.name, process.command_line, destination.ip HAVING COUNT() > 5`. |
| 10. Hardware Enumeration with High Frequency | High-frequency hardware enumeration, indicating automated reconnaissance, as in APT41. | - Process Creation (DS0009: Sysmon ID 1)<br>- Metrics | - **Splunk**: `index=endpoint sourcetype=sysmon EventCode=1 CommandLine IN ("*systeminfo*", "*wmic bios*") \| timechart span=1m count by host \| where count > 50`.<br>- **KQL**: `DeviceProcessEvents \| where ProcessCommandLine has_any ("systeminfo", "wmic bios") \| summarize MinuteCount=count() by bin(Timestamp, 1m), DeviceName \| where MinuteCount > 50`.<br>- **ELK**: `FROM logs-endpoint.process-* \| WHERE process.command_line : ("*systeminfo*" OR "*wmic bios*") \| STATS COUNT() BY date_histogram(@timestamp, '1m'), host.name \| WHERE COUNT() > 50`. |

### T1592.002: Software

| Hypothesis | Description | Data Sources | Hunting Queries |
|-----------|-------------|--------------|-----------------|
| 1. Unauthorized Software Enumeration | Adversaries enumerate installed software using `wmic product`, as in Volt Typhoon. | - Process Creation (DS0009: Sysmon ID 1)<br>- Windows Logs | - **Splunk**: `index=endpoint sourcetype=sysmon EventCode=1 CommandLine IN ("*wmic product*", "*Get-WmiObject Win32_Product*") \| stats count by host, CommandLine \| where count > 5`.<br>- **KQL**: `DeviceProcessEvents \| where ProcessCommandLine has_any ("wmic product", "Get-WmiObject Win32_Product") \| summarize count() by DeviceName, ProcessCommandLine \| where count_ > 5`.<br>- **ELK**: `FROM logs-endpoint.process-* \| WHERE process.command_line : ("*wmic product*" OR "*Get-WmiObject Win32_Product*") \| STATS COUNT() BY host.name, process.command_line HAVING COUNT() > 5`. |
| 2. Software Enumeration in Linux Environments | Adversaries use Linux commands (e.g., `dpkg`, `rpm`) for software reconnaissance, as in Turla. | - Process Creation (Linux Auditd)<br>- Linux Logs | - **Splunk**: `index=linux sourcetype=auditd exe IN ("*dpkg*", "*rpm*") \| stats count by host, exe \| where count > 5`.<br>- **KQL**: `LinuxAuditd \| where ProcessName has_any ("dpkg", "rpm") \| summarize count() by HostName, ProcessName \| where count_ > 5`.<br>- **ELK**: `FROM logs-auditd-* \| WHERE process.exe : ("*dpkg*" OR "*rpm*") \| STATS COUNT() BY host.name, process.exe HAVING COUNT() > 5`. |
| 3. Software Enumeration via Cloud APIs | Adversaries query cloud APIs for software details, as in 2025 cloud-focused attacks. | - Cloud Audit Logs (AWS CloudTrail)<br>- Network Traffic | - **Splunk**: `index=cloud sourcetype=aws:cloudtrail eventName IN ("DescribeImages", "DescribeInstanceAttribute") AND userIdentity NOT IN (authorized_users) \| stats count by src_ip, eventName \| where count > 10`.<br>- **KQL**: `AWSCloudTrail \| where EventName in ("DescribeImages", "DescribeInstanceAttribute") and Caller !in (authorizedUsers) \| summarize count() by SourceIP, EventName \| where count_ > 10`.<br>- **ELK**: `FROM logs-aws.cloudtrail-* \| WHERE event.action IN ['DescribeImages', 'DescribeInstanceAttribute'] AND user.identity NOT IN ['authorized_users'] \| STATS COUNT() BY source.ip, event.action HAVING COUNT() > 10`. |
| 4. Software Enumeration with Suspicious Timing | Software enumeration outside business hours, as in APT41. | - Process Creation (DS0009: Sysmon ID 1)<br>- Metrics | - **Splunk**: `index=endpoint sourcetype=sysmon EventCode=1 CommandLine IN ("*wmic product*", "*Get-WmiObject Win32_Product*") \| timechart span=1h count by host \| where count > avg(count)*3 AND (_time < "08:00" OR _time > "18:00")`.<br>- **KQL**: `DeviceProcessEvents \| where ProcessCommandLine has_any ("wmic product", "Get-WmiObject Win32_Product") \| summarize HourlyCount=count() by bin(Timestamp, 1h), DeviceName \| where HourlyCount > avg(HourlyCount) * 3 and (hour(Timestamp) < 8 or hour(Timestamp) > 18)`.<br>- **ELK**: `FROM logs-endpoint.process-* \| WHERE process.command_line : ("*wmic product*" OR "*Get-WmiObject Win32_Product*") \| STATS COUNT() BY date_histogram(@timestamp, '1h'), host.name \| WHERE COUNT() > AVG(COUNT()) * 3 AND (HOUR(@timestamp) < 8 OR HOUR(@timestamp) > 18)`. |
| 5. Software Enumeration from Compromised Endpoints | Compromised endpoints run software enumeration commands, as in FIN7. | - Process Creation (DS0009: Sysmon ID 1)<br>- Network Traffic | - **Splunk**: `index=endpoint sourcetype=sysmon EventCode=1 CommandLine IN ("*wmic product*", "*Get-WmiObject Win32_Product*") \| join host [search index=network sourcetype=zeek_conn] \| stats count by host, CommandLine, dest_ip \| where count > 5`.<br>- **KQL**: `DeviceProcessEvents \| where ProcessCommandLine has_any ("wmic product", "Get-WmiObject Win32_Product") \| join kind=inner (DeviceNetworkEvents) on DeviceName \| summarize count() by DeviceName, ProcessCommandLine, RemoteIP \| where count_ > 5`.<br>- **ELK**: `FROM logs-endpoint.process-* \| WHERE process.command_line : ("*wmic product*" OR "*Get-WmiObject Win32_Product*") \| JOIN logs-zeek.conn-* ON host.name \| STATS COUNT() BY host.name, process.command_line, destination.ip HAVING COUNT() > 5`. |
| 6. Software Enumeration via PowerShell | Adversaries use PowerShell for software enumeration, as in APT29. | - Process Creation (DS0009: Sysmon ID 1)<br>- Windows Logs | - **Splunk**: `index=endpoint sourcetype=sysmon EventCode=1 CommandLine IN ("*Get-WmiObject Win32_Product*", "*Get-ItemProperty*") \| stats count by host, CommandLine \| where count > 5`.<br>- **KQL**: `DeviceProcessEvents \| where ProcessCommandLine has_any ("Get-WmiObject Win32_Product", "Get-ItemProperty") \| summarize count() by DeviceName, ProcessCommandLine \| where count_ > 5`.<br>- **ELK**: `FROM logs-endpoint.process-* \| WHERE process.command_line : ("*Get-WmiObject Win32_Product*" OR "*Get-ItemProperty*") \| STATS COUNT() BY host.name, process.command_line HAVING COUNT() > 5`. |
| 7. Software Enumeration with Network Correlation | Software enumeration followed by suspicious network activity, as in Volt Typhoon. | - Process Creation (DS0009: Sysmon ID 1)<br>- Network Traffic | - **Splunk**: `index=endpoint sourcetype=sysmon EventCode=1 CommandLine IN ("*wmic product*", "*Get-WmiObject Win32_Product*") \| join host [search index=network sourcetype=zeek_http user_agent NOT IN (known_agents)] \| stats count by host, CommandLine, user_agent \| where count > 5`.<br>- **KQL**: `DeviceProcessEvents \| where ProcessCommandLine has_any ("wmic product", "Get-WmiObject Win32_Product") \| join kind=inner (DeviceNetworkEvents \| where Protocol == "HTTP" and AdditionalFields.UserAgent !in (knownAgents)) on DeviceName \| summarize count() by DeviceName, ProcessCommandLine, AdditionalFields.UserAgent \| where count_ > 5`.<br>- **ELK**: `FROM logs-endpoint.process-* \| WHERE process.command_line : ("*wmic product*" OR "*Get-WmiObject Win32_Product*") \| JOIN logs-zeek.http-* ON host.name WHERE http.user_agent NOT IN ['known_agents'] \| STATS COUNT() BY host.name, process.command_line, http.user_agent HAVING COUNT() > 5`. |
| 8. Software Enumeration in Cloud Instances | Adversaries enumerate software in cloud instances, as in 2025 trends. | - Cloud Audit Logs (AWS CloudTrail)<br>- Endpoint Logs | - **Splunk**: `index=cloud sourcetype=aws:cloudtrail eventName="DescribeImages" AND userIdentity NOT IN (authorized_users) \| stats count by src_ip, userIdentity \| where count > 10`.<br>- **KQL**: `AWSCloudTrail \| where EventName == "DescribeImages" and Caller !in (authorizedUsers) \| summarize count() by SourceIP, Caller \| where count_ > 10`.<br>- **ELK**: `FROM logs-aws.cloudtrail-* \| WHERE event.action = 'DescribeImages' AND user.identity NOT IN ['authorized_users'] \| STATS COUNT() BY source.ip, user.identity HAVING COUNT() > 10`. |
| 9. Software Enumeration via Remote Access Tools | Adversaries use RATs to gather software info, as in Cobalt Strike. | - Process Creation (DS0009: Sysmon ID 1)<br>- Network Traffic | - **Splunk**: `index=endpoint sourcetype=sysmon EventCode=1 CommandLine IN ("*teamviewer*", "*anydesk*") \| join host [search index=network sourcetype=zeek_conn] \| stats count by host, CommandLine, dest_ip \| where count > 5`.<br>- **KQL**: `DeviceProcessEvents \| where ProcessCommandLine has_any ("teamviewer", "anydesk") \| join kind=inner (DeviceNetworkEvents) on DeviceName \| summarize count() by DeviceName, ProcessCommandLine, RemoteIP \| where count_ > 5`.<br>- **ELK**: `FROM logs-endpoint.process-* \| WHERE process.command_line : ("*teamviewer*" OR "*anydesk*") \| JOIN logs-zeek.conn-* ON host.name \| STATS COUNT() BY host.name, process.command_line, destination.ip HAVING COUNT() > 5`. |
| 10. Software Enumeration with High Frequency | High-frequency software enumeration, indicating automated reconnaissance, as in APT41. | - Process Creation (DS0009: Sysmon ID 1)<br>- Metrics | - **Splunk**: `index=endpoint sourcetype=sysmon EventCode=1 CommandLine IN ("*wmic product*", "*Get-WmiObject Win32_Product*") \| timechart span=1m count by host \| where count > 50`.<br>- **KQL**: `DeviceProcessEvents \| where ProcessCommandLine has_any ("wmic product", "Get-WmiObject Win32_Product") \| summarize MinuteCount=count() by bin(Timestamp, 1m), DeviceName \| where MinuteCount > 50`.<br>- **ELK**: `FROM logs-endpoint.process-* \| WHERE process.command_line : ("*wmic product*" OR "*Get-WmiObject Win32_Product*") \| STATS COUNT() BY date_histogram(@timestamp, '1m'), host.name \| WHERE COUNT() > 50`. |

### T1592.003: Firmware

| Hypothesis | Description | Data Sources | Hunting Queries |
|-----------|-------------|--------------|-----------------|
| 1. Unauthorized Firmware Enumeration | Adversaries enumerate firmware details using `wmic bios`, as in Volt Typhoon. | - Process Creation (DS0009: Sysmon ID 1)<br>- Windows Logs | - **Splunk**: `index=endpoint sourcetype=sysmon EventCode=1 CommandLine IN ("*wmic bios*", "*Get-WmiObject Win32_BIOS*") \| stats count by host, CommandLine \| where count > 5`.<br>- **KQL**: `DeviceProcessEvents \| where ProcessCommandLine has_any ("wmic bios", "Get-WmiObject Win32_BIOS") \| summarize count() by DeviceName, ProcessCommandLine \| where count_ > 5`.<br>- **ELK**: `FROM logs-endpoint.process-* \| WHERE process.command_line : ("*wmic bios*" OR "*Get-WmiObject Win32_BIOS*") \| STATS COUNT() BY host.name, process.command_line HAVING COUNT() > 5`. |
| 2. Firmware Enumeration in Linux Environments | Adversaries use Linux commands (e.g., `dmidecode`) for firmware reconnaissance, as in Turla. | - Process Creation (Linux Auditd)<br>- Linux Logs | - **Splunk**: `index=linux sourcetype=auditd exe IN ("*dmidecode*") \| stats count by host, exe \| where count > 5`.<br>- **KQL**: `LinuxAuditd \| where ProcessName has_any ("dmidecode") \| summarize count() by HostName, ProcessName \| where count_ > 5`.<br>- **ELK**: `FROM logs-auditd-* \| WHERE process.exe : ("*dmidecode*") \| STATS COUNT() BY host.name, process.exe HAVING COUNT() > 5`. |
| 3. Firmware Enumeration via Cloud APIs | Adversaries query cloud APIs for firmware details, as in 2025 trends. | - Cloud Audit Logs (AWS CloudTrail)<br>- Network Traffic | - **Splunk**: `index=cloud sourcetype=aws:cloudtrail eventName="DescribeInstanceAttribute" AND userIdentity NOT IN (authorized_users) \| stats count by src_ip, userIdentity \| where count > 10`.<br>- **KQL**: `AWSCloudTrail \| where EventName == "DescribeInstanceAttribute" and Caller !in (authorizedUsers) \| summarize count() by SourceIP, Caller \| where count_ > 10`.<br>- **ELK**: `FROM logs-aws.cloudtrail-* \| WHERE event.action = 'DescribeInstanceAttribute' AND user.identity NOT IN ['authorized_users'] \| STATS COUNT() BY source.ip, user.identity HAVING COUNT() > 10`. |
| 4. Firmware Enumeration with Suspicious Timing | Firmware enumeration outside business hours, as in APT41. | - Process Creation (DS0009: Sysmon ID 1)<br>- Metrics | - **Splunk**: `index=endpoint sourcetype=sysmon EventCode=1 CommandLine IN ("*wmic bios*", "*Get-WmiObject Win32_BIOS*") \| timechart span=1h count by host \| where count > avg(count)*3 AND (_time < "08:00" OR _time > "18:00")`.<br>- **KQL**: `DeviceProcessEvents \| where ProcessCommandLine has_any ("wmic bios", "Get-WmiObject Win32_BIOS") \| summarize HourlyCount=count() by bin(Timestamp, 1h), DeviceName \| where HourlyCount > avg(HourlyCount) * 3 and (hour(Timestamp) < 8 or hour(Timestamp) > 18)`.<br>- **ELK**: `FROM logs-endpoint.process-* \| WHERE process.command_line : ("*wmic bios*" OR "*Get-WmiObject Win32_BIOS*") \| STATS COUNT() BY date_histogram(@timestamp, '1h'), host.name \| WHERE COUNT() > AVG(COUNT()) * 3 AND (HOUR(@timestamp) < 8 OR HOUR(@timestamp) > 18)`. |
| 5. Firmware Enumeration from Compromised Endpoints | Compromised endpoints run firmware enumeration commands, as in FIN7. | - Process Creation (DS0009: Sysmon ID 1)<br>- Network Traffic | - **Splunk**: `index=endpoint sourcetype=sysmon EventCode=1 CommandLine IN ("*wmic bios*", "*Get-WmiObject Win32_BIOS*") \| join host [search index=network sourcetype=zeek_conn] \| stats count by host, CommandLine, dest_ip \| where count > 5`.<br>- **KQL**: `DeviceProcessEvents \| where ProcessCommandLine has_any ("wmic bios", "Get-WmiObject Win32_BIOS") \| join kind=inner (DeviceNetworkEvents) on DeviceName \| summarize count() by DeviceName, ProcessCommandLine, RemoteIP \| where count_ > 5`.<br>- **ELK**: `FROM logs-endpoint.process-* \| WHERE process.command_line : ("*wmic bios*" OR "*Get-WmiObject Win32_BIOS*") \| JOIN logs-zeek.conn-* ON host.name \| STATS COUNT() BY host.name, process.command_line, destination.ip HAVING COUNT() > 5`. |
| 6. Firmware Enumeration via PowerShell | Adversaries use PowerShell for firmware enumeration, as in APT29. | - Process Creation (DS0009: Sysmon ID 1)<br>- Windows Logs | - **Splunk**: `index=endpoint sourcetype=sysmon EventCode=1 CommandLine IN ("*Get-WmiObject Win32_BIOS*", "*Get-CimInstance Win32_BIOS*") \| stats count by host, CommandLine \| where count > 5`.<br>- **KQL**: `DeviceProcessEvents \| where ProcessCommandLine has_any ("Get-WmiObject Win32_BIOS", "Get-CimInstance Win32_BIOS") \| summarize count() by DeviceName, ProcessCommandLine \| where count_ > 5`.<br>- **ELK**: `FROM logs-endpoint.process-* \| WHERE process.command_line : ("*Get-WmiObject Win32_BIOS*" OR "*Get-CimInstance Win32_BIOS*") \| STATS COUNT() BY host.name, process.command_line HAVING COUNT() > 5`. |
| 7. Firmware Enumeration with Network Correlation | Firmware enumeration followed by suspicious network activity, as in Volt Typhoon. | - Process Creation (DS0009: Sysmon ID 1)<br>- Network Traffic | - **Splunk**: `index=endpoint sourcetype=sysmon EventCode=1 CommandLine IN ("*wmic bios*", "*Get-WmiObject Win32_BIOS*") \| join host [search index=network sourcetype=zeek_http user_agent NOT IN (known_agents)] \| stats count by host, CommandLine, user_agent \| where count > 5`.<br>- **KQL**: `DeviceProcessEvents \| where ProcessCommandLine has_any ("wmic bios", "Get-WmiObject Win32_BIOS") \| join kind=inner (DeviceNetworkEvents \| where Protocol == "HTTP" and AdditionalFields.UserAgent !in (knownAgents)) on DeviceName \| summarize count() by DeviceName, ProcessCommandLine, AdditionalFields.UserAgent \| where count_ > 5`.<br>- **ELK**: `FROM logs-endpoint.process-* \| WHERE process.command_line : ("*wmic bios*" OR "*Get-WmiObject Win32_BIOS*") \| JOIN logs-zeek.http-* ON host.name WHERE http.user_agent NOT IN ['known_agents'] \| STATS COUNT() BY host.name, process.command_line, http.user_agent HAVING COUNT() > 5`. |
| 8. Firmware Enumeration in Cloud Instances | Adversaries enumerate firmware in cloud instances, as in 2025 trends. | - Cloud Audit Logs (AWS CloudTrail)<br>- Endpoint Logs | - **Splunk**: `index=cloud sourcetype=aws:cloudtrail eventName="DescribeInstanceAttribute" AND userIdentity NOT IN (authorized_users) \| stats count by src_ip, userIdentity \| where count > 10`.<br>- **KQL**: `AWSCloudTrail \| where EventName == "DescribeInstanceAttribute" and Caller !in (authorizedUsers) \| summarize count() by SourceIP, Caller \| where count_ > 10`.<br>- **ELK**: `FROM logs-aws.cloudtrail-* \| WHERE event.action = 'DescribeInstanceAttribute' AND user.identity NOT IN ['authorized_users'] \| STATS COUNT() BY source.ip, user.identity HAVING COUNT() > 10`. |
| 9. Firmware Enumeration via Remote Access Tools | Adversaries use RATs to gather firmware info, as in Cobalt Strike. | - Process Creation (DS0009: Sysmon ID 1)<br>- Network Traffic | - **Splunk**: `index=endpoint sourcetype=sysmon EventCode=1 CommandLine IN ("*teamviewer*", "*anydesk*") \| join host [search index=network sourcetype=zeek_conn] \| stats count by host, CommandLine, dest_ip \| where count > 5`.<br>- **KQL**: `DeviceProcessEvents \| where ProcessCommandLine has_any ("teamviewer", "anydesk") \| join kind=inner (DeviceNetworkEvents) on DeviceName \| summarize count() by DeviceName, ProcessCommandLine, RemoteIP \| where count_ > 5`.<br>- **ELK**: `FROM logs-endpoint.process-* \| WHERE process.command_line : ("*teamviewer*" OR "*anydesk*") \| JOIN logs-zeek.conn-* ON host.name \| STATS COUNT() BY host.name, process.command_line, destination.ip HAVING COUNT() > 5`. |
| 10. Firmware Enumeration with High Frequency | High-frequency firmware enumeration, indicating automated reconnaissance, as in APT41. | - Process Creation (DS0009: Sysmon ID 1)<br>- Metrics | - **Splunk**: `index=endpoint sourcetype=sysmon EventCode=1 CommandLine IN ("*wmic bios*", "*Get-WmiObject Win32_BIOS*") \| timechart span=1m count by host \| where count > 50`.<br>- **KQL**: `DeviceProcessEvents \| where ProcessCommandLine has_any ("wmic bios", "Get-WmiObject Win32_BIOS") \| summarize MinuteCount=count() by bin(Timestamp, 1m), DeviceName \| where MinuteCount > 50`.<br>- **ELK**: `FROM logs-endpoint.process-* \| WHERE process.command_line : ("*wmic bios*" OR "*Get-WmiObject Win32_BIOS*") \| STATS COUNT() BY date_histogram(@timestamp, '1m'), host.name \| WHERE COUNT() > 50`. |

### T1592.004: Client Configurations

| Hypothesis | Description | Data Sources | Hunting Queries |
|-----------|-------------|--------------|-----------------|
| 1. Unauthorized Client Configuration Enumeration | Adversaries enumerate client configurations using `systeminfo` or `net config`, as in Volt Typhoon. | - Process Creation (DS0009: Sysmon ID 1)<br>- Windows Logs | - **Splunk**: `index=endpoint sourcetype=sysmon EventCode=1 CommandLine IN ("*systeminfo*", "*net config*") \| stats count by host, CommandLine \| where count > 5`.<br>- **KQL**: `DeviceProcessEvents \| where ProcessCommandLine has_any ("systeminfo", "net config") \| summarize count() by DeviceName, ProcessCommandLine \| where count_ > 5`.<br>- **ELK**: `FROM logs-endpoint.process-* \| WHERE process.command_line : ("*systeminfo*" OR "*net config*") \| STATS COUNT() BY host.name, process.command_line HAVING COUNT() > 5`. |
| 2. Client Configuration Enumeration in Linux Environments | Adversaries use Linux commands (e.g., `uname`, `ifconfig`) for configuration reconnaissance, as in Turla. | - Process Creation (Linux Auditd)<br>- Linux Logs | - **Splunk**: `index=linux sourcetype=auditd exe IN ("*uname*", "*ifconfig*") \| stats count by host, exe \| where count > 5`.<br>- **KQL**: `LinuxAuditd \| where ProcessName has_any ("uname", "ifconfig") \| summarize count() by HostName, ProcessName \| where count_ > 5`.<br>- **ELK**: `FROM logs-auditd-* \| WHERE process.exe : ("*uname*" OR "*ifconfig*") \| STATS COUNT() BY host.name, process.exe HAVING COUNT() > 5`. |
| 3. Client Configuration Enumeration via Cloud APIs | Adversaries query cloud APIs for client configurations, as in 2025 cloud-focused attacks. | - Cloud Audit Logs (AWS CloudTrail)<br>- Network Traffic | - **Splunk**: `index=cloud sourcetype=aws:cloudtrail eventName IN ("DescribeInstanceAttribute", "DescribeNetworkInterfaces") AND userIdentity NOT IN (authorized_users) \| stats count by src_ip, eventName \| where count > 10`.<br>- **KQL**: `AWSCloudTrail \| where EventName in ("DescribeInstanceAttribute", "DescribeNetworkInterfaces") and Caller !in (authorizedUsers) \| summarize count() by SourceIP, EventName \| where count_ > 10`.<br>- **ELK**: `FROM logs-aws.cloudtrail-* \| WHERE event.action IN ['DescribeInstanceAttribute', 'DescribeNetworkInterfaces'] AND user.identity NOT IN ['authorized_users'] \| STATS COUNT() BY source.ip, event.action HAVING COUNT() > 10`. |
| 4. Client Configuration Enumeration with Suspicious Timing | Client configuration enumeration outside business hours, as in APT41. | - Process Creation (DS0009: Sysmon ID 1)<br>- Metrics | - **Splunk**: `index=endpoint sourcetype=sysmon EventCode=1 CommandLine IN ("*systeminfo*", "*net config*") \| timechart span=1h count by host \| where count > avg(count)*3 AND (_time < "08:00" OR _time > "18:00")`.<br>- **KQL**: `DeviceProcessEvents \| where ProcessCommandLine has_any ("systeminfo", "net config") \| summarize HourlyCount=count() by bin(Timestamp, 1h), DeviceName \| where HourlyCount > avg(HourlyCount) * 3 and (hour(Timestamp) < 8 or hour(Timestamp) > 18)`.<br>- **ELK**: `FROM logs-endpoint.process-* \| WHERE process.command_line : ("*systeminfo*" OR "*net config*") \| STATS COUNT() BY date_histogram(@timestamp, '1h'), host.name \| WHERE COUNT() > AVG(COUNT()) * 3 AND (HOUR(@timestamp) < 8 OR HOUR(@timestamp) > 18)`. |
| 5. Client Configuration Enumeration from Compromised Endpoints | Compromised endpoints run configuration enumeration commands, as in FIN7. | - Process Creation (DS0009: Sysmon ID 1)<br>- Network Traffic | - **Splunk**: `index=endpoint sourcetype=sysmon EventCode=1 CommandLine IN ("*systeminfo*", "*net config*") \| join host [search index=network sourcetype=zeek_conn] \| stats count by host, CommandLine, dest_ip \| where count > 5`.<br>- **KQL**: `DeviceProcessEvents \| where ProcessCommandLine has_any ("systeminfo", "net config") \| join kind=inner (DeviceNetworkEvents) on DeviceName \| summarize count() by DeviceName, ProcessCommandLine, RemoteIP \| where count_ > 5`.<br>- **ELK**: `FROM logs-endpoint.process-* \| WHERE process.command_line : ("*systeminfo*" OR "*net config*") \| JOIN logs-zeek.conn-* ON host.name \| STATS COUNT() BY host.name, process.command_line, destination.ip HAVING COUNT() > 5`. |
| 6. Client Configuration Enumeration via PowerShell | Adversaries use PowerShell for client configuration enumeration, as in APT29. | - Process Creation (DS0009: Sysmon ID 1)<br>- Windows Logs | - **Splunk**: `index=endpoint sourcetype=sysmon EventCode=1 CommandLine IN ("*Get-WmiObject Win32_OperatingSystem*", "*Get-NetAdapter*") \| stats count by host, CommandLine \| where count > 5`.<br>- **KQL**: `DeviceProcessEvents \| where ProcessCommandLine has_any ("Get-WmiObject Win32_OperatingSystem", "Get-NetAdapter") \| summarize count() by DeviceName, ProcessCommandLine \| where count_ > 5`.<br>- **ELK**: `FROM logs-endpoint.process-* \| WHERE process.command_line : ("*Get-WmiObject Win32_OperatingSystem*" OR "*Get-NetAdapter*") \| STATS COUNT() BY host.name, process.command_line HAVING COUNT() > 5`. |
| 7. Client Configuration Enumeration with Network Correlation | Client configuration enumeration followed by suspicious network activity, as in Volt Typhoon. | - Process Creation (DS0009: Sysmon ID 1)<br>- Network Traffic | - **Splunk**: `index=endpoint sourcetype=sysmon EventCode=1 CommandLine IN ("*systeminfo*", "*net config*") \| join host [search index=network sourcetype=zeek_http user_agent NOT IN (known_agents)] \| stats count by host, CommandLine, user_agent \| where count > 5`.<br>- **KQL**: `DeviceProcessEvents \| where ProcessCommandLine has_any ("systeminfo", "net config") \| join kind=inner (DeviceNetworkEvents \| where Protocol == "HTTP" and AdditionalFields.UserAgent !in (knownAgents)) on DeviceName \| summarize count() by DeviceName, ProcessCommandLine, AdditionalFields.UserAgent \| where count_ > 5`.<br>- **ELK**: `FROM logs-endpoint.process-* \| WHERE process.command_line : ("*systeminfo*" OR "*net config*") \| JOIN logs-zeek.http-* ON host.name WHERE http.user_agent NOT IN ['known_agents'] \| STATS COUNT() BY host.name, process.command_line, http.user_agent HAVING COUNT() > 5`. |
| 8. Client Configuration Enumeration in Cloud Instances | Adversaries enumerate client configurations in cloud instances, as in 2025 trends. | - Cloud Audit Logs (AWS CloudTrail)<br>- Endpoint Logs | - **Splunk**: `index=cloud sourcetype=aws:cloudtrail eventName IN ("DescribeInstanceAttribute", "DescribeNetworkInterfaces") AND userIdentity NOT IN (authorized_users) \| stats count by src_ip, userIdentity \| where count > 10`.<br>- **KQL**: `AWSCloudTrail \| where EventName in ("DescribeInstanceAttribute", "DescribeNetworkInterfaces") and Caller !in (authorizedUsers) \| summarize count() by SourceIP, Caller \| where count_ > 10`.<br>- **ELK**: `FROM logs-aws.cloudtrail-* \| WHERE event.action IN ['DescribeInstanceAttribute', 'DescribeNetworkInterfaces'] AND user.identity NOT IN ['authorized_users'] \| STATS COUNT() BY source.ip, user.identity HAVING COUNT() > 10`. |
| 9. Client Configuration Enumeration via Remote Access Tools | Adversaries use RATs to gather client configuration info, as in Cobalt Strike. | - Process Creation (DS0009: Sysmon ID 1)<br>- Network Traffic | - **Splunk**: `index=endpoint sourcetype=sysmon EventCode=1 CommandLine IN ("*teamviewer*", "*anydesk*") \| join host [search index=network sourcetype=zeek_conn] \| stats count by host, CommandLine, dest_ip \| where count > 5`.<br>- **KQL**: `DeviceProcessEvents \| where ProcessCommandLine has_any ("teamviewer", "anydesk") \| join kind=inner (DeviceNetworkEvents) on DeviceName \| summarize count() by DeviceName, ProcessCommandLine, RemoteIP \| where count_ > 5`.<br>- **ELK**: `FROM logs-endpoint.process-* \| WHERE process.command_line : ("*teamviewer*" OR "*anydesk*") \| JOIN logs-zeek.conn-* ON host.name \| STATS COUNT() BY host.name, process.command_line, destination.ip HAVING COUNT() > 5`. |
| 10. Client Configuration Enumeration with High Frequency | High-frequency client configuration enumeration, indicating automated reconnaissance, as in APT41. | - Process Creation (DS0009: Sysmon ID 1)<br>- Metrics | - **Splunk**: `index=endpoint sourcetype=sysmon EventCode=1 CommandLine IN ("*systeminfo*", "*net config*") \| timechart span=1m count by host \| where count > 50`.<br>- **KQL**: `DeviceProcessEvents \| where ProcessCommandLine has_any ("systeminfo", "net config") \| summarize MinuteCount=count() by bin(Timestamp, 1m), DeviceName \| where MinuteCount > 50`.<br>- **ELK**: `FROM logs-endpoint.process-* \| WHERE process.command_line : ("*systeminfo*" OR "*net config*") \| STATS COUNT() BY date_histogram(@timestamp, '1m'), host.name \| WHERE COUNT() > 50`. |

### T1589: Gather Victim Identity Information

### T1589.001: Credentials

| Hypothesis | Description | Data Sources | Hunting Queries |
|-----------|-------------|--------------|-----------------|
| 1. Credential Harvesting via Phishing | Adversaries use phishing emails to harvest credentials, as in Volt Typhoon campaigns. | - Email Logs (DS0004)<br>- Network Traffic (DS0003: Zeek HTTP) | - **Splunk**: `index=email sourcetype=email_logs subject IN ("*password reset*", "*urgent login*") AND attachment IN ("*.exe", "*.js") \| stats count by src_ip, recipient \| where count > 5`.<br>- **KQL**: `EmailEvents \| where EmailSubject has_any ("password reset", "urgent login") and AttachmentName has_any (".exe", ".js") \| summarize count() by SenderIP, RecipientEmailAddress \| where count_ > 5`.<br>- **ELK**: `FROM logs-email-* \| WHERE email.subject : ("*password reset*" OR "*urgent login*") AND email.attachment : ("*.exe" OR "*.js") \| STATS COUNT() BY source.ip, email.recipient HAVING COUNT() > 5`. |
| 2. Credential Dumping via Mimikatz | Adversaries use Mimikatz or similar tools to dump credentials, as in APT41. | - Process Creation (DS0009: Sysmon ID 1)<br>- Windows Logs | - **Splunk**: `index=endpoint sourcetype=sysmon EventCode=1 CommandLine IN ("*mimikatz*", "*sekurlsa*") \| stats count by host, CommandLine \| where count > 1`.<br>- **KQL**: `DeviceProcessEvents \| where ProcessCommandLine has_any ("mimikatz", "sekurlsa") \| summarize count() by DeviceName, ProcessCommandLine \| where count_ > 1`.<br>- **ELK**: `FROM logs-endpoint.process-* \| WHERE process.command_line : ("*mimikatz*" OR "*sekurlsa*") \| STATS COUNT() BY host.name, process.command_line HAVING COUNT() > 1`. |
| 3. Credential Harvesting via Keylogging | Adversaries deploy keyloggers to capture credentials, as in FIN7. | - Process Creation (DS0009: Sysmon ID 1)<br>- Endpoint Logs | - **Splunk**: `index=endpoint sourcetype=sysmon EventCode=1 CommandLine IN ("*keylogger*", "*logkeys*") \| stats count by host, CommandLine \| where count > 1`.<br>- **KQL**: `DeviceProcessEvents \| where ProcessCommandLine has_any ("keylogger", "logkeys") \| summarize count() by DeviceName, ProcessCommandLine \| where count_ > 1`.<br>- **ELK**: `FROM logs-endpoint.process-* \| WHERE process.command_line : ("*keylogger*" OR "*logkeys*") \| STATS COUNT() BY host.name, process.command_line HAVING COUNT() > 1`. |
| 4. Credential Harvesting via Cloud Console Access | Adversaries access cloud consoles to steal credentials, as in 2025 cloud-focused attacks. | - Cloud Audit Logs (AWS CloudTrail)<br>- Authentication Logs | - **Splunk**: `index=cloud sourcetype=aws:cloudtrail eventName="ConsoleLogin" AND userIdentity NOT IN (authorized_users) \| stats count by src_ip, userIdentity \| where count > 5`.<br>- **KQL**: `AWSCloudTrail \| where EventName == "ConsoleLogin" and Caller !in (authorizedUsers) \| summarize count() by SourceIP, Caller \| where count_ > 5`.<br>- **ELK**: `FROM logs-aws.cloudtrail-* \| WHERE event.action = 'ConsoleLogin' AND user.identity NOT IN ['authorized_users'] \| STATS COUNT() BY source.ip, user.identity HAVING COUNT() > 5`. |
| 5. Credential Harvesting via Suspicious PowerShell | Adversaries use PowerShell to harvest credentials, as in APT29. | - Process Creation (DS0009: Sysmon ID 1)<br>- Windows Logs | - **Splunk**: `index=endpoint sourcetype=sysmon EventCode=1 CommandLine IN ("*Get-Credential*", "*Invoke-Mimikatz*") \| stats count by host, CommandLine \| where count > 1`.<br>- **KQL**: `DeviceProcessEvents \| where ProcessCommandLine has_any ("Get-Credential", "Invoke-Mimikatz") \| summarize count() by DeviceName, ProcessCommandLine \| where count_ > 1`.<br>- **ELK**: `FROM logs-endpoint.process-* \| WHERE process.command_line : ("*Get-Credential*" OR "*Invoke-Mimikatz*") \| STATS COUNT() BY host.name, process.command_line HAVING COUNT() > 1`. |
| 6. Credential Harvesting in Linux Environments | Adversaries attempt to access credential files (e.g., `/etc/shadow`), as in Turla. | - Process Creation (Linux Auditd)<br>- Linux Logs | - **Splunk**: `index=linux sourcetype=auditd exe IN ("*cat /etc/shadow*", "*getent passwd*") \| stats count by host, exe \| where count > 1`.<br>- **KQL**: `LinuxAuditd \| where ProcessName has_any ("cat /etc/shadow", "getent passwd") \| summarize count() by HostName, ProcessName \| where count_ > 1`.<br>- **ELK**: `FROM logs-auditd-* \| WHERE process.exe : ("*cat /etc/shadow*" OR "*getent passwd*") \| STATS COUNT() BY host.name, process.exe HAVING COUNT() > 1`. |
| 7. Credential Harvesting with Network Correlation | Credential harvesting followed by suspicious network activity, as in Volt Typhoon. | - Process Creation (DS0009: Sysmon ID 1)<br>- Network Traffic (DS0003: Zeek HTTP) | - **Splunk**: `index=endpoint sourcetype=sysmon EventCode=1 CommandLine IN ("*mimikatz*", "*sekurlsa*") \| join host [search index=network sourcetype=zeek_http user_agent NOT IN (known_agents)] \| stats count by host, CommandLine, user_agent \| where count > 1`.<br>- **KQL**: `DeviceProcessEvents \| where ProcessCommandLine has_any ("mimikatz", "sekurlsa") \| join kind=inner (DeviceNetworkEvents \| where Protocol == "HTTP" and AdditionalFields.UserAgent !in (knownAgents)) on DeviceName \| summarize count() by DeviceName, ProcessCommandLine, AdditionalFields.UserAgent \| where count_ > 1`.<br>- **ELK**: `FROM logs-endpoint.process-* \| WHERE process.command_line : ("*mimikatz*" OR "*sekurlsa*") \| JOIN logs-zeek.http-* ON host.name WHERE http.user_agent NOT IN ['known_agents'] \| STATS COUNT() BY host.name, process.command_line, http.user_agent HAVING COUNT() > 1`. |
| 8. Credential Harvesting via Browser Data | Adversaries steal credentials from browser storage, as in Cobalt Strike. | - Process Creation (DS0009: Sysmon ID 1)<br>- Endpoint Logs | - **Splunk**: `index=endpoint sourcetype=sysmon EventCode=1 CommandLine IN ("*chrome --dump*", "*firefox --profile*") \| stats count by host, CommandLine \| where count > 1`.<br>- **KQL**: `DeviceProcessEvents \| where ProcessCommandLine has_any ("chrome --dump", "firefox --profile") \| summarize count() by DeviceName, ProcessCommandLine \| where count_ > 1`.<br>- **ELK**: `FROM logs-endpoint.process-* \| WHERE process.command_line : ("*chrome --dump*" OR "*firefox --profile*") \| STATS COUNT() BY host.name, process.command_line HAVING COUNT() > 1`. |
| 9. Credential Harvesting with Anomalous Timing | Credential harvesting outside business hours, as in 2025 trends. | - Process Creation (DS0009: Sysmon ID 1)<br>- Metrics | - **Splunk**: `index=endpoint sourcetype=sysmon EventCode=1 CommandLine IN ("*mimikatz*", "*sekurlsa*") \| timechart span=1h count by host \| where count > avg(count)*3 AND (_time < "08:00" OR _time > "18:00")`.<br>- **KQL**: `DeviceProcessEvents \| where ProcessCommandLine has_any ("mimikatz", "sekurlsa") \| summarize HourlyCount=count() by bin(Timestamp, 1h), DeviceName \| where HourlyCount > avg(HourlyCount) * 3 and (hour(Timestamp) < 8 or hour(Timestamp) > 18)`.<br>- **ELK**: `FROM logs-endpoint.process-* \| WHERE process.command_line : ("*mimikatz*" OR "*sekurlsa*") \| STATS COUNT() BY date_histogram(@timestamp, '1h'), host.name \| WHERE COUNT() > AVG(COUNT()) * 3 AND (HOUR(@timestamp) < 8 OR HOUR(@timestamp) > 18)`. |
| 10. Credential Harvesting via Remote Access Tools | Adversaries use RATs to steal credentials, as in FIN7. | - Process Creation (DS0009: Sysmon ID 1)<br>- Network Traffic (DS0003: Zeek Conn) | - **Splunk**: `index=endpoint sourcetype=sysmon EventCode=1 CommandLine IN ("*teamviewer*", "*anydesk*") \| join host [search index=network sourcetype=zeek_conn] \| stats count by host, CommandLine, dest_ip \| where count > 5`.<br>- **KQL**: `DeviceProcessEvents \| where ProcessCommandLine has_any ("teamviewer", "anydesk") \| join kind=inner (DeviceNetworkEvents) on DeviceName \| summarize count() by DeviceName, ProcessCommandLine, RemoteIP \| where count_ > 5`.<br>- **ELK**: `FROM logs-endpoint.process-* \| WHERE process.command_line : ("*teamviewer*" OR "*anydesk*") \| JOIN logs-zeek.conn-* ON host.name \| STATS COUNT() BY host.name, process.command_line, destination.ip HAVING COUNT() > 5`. |

### T1589.002: Email Addresses

| Hypothesis | Description | Data Sources | Hunting Queries |
|-----------|-------------|--------------|-----------------|
| 1. Email Address Harvesting via Phishing Campaigns | Adversaries send phishing emails to collect email addresses, as in Volt Typhoon. | - Email Logs (DS0004)<br>- Network Traffic (DS0003: Zeek HTTP) | - **Splunk**: `index=email sourcetype=email_logs subject IN ("*verify email*", "*update account*") AND src_ip NOT IN (trusted_ips) \| stats count by src_ip, recipient \| where count > 10`.<br>- **KQL**: `EmailEvents \| where EmailSubject has_any ("verify email", "update account") and SenderIP !in (trustedIPs) \| summarize count() by SenderIP, RecipientEmailAddress \| where count_ > 10`.<br>- **ELK**: `FROM logs-email-* \| WHERE email.subject : ("*verify email*" OR "*update account*") AND source.ip NOT IN ['trusted_ips'] \| STATS COUNT() BY source.ip, email.recipient HAVING COUNT() > 10`. |
| 2. Email Address Harvesting via Web Scraping | Adversaries use web scraping tools to collect email addresses, as in APT41. | - Network Traffic (DS0003: Zeek HTTP)<br>- Proxy Logs | - **Splunk**: `index=network sourcetype=zeek_http user_agent IN ("*Scrapy*", "*BeautifulSoup*") AND uri IN ("*contact*", "*about*") \| stats count by src_ip, user_agent, uri \| where count > 10`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "HTTP" and AdditionalFields.UserAgent has_any ("Scrapy", "BeautifulSoup") and RemoteUrl has_any ("contact", "about") \| summarize count() by DeviceIP, AdditionalFields.UserAgent, RemoteUrl \| where count_ > 10`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE http.user_agent : ("*Scrapy*" OR "*BeautifulSoup*") AND http.uri : ("*contact*" OR "*about*") \| STATS COUNT() BY source.ip, http.user_agent, http.uri HAVING COUNT() > 10`. |
| 3. Email Address Harvesting via Cloud APIs | Adversaries query cloud APIs to collect email addresses, as in 2025 trends. | - Cloud Audit Logs (AWS CloudTrail)<br>- Authentication Logs | - **Splunk**: `index=cloud sourcetype=aws:cloudtrail eventName IN ("ListUsers", "GetUser") AND userIdentity NOT IN (authorized_users) \| stats count by src_ip, userIdentity \| where count > 10`.<br>- **KQL**: `AWSCloudTrail \| where EventName in ("ListUsers", "GetUser") and Caller !in (authorizedUsers) \| summarize count() by SourceIP, Caller \| where count_ > 10`.<br>- **ELK**: `FROM logs-aws.cloudtrail-* \| WHERE event.action IN ['ListUsers', 'GetUser'] AND user.identity NOT IN ['authorized_users'] \| STATS COUNT() BY source.ip, user.identity HAVING COUNT() > 10`. |
| 4. Email Address Harvesting with Suspicious Timing | Email address harvesting outside business hours, as in APT29. | - Email Logs (DS0004)<br>- Metrics | - **Splunk**: `index=email sourcetype=email_logs subject IN ("*verify email*", "*update account*") \| timechart span=1h count by src_ip \| where count > avg(count)*3 AND (_time < "08:00" OR _time > "18:00")`.<br>- **KQL**: `EmailEvents \| where EmailSubject has_any ("verify email", "update account") \| summarize HourlyCount=count() by bin(Timestamp, 1h), SenderIP \| where HourlyCount > avg(HourlyCount) * 3 and (hour(Timestamp) < 8 or hour(Timestamp) > 18)`.<br>- **ELK**: `FROM logs-email-* \| WHERE email.subject : ("*verify email*" OR "*update account*") \| STATS COUNT() BY date_histogram(@timestamp, '1h'), source.ip \| WHERE COUNT() > AVG(COUNT()) * 3 AND (HOUR(@timestamp) < 8 OR HOUR(@timestamp) > 18)`. |
| 5. Email Address Harvesting via Compromised Endpoints | Compromised endpoints collect email addresses, as in FIN7. | - Process Creation (DS0009: Sysmon ID 1)<br>- Network Traffic (DS0003: Zeek HTTP) | - **Splunk**: `index=endpoint sourcetype=sysmon EventCode=1 CommandLine IN ("*curl*", "*wget*") \| join host [search index=network sourcetype=zeek_http uri IN ("*contact*", "*about*")] \| stats count by host, CommandLine, uri \| where count > 5`.<br>- **KQL**: `DeviceProcessEvents \| where ProcessCommandLine has_any ("curl", "wget") \| join kind=inner (DeviceNetworkEvents \| where Protocol == "HTTP" and RemoteUrl has_any ("contact", "about")) on DeviceName \| summarize count() by DeviceName, ProcessCommandLine, RemoteUrl \| where count_ > 5`.<br>- **ELK**: `FROM logs-endpoint.process-* \| WHERE process.command_line : ("*curl*" OR "*wget*") \| JOIN logs-zeek.http-* ON host.name WHERE http.uri : ("*contact*" OR "*about*") \| STATS COUNT() BY host.name, process.command_line, http.uri HAVING COUNT() > 5`. |
| 6. Email Address Harvesting via Browser Automation | Adversaries use browser automation tools (e.g., Selenium) to harvest email addresses, as in Cobalt Strike. | - Process Creation (DS0009: Sysmon ID 1)<br>- Network Traffic (DS0003: Zeek HTTP) | - **Splunk**: `index=endpoint sourcetype=sysmon EventCode=1 CommandLine IN ("*selenium*", "*puppeteer*") \| join host [search index=network sourcetype=zeek_http uri IN ("*contact*", "*about*")] \| stats count by host, CommandLine, uri \| where count > 5`.<br>- **KQL**: `DeviceProcessEvents \| where ProcessCommandLine has_any ("selenium", "puppeteer") \| join kind=inner (DeviceNetworkEvents \| where Protocol == "HTTP" and RemoteUrl has_any ("contact", "about")) on DeviceName \| summarize count() by DeviceName, ProcessCommandLine, RemoteUrl \| where count_ > 5`.<br>- **ELK**: `FROM logs-endpoint.process-* \| WHERE process.command_line : ("*selenium*" OR "*puppeteer*") \| JOIN logs-zeek.http-* ON host.name WHERE http.uri : ("*contact*" OR "*about*") \| STATS COUNT() BY host.name, process.command_line, http.uri HAVING COUNT() > 5`. |
| 7. Email Address Harvesting in Linux Environments | Adversaries access email-related files (e.g., `/etc/mail/*`), as in Turla. | - Process Creation (Linux Auditd)<br>- Linux Logs | - **Splunk**: `index=linux sourcetype=auditd exe IN ("*cat /etc/mail/*", "*grep @*") \| stats count by host, exe \| where count > 1`.<br>- **KQL**: `LinuxAuditd \| where ProcessName has_any ("cat /etc/mail", "grep @") \| summarize count() by HostName, ProcessName \| where count_ > 1`.<br>- **ELK**: `FROM logs-auditd-* \| WHERE process.exe : ("*cat /etc/mail/*" OR "*grep @*") \| STATS COUNT() BY host.name, process.exe HAVING COUNT() > 1`. |
| 8. Email Address Harvesting via Social Engineering | Adversaries use social engineering to collect email addresses, as in 2025 trends. | - Email Logs (DS0004)<br>- Network Traffic (DS0003: Zeek HTTP) | - **Splunk**: `index=email sourcetype=email_logs subject IN ("*survey*", "*feedback*") AND src_ip NOT IN (trusted_ips) \| stats count by src_ip, recipient \| where count > 10`.<br>- **KQL**: `EmailEvents \| where EmailSubject has_any ("survey", "feedback") and SenderIP !in (trustedIPs) \| summarize count() by SenderIP, RecipientEmailAddress \| where count_ > 10`.<br>- **ELK**: `FROM logs-email-* \| WHERE email.subject : ("*survey*" OR "*feedback*") AND source.ip NOT IN ['trusted_ips'] \| STATS COUNT() BY source.ip, email.recipient HAVING COUNT() > 10`. |
| 9. Email Address Harvesting with High Frequency | High-frequency email address harvesting, indicating automated reconnaissance, as in APT41. | - Email Logs (DS0004)<br>- Metrics | - **Splunk**: `index=email sourcetype=email_logs subject IN ("*verify email*", "*update account*") \| timechart span=1m count by src_ip \| where count > 50`.<br>- **KQL**: `EmailEvents \| where EmailSubject has_any ("verify email", "update account") \| summarize MinuteCount=count() by bin(Timestamp, 1m), SenderIP \| where MinuteCount > 50`.<br>- **ELK**: `FROM logs-email-* \| WHERE email.subject : ("*verify email*" OR "*update account*") \| STATS COUNT() BY date_histogram(@timestamp, '1m'), source.ip \| WHERE COUNT() > 50`. |
| 10. Email Address Harvesting via Remote Access Tools | Adversaries use RATs to collect email addresses, as in FIN7. | - Process Creation (DS0009: Sysmon ID 1)<br>- Network Traffic (DS0003: Zeek Conn) | - **Splunk**: `index=endpoint sourcetype=sysmon EventCode=1 CommandLine IN ("*teamviewer*", "*anydesk*") \| join host [search index=network sourcetype=zeek_conn] \| stats count by host, CommandLine, dest_ip \| where count > 5`.<br>- **KQL**: `DeviceProcessEvents \| where ProcessCommandLine has_any ("teamviewer", "anydesk") \| join kind=inner (DeviceNetworkEvents) on DeviceName \| summarize count() by DeviceName, ProcessCommandLine, RemoteIP \| where count_ > 5`.<br>- **ELK**: `FROM logs-endpoint.process-* \| WHERE process.command_line : ("*teamviewer*" OR "*anydesk*") \| JOIN logs-zeek.conn-* ON host.name \| STATS COUNT() BY host.name, process.command_line, destination.ip HAVING COUNT() > 5`. |

### T1589.003: Employee Names

| Hypothesis | Description | Data Sources | Hunting Queries |
|-----------|-------------|--------------|-----------------|
| 1. Employee Name Harvesting via Phishing | Adversaries use phishing emails to collect employee names, as in Volt Typhoon. | - Email Logs (DS0004)<br>- Network Traffic (DS0003: Zeek HTTP) | - **Splunk**: `index=email sourcetype=email_logs subject IN ("*employee survey*", "*HR update*") AND src_ip NOT IN (trusted_ips) \| stats count by src_ip, recipient \| where count > 10`.<br>- **KQL**: `EmailEvents \| where EmailSubject has_any ("employee survey", "HR update") and SenderIP !in (trustedIPs) \| summarize count() by SenderIP, RecipientEmailAddress \| where count_ > 10`.<br>- **ELK**: `FROM logs-email-* \| WHERE email.subject : ("*employee survey*" OR "*HR update*") AND source.ip NOT IN ['trusted_ips'] \| STATS COUNT() BY source.ip, email.recipient HAVING COUNT() > 10`. |
| 2. Employee Name Harvesting via Web Scraping | Adversaries scrape websites for employee names, as in APT41. | - Network Traffic (DS0003: Zeek HTTP)<br>- Proxy Logs | - **Splunk**: `index=network sourcetype=zeek_http uri IN ("*team*", "*staff*", "*directory*") AND user_agent IN ("*Scrapy*", "*BeautifulSoup*") \| stats count by src_ip, uri, user_agent \| where count > 10`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "HTTP" and RemoteUrl has_any ("team", "staff", "directory") and AdditionalFields.UserAgent has_any ("Scrapy", "BeautifulSoup") \| summarize count() by DeviceIP, RemoteUrl, AdditionalFields.UserAgent \| where count_ > 10`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE http.uri : ("*team*" OR "*staff*" OR "*directory*") AND http.user_agent : ("*Scrapy*" OR "*BeautifulSoup*") \| STATS COUNT() BY source.ip, http.uri, http.user_agent HAVING COUNT() > 10`. |
| 3. Employee Name Harvesting via Cloud APIs | Adversaries query cloud APIs for employee names, as in 2025 trends. | - Cloud Audit Logs (AWS CloudTrail)<br>- Authentication Logs | - **Splunk**: `index=cloud sourcetype=aws:cloudtrail eventName IN ("ListUsers", "GetUser") AND userIdentity NOT IN (authorized_users) \| stats count by src_ip, userIdentity \| where count > 10`.<br>- **KQL**: `AWSCloudTrail \| where EventName in ("ListUsers", "GetUser") and Caller !in (authorizedUsers) \| summarize count() by SourceIP, Caller \| where count_ > 10`.<br>- **ELK**: `FROM logs-aws.cloudtrail-* \| WHERE event.action IN ['ListUsers', 'GetUser'] AND user.identity NOT IN ['authorized_users'] \| STATS COUNT() BY source.ip, user.identity HAVING COUNT() > 10`. |
| 4. Employee Name Harvesting with Suspicious Timing | Employee name harvesting outside business hours, as in APT29. | - Email Logs (DS0004)<br>- Metrics | - **Splunk**: `index=email sourcetype=email_logs subject IN ("*employee survey*", "*HR update*") \| timechart span=1h count by src_ip \| where count > avg(count)*3 AND (_time < "08:00" OR _time > "18:00")`.<br>- **KQL**: `EmailEvents \| where EmailSubject has_any ("employee survey", "HR update") \| summarize HourlyCount=count() by bin(Timestamp, 1h), SenderIP \| where HourlyCount > avg(HourlyCount) * 3 and (hour(Timestamp) < 8 or hour(Timestamp) > 18)`.<br>- **ELK**: `FROM logs-email-* \| WHERE email.subject : ("*employee survey*" OR "*HR update*") \| STATS COUNT() BY date_histogram(@timestamp, '1h'), source.ip \| WHERE COUNT() > AVG(COUNT()) * 3 AND (HOUR(@timestamp) < 8 OR HOUR(@timestamp) > 18)`. |
| 5. Employee Name Harvesting via Compromised Endpoints | Compromised endpoints collect employee names, as in FIN7. | - Process Creation (DS0009: Sysmon ID 1)<br>- Network Traffic (DS0003: Zeek HTTP) | - **Splunk**: `index=endpoint sourcetype=sysmon EventCode=1 CommandLine IN ("*curl*", "*wget*") \| join host [search index=network sourcetype=zeek_http uri IN ("*team*", "*staff*")] \| stats count by host, CommandLine, uri \| where count > 5`.<br>- **KQL**: `DeviceProcessEvents \| where ProcessCommandLine has_any ("curl", "wget") \| join kind=inner (DeviceNetworkEvents \| where Protocol == "HTTP" and RemoteUrl has_any ("team", "staff")) on DeviceName \| summarize count() by DeviceName, ProcessCommandLine, RemoteUrl \| where count_ > 5`.<br>- **ELK**: `FROM logs-endpoint.process-* \| WHERE process.command_line : ("*curl*" OR "*wget*") \| JOIN logs-zeek.http-* ON host.name WHERE http.uri : ("*team*" OR "*staff*") \| STATS COUNT() BY host.name, process.command_line, http.uri HAVING COUNT() > 5`. |
| 6. Employee Name Harvesting via Browser Automation | Adversaries use browser automation tools to harvest employee names, as in Cobalt Strike. | - Process Creation (DS0009: Sysmon ID 1)<br>- Network Traffic (DS0003: Zeek HTTP) | - **Splunk**: `index=endpoint sourcetype=sysmon EventCode=1 CommandLine IN ("*selenium*", "*puppeteer*") \| join host [search index=network sourcetype=zeek_http uri IN ("*team*", "*staff*")] \| stats count by host, CommandLine, uri \| where count > 5`.<br>- **KQL**: `DeviceProcessEvents \| where ProcessCommandLine has_any ("selenium", "puppeteer") \| join kind=inner (DeviceNetworkEvents \| where Protocol == "HTTP" and RemoteUrl has_any ("team", "staff")) on DeviceName \| summarize count() by DeviceName, ProcessCommandLine, RemoteUrl \| where count_ > 5`.<br>- **ELK**: `FROM logs-endpoint.process-* \| WHERE process.command_line : ("*selenium*" OR "*puppeteer*") \| JOIN logs-zeek.http-* ON host.name WHERE http.uri : ("*team*" OR "*staff*") \| STATS COUNT() BY host.name, process.command_line, http.uri HAVING COUNT() > 5`. |
| 7. Employee Name Harvesting in Linux Environments | Adversaries access employee-related files (e.g., `/etc/passwd`), as in Turla. | - Process Creation (Linux Auditd)<br>- Linux Logs | - **Splunk**: `index=linux sourcetype=auditd exe IN ("*cat /etc/passwd*", "*getent passwd*") \| stats count by host, exe \| where count > 1`.<br>- **KQL**: `LinuxAuditd \| where ProcessName has_any ("cat /etc/passwd", "getent passwd") \| summarize count() by HostName, ProcessName \| where count_ > 1`.<br>- **ELK**: `FROM logs-auditd-* \| WHERE process.exe : ("*cat /etc/passwd*" OR "*getent passwd*") \| STATS COUNT() BY host.name, process.exe HAVING COUNT() > 1`. |
| 8. Employee Name Harvesting via Social Engineering | Adversaries use social engineering to collect employee names, as in 2025 trends. | - Email Logs (DS0004)<br>- Network Traffic (DS0003: Zeek HTTP) | - **Splunk**: `index=email sourcetype=email_logs subject IN ("*employee directory*", "*team update*") AND src_ip NOT IN (trusted_ips) \| stats count by src_ip, recipient \| where count > 10`.<br>- **KQL**: `EmailEvents \| where EmailSubject has_any ("employee directory", "team update") and SenderIP !in (trustedIPs) \| summarize count() by SenderIP, RecipientEmailAddress \| where count_ > 10`.<br>- **ELK**: `FROM logs-email-* \| WHERE email.subject : ("*employee directory*" OR "*team update*") AND source.ip NOT IN ['trusted_ips'] \| STATS COUNT() BY source.ip, email.recipient HAVING COUNT() > 10`. |
| 9. Employee Name Harvesting with High Frequency | High-frequency employee name harvesting, indicating automated reconnaissance, as in APT41. | - Email Logs (DS0004)<br>- Metrics | - **Splunk**: `index=email sourcetype=email_logs subject IN ("*employee survey*", "*HR update*") \| timechart span=1m count by src_ip \| where count > 50`.<br>- **KQL**: `EmailEvents \| where EmailSubject has_any ("employee survey", "HR update") \| summarize MinuteCount=count() by bin(Timestamp, 1m), SenderIP \| where MinuteCount > 50`.<br>- **ELK**: `FROM logs-email-* \| WHERE email.subject : ("*employee survey*" OR "*HR update*") \| STATS COUNT() BY date_histogram(@timestamp, '1m'), source.ip \| WHERE COUNT() > 50`. |
| 10. Employee Name Harvesting via Remote Access Tools | Adversaries use RATs to collect employee names, as in FIN7. | - Process Creation (DS0009: Sysmon ID 1)<br>- Network Traffic (DS0003: Zeek Conn) | - **Splunk**: `index=endpoint sourcetype=sysmon EventCode=1 CommandLine IN ("*teamviewer*", "*anydesk*") \| join host [search index=network sourcetype=zeek_conn] \| stats count by host, CommandLine, dest_ip \| where count > 5`.<br>- **KQL**: `DeviceProcessEvents \| where ProcessCommandLine has_any ("teamviewer", "anydesk") \| join kind=inner (DeviceNetworkEvents) on DeviceName \| summarize count() by DeviceName, ProcessCommandLine, RemoteIP \| where count_ > 5`.<br>- **ELK**: `FROM logs-endpoint.process-* \| WHERE process.command_line : ("*teamviewer*" OR "*anydesk*") \| JOIN logs-zeek.conn-* ON host.name \| STATS COUNT() BY host.name, process.command_line, destination.ip HAVING COUNT() > 5`. |


### T1590: Gather Victim Network Information

### T1590.001: Domain Properties

| Hypothesis | Description | Data Sources | Hunting Queries |
|-----------|-------------|--------------|-----------------|
| 1. Unauthorized WHOIS Queries for Domain Properties | Adversaries perform WHOIS lookups to gather domain registration details, as in Volt Typhoon. High risk in environments with public-facing domains. | - Network Traffic (DS0003: Zeek DNS)<br>- Proxy Logs | - **Splunk**: `index=network sourcetype=zeek_dns query_type="TXT" AND query IN ("*.whois.*", "*.registrar.*") \| stats count by src_ip, query \| where count > 10`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "DNS" and AdditionalFields.QueryType == "TXT" and AdditionalFields.Query has_any (".whois.", ".registrar.") \| summarize count() by DeviceIP, AdditionalFields.Query \| where count_ > 10`.<br>- **ELK**: `FROM logs-zeek.dns-* \| WHERE dns.query.type = "TXT" AND dns.query : ("*.whois.*" OR "*.registrar.*") \| STATS COUNT() BY source.ip, dns.query HAVING COUNT() > 10`. |
| 2. Domain Property Enumeration via Suspicious User Agents | Adversaries use non-standard user agents to scrape domain details, as in APT41. | - Network Traffic (DS0003: Zeek HTTP)<br>- Proxy Logs | - **Splunk**: `index=network sourcetype=zeek_http user_agent NOT IN (known_agents) AND uri IN ("*whois*", "*domain*") \| stats count by src_ip, user_agent, uri \| where count > 10`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "HTTP" and AdditionalFields.UserAgent !in (knownAgents) and RemoteUrl has_any ("whois", "domain") \| summarize count() by DeviceIP, AdditionalFields.UserAgent, RemoteUrl \| where count_ > 10`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE http.user_agent NOT IN ['known_agents'] AND http.uri : ("*whois*" OR "*domain*") \| STATS COUNT() BY source.ip, http.user_agent, http.uri HAVING COUNT() > 10`. |
| 3. Domain Property Enumeration in Cloud Environments | Adversaries query cloud APIs for domain details, as in 2025 cloud-focused attacks. | - Cloud Audit Logs (AWS CloudTrail)<br>- Network Traffic | - **Splunk**: `index=cloud sourcetype=aws:cloudtrail eventName IN ("DescribeDomains", "ListDomains") AND userIdentity NOT IN (authorized_users) \| stats count by src_ip, eventName \| where count > 10`.<br>- **KQL**: `AWSCloudTrail \| where EventName in ("DescribeDomains", "ListDomains") and Caller !in (authorizedUsers) \| summarize count() by SourceIP, EventName \| where count_ > 10`.<br>- **ELK**: `FROM logs-aws.cloudtrail-* \| WHERE event.action IN ['DescribeDomains', 'ListDomains'] AND user.identity NOT IN ['authorized_users'] \| STATS COUNT() BY source.ip, event.action HAVING COUNT() > 10`. |
| 4. Domain Property Enumeration with Anomalous Timing | Domain enumeration outside business hours, indicating reconnaissance, as in APT29. | - Network Traffic (DS0003: Zeek DNS)<br>- Metrics | - **Splunk**: `index=network sourcetype=zeek_dns query_type="TXT" AND query IN ("*.whois.*") \| timechart span=1h count by src_ip \| where count > avg(count)*3 AND (_time < "08:00" OR _time > "18:00")`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "DNS" and AdditionalFields.QueryType == "TXT" and AdditionalFields.Query has_any (".whois.") \| summarize HourlyCount=count() by bin(Timestamp, 1h), DeviceIP \| where HourlyCount > avg(HourlyCount) * 3 and (hour(Timestamp) < 8 or hour(Timestamp) > 18)`.<br>- **ELK**: `FROM logs-zeek.dns-* \| WHERE dns.query.type = "TXT" AND dns.query : ("*.whois.*") \| STATS COUNT() BY date_histogram(@timestamp, '1h'), source.ip \| WHERE COUNT() > AVG(COUNT()) * 3 AND (HOUR(@timestamp) < 8 OR HOUR(@timestamp) > 18)`. |
| 5. Domain Property Enumeration from Compromised Endpoints | Compromised internal hosts perform WHOIS queries, as in FIN7. | - Process Creation (DS0009: Sysmon ID 1)<br>- Network Traffic (DS0003: Zeek DNS) | - **Splunk**: `index=endpoint sourcetype=sysmon EventCode=1 CommandLine IN ("*whois*", "*nslookup*") \| join host [search index=network sourcetype=zeek_dns query IN ("*.whois.*")] \| stats count by host, CommandLine, query \| where count > 5`.<br>- **KQL**: `DeviceProcessEvents \| where ProcessCommandLine has_any ("whois", "nslookup") \| join kind=inner (DeviceNetworkEvents \| where Protocol == "DNS" and AdditionalFields.Query has_any (".whois.")) on DeviceName \| summarize count() by DeviceName, ProcessCommandLine, AdditionalFields.Query \| where count_ > 5`.<br>- **ELK**: `FROM logs-endpoint.process-* \| WHERE process.command_line : ("*whois*" OR "*nslookup*") \| JOIN logs-zeek.dns-* ON host.name WHERE dns.query : ("*.whois.*") \| STATS COUNT() BY host.name, process.command_line, dns.query HAVING COUNT() > 5`. |
| 6. Domain Property Enumeration in Linux Environments | Adversaries use Linux tools (e.g., `whois`, `dig`) for domain reconnaissance, as in Turla. | - Process Creation (Linux Auditd)<br>- Network Traffic (DS0003: Zeek DNS) | - **Splunk**: `index=linux sourcetype=auditd exe IN ("*whois*", "*dig*") \| stats count by host, exe \| where count > 5`.<br>- **KQL**: `LinuxAuditd \| where ProcessName has_any ("whois", "dig") \| summarize count() by HostName, ProcessName \| where count_ > 5`.<br>- **ELK**: `FROM logs-auditd-* \| WHERE process.exe : ("*whois*" OR "*dig*") \| STATS COUNT() BY host.name, process.exe HAVING COUNT() > 5`. |
| 7. Domain Property Enumeration with High Frequency | High-frequency WHOIS queries, indicating automated reconnaissance, as in APT41. | - Network Traffic (DS0003: Zeek DNS)<br>- Metrics | - **Splunk**: `index=network sourcetype=zeek_dns query_type="TXT" AND query IN ("*.whois.*") \| timechart span=1m count by src_ip \| where count > 50`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "DNS" and AdditionalFields.QueryType == "TXT" and AdditionalFields.Query has_any (".whois.") \| summarize MinuteCount=count() by bin(Timestamp, 1m), DeviceIP \| where MinuteCount > 50`.<br>- **ELK**: `FROM logs-zeek.dns-* \| WHERE dns.query.type = "TXT" AND dns.query : ("*.whois.*") \| STATS COUNT() BY date_histogram(@timestamp, '1m'), source.ip \| WHERE COUNT() > 50`. |
| 8. Domain Property Enumeration via Browser Automation | Adversaries use browser automation tools (e.g., Selenium) to scrape domain details, as in Cobalt Strike. | - Process Creation (DS0009: Sysmon ID 1)<br>- Network Traffic (DS0003: Zeek HTTP) | - **Splunk**: `index=endpoint sourcetype=sysmon EventCode=1 CommandLine IN ("*selenium*", "*puppeteer*") \| join host [search index=network sourcetype=zeek_http uri IN ("*whois*", "*domain*")] \| stats count by host, CommandLine, uri \| where count > 5`.<br>- **KQL**: `DeviceProcessEvents \| where ProcessCommandLine has_any ("selenium", "puppeteer") \| join kind=inner (DeviceNetworkEvents \| where Protocol == "HTTP" and RemoteUrl has_any ("whois", "domain")) on DeviceName \| summarize count() by DeviceName, ProcessCommandLine, RemoteUrl \| where count_ > 5`.<br>- **ELK**: `FROM logs-endpoint.process-* \| WHERE process.command_line : ("*selenium*" OR "*puppeteer*") \| JOIN logs-zeek.http-* ON host.name WHERE http.uri : ("*whois*" OR "*domain*") \| STATS COUNT() BY host.name, process.command_line, http.uri HAVING COUNT() > 5`. |
| 9. Domain Property Enumeration via Known Malicious IPs | Domain enumeration from known malicious IPs, as in Volt Typhoon. | - Network Traffic (DS0003: Zeek DNS)<br>- Threat Intelligence | - **Splunk**: `index=network sourcetype=zeek_dns src_ip IN (threat_intel_ips) AND query IN ("*.whois.*") \| stats count by src_ip, query \| where count > 10`.<br>- **KQL**: `DeviceNetworkEvents \| where DeviceIP in (threatIntelIPs) and AdditionalFields.Query has_any (".whois.") \| summarize count() by DeviceIP, AdditionalFields.Query \| where count_ > 10`.<br>- **ELK**: `FROM logs-zeek.dns-* \| WHERE source.ip IN ['threat_intel_ips'] AND dns.query : ("*.whois.*") \| STATS COUNT() BY source.ip, dns.query HAVING COUNT() > 10`. |
| 10. Domain Property Enumeration with Suspicious Headers | Domain enumeration with custom HTTP headers, as in APT41. | - Network Traffic (DS0003: Zeek HTTP)<br>- Proxy Logs | - **Splunk**: `index=network sourcetype=zeek_http header IN ("*X-Scan*", "*Custom-Scan*") AND uri IN ("*whois*", "*domain*") \| stats count by src_ip, header, uri \| where count > 10`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "HTTP" and AdditionalFields.Header has_any ("X-Scan", "Custom-Scan") and RemoteUrl has_any ("whois", "domain") \| summarize count() by DeviceIP, AdditionalFields.Header, RemoteUrl \| where count_ > 10`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE http.header : ("*X-Scan*" OR "*Custom-Scan*") AND http.uri : ("*whois*" OR "*domain*") \| STATS COUNT() BY source.ip, http.header, http.uri HAVING COUNT() > 10`. |

### T1590.002: DNS

| Hypothesis | Description | Data Sources | Hunting Queries |
|-----------|-------------|--------------|-----------------|
| 1. Suspicious DNS Queries for Subdomains | Adversaries enumerate subdomains via DNS queries, as in Volt Typhoon. | - Network Traffic (DS0003: Zeek DNS)<br>- DNS Logs | - **Splunk**: `index=network sourcetype=zeek_dns query_type IN ("A", "AAAA") AND query MATCHES "[a-z0-9]+\.[a-z0-9]+\.yourdomain\.com" \| stats count by src_ip, query \| where count > 50`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "DNS" and AdditionalFields.QueryType in ("A", "AAAA") and AdditionalFields.Query matches regex "[a-z0-9]+\\.[a-z0-9]+\\.yourdomain\\.com" \| summarize count() by DeviceIP, AdditionalFields.Query \| where count_ > 50`.<br>- **ELK**: `FROM logs-zeek.dns-* \| WHERE dns.query.type IN ['A', 'AAAA'] AND dns.query MATCHES '[a-z0-9]+\\.[a-z0-9]+\\.yourdomain\\.com' \| STATS COUNT() BY source.ip, dns.query HAVING COUNT() > 50`. |
| 2. High-Volume DNS Queries from Single Source | Adversaries perform high-volume DNS queries to map networks, as in APT41. | - Network Traffic (DS0003: Zeek DNS)<br>- DNS Logs | - **Splunk**: `index=network sourcetype=zeek_dns query_type IN ("A", "AAAA", "CNAME") \| stats count by src_ip \| where count > 1000`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "DNS" and AdditionalFields.QueryType in ("A", "AAAA", "CNAME") \| summarize count() by DeviceIP \| where count_ > 1000`.<br>- **ELK**: `FROM logs-zeek.dns-* \| WHERE dns.query.type IN ['A', 'AAAA', 'CNAME'] \| STATS COUNT() BY source.ip HAVING COUNT() > 1000`. |
| 3. DNS Queries with Anomalous Timing | DNS enumeration outside business hours, as in APT29. | - Network Traffic (DS0003: Zeek DNS)<br>- Metrics | - **Splunk**: `index=network sourcetype=zeek_dns query_type IN ("A", "AAAA") \| timechart span=1h count by src_ip \| where count > avg(count)*3 AND (_time < "08:00" OR _time > "18:00")`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "DNS" and AdditionalFields.QueryType in ("A", "AAAA") \| summarize HourlyCount=count() by bin(Timestamp, 1h), DeviceIP \| where HourlyCount > avg(HourlyCount) * 3 and (hour(Timestamp) < 8 or hour(Timestamp) > 18)`.<br>- **ELK**: `FROM logs-zeek.dns-* \| WHERE dns.query.type IN ['A', 'AAAA'] \| STATS COUNT() BY date_histogram(@timestamp, '1h'), source.ip \| WHERE COUNT() > AVG(COUNT()) * 3 AND (HOUR(@timestamp) < 8 OR HOUR(@timestamp) > 18)`. |
| 4. DNS Queries from Compromised Endpoints | Compromised internal hosts perform DNS enumeration, as in FIN7. | - Process Creation (DS0009: Sysmon ID 1)<br>- Network Traffic (DS0003: Zeek DNS) | - **Splunk**: `index=endpoint sourcetype=sysmon EventCode=1 CommandLine IN ("*nslookup*", "*dig*") \| join host [search index=network sourcetype=zeek_dns query_type IN ("A", "AAAA")] \| stats count by host, CommandLine, query \| where count > 5`.<br>- **KQL**: `DeviceProcessEvents \| where ProcessCommandLine has_any ("nslookup", "dig") \| join kind=inner (DeviceNetworkEvents \| where Protocol == "DNS" and AdditionalFields.QueryType in ("A", "AAAA")) on DeviceName \| summarize count() by DeviceName, ProcessCommandLine, AdditionalFields.Query \| where count_ > 5`.<br>- **ELK**: `FROM logs-endpoint.process-* \| WHERE process.command_line : ("*nslookup*" OR "*dig*") \| JOIN logs-zeek.dns-* ON host.name WHERE dns.query.type IN ['A', 'AAAA'] \| STATS COUNT() BY host.name, process.command_line, dns.query HAVING COUNT() > 5`. |
| 5. DNS Queries with High Entropy | Adversaries use high-entropy DNS queries for reconnaissance, as in Cobalt Strike. | - Network Traffic (DS0003: Zeek DNS)<br>- DNS Logs | - **Splunk**: `index=network sourcetype=zeek_dns query_entropy > 4 AND query_type IN ("A", "AAAA") \| stats count by src_ip, query \| where count > 50`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "DNS" and AdditionalFields.QueryEntropy > 4 and AdditionalFields.QueryType in ("A", "AAAA") \| summarize count() by DeviceIP, AdditionalFields.Query \| where count_ > 50`.<br>- **ELK**: `FROM logs-zeek.dns-* \| WHERE dns.query.entropy > 4 AND dns.query.type IN ['A', 'AAAA'] \| STATS COUNT() BY source.ip, dns.query HAVING COUNT() > 50`. |
| 6. DNS Queries in Linux Environments | Adversaries use Linux tools (e.g., `dig`, `host`) for DNS enumeration, as in Turla. | - Process Creation (Linux Auditd)<br>- Network Traffic (DS0003: Zeek DNS) | - **Splunk**: `index=linux sourcetype=auditd exe IN ("*dig*", "*host*") \| stats count by host, exe \| where count > 5`.<br>- **KQL**: `LinuxAuditd \| where ProcessName has_any ("dig", "host") \| summarize count() by HostName, ProcessName \| where count_ > 5`.<br>- **ELK**: `FROM logs-auditd-* \| WHERE process.exe : ("*dig*" OR "*host*") \| STATS COUNT() BY host.name, process.exe HAVING COUNT() > 5`. |
| 7. DNS Queries Targeting Cloud Infrastructure | Adversaries enumerate cloud-hosted DNS records, as in 2025 trends. | - Cloud Audit Logs (AWS CloudTrail)<br>- Network Traffic (DS0003: Zeek DNS) | - **Splunk**: `index=cloud sourcetype=aws:cloudtrail eventName IN ("ListHostedZones", "ListResourceRecordSets") AND userIdentity NOT IN (authorized_users) \| stats count by src_ip, eventName \| where count > 10`.<br>- **KQL**: `AWSCloudTrail \| where EventName in ("ListHostedZones", "ListResourceRecordSets") and Caller !in (authorizedUsers) \| summarize count() by SourceIP, EventName \| where count_ > 10`.<br>- **ELK**: `FROM logs-aws.cloudtrail-* \| WHERE event.action IN ['ListHostedZones', 'ListResourceRecordSets'] AND user.identity NOT IN ['authorized_users'] \| STATS COUNT() BY source.ip, event.action HAVING COUNT() > 10`. |
| 8. DNS Queries with Suspicious User Agents | DNS enumeration via HTTP with non-standard user agents, as in APT41. | - Network Traffic (DS0003: Zeek HTTP)<br>- Proxy Logs | - **Splunk**: `index=network sourcetype=zeek_http user_agent NOT IN (known_agents) AND uri IN ("*dns*", "*resolve*") \| stats count by src_ip, user_agent, uri \| where count > 10`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "HTTP" and AdditionalFields.UserAgent !in (knownAgents) and RemoteUrl has_any ("dns", "resolve") \| summarize count() by DeviceIP, AdditionalFields.UserAgent, RemoteUrl \| where count_ > 10`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE http.user_agent NOT IN ['known_agents'] AND http.uri : ("*dns*" OR "*resolve*") \| STATS COUNT() BY source.ip, http.user_agent, http.uri HAVING COUNT() > 10`. |
| 9. DNS Queries from Known Malicious IPs | DNS enumeration from known malicious IPs, as in Volt Typhoon. | - Network Traffic (DS0003: Zeek DNS)<br>- Threat Intelligence | - **Splunk**: `index=network sourcetype=zeek_dns src_ip IN (threat_intel_ips) AND query_type IN ("A", "AAAA") \| stats count by src_ip, query \| where count > 50`.<br>- **KQL**: `DeviceNetworkEvents \| where DeviceIP in (threatIntelIPs) and AdditionalFields.QueryType in ("A", "AAAA") \| summarize count() by DeviceIP, AdditionalFields.Query \| where count_ > 50`.<br>- **ELK**: `FROM logs-zeek.dns-* \| WHERE source.ip IN ['threat_intel_ips'] AND dns.query.type IN ['A', 'AAAA'] \| STATS COUNT() BY source.ip, dns.query HAVING COUNT() > 50`. |
| 10. DNS Queries with Rapid Sequential Queries | Adversaries perform rapid sequential DNS queries, as in Cobalt Strike. | - Network Traffic (DS0003: Zeek DNS)<br>- Metrics | - **Splunk**: `index=network sourcetype=zeek_dns query_type IN ("A", "AAAA") \| timechart span=1m count by src_ip \| where count > 100`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "DNS" and AdditionalFields.QueryType in ("A", "AAAA") \| summarize MinuteCount=count() by bin(Timestamp, 1m), DeviceIP \| where MinuteCount > 100`.<br>- **ELK**: `FROM logs-zeek.dns-* \| WHERE dns.query.type IN ['A', 'AAAA'] \| STATS COUNT() BY date_histogram(@timestamp, '1m'), source.ip \| WHERE COUNT() > 100`. |

### T1590.003: Network Trust Dependencies

| Hypothesis | Description | Data Sources | Hunting Queries |
|-----------|-------------|--------------|-----------------|
| 1. Unauthorized Trust Dependency Enumeration | Adversaries enumerate trust relationships via `nltest`, as in Volt Typhoon. | - Process Creation (DS0009: Sysmon ID 1)<br>- Windows Logs | - **Splunk**: `index=endpoint sourcetype=sysmon EventCode=1 CommandLine IN ("*nltest /domain_trusts*", "*net view /domain*") \| stats count by host, CommandLine \| where count > 5`.<br>- **KQL**: `DeviceProcessEvents \| where ProcessCommandLine has_any ("nltest /domain_trusts", "net view /domain") \| summarize count() by DeviceName, ProcessCommandLine \| where count_ > 5`.<br>- **ELK**: `FROM logs-endpoint.process-* \| WHERE process.command_line : ("*nltest /domain_trusts*" OR "*net view /domain*") \| STATS COUNT() BY host.name, process.command_line HAVING COUNT() > 5`. |
| 2. Trust Dependency Enumeration in Linux Environments | Adversaries use Linux commands (e.g., `smbclient`) to enumerate trust dependencies, as in Turla. | - Process Creation (Linux Auditd)<br>- Linux Logs | - **Splunk**: `index=linux sourcetype=auditd exe IN ("*smbclient -L*", "*rpcclient*") \| stats count by host, exe \| where count > 5`.<br>- **KQL**: `LinuxAuditd \| where ProcessName has_any ("smbclient -L", "rpcclient") \| summarize count() by HostName, ProcessName \| where count_ > 5`.<br>- **ELK**: `FROM logs-auditd-* \| WHERE process.exe : ("*smbclient -L*" OR "*rpcclient*") \| STATS COUNT() BY host.name, process.exe HAVING COUNT() > 5`. |
| 3. Trust Dependency Enumeration via Cloud APIs | Adversaries query cloud APIs for trust relationships, as in 2025 trends. | - Cloud Audit Logs (AWS CloudTrail)<br>- Authentication Logs | - **Splunk**: `index=cloud sourcetype=aws:cloudtrail eventName IN ("GetRole", "ListRoles") AND userIdentity NOT IN (authorized_users) \| stats count by src_ip, eventName \| where count > 10`.<br>- **KQL**: `AWSCloudTrail \| where EventName in ("GetRole", "ListRoles") and Caller !in (authorizedUsers) \| summarize count() by SourceIP, EventName \| where count_ > 10`.<br>- **ELK**: `FROM logs-aws.cloudtrail-* \| WHERE event.action IN ['GetRole', 'ListRoles'] AND user.identity NOT IN ['authorized_users'] \| STATS COUNT() BY source.ip, event.action HAVING COUNT() > 10`. |
| 4. Trust Dependency Enumeration with Suspicious Timing | Trust enumeration outside business hours, as in APT29. | - Process Creation (DS0009: Sysmon ID 1)<br>- Metrics | - **Splunk**: `index=endpoint sourcetype=sysmon EventCode=1 CommandLine IN ("*nltest /domain_trusts*", "*net view /domain*") \| timechart span=1h count by host \| where count > avg(count)*3 AND (_time < "08:00" OR _time > "18:00")`.<br>- **KQL**: `DeviceProcessEvents \| where ProcessCommandLine has_any ("nltest /domain_trusts", "net view /domain") \| summarize HourlyCount=count() by bin(Timestamp, 1h), DeviceName \| where HourlyCount > avg(HourlyCount) * 3 and (hour(Timestamp) < 8 or hour(Timestamp) > 18)`.<br>- **ELK**: `FROM logs-endpoint.process-* \| WHERE process.command_line : ("*nltest /domain_trusts*" OR "*net view /domain*") \| STATS COUNT() BY date_histogram(@timestamp, '1h'), host.name \| WHERE COUNT() > AVG(COUNT()) * 3 AND (HOUR(@timestamp) < 8 OR HOUR(@timestamp) > 18)`. |
| 5. Trust Dependency Enumeration from Compromised Endpoints | Compromised endpoints enumerate trust relationships, as in FIN7. | - Process Creation (DS0009: Sysmon ID 1)<br>- Network Traffic (DS0003: Zeek Conn) | - **Splunk**: `index=endpoint sourcetype=sysmon EventCode=1 CommandLine IN ("*nltest /domain_trusts*", "*net view /domain*") \| join host [search index=network sourcetype=zeek_conn] \| stats count by host, CommandLine, dest_ip \| where count > 5`.<br>- **KQL**: `DeviceProcessEvents \| where ProcessCommandLine has_any ("nltest /domain_trusts", "net view /domain") \| join kind=inner (DeviceNetworkEvents) on DeviceName \| summarize count() by DeviceName, ProcessCommandLine, RemoteIP \| where count_ > 5`.<br>- **ELK**: `FROM logs-endpoint.process-* \| WHERE process.command_line : ("*nltest /domain_trusts*" OR "*net view /domain*") \| JOIN logs-zeek.conn-* ON host.name \| STATS COUNT() BY host.name, process.command_line, destination.ip HAVING COUNT() > 5`. |
| 6. Trust Dependency Enumeration via PowerShell | Adversaries use PowerShell to enumerate trust relationships, as in APT41. | - Process Creation (DS0009: Sysmon ID 1)<br>- Windows Logs | - **Splunk**: `index=endpoint sourcetype=sysmon EventCode=1 CommandLine IN ("*Get-ADTrust*", "*Get-DomainTrust*") \| stats count by host, CommandLine \| where count > 5`.<br>- **KQL**: `DeviceProcessEvents \| where ProcessCommandLine has_any ("Get-ADTrust", "Get-DomainTrust") \| summarize count() by DeviceName, ProcessCommandLine \| where count_ > 5`.<br>- **ELK**: `FROM logs-endpoint.process-* \| WHERE process.command_line : ("*Get-ADTrust*" OR "*Get-DomainTrust*") \| STATS COUNT() BY host.name, process.command_line HAVING COUNT() > 5`. |
| 7. Trust Dependency Enumeration with Network Correlation | Trust enumeration followed by suspicious network activity, as in Volt Typhoon. | - Process Creation (DS0009: Sysmon ID 1)<br>- Network Traffic (DS0003: Zeek HTTP) | - **Splunk**: `index=endpoint sourcetype=sysmon EventCode=1 CommandLine IN ("*nltest /domain_trusts*", "*net view /domain*") \| join host [search index=network sourcetype=zeek_http user_agent NOT IN (known_agents)] \| stats count by host, CommandLine, user_agent \| where count > 5`.<br>- **KQL**: `DeviceProcessEvents \| where ProcessCommandLine has_any ("nltest /domain_trusts", "net view /domain") \| join kind=inner (DeviceNetworkEvents \| where Protocol == "HTTP" and AdditionalFields.UserAgent !in (knownAgents)) on DeviceName \| summarize count() by DeviceName, ProcessCommandLine, AdditionalFields.UserAgent \| where count_ > 5`.<br>- **ELK**: `FROM logs-endpoint.process-* \| WHERE process.command_line : ("*nltest /domain_trusts*" OR "*net view /domain*") \| JOIN logs-zeek.http-* ON host.name WHERE http.user_agent NOT IN ['known_agents'] \| STATS COUNT() BY host.name, process.command_line, http.user_agent HAVING COUNT() > 5`. |
| 8. Trust Dependency Enumeration in Cloud Environments | Adversaries enumerate trust dependencies in cloud environments, as in 2025 trends. | - Cloud Audit Logs (AWS CloudTrail)<br>- Authentication Logs | - **Splunk**: `index=cloud sourcetype=aws:cloudtrail eventName IN ("AssumeRole", "GetCallerIdentity") AND userIdentity NOT IN (authorized_users) \| stats count by src_ip, eventName \| where count > 10`.<br>- **KQL**: `AWSCloudTrail \| where EventName in ("AssumeRole", "GetCallerIdentity") and Caller !in (authorizedUsers) \| summarize count() by SourceIP, EventName \| where count_ > 10`.<br>- **ELK**: `FROM logs-aws.cloudtrail-* \| WHERE event.action IN ['AssumeRole', 'GetCallerIdentity'] AND user.identity NOT IN ['authorized_users'] \| STATS COUNT() BY source.ip, event.action HAVING COUNT() > 10`. |
| 9. Trust Dependency Enumeration via Remote Access Tools | Adversaries use RATs to enumerate trust relationships, as in Cobalt Strike. | - Process Creation (DS0009: Sysmon ID 1)<br>- Network Traffic (DS0003: Zeek Conn) | - **Splunk**: `index=endpoint sourcetype=sysmon EventCode=1 CommandLine IN ("*teamviewer*", "*anydesk*") \| join host [search index=network sourcetype=zeek_conn] \| stats count by host, CommandLine, dest_ip \| where count > 5`.<br>- **KQL**: `DeviceProcessEvents \| where ProcessCommandLine has_any ("teamviewer", "anydesk") \| join kind=inner (DeviceNetworkEvents) on DeviceName \| summarize count() by DeviceName, ProcessCommandLine, RemoteIP \| where count_ > 5`.<br>- **ELK**: `FROM logs-endpoint.process-* \| WHERE process.command_line : ("*teamviewer*" OR "*anydesk*") \| JOIN logs-zeek.conn-* ON host.name \| STATS COUNT() BY host.name, process.command_line, destination.ip HAVING COUNT() > 5`. |
| 10. Trust Dependency Enumeration with High Frequency | High-frequency trust enumeration, indicating automated reconnaissance, as in APT41. | - Process Creation (DS0009: Sysmon ID 1)<br>- Metrics | - **Splunk**: `index=endpoint sourcetype=sysmon EventCode=1 CommandLine IN ("*nltest /domain_trusts*", "*net view /domain*") \| timechart span=1m count by host \| where count > 50`.<br>- **KQL**: `DeviceProcessEvents \| where ProcessCommandLine has_any ("nltest /domain_trusts", "net view /domain") \| summarize MinuteCount=count() by bin(Timestamp, 1m), DeviceName \| where MinuteCount > 50`.<br>- **ELK**: `FROM logs-endpoint.process-* \| WHERE process.command_line : ("*nltest /domain_trusts*" OR "*net view /domain*") \| STATS COUNT() BY date_histogram(@timestamp, '1m'), host.name \| WHERE COUNT() > 50`. |

### T1590.004: Network Topology

| Hypothesis | Description | Data Sources | Hunting Queries |
|-----------|-------------|--------------|-----------------|
| 1. Unauthorized Network Topology Enumeration | Adversaries enumerate network topology using `netstat` or `nmap`, as in Volt Typhoon. | - Process Creation (DS0009: Sysmon ID 1)<br>- Network Traffic (DS0003: Zeek Conn) | - **Splunk**: `index=endpoint sourcetype=sysmon EventCode=1 CommandLine IN ("*netstat -an*", "*nmap*") \| stats count by host, CommandLine \| where count > 5`.<br>- **KQL**: `DeviceProcessEvents \| where ProcessCommandLine has_any ("netstat -an", "nmap") \| summarize count() by DeviceName, ProcessCommandLine \| where count_ > 5`.<br>- **ELK**: `FROM logs-endpoint.process-* \| WHERE process.command_line : ("*netstat -an*" OR "*nmap*") \| STATS COUNT() BY host.name, process.command_line HAVING COUNT() > 5`. |
| 2. Network Topology Enumeration in Linux Environments | Adversaries use Linux tools (e.g., `nmap`, `ip`) for topology reconnaissance, as in Turla. | - Process Creation (Linux Auditd)<br>- Network Traffic (DS0003: Zeek Conn) | - **Splunk**: `index=linux sourcetype=auditd exe IN ("*nmap*", "*ip route*") \| stats count by host, exe \| where count > 5`.<br>- **KQL**: `LinuxAuditd \| where ProcessName has_any ("nmap", "ip route") \| summarize count() by HostName, ProcessName \| where count_ > 5`.<br>- **ELK**: `FROM logs-auditd-* \| WHERE process.exe : ("*nmap*" OR "*ip route*") \| STATS COUNT() BY host.name, process.exe HAVING COUNT() > 5`. |
| 3. Network Topology Enumeration via Cloud APIs | Adversaries query cloud APIs for network topology, as in 2025 trends. | - Cloud Audit Logs (AWS CloudTrail)<br>- Network Traffic | - **Splunk**: `index=cloud sourcetype=aws:cloudtrail eventName IN ("DescribeVpcs", "DescribeSubnets") AND userIdentity NOT IN (authorized_users) \| stats count by src_ip, eventName \| where count > 10`.<br>- **KQL**: `AWSCloudTrail \| where EventName in ("DescribeVpcs", "DescribeSubnets") and Caller !in (authorizedUsers) \| summarize count() by SourceIP, EventName \| where count_ > 10`.<br>- **ELK**: `FROM logs-aws.cloudtrail-* \| WHERE event.action IN ['DescribeVpcs', 'DescribeSubnets'] AND user.identity NOT IN ['authorized_users'] \| STATS COUNT() BY source.ip, event.action HAVING COUNT() > 10`. |
| 4. Network Topology Enumeration with Suspicious Timing | Topology enumeration outside business hours, as in APT29. | - Process Creation (DS0009: Sysmon ID 1)<br>- Metrics | - **Splunk**: `index=endpoint sourcetype=sysmon EventCode=1 CommandLine IN ("*netstat -an*", "*nmap*") \| timechart span=1h count by host \| where count > avg(count)*3 AND (_time < "08:00" OR _time > "18:00")`.<br>- **KQL**: `DeviceProcessEvents \| where ProcessCommandLine has_any ("netstat -an", "nmap") \| summarize HourlyCount=count() by bin(Timestamp, 1h), DeviceName \| where HourlyCount > avg(HourlyCount) * 3 and (hour(Timestamp) < 8 or hour(Timestamp) > 18)`.<br>- **ELK**: `FROM logs-endpoint.process-* \| WHERE process.command_line : ("*netstat -an*" OR "*nmap*") \| STATS COUNT() BY date_histogram(@timestamp, '1h'), host.name \| WHERE COUNT() > AVG(COUNT()) * 3 AND (HOUR(@timestamp) < 8 OR HOUR(@timestamp) > 18)`. |
| 5. Network Topology Enumeration from Compromised Endpoints | Compromised endpoints perform topology enumeration, as in FIN7. | - Process Creation (DS0009: Sysmon ID 1)<br>- Network Traffic (DS0003: Zeek Conn) | - **Splunk**: `index=endpoint sourcetype=sysmon EventCode=1 CommandLine IN ("*netstat -an*", "*nmap*") \| join host [search index=network sourcetype=zeek_conn] \| stats count by host, CommandLine, dest_ip \| where count > 5`.<br>- **KQL**: `DeviceProcessEvents \| where ProcessCommandLine has_any ("netstat -an", "nmap") \| join kind=inner (DeviceNetworkEvents) on DeviceName \| summarize count() by DeviceName, ProcessCommandLine, RemoteIP \| where count_ > 5`.<br>- **ELK**: `FROM logs-endpoint.process-* \| WHERE process.command_line : ("*netstat -an*" OR "*nmap*") \| JOIN logs-zeek.conn-* ON host.name \| STATS COUNT() BY host.name, process.command_line, destination.ip HAVING COUNT() > 5`. |
| 6. Network Topology Enumeration via PowerShell | Adversaries use PowerShell to enumerate network topology, as in APT41. | - Process Creation (DS0009: Sysmon ID 1)<br>- Windows Logs | - **Splunk**: `index=endpoint sourcetype=sysmon EventCode=1 CommandLine IN ("*Get-NetRoute*", "*Get-NetNeighbor*") \| stats count by host, CommandLine \| where count > 5`.<br>- **KQL**: `DeviceProcessEvents \| where ProcessCommandLine has_any ("Get-NetRoute", "Get-NetNeighbor") \| summarize count() by DeviceName, ProcessCommandLine \| where count_ > 5`.<br>- **ELK**: `FROM logs-endpoint.process-* \| WHERE process.command_line : ("*Get-NetRoute*" OR "*Get-NetNeighbor*") \| STATS COUNT() BY host.name, process.command_line HAVING COUNT() > 5`. |
| 7. Network Topology Enumeration with Network Correlation | Topology enumeration followed by suspicious network activity, as in Volt Typhoon. | - Process Creation (DS0009: Sysmon ID 1)<br>- Network Traffic (DS0003: Zeek HTTP) | - **Splunk**: `index=endpoint sourcetype=sysmon EventCode=1 CommandLine IN ("*netstat -an*", "*nmap*") \| join host [search index=network sourcetype=zeek_http user_agent NOT IN (known_agents)] \| stats count by host, CommandLine, user_agent \| where count > 5`.<br>- **KQL**: `DeviceProcessEvents \| where ProcessCommandLine has_any ("netstat -an", "nmap") \| join kind=inner (DeviceNetworkEvents \| where Protocol == "HTTP" and AdditionalFields.UserAgent !in (knownAgents)) on DeviceName \| summarize count() by DeviceName, ProcessCommandLine, AdditionalFields.UserAgent \| where count_ > 5`.<br>- **ELK**: `FROM logs-endpoint.process-* \| WHERE process.command_line : ("*netstat -an*" OR "*nmap*") \| JOIN logs-zeek.http-* ON host.name WHERE http.user_agent NOT IN ['known_agents'] \| STATS COUNT() BY host.name, process.command_line, http.user_agent HAVING COUNT() > 5`. |
| 8. Network Topology Enumeration in Cloud Environments | Adversaries enumerate cloud network topology, as in 2025 trends. | - Cloud Audit Logs (AWS CloudTrail)<br>- Network Traffic | - **Splunk**: `index=cloud sourcetype=aws:cloudtrail eventName IN ("DescribeSecurityGroups", "DescribeNetworkInterfaces") AND userIdentity NOT IN (authorized_users) \| stats count by src_ip, eventName \| where count > 10`.<br>- **KQL**: `AWSCloudTrail \| where EventName in ("DescribeSecurityGroups", "DescribeNetworkInterfaces") and Caller !in (authorizedUsers) \| summarize count() by SourceIP, EventName \| where count_ > 10`.<br>- **ELK**: `FROM logs-aws.cloudtrail-* \| WHERE event.action IN ['DescribeSecurityGroups', 'DescribeNetworkInterfaces'] AND user.identity NOT IN ['authorized_users'] \| STATS COUNT() BY source.ip, event.action HAVING COUNT() > 10`. |
| 9. Network Topology Enumeration via Remote Access Tools | Adversaries use RATs to enumerate network topology, as in Cobalt Strike. | - Process Creation (DS0009: Sysmon ID 1)<br>- Network Traffic (DS0003: Zeek Conn) | - **Splunk**: `index=endpoint sourcetype=sysmon EventCode=1 CommandLine IN ("*teamviewer*", "*anydesk*") \| join host [search index=network sourcetype=zeek_conn] \| stats count by host, CommandLine, dest_ip \| where count > 5`.<br>- **KQL**: `DeviceProcessEvents \| where ProcessCommandLine has_any ("teamviewer", "anydesk") \| join kind=inner (DeviceNetworkEvents) on DeviceName \| summarize count() by DeviceName, ProcessCommandLine, RemoteIP \| where count_ > 5`.<br>- **ELK**: `FROM logs-endpoint.process-* \| WHERE process.command_line : ("*teamviewer*" OR "*anydesk*") \| JOIN logs-zeek.conn-* ON host.name \| STATS COUNT() BY host.name, process.command_line, destination.ip HAVING COUNT() > 5`. |
| 10. Network Topology Enumeration with High Frequency | High-frequency topology enumeration, indicating automated reconnaissance, as in APT41. | - Process Creation (DS0009: Sysmon ID 1)<br>- Metrics | - **Splunk**: `index=endpoint sourcetype=sysmon EventCode=1 CommandLine IN ("*netstat -an*", "*nmap*") \| timechart span=1m count by host \| where count > 50`.<br>- **KQL**: `DeviceProcessEvents \| where ProcessCommandLine has_any ("netstat -an", "nmap") \| summarize MinuteCount=count() by bin(Timestamp, 1m), DeviceName \| where MinuteCount > 50`.<br>- **ELK**: `FROM logs-endpoint.process-* \| WHERE process.command_line : ("*netstat -an*" OR "*nmap*") \| STATS COUNT() BY date_histogram(@timestamp, '1m'), host.name \| WHERE COUNT() > 50`. |

### T1590.005: IP Addresses

| Hypothesis | Description | Data Sources | Hunting Queries |
|-----------|-------------|--------------|-----------------|
| 1. Unauthorized IP Address Enumeration | Adversaries enumerate IP addresses using `ping` or `nmap`, as in Volt Typhoon. | - Process Creation (DS0009: Sysmon ID 1)<br>- Network Traffic (DS0003: Zeek Conn) | - **Splunk**: `index=endpoint sourcetype=sysmon EventCode=1 CommandLine IN ("*ping*", "*nmap*") \| stats count by host, CommandLine \| where count > 5`.<br>- **KQL**: `DeviceProcessEvents \| where ProcessCommandLine has_any ("ping", "nmap") \| summarize count() by DeviceName, ProcessCommandLine \| where count_ > 5`.<br>- **ELK**: `FROM logs-endpoint.process-* \| WHERE process.command_line : ("*ping*" OR "*nmap*") \| STATS COUNT() BY host.name, process.command_line HAVING COUNT() > 5`. |
| 2. IP Address Enumeration in Linux Environments | Adversaries use Linux tools (e.g., `ping`, `nmap`) for IP enumeration, as in Turla. | - Process Creation (Linux Auditd)<br>- Network Traffic (DS0003: Zeek Conn) | - **Splunk**: `index=linux sourcetype=auditd exe IN ("*ping*", "*nmap*") \| stats count by host, exe \| where count > 5`.<br>- **KQL**: `LinuxAuditd \| where ProcessName has_any ("ping", "nmap") \| summarize count() by HostName, ProcessName \| where count_ > 5`.<br>- **ELK**: `FROM logs-auditd-* \| WHERE process.exe : ("*ping*" OR "*nmap*") \| STATS COUNT() BY host.name, process.exe HAVING COUNT() > 5`. |
| 3. IP Address Enumeration via Cloud APIs | Adversaries query cloud APIs for IP addresses, as in 2025 trends. | - Cloud Audit Logs (AWS CloudTrail)<br>- Network Traffic | - **Splunk**: `index=cloud sourcetype=aws:cloudtrail eventName IN ("DescribeInstances", "DescribeNetworkInterfaces") AND userIdentity NOT IN (authorized_users) \| stats count by src_ip, eventName \| where count > 10`.<br>- **KQL**: `AWSCloudTrail \| where EventName in ("DescribeInstances", "DescribeNetworkInterfaces") and Caller !in (authorizedUsers) \| summarize count() by SourceIP, EventName \| where count_ > 10`.<br>- **ELK**: `FROM logs-aws.cloudtrail-* \| WHERE event.action IN ['DescribeInstances', 'DescribeNetworkInterfaces'] AND user.identity NOT IN ['authorized_users'] \| STATS COUNT() BY source.ip, event.action HAVING COUNT() > 10`. |
| 4. IP Address Enumeration with Suspicious Timing | IP enumeration outside business hours, as in APT29. | - Process Creation (DS0009: Sysmon ID 1)<br>- Metrics | - **Splunk**: `index=endpoint sourcetype=sysmon EventCode=1 CommandLine IN ("*ping*", "*nmap*") \| timechart span=1h count by host \| where count > avg(count)*3 AND (_time < "08:00" OR _time > "18:00")`.<br>- **KQL**: `DeviceProcessEvents \| where ProcessCommandLine has_any ("ping", "nmap") \| summarize HourlyCount=count() by bin(Timestamp, 1h), DeviceName \| where HourlyCount > avg(HourlyCount) * 3 and (hour(Timestamp) < 8 or hour(Timestamp) > 18)`.<br>- **ELK**: `FROM logs-endpoint.process-* \| WHERE process.command_line : ("*ping*" OR "*nmap*") \| STATS COUNT() BY date_histogram(@timestamp, '1h'), host.name \| WHERE COUNT() > AVG(COUNT()) * 3 AND (HOUR(@timestamp) < 8 OR HOUR(@timestamp) > 18)`. |
| 5. IP Address Enumeration from Compromised Endpoints | Compromised endpoints perform IP enumeration, as in FIN7. | - Process Creation (DS0009: Sysmon ID 1)<br>- Network Traffic (DS0003: Zeek Conn) | - **Splunk**: `index=endpoint sourcetype=sysmon EventCode=1 CommandLine IN ("*ping*", "*nmap*") \| join host [search index=network sourcetype=zeek_conn] \| stats count by host, CommandLine, dest_ip \| where count > 5`.<br>- **KQL**: `DeviceProcessEvents \| where ProcessCommandLine has_any ("ping", "nmap") \| join kind=inner (DeviceNetworkEvents) on DeviceName \| summarize count() by DeviceName, ProcessCommandLine, RemoteIP \| where count_ > 5`.<br>- **ELK**: `FROM logs-endpoint.process-* \| WHERE process.command_line : ("*ping*" OR "*nmap*") \| JOIN logs-zeek.conn-* ON host.name \| STATS COUNT() BY host.name, process.command_line, destination.ip HAVING COUNT() > 5`. |
| 6. IP Address Enumeration via PowerShell | Adversaries use PowerShell to enumerate IP addresses, as in APT41. | - Process Creation (DS0009: Sysmon ID 1)<br>- Windows Logs | - **Splunk**: `index=endpoint sourcetype=sysmon EventCode=1 CommandLine IN ("*Get-NetIPAddress*", "*Test-Connection*") \| stats count by host, CommandLine \| where count > 5`.<br>- **KQL**: `DeviceProcessEvents \| where ProcessCommandLine has_any ("Get-NetIPAddress", "Test-Connection") \| summarize count() by DeviceName, ProcessCommandLine \| where count_ > 5`.<br>- **ELK**: `FROM logs-endpoint.process-* \| WHERE process.command_line : ("*Get-NetIPAddress*" OR "*Test-Connection*") \| STATS COUNT() BY host.name, process.command_line HAVING COUNT() > 5`. |
| 7. IP Address Enumeration with Network Correlation | IP enumeration followed by suspicious network activity, as in Volt Typhoon. | - Process Creation (DS0009: Sysmon ID 1)<br>- Network Traffic (DS0003: Zeek HTTP) | - **Splunk**: `index=endpoint sourcetype=sysmon EventCode=1 CommandLine IN ("*ping*", "*nmap*") \| join host [search index=network sourcetype=zeek_http user_agent NOT IN (known_agents)] \| stats count by host, CommandLine, user_agent \| where count > 5`.<br>- **KQL**: `DeviceProcessEvents \| where ProcessCommandLine has_any ("ping", "nmap") \| join kind=inner (DeviceNetworkEvents \| where Protocol == "HTTP" and AdditionalFields.UserAgent !in (knownAgents)) on DeviceName \| summarize count() by DeviceName, ProcessCommandLine, AdditionalFields.UserAgent \| where count_ > 5`.<br>- **ELK**: `FROM logs-endpoint.process-* \| WHERE process.command_line : ("*ping*" OR "*nmap*") \| JOIN logs-zeek.http-* ON host.name WHERE http.user_agent NOT IN ['known_agents'] \| STATS COUNT() BY host.name, process.command_line, http.user_agent HAVING COUNT() > 5`. |
| 8. IP Address Enumeration in Cloud Environments | Adversaries enumerate IP addresses in cloud environments, as in 2025 trends. | - Cloud Audit Logs (AWS CloudTrail)<br>- Network Traffic | - **Splunk**: `index=cloud sourcetype=aws:cloudtrail eventName IN ("DescribeInstances", "DescribeNetworkInterfaces") AND userIdentity NOT IN (authorized_users) \| stats count by src_ip, eventName \| where count > 10`.<br>- **KQL**: `AWSCloudTrail \| where EventName in ("DescribeInstances", "DescribeNetworkInterfaces") and Caller !in (authorizedUsers) \| summarize count() by SourceIP, EventName \| where count_ > 10`.<br>- **ELK**: `FROM logs-aws.cloudtrail-* \| WHERE event.action IN ['DescribeInstances', 'DescribeNetworkInterfaces'] AND user.identity NOT IN ['authorized_users'] \| STATS COUNT() BY source.ip, event.action HAVING COUNT() > 10`. |
| 9. IP Address Enumeration via Remote Access Tools | Adversaries use RATs to enumerate IP addresses, as in Cobalt Strike. | - Process Creation (DS0009: Sysmon ID 1)<br>- Network Traffic (DS0003: Zeek Conn) | - **Splunk**: `index=endpoint sourcetype=sysmon EventCode=1 CommandLine IN ("*teamviewer*", "*anydesk*") \| join host [search index=network sourcetype=zeek_conn] \| stats count by host, CommandLine, dest_ip \| where count > 5`.<br>- **KQL**: `DeviceProcessEvents \| where ProcessCommandLine has_any ("teamviewer", "anydesk") \| join kind=inner (DeviceNetworkEvents) on DeviceName \| summarize count() by DeviceName, ProcessCommandLine, RemoteIP \| where count_ > 5`.<br>- **ELK**: `FROM logs-endpoint.process-* \| WHERE process.command_line : ("*teamviewer*" OR "*anydesk*") \| JOIN logs-zeek.conn-* ON host.name \| STATS COUNT() BY host.name, process.command_line, destination.ip HAVING COUNT() > 5`. |
| 10. IP Address Enumeration with High Frequency | High-frequency IP enumeration, indicating automated reconnaissance, as in APT41. | - Process Creation (DS0009: Sysmon ID 1)<br>- Metrics | - **Splunk**: `index=endpoint sourcetype=sysmon EventCode=1 CommandLine IN ("*ping*", "*nmap*") \| timechart span=1m count by host \| where count > 50`.<br>- **KQL**: `DeviceProcessEvents \| where ProcessCommandLine has_any ("ping", "nmap") \| summarize MinuteCount=count() by bin(Timestamp, 1m), DeviceName \| where MinuteCount > 50`.<br>- **ELK**: `FROM logs-endpoint.process-* \| WHERE process.command_line : ("*ping*" OR "*nmap*") \| STATS COUNT() BY date_histogram(@timestamp, '1m'), host.name \| WHERE COUNT() > 50`. |

### T1590.006: SMTP Email Addresses

| Hypothesis | Description | Data Sources | Hunting Queries |
|-----------|-------------|--------------|-----------------|
| 1. SMTP Email Address Harvesting via Phishing | Adversaries use phishing emails to collect SMTP email addresses, as in Volt Typhoon. | - Email Logs (DS0004)<br>- Network Traffic (DS0003: Zeek SMTP) | - **Splunk**: `index=email sourcetype=zeek_smtp subject IN ("*verify email*", "*update account*") AND src_ip NOT IN (trusted_ips) \| stats count by src_ip, recipient \| where count > 10`.<br>- **KQL**: `EmailEvents \| where EmailSubject has_any ("verify email", "update account") and SenderIP !in (trustedIPs) \| summarize count() by SenderIP, RecipientEmailAddress \| where count_ > 10`.<br>- **ELK**: `FROM logs-zeek.smtp-* \| WHERE email.subject : ("*verify email*" OR "*update account*") AND source.ip NOT IN ['trusted_ips'] \| STATS COUNT() BY source.ip, email.recipient HAVING COUNT() > 10`. |
| 2. SMTP Email Address Harvesting via SMTP Enumeration | Adversaries enumerate SMTP servers using `VRFY` or `EXPN`, as in APT41. | - Network Traffic (DS0003: Zeek SMTP)<br>- Email Logs | - **Splunk**: `index=network sourcetype=zeek_smtp command IN ("VRFY", "EXPN") \| stats count by src_ip, command \| where count > 10`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "SMTP" and AdditionalFields.Command in ("VRFY", "EXPN") \| summarize count() by DeviceIP, AdditionalFields.Command \| where count_ > 10`.<br>- **ELK**: `FROM logs-zeek.smtp-* \| WHERE smtp.command IN ['VRFY', 'EXPN'] \| STATS COUNT() BY source.ip, smtp.command HAVING COUNT() > 10`. |
| 3. SMTP Email Address Harvesting via Cloud APIs | Adversaries query cloud APIs for SMTP configurations, as in 2025 trends. | - Cloud Audit Logs (AWS CloudTrail)<br>- Network Traffic | - **Splunk**: `index=cloud sourcetype=aws:cloudtrail eventName IN ("ListUsers", "GetUser") AND userIdentity NOT IN (authorized_users) \| stats count by src_ip, eventName \| where count > 10`.<br>- **KQL**: `AWSCloudTrail \| where EventName in ("ListUsers", "GetUser") and Caller !in (authorizedUsers) \| summarize count() by SourceIP, EventName \| where count_ > 10`.<br>- **ELK**: `FROM logs-aws.cloudtrail-* \| WHERE event.action IN ['ListUsers', 'GetUser'] AND user.identity NOT IN ['authorized_users'] \| STATS COUNT() BY source.ip, event.action HAVING COUNT() > 10`. |
| 4. SMTP Email Address Harvesting with Suspicious Timing | SMTP enumeration outside business hours, as in APT29. | - Email Logs (DS0004)<br>- Metrics | - **Splunk**: `index=email sourcetype=zeek_smtp command IN ("VRFY", "EXPN") \| timechart span=1h count by src_ip \| where count > avg(count)*3 AND (_time < "08:00" OR _time > "18:00")`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "SMTP" and AdditionalFields.Command in ("VRFY", "EXPN") \| summarize HourlyCount=count() by bin(Timestamp, 1h), DeviceIP \| where HourlyCount > avg(HourlyCount) * 3 and (hour(Timestamp) < 8 or hour(Timestamp) > 18)`.<br>- **ELK**: `FROM logs-zeek.smtp-* \| WHERE smtp.command IN ['VRFY', 'EXPN'] \| STATS COUNT() BY date_histogram(@timestamp, '1h'), source.ip \| WHERE COUNT() > AVG(COUNT()) * 3 AND (HOUR(@timestamp) < 8 OR HOUR(@timestamp) > 18)`. |
| 5. SMTP Email Address Harvesting from Compromised Endpoints | Compromised endpoints perform SMTP enumeration, as in FIN7. | - Process Creation (DS0009: Sysmon ID 1)<br>- Network Traffic (DS0003: Zeek SMTP) | - **Splunk**: `index=endpoint sourcetype=sysmon EventCode=1 CommandLine IN ("*telnet smtp*", "*nc -v smtp*") \| join host [search index=network sourcetype=zeek_smtp command IN ("VRFY", "EXPN")] \| stats count by host, CommandLine, command \| where count > 5`.<br>- **KQL**: `DeviceProcessEvents \| where ProcessCommandLine has_any ("telnet smtp", "nc -v smtp") \| join kind=inner (DeviceNetworkEvents \| where Protocol == "SMTP" and AdditionalFields.Command in ("VRFY", "EXPN")) on DeviceName \| summarize count() by DeviceName, ProcessCommandLine, AdditionalFields.Command \| where count_ > 5`.<br>- **ELK**: `FROM logs-endpoint.process-* \| WHERE process.command_line : ("*telnet smtp*" OR "*nc -v smtp*") \| JOIN logs-zeek.smtp-* ON host.name WHERE smtp.command IN ['VRFY', 'EXPN'] \| STATS COUNT() BY host.name, process.command_line, smtp.command HAVING COUNT() > 5`. |
| 6. SMTP Email Address Harvesting in Linux Environments | Adversaries use Linux tools (e.g., `telnet`, `nc`) for SMTP enumeration, as in Turla. | - Process Creation (Linux Auditd)<br>- Network Traffic (DS0003: Zeek SMTP) | - **Splunk**: `index=linux sourcetype=auditd exe IN ("*telnet smtp*", "*nc -v smtp*") \| stats count by host, exe \| where count > 5`.<br>- **KQL**: `LinuxAuditd \| where ProcessName has_any ("telnet smtp", "nc -v smtp") \| summarize count() by HostName, ProcessName \| where count_ > 5`.<br>- **ELK**: `FROM logs-auditd-* \| WHERE process.exe : ("*telnet smtp*" OR "*nc -v smtp*") \| STATS COUNT() BY host.name, process.exe HAVING COUNT() > 5`. |
| 7. SMTP Email Address Harvesting via Phishing with Malicious Attachments | Adversaries use phishing with malicious attachments to harvest SMTP addresses, as in APT41. | - Email Logs (DS0004)<br>- Network Traffic (DS0003: Zeek SMTP) | - **Splunk**: `index=email sourcetype=zeek_smtp attachment IN ("*.exe", "*.js") AND src_ip NOT IN (trusted_ips) \| stats count by src_ip, recipient \| where count > 10`.<br>- **KQL**: `EmailEvents \| where AttachmentName has_any (".exe", ".js") and SenderIP !in (trustedIPs) \| summarize count() by SenderIP, RecipientEmailAddress \| where count_ > 10`.<br>- **ELK**: `FROM logs-zeek.smtp-* \| WHERE email.attachment : ("*.exe" OR "*.js") AND source.ip NOT IN ['trusted_ips'] \| STATS COUNT() BY source.ip, email.recipient HAVING COUNT() > 10`. |
| 8. SMTP Email Address Harvesting via Browser Automation | Adversaries use browser automation to harvest SMTP addresses, as in Cobalt Strike. | - Process Creation (DS0009: Sysmon ID 1)<br>- Network Traffic (DS0003: Zeek SMTP) | - **Splunk**: `index=endpoint sourcetype=sysmon EventCode=1 CommandLine IN ("*selenium*", "*puppeteer*") \| join host [search index=network sourcetype=zeek_smtp] \| stats count by host, CommandLine, recipient \| where count > 5`.<br>- **KQL**: `DeviceProcessEvents \| where ProcessCommandLine has_any ("selenium", "puppeteer") \| join kind=inner (DeviceNetworkEvents \| where Protocol == "SMTP") on DeviceName \| summarize count() by DeviceName, ProcessCommandLine, AdditionalFields.Recipient \| where count_ > 5`.<br>- **ELK**: `FROM logs-endpoint.process-* \| WHERE process.command_line : ("*selenium*" OR "*puppeteer*") \| JOIN logs-zeek.smtp-* ON host.name \| STATS COUNT() BY host.name, process.command_line, email.recipient HAVING COUNT() > 5`. |
| 9. SMTP Email Address Harvesting with High Frequency | High-frequency SMTP enumeration, indicating automated reconnaissance, as in APT41. | - Email Logs (DS0004)<br>- Metrics | - **Splunk**: `index=email sourcetype=zeek_smtp command IN ("VRFY", "EXPN") \| timechart span=1m count by src_ip \| where count > 50`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "SMTP" and AdditionalFields.Command in ("VRFY", "EXPN") \| summarize MinuteCount=count() by bin(Timestamp, 1m), DeviceIP \| where MinuteCount > 50`.<br>- **ELK**: `FROM logs-zeek.smtp-* \| WHERE smtp.command IN ['VRFY', 'EXPN'] \| STATS COUNT() BY date_histogram(@timestamp, '1m'), source.ip \| WHERE COUNT() > 50`. |
| 10. SMTP Email Address Harvesting via Known Malicious IPs | SMTP enumeration from known malicious IPs, as in Volt Typhoon. | - Network Traffic (DS0003: Zeek SMTP)<br>- Threat Intelligence | - **Splunk**: `index=network sourcetype=zeek_smtp src_ip IN (threat_intel_ips) AND command IN ("VRFY", "EXPN") \| stats count by src_ip, command \| where count > 10`.<br>- **KQL**: `DeviceNetworkEvents \| where DeviceIP in (threatIntelIPs) and AdditionalFields.Command in ("VRFY", "EXPN") \| summarize count() by DeviceIP, AdditionalFields.Command \| where count_ > 10`.<br>- **ELK**: `FROM logs-zeek.smtp-* \| WHERE source.ip IN ['threat_intel_ips'] AND smtp.command IN ['VRFY', 'EXPN'] \| STATS COUNT() BY source.ip, smtp.command HAVING COUNT() > 10`. |

### T1591: Gather Victim Org Information

