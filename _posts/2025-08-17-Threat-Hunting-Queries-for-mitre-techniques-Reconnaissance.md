---
layout: default
title:  Reconnaissance
category: Threat-Hunting-Queries  # This becomes a main topic in sidebar
---

## Reconnaissance

### T1595.001: Scanning IP Blocks

| Hypothesis | Description | Data Sources | Hunting Queries |
|-----------|-------------|--------------|-----------------|
| 1. High-Volume IP Block Scanning from Single Source | Adversaries perform large-scale IP block scanning to identify live hosts, as seen in Volt Typhoon pre-exploitation. High risk in environments with limited network monitoring. | - Network Traffic (DS0003: Zeek Conn)<br>- Firewall Logs | - **Splunk**: `index=network sourcetype=zeek_conn dest_port IN (80,443,3389) \| stats count by src_ip, dest_ip \| where count > 100 \| sort -count` (Detects high connection attempts to multiple IPs).<br>- **KQL**: `DeviceNetworkEvents \| where RemotePort in (80, 443, 3389) \| summarize ConnectionCount=count() by DeviceIP, RemoteIP \| where ConnectionCount > 100 \| sort by ConnectionCount desc`.<br>- **ELK**: `FROM logs-zeek.conn-* \| WHERE destination.port IN [80, 443, 3389] \| STATS COUNT() BY source.ip, destination.ip HAVING COUNT() > 100 \| SORT COUNT() DESC`. |
| 2. IP Block Scanning with Anomalous Timing | Scanning occurs outside business hours, indicating reconnaissance, as in APT41. | - Network Traffic (DS0003: Zeek Conn)<br>- Metrics | - **Splunk**: `index=network sourcetype=zeek_conn dest_port IN (80,443) \| timechart span=1h count by src_ip \| where count > avg(count)*3 AND _time < "08:00" OR _time > "18:00"`.<br>- **KQL**: `DeviceNetworkEvents \| where RemotePort in (80, 443) \| summarize HourlyCount=count() by bin(Timestamp, 1h), DeviceIP \| where HourlyCount > avg(HourlyCount) * 3 and (hour(Timestamp) < 8 or hour(Timestamp) > 18)`.<br>- **ELK**: `FROM logs-zeek.conn-* \| WHERE destination.port IN [80, 443] \| STATS COUNT() BY date_histogram(@timestamp, '1h'), source.ip \| WHERE COUNT() > AVG(COUNT()) * 3 AND (HOUR(@timestamp) < 8 OR HOUR(@timestamp) > 18)`. |
| 3. IP Block Scanning Targeting Cloud Infrastructure | Adversaries scan cloud-hosted IP ranges, as in 2025 cloud-focused attacks. | - Cloud Audit Logs (AWS CloudTrail)<br>- Network Traffic | - **Splunk**: `index=cloud sourcetype=aws:cloudtrail eventName="DescribeInstances" AND src_ip NOT IN (trusted_ips) \| stats count by src_ip, eventName \| where count > 50`.<br>- **KQL**: `AWSCloudTrail \| where EventName == "DescribeInstances" and SourceIP !in (trustedIPs) \| summarize count() by SourceIP, EventName \| where count_ > 50`.<br>- **ELK**: `FROM logs-aws.cloudtrail-* \| WHERE event.action = 'DescribeInstances' AND source.ip NOT IN ['trusted_ips'] \| STATS COUNT() BY source.ip, event.action HAVING COUNT() > 50`. |
| 4. IP Block Scanning from Known Malicious IPs | Scanning from IPs associated with known threat actors, as in Volt Typhoon. | - Network Traffic (DS0003: Zeek Conn)<br>- Threat Intelligence | - **Splunk**: `index=network sourcetype=zeek_conn src_ip IN (threat_intel_ips) AND dest_port IN (80,443,3389) \| stats count by src_ip, dest_ip \| where count > 10`.<br>- **KQL**: `DeviceNetworkEvents \| where DeviceIP in (threatIntelIPs) and RemotePort in (80, 443, 3389) \| summarize count() by DeviceIP, RemoteIP \| where count_ > 10`.<br>- **ELK**: `FROM logs-zeek.conn-* \| WHERE source.ip IN ['threat_intel_ips'] AND destination.port IN [80, 443, 3389] \| STATS COUNT() BY source.ip, destination.ip HAVING COUNT() > 10`. |
| 5. IP Block Scanning with Low TTL | Adversaries use low TTL packets to evade detection during IP block scans, as in APT29. | - Network Traffic (DS0003: Zeek Conn)<br>- Packet Analysis | - **Splunk**: `index=network sourcetype=zeek_conn ttl < 64 AND dest_port IN (80,443) \| stats count by src_ip, dest_ip \| where count > 50`.<br>- **KQL**: `DeviceNetworkEvents \| where AdditionalFields.TTL < 64 and RemotePort in (80, 443) \| summarize count() by DeviceIP, RemoteIP \| where count_ > 50`.<br>- **ELK**: `FROM logs-zeek.conn-* \| WHERE network.ttl < 64 AND destination.port IN [80, 443] \| STATS COUNT() BY source.ip, destination.ip HAVING COUNT() > 50`. |
| 6. IP Block Scanning in Linux Environments | Scanning targeting Linux servers, as in Turla campaigns. | - Network Traffic (DS0003: Zeek Conn)<br>- Linux Logs | - **Splunk**: `index=linux sourcetype=auditd syscall="connect" AND dest_port IN (22,80,443) AND src_ip NOT IN (trusted_ips) \| stats count by src_ip, dest_ip \| where count > 20`.<br>- **KQL**: `DeviceNetworkEvents \| where RemotePort in (22, 80, 443) and DeviceIP !in (trustedIPs) \| summarize count() by DeviceIP, RemoteIP \| where count_ > 20`.<br>- **ELK**: `FROM logs-auditd-* \| WHERE syscall.name = "connect" AND destination.port IN [22, 80, 443] AND source.ip NOT IN ['trusted_ips'] \| STATS COUNT() BY source.ip, destination.ip HAVING COUNT() > 20`. |
| 7. IP Block Scanning with Suspicious User Agents | Scanning with non-standard user agents, as in Cobalt Strike reconnaissance. | - Network Traffic (DS0003: Zeek HTTP)<br>- Proxy Logs | - **Splunk**: `index=network sourcetype=zeek_http user_agent NOT IN (known_agents) AND dest_port IN (80,443) \| stats count by src_ip, user_agent \| where count > 10`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "HTTP" and AdditionalFields.UserAgent !in (knownAgents) and RemotePort in (80, 443) \| summarize count() by DeviceIP, AdditionalFields.UserAgent \| where count_ > 10`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE http.user_agent NOT IN ['known_agents'] AND destination.port IN [80, 443] \| STATS COUNT() BY source.ip, http.user_agent HAVING COUNT() > 10`. |
| 8. IP Block Scanning with Rapid Sequential Ports | Adversaries scan sequential ports across IP blocks, as in Volt Typhoon. | - Network Traffic (DS0003: Zeek Conn)<br>- Firewall Logs | - **Splunk**: `index=network sourcetype=zeek_conn \| stats count by src_ip, dest_ip, dest_port \| where count > 50 AND max(dest_port) - min(dest_port) < 10`.<br>- **KQL**: `DeviceNetworkEvents \| summarize count(), max(RemotePort), min(RemotePort) by DeviceIP, RemoteIP \| where count_ > 50 and (max_RemotePort - min_RemotePort) < 10`.<br>- **ELK**: `FROM logs-zeek.conn-* \| STATS COUNT(), MAX(destination.port), MIN(destination.port) BY source.ip, destination.ip HAVING COUNT() > 50 AND (MAX(destination.port) - MIN(destination.port)) < 10`. |
| 9. IP Block Scanning with High Failure Rates | Scanning with high connection failure rates, indicating reconnaissance, as in APT41. | - Network Traffic (DS0003: Zeek Conn)<br>- Firewall Logs | - **Splunk**: `index=network sourcetype=zeek_conn conn_state="REJ" AND dest_port IN (80,443,3389) \| stats count by src_ip, dest_ip \| where count > 50`.<br>- **KQL**: `DeviceNetworkEvents \| where AdditionalFields.ConnectionState == "REJ" and RemotePort in (80, 443, 3389) \| summarize count() by DeviceIP, RemoteIP \| where count_ > 50`.<br>- **ELK**: `FROM logs-zeek.conn-* \| WHERE network.connection.state = 'REJ' AND destination.port IN [80, 443, 3389] \| STATS COUNT() BY source.ip, destination.ip HAVING COUNT() > 50`. |
| 10. IP Block Scanning Targeting Internal Networks | Internal hosts scanning IP blocks, indicating compromised insider, as in FIN7. | - Network Traffic (DS0003: Zeek Conn)<br>- Endpoint Logs | - **Splunk**: `index=network sourcetype=zeek_conn src_ip IN (internal_ips) AND dest_ip IN (internal_ips) AND dest_port IN (80,443) \| stats count by src_ip, dest_ip \| where count > 50`.<br>- **KQL**: `DeviceNetworkEvents \| where DeviceIP in (internalIPs) and RemoteIP in (internalIPs) and RemotePort in (80, 443) \| summarize count() by DeviceIP, RemoteIP \| where count_ > 50`.<br>- **ELK**: `FROM logs-zeek.conn-* \| WHERE source.ip IN ['internal_ips'] AND destination.ip IN ['internal_ips'] AND destination.port IN [80, 443] \| STATS COUNT() BY source.ip, destination.ip HAVING COUNT() > 50`. |

## T1595.002: Vulnerability Scanning

| Hypothesis | Description | Data Sources | Hunting Queries |
|-----------|-------------|--------------|-----------------|
| 1. Vulnerability Scanning with Known Tools | Adversaries use tools like Nessus or OpenVAS for vulnerability scanning, as in Volt Typhoon. | - Network Traffic (DS0003: Zeek HTTP)<br>- Proxy Logs | - **Splunk**: `index=network sourcetype=zeek_http user_agent IN ("*Nessus*", "*OpenVAS*") \| stats count by src_ip, user_agent \| where count > 10`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "HTTP" and AdditionalFields.UserAgent has_any ("Nessus", "OpenVAS") \| summarize count() by DeviceIP, AdditionalFields.UserAgent \| where count_ > 10`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE http.user_agent : ("*Nessus*" OR "*OpenVAS*") \| STATS COUNT() BY source.ip, http.user_agent HAVING COUNT() > 10`. |
| 2. Vulnerability Scanning with Specific Ports | Scanning targets specific ports associated with vulnerabilities (e.g., 445 for SMB), as in APT41. | - Network Traffic (DS0003: Zeek Conn)<br>- Firewall Logs | - **Splunk**: `index=network sourcetype=zeek_conn dest_port IN (445,1433,3306) \| stats count by src_ip, dest_port \| where count > 50`.<br>- **KQL**: `DeviceNetworkEvents \| where RemotePort in (445, 1433, 3306) \| summarize count() by DeviceIP, RemotePort \| where count_ > 50`.<br>- **ELK**: `FROM logs-zeek.conn-* \| WHERE destination.port IN [445, 1433, 3306] \| STATS COUNT() BY source.ip, destination.port HAVING COUNT() > 50`. |
| 3. Vulnerability Scanning in Cloud Environments | Adversaries scan cloud services for misconfigurations, as in 2025 trends. | - Cloud Audit Logs (AWS CloudTrail)<br>- Network Traffic | - **Splunk**: `index=cloud sourcetype=aws:cloudtrail eventName IN ("DescribeSecurityGroups", "DescribeInstances") AND src_ip NOT IN (trusted_ips) \| stats count by src_ip, eventName \| where count > 50`.<br>- **KQL**: `AWSCloudTrail \| where EventName in ("DescribeSecurityGroups", "DescribeInstances") and SourceIP !in (trustedIPs) \| summarize count() by SourceIP, EventName \| where count_ > 50`.<br>- **ELK**: `FROM logs-aws.cloudtrail-* \| WHERE event.action IN ['DescribeSecurityGroups', 'DescribeInstances'] AND source.ip NOT IN ['trusted_ips'] \| STATS COUNT() BY source.ip, event.action HAVING COUNT() > 50`. |
| 4. Vulnerability Scanning with High Failure Rates | Scanning with high failure rates, indicating probing for vulnerabilities, as in APT29. | - Network Traffic (DS0003: Zeek Conn)<br>- Firewall Logs | - **Splunk**: `index=network sourcetype=zeek_conn conn_state="REJ" AND dest_port IN (445,1433) \| stats count by src_ip, dest_port \| where count > 50`.<br>- **KQL**: `DeviceNetworkEvents \| where AdditionalFields.ConnectionState == "REJ" and RemotePort in (445, 1433) \| summarize count() by DeviceIP, RemotePort \| where count_ > 50`.<br>- **ELK**: `FROM logs-zeek.conn-* \| WHERE network.connection.state = 'REJ' AND destination.port IN [445, 1433] \| STATS COUNT() BY source.ip, destination.port HAVING COUNT() > 50`. |
| 5. Vulnerability Scanning from Compromised Endpoints | Compromised internal hosts perform vulnerability scans, as in FIN7. | - Process Creation (DS0009: Sysmon ID 1)<br>- Network Traffic | - **Splunk**: `index=endpoint sourcetype=sysmon EventCode=1 CommandLine IN ("*nmap*", "*nessus*") \| join host [search index=network sourcetype=zeek_conn dest_port IN (445,1433)] \| stats count by host, CommandLine, dest_port \| where count > 10`.<br>- **KQL**: `DeviceProcessEvents \| where ProcessCommandLine has_any ("nmap", "nessus") \| join kind=inner (DeviceNetworkEvents \| where RemotePort in (445, 1433)) on DeviceName \| summarize count() by DeviceName, ProcessCommandLine, RemotePort \| where count_ > 10`.<br>- **ELK**: `FROM logs-endpoint.process-* \| WHERE process.command_line : ("*nmap*" OR "*nessus*") \| JOIN logs-zeek.conn-* ON host.name WHERE destination.port IN [445, 1433] \| STATS COUNT() BY host.name, process.command_line, destination.port HAVING COUNT() > 10`. |
| 6. Vulnerability Scanning with Suspicious Headers | Scanning with custom HTTP headers, as in Cobalt Strike reconnaissance. | - Network Traffic (DS0003: Zeek HTTP)<br>- Proxy Logs | - **Splunk**: `index=network sourcetype=zeek_http header IN ("*X-Scan*", "*Custom-Scan*") \| stats count by src_ip, header \| where count > 10`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "HTTP" and AdditionalFields.Header has_any ("X-Scan", "Custom-Scan") \| summarize count() by DeviceIP, AdditionalFields.Header \| where count_ > 10`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE http.header : ("*X-Scan*" OR "*Custom-Scan*") \| STATS COUNT() BY source.ip, http.header HAVING COUNT() > 10`. |
| 7. Vulnerability Scanning in Linux Environments | Scanning targeting Linux services (e.g., SSH, Apache), as in Turla. | - Network Traffic (DS0003: Zeek Conn)<br>- Linux Logs | - **Splunk**: `index=linux sourcetype=auditd syscall="connect" AND dest_port IN (22,80,443) AND src_ip NOT IN (trusted_ips) \| stats count by src_ip, dest_port \| where count > 20`.<br>- **KQL**: `DeviceNetworkEvents \| where RemotePort in (22, 80, 443) and DeviceIP !in (trustedIPs) \| summarize count() by DeviceIP, RemotePort \| where count_ > 20`.<br>- **ELK**: `FROM logs-auditd-* \| WHERE syscall.name = "connect" AND destination.port IN [22, 80, 443] AND source.ip NOT IN ['trusted_ips'] \| STATS COUNT() BY source.ip, destination.port HAVING COUNT() > 20`. |
| 8. Vulnerability Scanning with Rapid Sequential IPs | Scanning targets sequential IPs for vulnerabilities, as in Volt Typhoon. | - Network Traffic (DS0003: Zeek Conn)<br>- Firewall Logs | - **Splunk**: `index=network sourcetype=zeek_conn dest_port IN (445,1433) \| stats count by src_ip, dest_ip \| where count > 50 AND max(dest_ip) - min(dest_ip) < 10`.<br>- **KQL**: `DeviceNetworkEvents \| where RemotePort in (445, 1433) \| summarize count(), max(RemoteIP), min(RemoteIP) by DeviceIP \| where count_ > 50 and (max_RemoteIP - min_RemoteIP) < 10`.<br>- **ELK**: `FROM logs-zeek.conn-* \| WHERE destination.port IN [445, 1433] \| STATS COUNT(), MAX(destination.ip), MIN(destination.ip) BY source.ip HAVING COUNT() > 50 AND (MAX(destination.ip) - MIN(destination.ip)) < 10`. |
| 9. Vulnerability Scanning with High Entropy Payloads | Scanning with high-entropy payloads, indicating exploit attempts, as in APT41. | - Network Traffic (DS0003: Zeek HTTP)<br>- Packet Analysis | - **Splunk**: `index=network sourcetype=zeek_http payload_entropy > 7 AND dest_port IN (80,443) \| stats count by src_ip, uri \| where count > 10`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "HTTP" and AdditionalFields.PayloadEntropy > 7 and RemotePort in (80, 443) \| summarize count() by DeviceIP, RemoteUrl \| where count_ > 10`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE http.payload.entropy > 7 AND destination.port IN [80, 443] \| STATS COUNT() BY source.ip, http.uri HAVING COUNT() > 10`. |
| 10. Vulnerability Scanning Targeting Internal Hosts | Internal hosts performing vulnerability scans, indicating compromise, as in FIN7. | - Network Traffic (DS0003: Zeek Conn)<br>- Endpoint Logs | - **Splunk**: `index=network sourcetype=zeek_conn src_ip IN (internal_ips) AND dest_port IN (445,1433) \| stats count by src_ip, dest_ip \| where count > 50`.<br>- **KQL**: `DeviceNetworkEvents \| where DeviceIP in (internalIPs) and RemotePort in (445, 1433) \| summarize count() by DeviceIP, RemoteIP \| where count_ > 50`.<br>- **ELK**: `FROM logs-zeek.conn-* \| WHERE source.ip IN ['internal_ips'] AND destination.port IN [445, 1433] \| STATS COUNT() BY source.ip, destination.ip HAVING COUNT() > 50`. |

## T1595.003: Wordlist Scanning

| Hypothesis | Description | Data Sources | Hunting Queries |
|-----------|-------------|--------------|-----------------|
| 1. Wordlist Scanning for Directory Enumeration | Adversaries use wordlist scanning to enumerate directories, as in Volt Typhoon. | - Network Traffic (DS0003: Zeek HTTP)<br>- Web Server Logs | - **Splunk**: `index=network sourcetype=zeek_http uri IN ("*admin*", "*login*", "*wp-admin*") AND status_code=404 \| stats count by src_ip, uri \| where count > 50`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "HTTP" and RemoteUrl has_any ("admin", "login", "wp-admin") and AdditionalFields.StatusCode == 404 \| summarize count() by DeviceIP, RemoteUrl \| where count_ > 50`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE http.uri : ("*admin*" OR "*login*" OR "*wp-admin*") AND http.status = 404 \| STATS COUNT() BY source.ip, http.uri HAVING COUNT() > 50`. |
| 2. Wordlist Scanning with Rapid Requests | High-frequency wordlist scanning, indicating automated tools, as in APT41. | - Network Traffic (DS0003: Zeek HTTP)<br>- Metrics | - **Splunk**: `index=network sourcetype=zeek_http \| timechart span=1m count by src_ip \| where count > 100`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "HTTP" \| summarize MinuteCount=count() by bin(Timestamp, 1m), DeviceIP \| where MinuteCount > 100`.<br>- **ELK**: `FROM logs-zeek.http-* \| STATS COUNT() BY date_histogram(@timestamp, '1m'), source.ip \| WHERE COUNT() > 100`. |
| 3. Wordlist Scanning Targeting Cloud Applications | Scanning cloud-hosted apps (e.g., S3 buckets), as in 2025 trends. | - Cloud Audit Logs (AWS CloudTrail)<br>- Network Traffic | - **Splunk**: `index=cloud sourcetype=aws:cloudtrail eventName="ListBuckets" AND src_ip NOT IN (trusted_ips) \| stats count by src_ip, eventName \| where count > 50`.<br>- **KQL**: `AWSCloudTrail \| where EventName == "ListBuckets" and SourceIP !in (trustedIPs) \| summarize count() by SourceIP, EventName \| where count_ > 50`.<br>- **ELK**: `FROM logs-aws.cloudtrail-* \| WHERE event.action = 'ListBuckets' AND source.ip NOT IN ['trusted_ips'] \| STATS COUNT() BY source.ip, event.action HAVING COUNT() > 50`. |
| 4. Wordlist Scanning with Suspicious User Agents | Wordlist scanning with non-standard user agents, as in Cobalt Strike. | - Network Traffic (DS0003: Zeek HTTP)<br>- Proxy Logs | - **Splunk**: `index=network sourcetype=zeek_http user_agent NOT IN (known_agents) AND uri IN ("*admin*", "*login*") \| stats count by src_ip, user_agent \| where count > 20`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "HTTP" and AdditionalFields.UserAgent !in (knownAgents) and RemoteUrl has_any ("admin", "login") \| summarize count() by DeviceIP, AdditionalFields.UserAgent \| where count_ > 20`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE http.user_agent NOT IN ['known_agents'] AND http.uri : ("*admin*" OR "*login*") \| STATS COUNT() BY source.ip, http.user_agent HAVING COUNT() > 20`. |
| 5. Wordlist Scanning from Compromised Endpoints | Compromised internal hosts perform wordlist scanning, as in FIN7. | - Process Creation (DS0009: Sysmon ID 1)<br>- Network Traffic | - **Splunk**: `index=endpoint sourcetype=sysmon EventCode=1 CommandLine IN ("*curl*", "*wget*") \| join host [search index=network sourcetype=zeek_http uri IN ("*admin*", "*login*")] \| stats count by host, CommandLine, uri \| where count > 10`.<br>- **KQL**: `DeviceProcessEvents \| where ProcessCommandLine has_any ("curl", "wget") \| join kind=inner (DeviceNetworkEvents \| where Protocol == "HTTP" and RemoteUrl has_any ("admin", "login")) on DeviceName \| summarize count() by DeviceName, ProcessCommandLine, RemoteUrl \| where count_ > 10`.<br>- **ELK**: `FROM logs-endpoint.process-* \| WHERE process.command_line : ("*curl*" OR "*wget*") \| JOIN logs-zeek.http-* ON host.name WHERE http.uri : ("*admin*" OR "*login*") \| STATS COUNT() BY host.name, process.command_line, http.uri HAVING COUNT() > 10`. |
| 6. Wordlist Scanning in Linux Environments | Wordlist scanning targeting Linux web servers, as in Turla. | - Network Traffic (DS0003: Zeek HTTP)<br>- Linux Logs | - **Splunk**: `index=linux sourcetype=auditd syscall="connect" AND dest_port IN (80,443) AND uri IN ("*admin*", "*login*") \| stats count by src_ip, uri \| where count > 20`.<br>- **KQL**: `DeviceNetworkEvents \| where RemotePort in (80, 443) and RemoteUrl has_any ("admin", "login") \| summarize count() by DeviceIP, RemoteUrl \| where count_ > 20`.<br>- **ELK**: `FROM logs-auditd-* \| WHERE syscall.name = "connect" AND destination.port IN [80, 443] AND http.uri : ("*admin*" OR "*login*") \| STATS COUNT() BY source.ip, http.uri HAVING COUNT() > 20`. |
| 7. Wordlist Scanning with High 404 Rates | Wordlist scanning generating high 404 errors, as in APT41. | - Network Traffic (DS0003: Zeek HTTP)<br>- Web Server Logs | - **Splunk**: `index=network sourcetype=zeek_http status_code=404 \| stats count by src_ip, uri \| where count > 50`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "HTTP" and AdditionalFields.StatusCode == 404 \| summarize count() by DeviceIP, RemoteUrl \| where count_ > 50`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE http.status = 404 \| STATS COUNT() BY source.ip, http.uri HAVING COUNT() > 50`. |
| 8. Wordlist Scanning with Sequential URIs | Scanning with sequential URI patterns, as in Volt Typhoon. | - Network Traffic (DS0003: Zeek HTTP)<br>- Web Server Logs | - **Splunk**: `index=network sourcetype=zeek_http uri IN ("*admin*", "*login*") \| stats count by src_ip, uri \| where count > 50 AND uri MATCHES "[0-9]"`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "HTTP" and RemoteUrl has_any ("admin", "login") \| summarize count() by DeviceIP, RemoteUrl \| where count_ > 50 and RemoteUrl matches regex "[0-9]"`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE http.uri : ("*admin*" OR "*login*") \| STATS COUNT() BY source.ip, http.uri HAVING COUNT() > 50 AND http.uri MATCHES '[0-9]'`. |
| 9. Wordlist Scanning Targeting CMS Platforms | Scanning targeting CMS platforms (e.g., WordPress), as in APT29. | - Network Traffic (DS0003: Zeek HTTP)<br>- Web Server Logs | - **Splunk**: `index=network sourcetype=zeek_http uri IN ("*wp-admin*", "*drupal*") AND status_code=404 \| stats count by src_ip, uri \| where count > 50`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "HTTP" and RemoteUrl has_any ("wp-admin", "drupal") and AdditionalFields.StatusCode == 404 \| summarize count() by DeviceIP, RemoteUrl \| where count_ > 50`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE http.uri : ("*wp-admin*" OR "*drupal*") AND http.status = 404 \| STATS COUNT() BY source.ip, http.uri HAVING COUNT() > 50`. |
| 10. Wordlist Scanning with Anomalous Timing | Wordlist scanning outside business hours, as in 2025 trends. | - Network Traffic (DS0003: Zeek HTTP)<br>- Metrics | - **Splunk**: `index=network sourcetype=zeek_http uri IN ("*admin*", "*login*") \| timechart span=1h count by src_ip \| where count > avg(count)*3 AND (_time < "08:00" OR _time > "18:00")`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "HTTP" and RemoteUrl has_any ("admin", "login") \| summarize HourlyCount=count() by bin(Timestamp, 1h), DeviceIP \| where HourlyCount > avg(HourlyCount) * 3 and (hour(Timestamp) < 8 or hour(Timestamp) > 18)`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE http.uri : ("*admin*" OR "*login*") \| STATS COUNT() BY date_histogram(@timestamp, '1h'), source.ip \| WHERE COUNT() > AVG(COUNT()) * 3 AND (HOUR(@timestamp) < 8 OR HOUR(@timestamp) > 18)`. |

## T1595.004: Visual Reconnaissance

| Hypothesis | Description | Data Sources | Hunting Queries |
|-----------|-------------|--------------|-----------------|
| 1. Visual Reconnaissance via Screenshot Tools | Adversaries use screenshot tools for visual reconnaissance, as in Volt Typhoon. | - Process Creation (DS0009: Sysmon ID 1)<br>- Endpoint Logs | - **Splunk**: `index=endpoint sourcetype=sysmon EventCode=1 CommandLine IN ("*msscreen*", "*snippingtool*") \| stats count by host, CommandLine \| where count > 5`.<br>- **KQL**: `DeviceProcessEvents \| where ProcessCommandLine has_any ("msscreen", "snippingtool") \| summarize count() by DeviceName, ProcessCommandLine \| where count_ > 5`.<br>- **ELK**: `FROM logs-endpoint.process-* \| WHERE process.command_line : ("*msscreen*" OR "*snippingtool*") \| STATS COUNT() BY host.name, process.command_line HAVING COUNT() > 5`. |
| 2. Visual Reconnaissance via Browser Automation | Adversaries use browser automation tools (e.g., Selenium) for visual reconnaissance, as in APT41. | - Process Creation (DS0009: Sysmon ID 1)<br>- Network Traffic | - **Splunk**: `index=endpoint sourcetype=sysmon EventCode=1 CommandLine IN ("*selenium*", "*puppeteer*") \| join host [search index=network sourcetype=zeek_http] \| stats count by host, CommandLine, uri \| where count > 10`.<br>- **KQL**: `DeviceProcessEvents \| where ProcessCommandLine has_any ("selenium", "puppeteer") \| join kind=inner (DeviceNetworkEvents \| where Protocol == "HTTP") on DeviceName \| summarize count() by DeviceName, ProcessCommandLine, RemoteUrl \| where count_ > 10`.<br>- **ELK**: `FROM logs-endpoint.process-* \| WHERE process.command_line : ("*selenium*" OR "*puppeteer*") \| JOIN logs-zeek.http-* ON host.name \| STATS COUNT() BY host.name, process.command_line, http.uri HAVING COUNT() > 10`. |
| 3. Visual Reconnaissance in Cloud Environments | Adversaries access cloud consoles for visual reconnaissance, as in 2025 trends. | - Cloud Audit Logs (AWS CloudTrail)<br>- Authentication Logs | - **Splunk**: `index=cloud sourcetype=aws:cloudtrail eventName="ConsoleLogin" AND userIdentity NOT IN (authorized_users) \| stats count by src_ip, userIdentity \| where count > 5`.<br>- **KQL**: `AWSCloudTrail \| where EventName == "ConsoleLogin" and Caller !in (authorizedUsers) \| summarize count() by SourceIP, Caller \| where count_ > 5`.<br>- **ELK**: `FROM logs-aws.cloudtrail-* \| WHERE event.action = 'ConsoleLogin' AND user.identity NOT IN ['authorized_users'] \| STATS COUNT() BY source.ip, user.identity HAVING COUNT() > 5`. |
| 4. Visual Reconnaissance via RDP Sessions | Adversaries use RDP for visual reconnaissance, as in FIN7. | - Network Traffic (DS0003: Zeek Conn)<br>- Windows Logs | - **Splunk**: `index=windows sourcetype=WinEventLog:Security EventCode=4624 AND LogonType=10 AND src_ip NOT IN (trusted_ips) \| stats count by src_ip, dest_host \| where count > 5`.<br>- **KQL**: `SecurityEvent \| where EventID == 4624 and LogonType == 10 and SourceIP !in (trustedIPs) \| summarize count() by SourceIP, TargetServerName \| where count_ > 5`.<br>- **ELK**: `FROM logs-windows.security-* \| WHERE event.code = '4624' AND winlog.logon.type = '10' AND source.ip NOT IN ['trusted_ips'] \| STATS COUNT() BY source.ip, winlog.event_data.TargetServerName HAVING COUNT() > 5`. |
| 5. Visual Reconnaissance via Screen Recording | Adversaries use screen recording tools, as in APT29. | - Process Creation (DS0009: Sysmon ID 1)<br>- Endpoint Logs | - **Splunk**: `index=endpoint sourcetype=sysmon EventCode=1 CommandLine IN ("*obs*", "*camtasia*") \| stats count by host, CommandLine \| where count > 5`.<br>- **KQL**: `DeviceProcessEvents \| where ProcessCommandLine has_any ("obs", "camtasia") \| summarize count() by DeviceName, ProcessCommandLine \| where count_ > 5`.<br>- **ELK**: `FROM logs-endpoint.process-* \| WHERE process.command_line : ("*obs*" OR "*camtasia*") \| STATS COUNT() BY host.name, process.command_line HAVING COUNT() > 5`. |
| 6. Visual Reconnaissance in Linux Environments | Adversaries use Linux screenshot tools (e.g., gnome-screenshot), as in Turla. | - Process Creation (Linux Auditd)<br>- Linux Logs | - **Splunk**: `index=linux sourcetype=auditd exe IN ("*gnome-screenshot*", "*scrot*") \| stats count by host, exe \| where count > 5`.<br>- **KQL**: `LinuxAuditd \| where ProcessName has_any ("gnome-screenshot", "scrot") \| summarize count() by HostName, ProcessName \| where count_ > 5`.<br>- **ELK**: `FROM logs-auditd-* \| WHERE process.exe : ("*gnome-screenshot*" OR "*scrot*") \| STATS COUNT() BY host.name, process.exe HAVING COUNT() > 5`. |
| 7. Visual Reconnaissance with Anomalous Timing | Visual reconnaissance outside business hours, as in 2025 trends. | - Process Creation (DS0009: Sysmon ID 1)<br>- Metrics | - **Splunk**: `index=endpoint sourcetype=sysmon EventCode=1 CommandLine IN ("*msscreen*", "*snippingtool*") \| timechart span=1h count by host \| where count > avg(count)*3 AND (_time < "08:00" OR _time > "18:00")`.<br>- **KQL**: `DeviceProcessEvents \| where ProcessCommandLine has_any ("msscreen", "snippingtool") \| summarize HourlyCount=count() by bin(Timestamp, 1h), DeviceName \| where HourlyCount > avg(HourlyCount) * 3 and (hour(Timestamp) < 8 or hour(Timestamp) > 18)`.<br>- **ELK**: `FROM logs-endpoint.process-* \| WHERE process.command_line : ("*msscreen*" OR "*snippingtool*") \| STATS COUNT() BY date_histogram(@timestamp, '1h'), host.name \| WHERE COUNT() > AVG(COUNT()) * 3 AND (HOUR(@timestamp) < 8 OR HOUR(@timestamp) > 18)`. |
| 8. Visual Reconnaissance via Web Scraping | Adversaries use web scraping tools for visual reconnaissance, as in APT41. | - Network Traffic (DS0003: Zeek HTTP)<br>- Proxy Logs | - **Splunk**: `index=network sourcetype=zeek_http user_agent IN ("*Scrapy*", "*BeautifulSoup*") \| stats count by src_ip, user_agent \| where count > 10`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "HTTP" and AdditionalFields.UserAgent has_any ("Scrapy", "BeautifulSoup") \| summarize count() by DeviceIP, AdditionalFields.UserAgent \| where count_ > 10`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE http.user_agent : ("*Scrapy*" OR "*BeautifulSoup*") \| STATS COUNT() BY source.ip, http.user_agent HAVING COUNT() > 10`. |
| 9. Visual Reconnaissance via Remote Access Tools | Adversaries use RATs for visual reconnaissance, as in Cobalt Strike. | - Process Creation (DS0009: Sysmon ID 1)<br>- Network Traffic | - **Splunk**: `index=endpoint sourcetype=sysmon EventCode=1 CommandLine IN ("*teamviewer*", "*anydesk*") \| join host [search index=network sourcetype=zeek_conn] \| stats count by host, CommandLine, dest_ip \| where count > 5`.<br>- **KQL**: `DeviceProcessEvents \| where ProcessCommandLine has_any ("teamviewer", "anydesk") \| join kind=inner (DeviceNetworkEvents) on DeviceName \| summarize count() by DeviceName, ProcessCommandLine, RemoteIP \| where count_ > 5`.<br>- **ELK**: `FROM logs-endpoint.process-* \| WHERE process.command_line : ("*teamviewer*" OR "*anydesk*") \| JOIN logs-zeek.conn-* ON host.name \| STATS COUNT() BY host.name, process.command_line, destination.ip HAVING COUNT() > 5`. |
| 10. Visual Reconnaissance with Suspicious Network Traffic | Visual reconnaissance generating suspicious network patterns, as in APT29. | - Network Traffic (DS0003: Zeek HTTP)<br>- Proxy Logs | - **Splunk**: `index=network sourcetype=zeek_http uri IN ("*screenshot*", "*capture*") \| stats count by src_ip, uri \| where count > 10`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "HTTP" and RemoteUrl has_any ("screenshot", "capture") \| summarize count() by DeviceIP, RemoteUrl \| where count_ > 10`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE http.uri : ("*screenshot*" OR "*capture*") \| STATS COUNT() BY source.ip, http.uri HAVING COUNT() > 10`. |
