---
layout: default
title:  Initial Access
category: Threat-Hunting-Queries  # This becomes a main topic in sidebar
---

## Initial Access

### T1133: External Remote Services
### T1133.001: Remote Desktop Protocol (RDP)

| Hypothesis | Description | Data Sources | Hunting Queries |
|-----------|-------------|--------------|-----------------|
| 1. Unauthorized RDP Access from External IPs | Adversaries use compromised credentials for RDP access, as in Volt Typhoon. | - Network Traffic (DS0003: Zeek Conn)<br>- Windows Event Logs (DS0002: Event ID 4624) | - **Splunk**: `index=network sourcetype=zeek_conn dest_port=3389 AND src_ip NOT IN (trusted_ips) \| join src_ip [search index=windows sourcetype=WinEventLog EventCode=4624 LogonType=10] \| stats count by src_ip, dest_ip, Account_Name \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where RemotePort == 3389 and DeviceIP !in (trustedIPs) \| join kind=inner (SecurityEvent \| where EventID == 4624 and LogonType == 10) on DeviceIP \| summarize count() by DeviceIP, RemoteIP, AccountName \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.conn-* \| WHERE destination.port == 3389 AND source.ip NOT IN ['trusted_ips'] \| JOIN logs-windows.security-* ON source.ip WHERE event.code == '4624' AND winlog.event_data.LogonType == '10' \| STATS COUNT() BY source.ip, destination.ip, winlog.event_data.AccountName HAVING COUNT() > 5`. |
| 2. High-Frequency RDP Attempts | High-frequency RDP connection attempts indicating brute force, as in APT41. | - Network Traffic (DS0003: Zeek Conn)<br>- Metrics | - **Splunk**: `index=network sourcetype=zeek_conn dest_port=3389 \| timechart span=1m count by src_ip \| where count > 50`.<br>- **KQL**: `DeviceNetworkEvents \| where RemotePort == 3389 \| summarize MinuteCount=count() by bin(Timestamp, 1m), DeviceIP \| where MinuteCount > 50`.<br>- **ELK**: `FROM logs-zeek.conn-* \| WHERE destination.port == 3389 \| STATS COUNT() BY date_histogram(@timestamp, '1m'), source.ip \| WHERE COUNT() > 50`. |
| 3. RDP Access with Suspicious User Accounts | Adversaries use non-standard accounts for RDP access, as in FIN7. | - Windows Event Logs (DS0002: Event ID 4624) | - **Splunk**: `index=windows sourcetype=WinEventLog EventCode=4624 LogonType=10 Account_Name NOT IN (authorized_users) \| stats count by src_ip, Account_Name \| where count > 5`.<br>- **KQL**: `SecurityEvent \| where EventID == 4624 and LogonType == 10 and AccountName !in (authorizedUsers) \| summarize count() by ClientIP, AccountName \| where count_ > 5`.<br>- **ELK**: `FROM logs-windows.security-* \| WHERE event.code == '4624' AND winlog.event_data.LogonType == '10' AND winlog.event_data.AccountName NOT IN ['authorized_users'] \| STATS COUNT() BY source.ip, winlog.event_data.AccountName HAVING COUNT() > 5`. |
| 4. RDP Access Outside Business Hours | RDP connections outside business hours, as in APT29. | - Windows Event Logs (DS0002: Event ID 4624)<br>- Metrics | - **Splunk**: `index=windows sourcetype=WinEventLog EventCode=4624 LogonType=10 \| timechart span=1h count by src_ip \| where count > avg(count)*3 AND (_time < "08:00" OR _time > "18:00")`.<br>- **KQL**: `SecurityEvent \| where EventID == 4624 and LogonType == 10 \| summarize HourlyCount=count() by bin(Timestamp, 1h), ClientIP \| where HourlyCount > avg(HourlyCount) * 3 and (hour(Timestamp) < 8 or hour(Timestamp) > 18)`.<br>- **ELK**: `FROM logs-windows.security-* \| WHERE event.code == '4624' AND winlog.event_data.LogonType == '10' \| STATS COUNT() BY date_histogram(@timestamp, '1h'), source.ip \| WHERE COUNT() > AVG(COUNT()) * 3 AND (HOUR(@timestamp) < 8 OR HOUR(@timestamp) > 18)`. |
| 5. RDP Access with Anomalous Ports | Adversaries use non-standard ports for RDP, as in 2025 trends. | - Network Traffic (DS0003: Zeek Conn) | - **Splunk**: `index=network sourcetype=zeek_conn dest_port NOT IN (3389) AND protocol="tcp" AND service="rdp" \| stats count by src_ip, dest_ip, dest_port \| where count > 10`.<br>- **KQL**: `DeviceNetworkEvents \| where RemotePort !in (3389) and Protocol == "TCP" and Service == "rdp" \| summarize count() by DeviceIP, RemoteIP, RemotePort \| where count_ > 10`.<br>- **ELK**: `FROM logs-zeek.conn-* \| WHERE destination.port NOT IN [3389] AND protocol == 'tcp' AND service == 'rdp' \| STATS COUNT() BY source.ip, destination.ip, destination.port HAVING COUNT() > 10`. |
| 6. RDP Access in Cloud Environments | Adversaries use RDP to access compromised cloud instances, as in 2025 trends. | - Cloud Audit Logs (AWS CloudTrail)<br>- Network Traffic (DS0003: Zeek Conn) | - **Splunk**: `index=cloud sourcetype=aws:cloudtrail eventName IN ("AuthorizeSecurityGroupIngress") AND requestParameters IN ("3389") AND src_ip NOT IN (trusted_ips) \| join src_ip [search index=network sourcetype=zeek_conn dest_port=3389] \| stats count by src_ip, eventName, dest_ip \| where count > 5`.<br>- **KQL**: `AWSCloudTrail \| where EventName in ("AuthorizeSecurityGroupIngress") and RequestParameters has "3389" and SourceIP !in (trustedIPs) \| join kind=inner (DeviceNetworkEvents \| where RemotePort == 3389) on SourceIP \| summarize count() by SourceIP, EventName, RemoteIP \| where count_ > 5`.<br>- **ELK**: `FROM logs-aws.cloudtrail-* \| WHERE event.action IN ['AuthorizeSecurityGroupIngress'] AND event.request_parameters : '3389' AND source.ip NOT IN ['trusted_ips'] \| JOIN logs-zeek.conn-* ON source.ip WHERE destination.port == 3389 \| STATS COUNT() BY source.ip, event.action, destination.ip HAVING COUNT() > 5`. |
| 7. RDP Access with Suspicious User Agents | Adversaries use non-standard user agents for RDP connections, as in APT41. | - Network Traffic (DS0003: Zeek RDP)<br>- Proxy Logs | - **Splunk**: `index=network sourcetype=zeek_rdp user_agent NOT IN (known_agents) AND dest_port=3389 \| stats count by src_ip, user_agent, dest_ip \| where count > 10`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "RDP" and AdditionalFields.UserAgent !in (knownAgents) and RemotePort == 3389 \| summarize count() by DeviceIP, AdditionalFields.UserAgent, RemoteIP \| where count_ > 10`.<br>- **ELK**: `FROM logs-zeek.rdp-* \| WHERE rdp.user_agent NOT IN ['known_agents'] AND destination.port == 3389 \| STATS COUNT() BY source.ip, rdp.user_agent, destination.ip HAVING COUNT() > 10`. |
| 8. RDP Access with Failed Logins | Multiple failed RDP login attempts indicating credential stuffing, as in Volt Typhoon. | - Windows Event Logs (DS0002: Event ID 4625) | - **Splunk**: `index=windows sourcetype=WinEventLog EventCode=4625 LogonType=10 \| stats count by src_ip, Account_Name \| where count > 10`.<br>- **KQL**: `SecurityEvent \| where EventID == 4625 and LogonType == 10 \| summarize count() by ClientIP, AccountName \| where count_ > 10`.<br>- **ELK**: `FROM logs-windows.security-* \| WHERE event.code == '4625' AND winlog.event_data.LogonType == '10' \| STATS COUNT() BY source.ip, winlog.event_data.AccountName HAVING COUNT() > 10`. |
| 9. RDP Access from Compromised Endpoints | Compromised endpoints initiate RDP connections, as in FIN7. | - Process Creation (DS0009: Sysmon ID 1)<br>- Network Traffic (DS0003: Zeek Conn) | - **Splunk**: `index=endpoint sourcetype=sysmon EventCode=1 Image="*mstsc.exe" \| join host [search index=network sourcetype=zeek_conn dest_port=3389] \| stats count by host, Image, dest_ip \| where count > 5`.<br>- **KQL**: `DeviceProcessEvents \| where ProcessName == "mstsc.exe" \| join kind=inner (DeviceNetworkEvents \| where RemotePort == 3389) on DeviceName \| summarize count() by DeviceName, ProcessName, RemoteIP \| where count_ > 5`.<br>- **ELK**: `FROM logs-endpoint.process-* \| WHERE process.executable : '*mstsc.exe' \| JOIN logs-zeek.conn-* ON host.name WHERE destination.port == 3389 \| STATS COUNT() BY host.name, process.executable, destination.ip HAVING COUNT() > 5`. |
| 10. RDP Access with Anomalous Session Duration | RDP sessions with unusual durations indicating persistence, as in APT29. | - Windows Event Logs (DS0002: Event ID 4624, 4634) | - **Splunk**: `index=windows sourcetype=WinEventLog EventCode IN (4624, 4634) LogonType=10 \| eval session_duration=if(EventCode=4634, _time - mvindex(_time, -1), null) \| stats count, avg(session_duration) as avg_duration by src_ip, Account_Name \| where avg_duration > 3600`.<br>- **KQL**: `SecurityEvent \| where EventID in (4624, 4634) and LogonType == 10 \| summarize SessionDuration=make_list(Timestamp), count() by ClientIP, AccountName \| project ClientIP, AccountName, count_, AvgDuration=avg(datetime_diff('second', SessionDuration[-1], SessionDuration[-2])) \| where AvgDuration > 3600`.<br>- **ELK**: `FROM logs-windows.security-* \| WHERE event.code IN ['4624', '4634'] AND winlog.event_data.LogonType == '10' \| EVAL session_duration = IF(event.code == '4634', @timestamp - LAG(@timestamp), NULL) \| STATS COUNT(), AVG(session_duration) AS avg_duration BY source.ip, winlog.event_data.AccountName \| WHERE avg_duration > 3600`. |

### T1133.002: File Transfer Protocol (FTP)

| Hypothesis | Description | Data Sources | Hunting Queries |
|-----------|-------------|--------------|-----------------|
| 1. Unauthorized FTP Access from External IPs | Adversaries use compromised credentials for FTP access, as in Volt Typhoon. | - Network Traffic (DS0003: Zeek FTP)<br>- File Transfer Logs | - **Splunk**: `index=network sourcetype=zeek_ftp src_ip NOT IN (trusted_ips) AND dest_port IN (20, 21) \| stats count by src_ip, dest_ip, user \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where RemotePort in (20, 21) and DeviceIP !in (trustedIPs) \| summarize count() by DeviceIP, RemoteIP, AdditionalFields.User \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.ftp-* \| WHERE destination.port IN [20, 21] AND source.ip NOT IN ['trusted_ips'] \| STATS COUNT() BY source.ip, destination.ip, ftp.user HAVING COUNT() > 5`. |
| 2. High-Frequency FTP Transfers | High-frequency FTP transfers indicating data exfiltration, as in APT41. | - Network Traffic (DS0003: Zeek FTP)<br>- Metrics | - **Splunk**: `index=network sourcetype=zeek_ftp dest_port IN (20, 21) \| timechart span=1m count by src_ip \| where count > 50`.<br>- **KQL**: `DeviceNetworkEvents \| where RemotePort in (20, 21) \| summarize MinuteCount=count() by bin(Timestamp, 1m), DeviceIP \| where MinuteCount > 50`.<br>- **ELK**: `FROM logs-zeek.ftp-* \| WHERE destination.port IN [20, 21] \| STATS COUNT() BY date_histogram(@timestamp, '1m'), source.ip \| WHERE COUNT() > 50`. |
| 3. FTP Access with Suspicious File Types | Adversaries transfer sensitive file types via FTP, as in FIN7. | - Network Traffic (DS0003: Zeek FTP) | - **Splunk**: `index=network sourcetype=zeek_ftp file IN ("*.zip", "*.rar", "*.docx", "*.pdf") AND src_ip NOT IN (trusted_ips) \| stats count by src_ip, dest_ip, file \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "FTP" and AdditionalFields.FileName has_any (".zip", ".rar", ".docx", ".pdf") and DeviceIP !in (trustedIPs) \| summarize count() by DeviceIP, RemoteIP, AdditionalFields.FileName \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.ftp-* \| WHERE ftp.file : ("*.zip" OR "*.rar" OR "*.docx" OR "*.pdf") AND source.ip NOT IN ['trusted_ips'] \| STATS COUNT() BY source.ip, destination.ip, ftp.file HAVING COUNT() > 5`. |
| 4. FTP Access Outside Business Hours | FTP transfers outside business hours, as in APT29. | - Network Traffic (DS0003: Zeek FTP)<br>- Metrics | - **Splunk**: `index=network sourcetype=zeek_ftp dest_port IN (20, 21) \| timechart span=1h count by src_ip \| where count > avg(count)*3 AND (_time < "08:00" OR _time > "18:00")`.<br>- **KQL**: `DeviceNetworkEvents \| where RemotePort in (20, 21) \| summarize HourlyCount=count() by bin(Timestamp, 1h), DeviceIP \| where HourlyCount > avg(HourlyCount) * 3 and (hour(Timestamp) < 8 or hour(Timestamp) > 18)`.<br>- **ELK**: `FROM logs-zeek.ftp-* \| WHERE destination.port IN [20, 21] \| STATS COUNT() BY date_histogram(@timestamp, '1h'), source.ip \| WHERE COUNT() > AVG(COUNT()) * 3 AND (HOUR(@timestamp) < 8 OR HOUR(@timestamp) > 18)`. |
| 5. FTP Access in Linux Environments | Adversaries use FTP in Linux environments for exfiltration, as in Turla. | - Process Creation (Linux Auditd)<br>- Network Traffic (DS0003: Zeek FTP) | - **Splunk**: `index=linux sourcetype=auditd exe IN ("*ftp*", "*sftp*") AND args IN ("*get*", "*put*") \| join host [search index=network sourcetype=zeek_ftp dest_port IN (20, 21)] \| stats count by host, exe, dest_ip \| where count > 5`.<br>- **KQL**: `LinuxAuditd \| where ProcessName has_any ("ftp", "sftp") and CommandLine has_any ("get", "put") \| join kind=inner (DeviceNetworkEvents \| where RemotePort in (20, 21)) on HostName \| summarize count() by HostName, ProcessName, RemoteIP \| where count_ > 5`.<br>- **ELK**: `FROM logs-auditd-* \| WHERE process.exe : ("*ftp*" OR "*sftp*") AND process.args : ("*get*" OR "*put*") \| JOIN logs-zeek.ftp-* ON host.name WHERE destination.port IN [20, 21] \| STATS COUNT() BY host.name, process.exe, destination.ip HAVING COUNT() > 5`. |
| 6. FTP Access with Suspicious User Agents | Adversaries use non-standard user agents for FTP transfers, as in APT41. | - Network Traffic (DS0003: Zeek FTP)<br>- Proxy Logs | - **Splunk**: `index=network sourcetype=zeek_ftp user_agent NOT IN (known_agents) AND dest_port IN (20, 21) \| stats count by src_ip, user_agent, dest_ip \| where count > 10`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "FTP" and AdditionalFields.UserAgent !in (knownAgents) and RemotePort in (20, 21) \| summarize count() by DeviceIP, AdditionalFields.UserAgent, RemoteIP \| where count_ > 10`.<br>- **ELK**: `FROM logs-zeek.ftp-* \| WHERE ftp.user_agent NOT IN ['known_agents'] AND destination.port IN [20, 21] \| STATS COUNT() BY source.ip, ftp.user_agent, destination.ip HAVING COUNT() > 10`. |
| 7. FTP Access with Large Data Transfers | Large data transfers via FTP indicating exfiltration, as in Volt Typhoon. | - Network Traffic (DS0003: Zeek FTP) | - **Splunk**: `index=network sourcetype=zeek_ftp dest_port IN (20, 21) AND bytes_out > 1000000 \| stats count by src_ip, dest_ip, bytes_out \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "FTP" and RemotePort in (20, 21) and BytesSent > 1000000 \| summarize count() by DeviceIP, RemoteIP, BytesSent \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.ftp-* \| WHERE destination.port IN [20, 21] AND ftp.bytes_out > 1000000 \| STATS COUNT() BY source.ip, destination.ip, ftp.bytes_out HAVING COUNT() > 5`. |
| 8. FTP Access from Compromised Endpoints | Compromised endpoints initiate FTP transfers, as in FIN7. | - Process Creation (DS0009: Sysmon ID 1)<br>- Network Traffic (DS0003: Zeek FTP) | - **Splunk**: `index=endpoint sourcetype=sysmon EventCode=1 Image IN ("*ftp.exe*", "*filezilla.exe*") \| join host [search index=network sourcetype=zeek_ftp dest_port IN (20, 21)] \| stats count by host, Image, dest_ip \| where count > 5`.<br>- **KQL**: `DeviceProcessEvents \| where ProcessName has_any ("ftp.exe", "filezilla.exe") \| join kind=inner (DeviceNetworkEvents \| where RemotePort in (20, 21)) on DeviceName \| summarize count() by DeviceName, ProcessName, RemoteIP \| where count_ > 5`.<br>- **ELK**: `FROM logs-endpoint.process-* \| WHERE process.executable : ("*ftp.exe*" OR "*filezilla.exe*") \| JOIN logs-zeek.ftp-* ON host.name WHERE destination.port IN [20, 21] \| STATS COUNT() BY host.name, process.executable, destination.ip HAVING COUNT() > 5`. |
| 9. FTP Access with Failed Logins | Multiple failed FTP login attempts indicating credential stuffing, as in Volt Typhoon. | - Network Traffic (DS0003: Zeek FTP) | - **Splunk**: `index=network sourcetype=zeek_ftp status="failed" AND dest_port IN (20, 21) \| stats count by src_ip, user \| where count > 10`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "FTP" and AdditionalFields.Status == "failed" and RemotePort in (20, 21) \| summarize count() by DeviceIP, AdditionalFields.User \| where count_ > 10`.<br>- **ELK**: `FROM logs-zeek.ftp-* \| WHERE ftp.status == 'failed' AND destination.port IN [20, 21] \| STATS COUNT() BY source.ip, ftp.user HAVING COUNT() > 10`. |
| 10. FTP Access in Cloud Environments | Adversaries use FTP to access compromised cloud instances, as in 2025 trends. | - Cloud Audit Logs (AWS CloudTrail)<br>- Network Traffic (DS0003: Zeek FTP) | - **Splunk**: `index=cloud sourcetype=aws:cloudtrail eventName IN ("AuthorizeSecurityGroupIngress") AND requestParameters IN ("20", "21") AND src_ip NOT IN (trusted_ips) \| join src_ip [search index=network sourcetype=zeek_ftp dest_port IN (20, 21)] \| stats count by src_ip, eventName, dest_ip \| where count > 5`.<br>- **KQL**: `AWSCloudTrail \| where EventName in ("AuthorizeSecurityGroupIngress") and RequestParameters has_any ("20", "21") and SourceIP !in (trustedIPs) \| join kind=inner (DeviceNetworkEvents \| where RemotePort in (20, 21)) on SourceIP \| summarize count() by SourceIP, EventName, RemoteIP \| where count_ > 5`.<br>- **ELK**: `FROM logs-aws.cloudtrail-* \| WHERE event.action IN ['AuthorizeSecurityGroupIngress'] AND event.request_parameters : ('20' OR '21') AND source.ip NOT IN ['trusted_ips'] \| JOIN logs-zeek.ftp-* ON source.ip WHERE destination.port IN [20, 21] \| STATS COUNT() BY source.ip, event.action, destination.ip HAVING COUNT() > 5`. |

### T1133.003: Hypertext Transfer Protocol (HTTP)

| Hypothesis | Description | Data Sources | Hunting Queries |
|-----------|-------------|--------------|-----------------|
| 1. Unauthorized HTTP Access to C2 Servers | Adversaries use HTTP for C2 communication, as in Volt Typhoon. | - Network Traffic (DS0003: Zeek HTTP)<br>- Threat Intelligence | - **Splunk**: `index=network sourcetype=zeek_http dest_ip IN (malware_c2_ips) AND response_status_code IN ("200", "404") \| stats count by src_ip, dest_ip, uri \| where count > 10`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "HTTP" and RemoteIP in (malwareC2IPs) and ResponseStatusCode in ("200", "404") \| summarize count() by DeviceIP, RemoteIP, RemoteUrl \| where count_ > 10`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE destination.ip IN ['malware_c2_ips'] AND http.response.status_code IN ['200', '404'] \| STATS COUNT() BY source.ip, destination.ip, http.uri HAVING COUNT() > 10`. |
| 2. High-Frequency HTTP Requests | High-frequency HTTP requests to external servers, as in APT41. | - Network Traffic (DS0003: Zeek HTTP)<br>- Metrics | - **Splunk**: `index=network sourcetype=zeek_http dest_port IN (80, 443) \| timechart span=1m count by src_ip \| where count > 50`.<br>- **KQL**: `DeviceNetworkEvents \| where RemotePort in (80, 443) \| summarize MinuteCount=count() by bin(Timestamp, 1m), DeviceIP \| where MinuteCount > 50`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE destination.port IN [80, 443] \| STATS COUNT() BY date_histogram(@timestamp, '1m'), source.ip \| WHERE COUNT() > 50`. |
| 3. HTTP Access with Suspicious User Agents | Adversaries use non-standard user agents for HTTP C2, as in APT41. | - Network Traffic (DS0003: Zeek HTTP)<br>- Proxy Logs | - **Splunk**: `index=network sourcetype=zeek_http user_agent NOT IN (known_agents) AND dest_ip IN (malware_c2_ips) \| stats count by src_ip, user_agent, dest_ip \| where count > 10`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "HTTP" and AdditionalFields.UserAgent !in (knownAgents) and RemoteIP in (malwareC2IPs) \| summarize count() by DeviceIP, AdditionalFields.UserAgent, RemoteIP \| where count_ > 10`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE http.user_agent NOT IN ['known_agents'] AND destination.ip IN ['malware_c2_ips'] \| STATS COUNT() BY source.ip, http.user_agent, destination.ip HAVING COUNT() > 10`. |
| 4. HTTP Access Outside Business Hours | HTTP C2 activity outside business hours, as in APT29. | - Network Traffic (DS0003: Zeek HTTP)<br>- Metrics | - **Splunk**: `index=network sourcetype=zeek_http dest_ip IN (malware_c2_ips) \| timechart span=1h count by src_ip \| where count > avg(count)*3 AND (_time < "08:00" OR _time > "18:00")`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "HTTP" and RemoteIP in (malwareC2IPs) \| summarize HourlyCount=count() by bin(Timestamp, 1h), DeviceIP \| where HourlyCount > avg(HourlyCount) * 3 and (hour(Timestamp) < 8 or hour(Timestamp) > 18)`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE destination.ip IN ['malware_c2_ips'] \| STATS COUNT() BY date_histogram(@timestamp, '1h'), source.ip \| WHERE COUNT() > AVG(COUNT()) * 3 AND (HOUR(@timestamp) < 8 OR HOUR(@timestamp) > 18)`. |
| 5. HTTP Access with Suspicious File Downloads | Adversaries download malicious files via HTTP, as in FIN7. | - Network Traffic (DS0003: Zeek HTTP) | - **Splunk**: `index=network sourcetype=zeek_http dest_ip IN (malware_c2_ips) AND uri IN ("*.exe", "*.zip", "*.scr") \| stats count by src_ip, dest_ip, uri \| where count > 10`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "HTTP" and RemoteIP in (malwareC2IPs) and RemoteUrl has_any (".exe", ".zip", ".scr") \| summarize count() by DeviceIP, RemoteIP, RemoteUrl \| where count_ > 10`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE destination.ip IN ['malware_c2_ips'] AND http.uri : ("*.exe" OR "*.zip" OR "*.scr") \| STATS COUNT() BY source.ip, destination.ip, http.uri HAVING COUNT() > 10`. |
| 6. HTTP Access in Linux Environments | Adversaries use HTTP in Linux environments for C2, as in Turla. | - Process Creation (Linux Auditd)<br>- Network Traffic (DS0003: Zeek HTTP) | - **Splunk**: `index=linux sourcetype=auditd exe IN ("*curl*", "*wget*") AND args IN (malware_c2_ips) \| join host [search index=network sourcetype=zeek_http dest_ip IN (malware_c2_ips)] \| stats count by host, exe, dest_ip \| where count > 5`.<br>- **KQL**: `LinuxAuditd \| where ProcessName has_any ("curl", "wget") and CommandLine has_any (malwareC2IPs) \| join kind=inner (DeviceNetworkEvents \| where Protocol == "HTTP" and RemoteIP in (malwareC2IPs)) on HostName \| summarize count() by HostName, ProcessName, RemoteIP \| where count_ > 5`.<br>- **ELK**: `FROM logs-auditd-* \| WHERE process.exe : ("*curl*" OR "*wget*") AND process.args : ['malware_c2_ips'] \| JOIN logs-zeek.http-* ON host.name WHERE destination.ip IN ['malware_c2_ips'] \| STATS COUNT() BY host.name, process.exe, destination.ip HAVING COUNT() > 5`. |
| 7. HTTP Access with Suspicious Content Types | Adversaries use HTTP to transfer suspicious content types, as in Volt Typhoon. | - Network Traffic (DS0003: Zeek HTTP) | - **Splunk**: `index=network sourcetype=zeek_http content_type IN ("application/octet-stream", "application/x-msdownload") AND dest_ip IN (malware_c2_ips) \| stats count by src_ip, dest_ip, content_type \| where count > 10`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "HTTP" and AdditionalFields.ContentType in ("application/octet-stream", "application/x-msdownload") and RemoteIP in (malwareC2IPs) \| summarize count() by DeviceIP, RemoteIP, AdditionalFields.ContentType \| where count_ > 10`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE http.content_type IN ['application/octet-stream', 'application/x-msdownload'] AND destination.ip IN ['malware_c2_ips'] \| STATS COUNT() BY source.ip, destination.ip, http.content_type HAVING COUNT() > 10`. |
| 8. HTTP Access from Compromised Endpoints | Compromised endpoints initiate HTTP C2, as in FIN7. | - Process Creation (DS0009: Sysmon ID 1)<br>- Network Traffic (DS0003: Zeek HTTP) | - **Splunk**: `index=endpoint sourcetype=sysmon EventCode=1 Image IN ("*powershell.exe*", "*cmd.exe*") \| join host [search index=network sourcetype=zeek_http dest_ip IN (malware_c2_ips)] \| stats count by host, Image, dest_ip \| where count > 5`.<br>- **KQL**: `DeviceProcessEvents \| where ProcessName has_any ("powershell.exe", "cmd.exe") \| join kind=inner (DeviceNetworkEvents \| where Protocol == "HTTP" and RemoteIP in (malwareC2IPs)) on DeviceName \| summarize count() by DeviceName, ProcessName, RemoteIP \| where count_ > 5`.<br>- **ELK**: `FROM logs-endpoint.process-* \| WHERE process.executable : ("*powershell.exe*" OR "*cmd.exe*") \| JOIN logs-zeek.http-* ON host.name WHERE destination.ip IN ['malware_c2_ips'] \| STATS COUNT() BY host.name, process.executable, destination.ip HAVING COUNT() > 5`. |
| 9. HTTP Access with Anomalous Ports | Adversaries use non-standard ports for HTTP C2, as in 2025 trends. | - Network Traffic (DS0003: Zeek HTTP) | - **Splunk**: `index=network sourcetype=zeek_http dest_port NOT IN (80, 443) AND dest_ip IN (malware_c2_ips) \| stats count by src_ip, dest_ip, dest_port \| where count > 10`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "HTTP" and RemotePort !in (80, 443) and RemoteIP in (malwareC2IPs) \| summarize count() by DeviceIP, RemoteIP, RemotePort \| where count_ > 10`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE destination.port NOT IN [80, 443] AND destination.ip IN ['malware_c2_ips'] \| STATS COUNT() BY source.ip, destination.ip, destination.port HAVING COUNT() > 10`. |
| 10. HTTP Access in Cloud Environments | Adversaries use HTTP to access compromised cloud instances, as in 2025 trends. | - Cloud Audit Logs (AWS CloudTrail)<br>- Network Traffic (DS0003: Zeek HTTP) | - **Splunk**: `index=cloud sourcetype=aws:cloudtrail eventName IN ("AuthorizeSecurityGroupIngress") AND requestParameters IN ("80", "443") AND src_ip NOT IN (trusted_ips) \| join src_ip [search index=network sourcetype=zeek_http dest_ip IN (malware_c2_ips)] \| stats count by src_ip, eventName, dest_ip \| where count > 5`.<br>- **KQL**: `AWSCloudTrail \| where EventName in ("AuthorizeSecurityGroupIngress") and RequestParameters has_any ("80", "443") and SourceIP !in (trustedIPs) \| join kind=inner (DeviceNetworkEvents \| where Protocol == "HTTP" and RemoteIP in (malwareC2IPs)) on SourceIP \| summarize count() by SourceIP, EventName, RemoteIP \| where count_ > 5`.<br>- **ELK**: `FROM logs-aws.cloudtrail-* \| WHERE event.action IN ['AuthorizeSecurityGroupIngress'] AND event.request_parameters : ('80' OR '443') AND source.ip NOT IN ['trusted_ips'] \| JOIN logs-zeek.http-* ON source.ip WHERE destination.ip IN ['malware_c2_ips'] \| STATS COUNT() BY source.ip, event.action, destination.ip HAVING COUNT() > 5`. |

### T1133.004: SSH

| Hypothesis | Description | Data Sources | Hunting Queries |
|-----------|-------------|--------------|-----------------|
| 1. Unauthorized SSH Access from External IPs | Adversaries use compromised credentials for SSH access, as in Volt Typhoon. | - Network Traffic (DS0003: Zeek SSH)<br>- Linux Audit Logs | - **Splunk**: `index=network sourcetype=zeek_ssh src_ip NOT IN (trusted_ips) AND dest_port=22 \| stats count by src_ip, dest_ip, user \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where RemotePort == 22 and DeviceIP !in (trustedIPs) \| summarize count() by DeviceIP, RemoteIP, AdditionalFields.User \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.ssh-* \| WHERE destination.port == 22 AND source.ip NOT IN ['trusted_ips'] \| STATS COUNT() BY source.ip, destination.ip, ssh.user HAVING COUNT() > 5`. |
| 2. High-Frequency SSH Attempts | High-frequency SSH connection attempts indicating brute force, as in APT41. | - Network Traffic (DS0003: Zeek SSH)<br>- Metrics | - **Splunk**: `index=network sourcetype=zeek_ssh dest_port=22 \| timechart span=1m count by src_ip \| where count > 50`.<br>- **KQL**: `DeviceNetworkEvents \| where RemotePort == 22 \| summarize MinuteCount=count() by bin(Timestamp, 1m), DeviceIP \| where MinuteCount > 50`.<br>- **ELK**: `FROM logs-zeek.ssh-* \| WHERE destination.port == 22 \| STATS COUNT() BY date_histogram(@timestamp, '1m'), source.ip \| WHERE COUNT() > 50`. |
| 3. SSH Access with Suspicious User Accounts | Adversaries use non-standard accounts for SSH access, as in Turla. | - Linux Audit Logs (DS0007) | - **Splunk**: `index=linux sourcetype=auditd type=USER_LOGIN user NOT IN (authorized_users) AND success="yes" \| stats count by src_ip, user \| where count > 5`.<br>- **KQL**: `LinuxAuditd \| where EventType == "USER_LOGIN" and User !in (authorizedUsers) and Success == "yes" \| summarize count() by SourceIP, User \| where count_ > 5`.<br>- **ELK**: `FROM logs-auditd-* \| WHERE auditd.type == 'USER_LOGIN' AND user.name NOT IN ['authorized_users'] AND auditd.success == 'yes' \| STATS COUNT() BY source.ip, user.name HAVING COUNT() > 5`. |
| 4. SSH Access Outside Business Hours | SSH connections outside business hours, as in APT29. | - Network Traffic (DS0003: Zeek SSH)<br>- Metrics | - **Splunk**: `index=network sourcetype=zeek_ssh dest_port=22 \| timechart span=1h count by src_ip \| where count > avg(count)*3 AND (_time < "08:00" OR _time > "18:00")`.<br>- **KQL**: `DeviceNetworkEvents \| where RemotePort == 22 \| summarize HourlyCount=count() by bin(Timestamp, 1h), DeviceIP \| where HourlyCount > avg(HourlyCount) * 3 and (hour(Timestamp) < 8 or hour(Timestamp) > 18)`.<br>- **ELK**: `FROM logs-zeek.ssh-* \| WHERE destination.port == 22 \| STATS COUNT() BY date_histogram(@timestamp, '1h'), source.ip \| WHERE COUNT() > AVG(COUNT()) * 3 AND (HOUR(@timestamp) < 8 OR HOUR(@timestamp) > 18)`. |
| 5. SSH Access with Anomalous Ports | Adversaries use non-standard ports for SSH, as in 2025 trends. | - Network Traffic (DS0003: Zeek SSH) | - **Splunk**: `index=network sourcetype=zeek_ssh dest_port NOT IN (22) AND protocol="tcp" AND service="ssh" \| stats count by src_ip, dest_ip, dest_port \| where count > 10`.<br>- **KQL**: `DeviceNetworkEvents \| where RemotePort !in (22) and Protocol == "TCP" and Service == "ssh" \| summarize count() by DeviceIP, RemoteIP, RemotePort \| where count_ > 10`.<br>- **ELK**: `FROM logs-zeek.ssh-* \| WHERE destination.port NOT IN [22] AND protocol == 'tcp' AND service == 'ssh' \| STATS COUNT() BY source.ip, destination.ip, destination.port HAVING COUNT() > 10`. |
| 6. SSH Access in Cloud Environments | Adversaries use SSH to access compromised cloud instances, as in 2025 trends. | - Cloud Audit Logs (AWS CloudTrail)<br>- Network Traffic (DS0003: Zeek SSH) | - **Splunk**: `index=cloud sourcetype=aws:cloudtrail eventName IN ("AuthorizeSecurityGroupIngress") AND requestParameters IN ("22") AND src_ip NOT IN (trusted_ips) \| join src_ip [search index=network sourcetype=zeek_ssh dest_port=22] \| stats count by src_ip, eventName, dest_ip \| where count > 5`.<br>- **KQL**: `AWSCloudTrail \| where EventName in ("AuthorizeSecurityGroupIngress") and RequestParameters has "22" and SourceIP !in (trustedIPs) \| join kind=inner (DeviceNetworkEvents \| where RemotePort == 22) on SourceIP \| summarize count() by SourceIP, EventName, RemoteIP \| where count_ > 5`.<br>- **ELK**: `FROM logs-aws.cloudtrail-* \| WHERE event.action IN ['AuthorizeSecurityGroupIngress'] AND event.request_parameters : '22' AND source.ip NOT IN ['trusted_ips'] \| JOIN logs-zeek.ssh-* ON source.ip WHERE destination.port == 22 \| STATS COUNT() BY source.ip, event.action, destination.ip HAVING COUNT() > 5`. |
| 7. SSH Access with Suspicious Commands | Adversaries execute suspicious commands via SSH, as in Turla. | - Process Creation (Linux Auditd) | - **Splunk**: `index=linux sourcetype=auditd exe IN ("*ssh*", "*sshd*") AND args IN ("*whoami*", "*wget*", "*curl*") \| stats count by host, exe, args \| where count > 5`.<br>- **KQL**: `LinuxAuditd \| where ProcessName has_any ("ssh", "sshd") and CommandLine has_any ("whoami", "wget", "curl") \| summarize count() by HostName, ProcessName, CommandLine \| where count_ > 5`.<br>- **ELK**: `FROM logs-auditd-* \| WHERE process.exe : ("*ssh*" OR "*sshd*") AND process.args : ("*whoami*" OR "*wget*" OR "*curl*") \| STATS COUNT() BY host.name, process.exe, process.args HAVING COUNT() > 5`. |
| 8. SSH Access with Failed Logins | Multiple failed SSH login attempts indicating credential stuffing, as in Volt Typhoon. | - Linux Audit Logs (DS0007) | - **Splunk**: `index=linux sourcetype=auditd type=USER_LOGIN success="no" \| stats count by src_ip, user \| where count > 10`.<br>- **KQL**: `LinuxAuditd \| where EventType == "USER_LOGIN" and Success == "no" \| summarize count() by SourceIP, User \| where count_ > 10`.<br>- **ELK**: `FROM logs-auditd-* \| WHERE auditd.type == 'USER_LOGIN' AND auditd.success == 'no' \| STATS COUNT() BY source.ip, user.name HAVING COUNT() > 10`. |
| 9. SSH Access from Compromised Endpoints | Compromised endpoints initiate SSH connections, as in FIN7. | - Process Creation (Linux Auditd)<br>- Network Traffic (DS0003: Zeek SSH) | - **Splunk**: `index=linux sourcetype=auditd exe IN ("*ssh*", "*scp*") \| join host [search index=network sourcetype=zeek_ssh dest_port=22] \| stats count by host, exe, dest_ip \| where count > 5`.<br>- **KQL**: `LinuxAuditd \| where ProcessName has_any ("ssh", "scp") \| join kind=inner (DeviceNetworkEvents \| where RemotePort == 22) on HostName \| summarize count() by HostName, ProcessName, RemoteIP \| where count_ > 5`.<br>- **ELK**: `FROM logs-auditd-* \| WHERE process.exe : ("*ssh*" OR "*scp*") \| JOIN logs-zeek.ssh-* ON host.name WHERE destination.port == 22 \| STATS COUNT() BY host.name, process.exe, destination.ip HAVING COUNT() > 5`. |
| 10. SSH Access with Anomalous Session Duration | SSH sessions with unusual durations indicating persistence, as in APT29. | - Network Traffic (DS0003: Zeek SSH) | - **Splunk**: `index=network sourcetype=zeek_ssh dest_port=22 \| eval session_duration=duration \| stats count, avg(session_duration) as avg_duration by src_ip, dest_ip \| where avg_duration > 3600`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "SSH" and RemotePort == 22 \| summarize SessionDuration=make_list(Duration), count() by DeviceIP, RemoteIP \| project DeviceIP, RemoteIP, count_, AvgDuration=avg(Duration) \| where AvgDuration > 3600`.<br>- **ELK**: `FROM logs-zeek.ssh-* \| WHERE destination.port == 22 \| EVAL session_duration = ssh.duration \| STATS COUNT(), AVG(session_duration) AS avg_duration BY source.ip, destination.ip \| WHERE avg_duration > 3600`. |

### T1133.005: Virtual Private Network (VPN)

| Hypothesis | Description | Data Sources | Hunting Queries |
|-----------|-------------|--------------|-----------------|
| 1. Unauthorized VPN Access from External IPs | Adversaries use compromised credentials for VPN access, as in Volt Typhoon. | - Network Traffic (DS0003: Zeek VPN)<br>- VPN Logs | - **Splunk**: `index=network sourcetype=zeek_vpn src_ip NOT IN (trusted_ips) AND dest_port IN (1194, 500, 4500) \| stats count by src_ip, dest_ip, user \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where RemotePort in (1194, 500, 4500) and DeviceIP !in (trustedIPs) \| summarize count() by DeviceIP, RemoteIP, AdditionalFields.User \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.vpn-* \| WHERE destination.port IN [1194, 500, 4500] AND source.ip NOT IN ['trusted_ips'] \| STATS COUNT() BY source.ip, destination.ip, vpn.user HAVING COUNT() > 5`. |
| 2. High-Frequency VPN Connections | High-frequency VPN connections indicating brute force, as in APT41. | - Network Traffic (DS0003: Zeek VPN)<br>- Metrics | - **Splunk**: `index=network sourcetype=zeek_vpn dest_port IN (1194, 500, 4500) \| timechart span=1m count by src_ip \| where count > 50`.<br>- **KQL**: `DeviceNetworkEvents \| where RemotePort in (1194, 500, 4500) \| summarize MinuteCount=count() by bin(Timestamp, 1m), DeviceIP \| where MinuteCount > 50`.<br>- **ELK**: `FROM logs-zeek.vpn-* \| WHERE destination.port IN [1194, 500, 4500] \| STATS COUNT() BY date_histogram(@timestamp, '1m'), source.ip \| WHERE COUNT() > 50`. |
| 3. VPN Access with Suspicious User Accounts | Adversaries use non-standard accounts for VPN access, as in FIN7. | - VPN Logs (DS0007) | - **Splunk**: `index=vpn sourcetype=vpn_log user NOT IN (authorized_users) AND status="connected" \| stats count by src_ip, user \| where count > 5`.<br>- **KQL**: `VpnLog \| where User !in (authorizedUsers) and Status == "connected" \| summarize count() by ClientIP, User \| where count_ > 5`.<br>- **ELK**: `FROM logs-vpn-* \| WHERE vpn.user NOT IN ['authorized_users'] AND vpn.status == 'connected' \| STATS COUNT() BY source.ip, vpn.user HAVING COUNT() > 5`. |
| 4. VPN Access Outside Business Hours | VPN connections outside business hours, as in APT29. | - VPN Logs (DS0007)<br>- Metrics | - **Splunk**: `index=vpn sourcetype=vpn_log status="connected" \| timechart span=1h count by src_ip \| where count > avg(count)*3 AND (_time < "08:00" OR _time > "18:00")`.<br>- **KQL**: `VpnLog \| where Status == "connected" \| summarize HourlyCount=count() by bin(Timestamp, 1h), ClientIP \| where HourlyCount > avg(HourlyCount) * 3 and (hour(Timestamp) < 8 or hour(Timestamp) > 18)`.<br>- **ELK**: `FROM logs-vpn-* \| WHERE vpn.status == 'connected' \| STATS COUNT() BY date_histogram(@timestamp, '1h'), source.ip \| WHERE COUNT() > AVG(COUNT()) * 3 AND (HOUR(@timestamp) < 8 OR HOUR(@timestamp) > 18)`. |
| 5. VPN Access with Anomalous Ports | Adversaries use non-standard ports for VPN, as in 2025 trends. | - Network Traffic (DS0003: Zeek VPN) | - **Splunk**: `index=network sourcetype=zeek_vpn dest_port NOT IN (1194, 500, 4500) AND protocol IN ("udp", "tcp") AND service="vpn" \| stats count by src_ip, dest_ip, dest_port \| where count > 10`.<br>- **KQL**: `DeviceNetworkEvents \| where RemotePort !in (1194, 500, 4500) and Protocol in ("UDP", "TCP") and Service == "vpn" \| summarize count() by DeviceIP, RemoteIP, RemotePort \| where count_ > 10`.<br>- **ELK**: `FROM logs-zeek.vpn-* \| WHERE destination.port NOT IN [1194, 500, 4500] AND protocol IN ['udp', 'tcp'] AND service == 'vpn' \| STATS COUNT() BY source.ip, destination.ip, destination.port HAVING COUNT() > 10`. |
| 6. VPN Access in Cloud Environments | Adversaries use VPN to access compromised cloud instances, as in 2025 trends. | - Cloud Audit Logs (AWS CloudTrail)<br>- Network Traffic (DS0003: Zeek VPN) | - **Splunk**: `index=cloud sourcetype=aws:cloudtrail eventName IN ("CreateVpnConnection", "AuthorizeSecurityGroupIngress") AND requestParameters IN ("1194", "500", "4500") AND src_ip NOT IN (trusted_ips) \| join src_ip [search index=network sourcetype=zeek_vpn dest_port IN (1194, 500, 4500)] \| stats count by src_ip, eventName, dest_ip \| where count > 5`.<br>- **KQL**: `AWSCloudTrail \| where EventName in ("CreateVpnConnection", "AuthorizeSecurityGroupIngress") and RequestParameters has_any ("1194", "500", "4500") and SourceIP !in (trustedIPs) \| join kind=inner (DeviceNetworkEvents \| where RemotePort in (1194, 500, 4500)) on SourceIP \| summarize count() by SourceIP, EventName, RemoteIP \| where count_ > 5`.<br>- **ELK**: `FROM logs-aws.cloudtrail-* \| WHERE event.action IN ['CreateVpnConnection', 'AuthorizeSecurityGroupIngress'] AND event.request_parameters : ('1194' OR '500' OR '4500') AND source.ip NOT IN ['trusted_ips'] \| JOIN logs-zeek.vpn-* ON source.ip WHERE destination.port IN [1194, 500, 4500] \| STATS COUNT() BY source.ip, event.action, destination.ip HAVING COUNT() > 5`. |
| 7. VPN Access with Suspicious User Agents | Adversaries use non-standard user agents for VPN connections, as in APT41. | - Network Traffic (DS0003: Zeek VPN)<br>- Proxy Logs | - **Splunk**: `index=network sourcetype=zeek_vpn user_agent NOT IN (known_agents) AND dest_port IN (1194, 500, 4500) \| stats count by src_ip, user_agent, dest_ip \| where count > 10`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "VPN" and AdditionalFields.UserAgent !in (knownAgents) and RemotePort in (1194, 500, 4500) \| summarize count() by DeviceIP, AdditionalFields.UserAgent, RemoteIP \| where count_ > 10`.<br>- **ELK**: `FROM logs-zeek.vpn-* \| WHERE vpn.user_agent NOT IN ['known_agents'] AND destination.port IN [1194, 500, 4500] \| STATS COUNT() BY source.ip, vpn.user_agent, destination.ip HAVING COUNT() > 10`. |
| 8. VPN Access with Failed Logins | Multiple failed VPN login attempts indicating credential stuffing, as in Volt Typhoon. | - VPN Logs (DS0007) | - **Splunk**: `index=vpn sourcetype=vpn_log status="failed" \| stats count by src_ip, user \| where count > 10`.<br>- **KQL**: `VpnLog \| where Status == "failed" \| summarize count() by ClientIP, User \| where count_ > 10`.<br>- **ELK**: `FROM logs-vpn-* \| WHERE vpn.status == 'failed' \| STATS COUNT() BY source.ip, vpn.user HAVING COUNT() > 10`. |
| 9. VPN Access from Compromised Endpoints | Compromised endpoints initiate VPN connections, as in FIN7. | - Process Creation (DS0009: Sysmon ID 1)<br>- Network Traffic (DS0003: Zeek VPN) | - **Splunk**: `index=endpoint sourcetype=sysmon EventCode=1 Image IN ("*openvpn.exe*", "*vpnclient.exe*") \| join host [search index=network sourcetype=zeek_vpn dest_port IN (1194, 500, 4500)] \| stats count by host, Image, dest_ip \| where count > 5`.<br>- **KQL**: `DeviceProcessEvents \| where ProcessName has_any ("openvpn.exe", "vpnclient.exe") \| join kind=inner (DeviceNetworkEvents \| where RemotePort in (1194, 500, 4500)) on DeviceName \| summarize count() by DeviceName, ProcessName, RemoteIP \| where count_ > 5`.<br>- **ELK**: `FROM logs-endpoint.process-* \| WHERE process.executable : ("*openvpn.exe*" OR "*vpnclient.exe*") \| JOIN logs-zeek.vpn-* ON host.name WHERE destination.port IN [1194, 500, 4500] \| STATS COUNT() BY host.name, process.executable, destination.ip HAVING COUNT() > 5`. |
| 10. VPN Access with Anomalous Session Duration | VPN sessions with unusual durations indicating persistence, as in APT29. | - Network Traffic (DS0003: Zeek VPN) | - **Splunk**: `index=network sourcetype=zeek_vpn dest_port IN (1194, 500, 4500) \| eval session_duration=duration \| stats count, avg(session_duration) as avg_duration by src_ip, dest_ip \| where avg_duration > 3600`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "VPN" and RemotePort in (1194, 500, 4500) \| summarize SessionDuration=make_list(Duration), count() by DeviceIP, RemoteIP \| project DeviceIP, RemoteIP, count_, AvgDuration=avg(Duration) \| where AvgDuration > 3600`.<br>- **ELK**: `FROM logs-zeek.vpn-* \| WHERE destination.port IN [1194, 500, 4500] \| EVAL session_duration = vpn.duration \| STATS COUNT(), AVG(session_duration) AS avg_duration BY source.ip, destination.ip \| WHERE avg_duration > 3600`. |

### T1190: Exploit Public-Facing Application

### T1190.001: Web Application Vulnerability

| Hypothesis | Description | Data Sources | Hunting Queries |
|-----------|-------------|--------------|-----------------|
| 1. SQL Injection Attempts | Adversaries exploit SQL injection vulnerabilities in web applications, as in Volt Typhoon. | - Network Traffic (DS0003: Zeek HTTP)<br>- Web Application Logs | - **Splunk**: `index=network sourcetype=zeek_http method=POST AND uri IN ("*SELECT*", "*UNION*", "*%27*") \| stats count by src_ip, dest_ip, uri \| where count > 10`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "HTTP" and HttpMethod == "POST" and RemoteUrl has_any ("SELECT", "UNION", "%27") \| summarize count() by DeviceIP, RemoteIP, RemoteUrl \| where count_ > 10`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE http.method == "POST" AND http.uri : ("*SELECT*" OR "*UNION*" OR "*%27*") \| STATS COUNT() BY source.ip, destination.ip, http.uri HAVING COUNT() > 10`. |
| 2. Cross-Site Scripting (XSS) Attempts | Adversaries attempt XSS attacks on web applications, as in APT41. | - Network Traffic (DS0003: Zeek HTTP)<br>- Web Application Logs | - **Splunk**: `index=network sourcetype=zeek_http content IN ("*script*", "*alert(*", "*onerror*") \| stats count by src_ip, dest_ip, content \| where count > 10`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "HTTP" and HttpContent has_any ("script", "alert(", "onerror") \| summarize count() by DeviceIP, RemoteIP, HttpContent \| where count_ > 10`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE http.content : ("*script*" OR "*alert(*" OR "*onerror*") \| STATS COUNT() BY source.ip, destination.ip, http.content HAVING COUNT() > 10`. |
| 3. High-Frequency Web Application Requests | High-frequency requests to web applications indicating scanning, as in FIN7. | - Network Traffic (DS0003: Zeek HTTP)<br>- Metrics | - **Splunk**: `index=network sourcetype=zeek_http dest_port IN (80, 443) \| timechart span=1m count by src_ip \| where count > 50`.<br>- **KQL**: `DeviceNetworkEvents \| where RemotePort in (80, 443) \| summarize MinuteCount=count() by bin(Timestamp, 1m), DeviceIP \| where MinuteCount > 50`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE destination.port IN [80, 443] \| STATS COUNT() BY date_histogram(@timestamp, '1m'), source.ip \| WHERE COUNT() > 50`. |
| 4. Web Application Exploitation from Known Malicious IPs | Adversaries exploit web applications from known malicious IPs, as in Volt Typhoon. | - Network Traffic (DS0003: Zeek HTTP)<br>- Threat Intelligence | - **Splunk**: `index=network sourcetype=zeek_http src_ip IN (threat_intel_ips) AND method=POST AND uri IN ("*.php", "*.asp", "*.jsp") \| stats count by src_ip, dest_ip, uri \| where count > 10`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "HTTP" and DeviceIP in (threatIntelIPs) and HttpMethod == "POST" and RemoteUrl has_any (".php", ".asp", ".jsp") \| summarize count() by DeviceIP, RemoteIP, RemoteUrl \| where count_ > 10`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE source.ip IN ['threat_intel_ips'] AND http.method == "POST" AND http.uri : ("*.php" OR "*.asp" OR "*.jsp") \| STATS COUNT() BY source.ip, destination.ip, http.uri HAVING COUNT() > 10`. |
| 5. Web Application Exploitation in Cloud Environments | Adversaries exploit web applications hosted in cloud environments, as in 2025 trends. | - Cloud Audit Logs (AWS CloudTrail)<br>- Network Traffic (DS0003: Zeek HTTP) | - **Splunk**: `index=cloud sourcetype=aws:cloudtrail eventName IN ("PutObject", "UploadPart") AND requestParameters IN ("*.php", "*.asp", "*.jsp") AND src_ip NOT IN (trusted_ips) \| join src_ip [search index=network sourcetype=zeek_http content IN ("*script*", "*alert(*")] \| stats count by src_ip, eventName, content \| where count > 5`.<br>- **KQL**: `AWSCloudTrail \| where EventName in ("PutObject", "UploadPart") and RequestParameters has_any (".php", ".asp", ".jsp") and SourceIP !in (trustedIPs) \| join kind=inner (DeviceNetworkEvents \| where Protocol == "HTTP" and HttpContent has_any ("script", "alert(")) on SourceIP \| summarize count() by SourceIP, EventName, HttpContent \| where count_ > 5`.<br>- **ELK**: `FROM logs-aws.cloudtrail-* \| WHERE event.action IN ['PutObject', 'UploadPart'] AND event.request_parameters : ("*.php" OR "*.asp" OR "*.jsp") AND source.ip NOT IN ['trusted_ips'] \| JOIN logs-zeek.http-* ON source.ip WHERE http.content : ("*script*" OR "*alert(*") \| STATS COUNT() BY source.ip, event.action, http.content HAVING COUNT() > 5`. |
| 6. Web Application Exploitation with Suspicious User Agents | Adversaries use non-standard user agents for exploitation, as in APT41. | - Network Traffic (DS0003: Zeek HTTP)<br>- Proxy Logs | - **Splunk**: `index=network sourcetype=zeek_http user_agent NOT IN (known_agents) AND method=POST AND content IN ("*script*", "*alert(*") \| stats count by src_ip, user_agent, content \| where count > 10`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "HTTP" and AdditionalFields.UserAgent !in (knownAgents) and HttpMethod == "POST" and HttpContent has_any ("script", "alert(") \| summarize count() by DeviceIP, AdditionalFields.UserAgent, HttpContent \| where count_ > 10`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE http.user_agent NOT IN ['known_agents'] AND http.method == "POST" AND http.content : ("*script*" OR "*alert(*") \| STATS COUNT() BY source.ip, http.user_agent, http.content HAVING COUNT() > 10`. |
| 7. Web Application Exploitation Outside Business Hours | Exploitation attempts outside business hours, as in APT29. | - Network Traffic (DS0003: Zeek HTTP)<br>- Metrics | - **Splunk**: `index=network sourcetype=zeek_http method=POST AND content IN ("*script*", "*alert(*") \| timechart span=1h count by src_ip \| where count > avg(count)*3 AND (_time < "08:00" OR _time > "18:00")`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "HTTP" and HttpMethod == "POST" and HttpContent has_any ("script", "alert(") \| summarize HourlyCount=count() by bin(Timestamp, 1h), DeviceIP \| where HourlyCount > avg(HourlyCount) * 3 and (hour(Timestamp) < 8 or hour(Timestamp) > 18)`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE http.method == "POST" AND http.content : ("*script*" OR "*alert(*") \| STATS COUNT() BY date_histogram(@timestamp, '1h'), source.ip \| WHERE COUNT() > AVG(COUNT()) * 3 AND (HOUR(@timestamp) < 8 OR HOUR(@timestamp) > 18)`. |
| 8. Web Application Exploitation via File Uploads | Adversaries exploit file upload vulnerabilities, as in FIN7. | - Network Traffic (DS0003: Zeek HTTP) | - **Splunk**: `index=network sourcetype=zeek_http method=POST AND uri IN ("*upload*", "*file*") AND content IN ("*.php", "*.asp", "*.jsp") \| stats count by src_ip, dest_ip, uri \| where count > 10`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "HTTP" and HttpMethod == "POST" and RemoteUrl has_any ("upload", "file") and HttpContent has_any (".php", ".asp", ".jsp") \| summarize count() by DeviceIP, RemoteIP, RemoteUrl \| where count_ > 10`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE http.method == "POST" AND http.uri : ("*upload*" OR "*file*") AND http.content : ("*.php" OR "*.asp" OR "*.jsp") \| STATS COUNT() BY source.ip, destination.ip, http.uri HAVING COUNT() > 10`. |
| 9. Web Application Exploitation with Suspicious Parameters | Adversaries use suspicious URL parameters for exploitation, as in Volt Typhoon. | - Network Traffic (DS0003: Zeek HTTP) | - **Splunk**: `index=network sourcetype=zeek_http uri IN ("*id=*", "*cmd=*", "*exec=*") AND method=GET \| stats count by src_ip, dest_ip, uri \| where count > 10`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "HTTP" and RemoteUrl has_any ("id=", "cmd=", "exec=") and HttpMethod == "GET" \| summarize count() by DeviceIP, RemoteIP, RemoteUrl \| where count_ > 10`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE http.uri : ("*id=*" OR "*cmd=*" OR "*exec=*") AND http.method == "GET" \| STATS COUNT() BY source.ip, destination.ip, http.uri HAVING COUNT() > 10`. |
| 10. Web Application Exploitation via Known Vulnerabilities | Adversaries target known CVEs in web applications, as in 2025 trends. | - Network Traffic (DS0003: Zeek HTTP)<br>- Threat Intelligence | - **Splunk**: `index=network sourcetype=zeek_http uri IN (known_vuln_paths) AND src_ip NOT IN (trusted_ips) \| stats count by src_ip, dest_ip, uri \| where count > 10`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "HTTP" and RemoteUrl in (knownVulnPaths) and DeviceIP !in (trustedIPs) \| summarize count() by DeviceIP, RemoteIP, RemoteUrl \| where count_ > 10`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE http.uri IN ['known_vuln_paths'] AND source.ip NOT IN ['trusted_ips'] \| STATS COUNT() BY source.ip, destination.ip, http.uri HAVING COUNT() > 10`. |

### T1190.002: Server Software Vulnerability

| Hypothesis | Description | Data Sources | Hunting Queries |
|-----------|-------------|--------------|-----------------|
| 1. Server Software Exploitation via Suspicious Commands | Adversaries exploit server software with command injection, as in Volt Typhoon. | - Process Creation (DS0009: Sysmon ID 1)<br>- Network Traffic (DS0003: Zeek HTTP) | - **Splunk**: `index=endpoint sourcetype=sysmon EventCode=1 Image IN ("*httpd.exe*", "*nginx.exe*") AND CommandLine IN ("*cmd.exe*", "*powershell.exe*") \| join host [search index=network sourcetype=zeek_http dest_ip IN (compromised_servers)] \| stats count by host, Image, dest_ip \| where count > 5`.<br>- **KQL**: `DeviceProcessEvents \| where ProcessName has_any ("httpd.exe", "nginx.exe") and ProcessCommandLine has_any ("cmd.exe", "powershell.exe") \| join kind=inner (DeviceNetworkEvents \| where RemoteIP in (compromisedServers)) on DeviceName \| summarize count() by DeviceName, ProcessName, RemoteIP \| where count_ > 5`.<br>- **ELK**: `FROM logs-endpoint.process-* \| WHERE process.executable : ("*httpd.exe*" OR "*nginx.exe*") AND process.command_line : ("*cmd.exe*" OR "*powershell.exe*") \| JOIN logs-zeek.http-* ON host.name WHERE destination.ip IN ['compromised_servers'] \| STATS COUNT() BY host.name, process.executable, destination.ip HAVING COUNT() > 5`. |
| 2. Server Software Exploitation from Malicious IPs | Adversaries exploit server software from known malicious IPs, as in APT41. | - Network Traffic (DS0003: Zeek HTTP)<br>- Threat Intelligence | - **Splunk**: `index=network sourcetype=zeek_http src_ip IN (threat_intel_ips) AND uri IN ("*.php", "*.asp", "*.jsp") AND method=POST \| stats count by src_ip, dest_ip, uri \| where count > 10`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "HTTP" and DeviceIP in (threatIntelIPs) and RemoteUrl has_any (".php", ".asp", ".jsp") and HttpMethod == "POST" \| summarize count() by DeviceIP, RemoteIP, RemoteUrl \| where count_ > 10`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE source.ip IN ['threat_intel_ips'] AND http.uri : ("*.php" OR "*.asp" OR "*.jsp") AND http.method == "POST" \| STATS COUNT() BY source.ip, destination.ip, http.uri HAVING COUNT() > 10`. |
| 3. High-Frequency Server Software Requests | High-frequency requests to server software endpoints, as in FIN7. | - Network Traffic (DS0003: Zeek HTTP)<br>- Metrics | - **Splunk**: `index=network sourcetype=zeek_http dest_ip IN (server_ips) AND dest_port IN (80, 443) \| timechart span=1m count by src_ip \| where count > 50`.<br>- **KQL**: `DeviceNetworkEvents \| where RemoteIP in (serverIPs) and RemotePort in (80, 443) \| summarize MinuteCount=count() by bin(Timestamp, 1m), DeviceIP \| where MinuteCount > 50`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE destination.ip IN ['server_ips'] AND destination.port IN [80, 443] \| STATS COUNT() BY date_histogram(@timestamp, '1m'), source.ip \| WHERE COUNT() > 50`. |
| 4. Server Software Exploitation in Linux Environments | Adversaries exploit server software on Linux systems, as in Turla. | - Process Creation (Linux Auditd)<br>- Network Traffic (DS0003: Zeek HTTP) | - **Splunk**: `index=linux sourcetype=auditd exe IN ("*httpd*", "*nginx*") AND args IN ("*.php", "*.sh") \| join host [search index=network sourcetype=zeek_http dest_ip IN (compromised_servers)] \| stats count by host, exe, dest_ip \| where count > 5`.<br>- **KQL**: `LinuxAuditd \| where ProcessName has_any ("httpd", "nginx") and CommandLine has_any (".php", ".sh") \| join kind=inner (DeviceNetworkEvents \| where RemoteIP in (compromisedServers)) on HostName \| summarize count() by HostName, ProcessName, RemoteIP \| where count_ > 5`.<br>- **ELK**: `FROM logs-auditd-* \| WHERE process.exe : ("*httpd*" OR "*nginx*") AND process.args : ("*.php" OR "*.sh") \| JOIN logs-zeek.http-* ON host.name WHERE destination.ip IN ['compromised_servers'] \| STATS COUNT() BY host.name, process.exe, destination.ip HAVING COUNT() > 5`. |
| 5. Server Software Exploitation with Suspicious User Agents | Adversaries use non-standard user agents for exploitation, as in APT41. | - Network Traffic (DS0003: Zeek HTTP)<br>- Proxy Logs | - **Splunk**: `index=network sourcetype=zeek_http user_agent NOT IN (known_agents) AND dest_ip IN (server_ips) AND method=POST \| stats count by src_ip, user_agent, dest_ip \| where count > 10`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "HTTP" and AdditionalFields.UserAgent !in (knownAgents) and RemoteIP in (serverIPs) and HttpMethod == "POST" \| summarize count() by DeviceIP, AdditionalFields.UserAgent, RemoteIP \| where count_ > 10`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE http.user_agent NOT IN ['known_agents'] AND destination.ip IN ['server_ips'] AND http.method == "POST" \| STATS COUNT() BY source.ip, http.user_agent, destination.ip HAVING COUNT() > 10`. |
| 6. Server Software Exploitation Outside Business Hours | Exploitation attempts outside business hours, as in APT29. | - Network Traffic (DS0003: Zeek HTTP)<br>- Metrics | - **Splunk**: `index=network sourcetype=zeek_http dest_ip IN (server_ips) AND method=POST \| timechart span=1h count by src_ip \| where count > avg(count)*3 AND (_time < "08:00" OR _time > "18:00")`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "HTTP" and RemoteIP in (serverIPs) and HttpMethod == "POST" \| summarize HourlyCount=count() by bin(Timestamp, 1h), DeviceIP \| where HourlyCount > avg(HourlyCount) * 3 and (hour(Timestamp) < 8 or hour(Timestamp) > 18)`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE destination.ip IN ['server_ips'] AND http.method == "POST" \| STATS COUNT() BY date_histogram(@timestamp, '1h'), source.ip \| WHERE COUNT() > AVG(COUNT()) * 3 AND (HOUR(@timestamp) < 8 OR HOUR(@timestamp) > 18)`. |
| 7. Server Software Exploitation via Known CVEs | Adversaries target known CVEs in server software, as in 2025 trends. | - Network Traffic (DS0003: Zeek HTTP)<br>- Threat Intelligence | - **Splunk**: `index=network sourcetype=zeek_http uri IN (known_vuln_paths) AND dest_ip IN (server_ips) \| stats count by src_ip, dest_ip, uri \| where count > 10`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "HTTP" and RemoteUrl in (knownVulnPaths) and RemoteIP in (serverIPs) \| summarize count() by DeviceIP, RemoteIP, RemoteUrl \| where count_ > 10`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE http.uri IN ['known_vuln_paths'] AND destination.ip IN ['server_ips'] \| STATS COUNT() BY source.ip, destination.ip, http.uri HAVING COUNT() > 10`. |
| 8. Server Software Exploitation with Suspicious File Downloads | Adversaries download malicious files post-exploitation, as in Volt Typhoon. | - Network Traffic (DS0003: Zeek HTTP) | - **Splunk**: `index=network sourcetype=zeek_http dest_ip IN (server_ips) AND uri IN ("*.exe", "*.zip", "*.scr") \| stats count by src_ip, dest_ip, uri \| where count > 10`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "HTTP" and RemoteIP in (serverIPs) and RemoteUrl has_any (".exe", ".zip", ".scr") \| summarize count() by DeviceIP, RemoteIP, RemoteUrl \| where count_ > 10`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE destination.ip IN ['server_ips'] AND http.uri : ("*.exe" OR "*.zip" OR "*.scr") \| STATS COUNT() BY source.ip, destination.ip, http.uri HAVING COUNT() > 10`. |
| 9. Server Software Exploitation in Cloud Environments | Adversaries exploit server software in cloud-hosted instances, as in 2025 trends. | - Cloud Audit Logs (AWS CloudTrail)<br>- Network Traffic (DS0003: Zeek HTTP) | - **Splunk**: `index=cloud sourcetype=aws:cloudtrail eventName IN ("RunInstances", "StartInstances") AND requestParameters IN ("*httpd*", "*nginx*") AND src_ip NOT IN (trusted_ips) \| join src_ip [search index=network sourcetype=zeek_http dest_ip IN (server_ips)] \| stats count by src_ip, eventName, dest_ip \| where count > 5`.<br>- **KQL**: `AWSCloudTrail \| where EventName in ("RunInstances", "StartInstances") and RequestParameters has_any ("httpd", "nginx") and SourceIP !in (trustedIPs) \| join kind=inner (DeviceNetworkEvents \| where Protocol == "HTTP" and RemoteIP in (serverIPs)) on SourceIP \| summarize count() by SourceIP, EventName, RemoteIP \| where count_ > 5`.<br>- **ELK**: `FROM logs-aws.cloudtrail-* \| WHERE event.action IN ['RunInstances', 'StartInstances'] AND event.request_parameters : ("*httpd*" OR "*nginx*") AND source.ip NOT IN ['trusted_ips'] \| JOIN logs-zeek.http-* ON source.ip WHERE destination.ip IN ['server_ips'] \| STATS COUNT() BY source.ip, event.action, destination.ip HAVING COUNT() > 5`. |
| 10. Server Software Exploitation with Anomalous Ports | Adversaries exploit server software on non-standard ports, as in 2025 trends. | - Network Traffic (DS0003: Zeek HTTP) | - **Splunk**: `index=network sourcetype=zeek_http dest_port NOT IN (80, 443) AND dest_ip IN (server_ips) AND method=POST \| stats count by src_ip, dest_ip, dest_port \| where count > 10`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "HTTP" and RemotePort !in (80, 443) and RemoteIP in (serverIPs) and HttpMethod == "POST" \| summarize count() by DeviceIP, RemoteIP, RemotePort \| where count_ > 10`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE destination.port NOT IN [80, 443] AND destination.ip IN ['server_ips'] AND http.method == "POST" \| STATS COUNT() BY source.ip, destination.ip, destination.port HAVING COUNT() > 10`. |

### T1190.003: Web Server Vulnerability

| Hypothesis | Description | Data Sources | Hunting Queries |
|-----------|-------------|--------------|-----------------|
| 1. Web Server Exploitation via Directory Traversal | Adversaries exploit directory traversal vulnerabilities, as in Volt Typhoon. | - Network Traffic (DS0003: Zeek HTTP) | - **Splunk**: `index=network sourcetype=zeek_http uri IN ("*../*", "*..%5C*") AND method=GET \| stats count by src_ip, dest_ip, uri \| where count > 10`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "HTTP" and RemoteUrl has_any ("../", "..%5C") and HttpMethod == "GET" \| summarize count() by DeviceIP, RemoteIP, RemoteUrl \| where count_ > 10`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE http.uri : ("*../*" OR "*..%5C*") AND http.method == "GET" \| STATS COUNT() BY source.ip, destination.ip, http.uri HAVING COUNT() > 10`. |
| 2. Web Server Exploitation via Suspicious Commands | Adversaries execute commands post-exploitation, as in APT41. | - Process Creation (DS0009: Sysmon ID 1)<br>- Network Traffic (DS0003: Zeek HTTP) | - **Splunk**: `index=endpoint sourcetype=sysmon EventCode=1 Image IN ("*httpd.exe*", "*nginx.exe*") AND CommandLine IN ("*cmd.exe*", "*powershell.exe*") \| join host [search index=network sourcetype=zeek_http dest_ip IN (web_servers)] \| stats count by host, Image, dest_ip \| where count > 5`.<br>- **KQL**: `DeviceProcessEvents \| where ProcessName has_any ("httpd.exe", "nginx.exe") and ProcessCommandLine has_any ("cmd.exe", "powershell.exe") \| join kind=inner (DeviceNetworkEvents \| where RemoteIP in (webServers)) on DeviceName \| summarize count() by DeviceName, ProcessName, RemoteIP \| where count_ > 5`.<br>- **ELK**: `FROM logs-endpoint.process-* \| WHERE process.executable : ("*httpd.exe*" OR "*nginx.exe*") AND process.command_line : ("*cmd.exe*" OR "*powershell.exe*") \| JOIN logs-zeek.http-* ON host.name WHERE destination.ip IN ['web_servers'] \| STATS COUNT() BY host.name, process.executable, destination.ip HAVING COUNT() > 5`. |
| 3. High-Frequency Web Server Requests | High-frequency requests to web servers indicating scanning, as in FIN7. | - Network Traffic (DS0003: Zeek HTTP)<br>- Metrics | - **Splunk**: `index=network sourcetype=zeek_http dest_ip IN (web_servers) AND dest_port IN (80, 443) \| timechart span=1m count by src_ip \| where count > 50`.<br>- **KQL**: `DeviceNetworkEvents \| where RemoteIP in (webServers) and RemotePort in (80, 443) \| summarize MinuteCount=count() by bin(Timestamp, 1m), DeviceIP \| where MinuteCount > 50`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE destination.ip IN ['web_servers'] AND destination.port IN [80, 443] \| STATS COUNT() BY date_histogram(@timestamp, '1m'), source.ip \| WHERE COUNT() > 50`. |
| 4. Web Server Exploitation from Malicious IPs | Adversaries exploit web servers from known malicious IPs, as in Volt Typhoon. | - Network Traffic (DS0003: Zeek HTTP)<br>- Threat Intelligence | - **Splunk**: `index=network sourcetype=zeek_http src_ip IN (threat_intel_ips) AND dest_ip IN (web_servers) AND method=POST \| stats count by src_ip, dest_ip, uri \| where count > 10`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "HTTP" and DeviceIP in (threatIntelIPs) and RemoteIP in (webServers) and HttpMethod == "POST" \| summarize count() by DeviceIP, RemoteIP, RemoteUrl \| where count_ > 10`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE source.ip IN ['threat_intel_ips'] AND destination.ip IN ['web_servers'] AND http.method == "POST" \| STATS COUNT() BY source.ip, destination.ip, http.uri HAVING COUNT() > 10`. |
| 5. Web Server Exploitation in Linux Environments | Adversaries exploit web servers on Linux systems, as in Turla. | - Process Creation (Linux Auditd)<br>- Network Traffic (DS0003: Zeek HTTP) | - **Splunk**: `index=linux sourcetype=auditd exe IN ("*httpd*", "*nginx*") AND args IN ("*.php", "*.sh") \| join host [search index=network sourcetype=zeek_http dest_ip IN (web_servers)] \| stats count by host, exe, dest_ip \| where count > 5`.<br>- **KQL**: `LinuxAuditd \| where ProcessName has_any ("httpd", "nginx") and CommandLine has_any (".php", ".sh") \| join kind=inner (DeviceNetworkEvents \| where RemoteIP in (webServers)) on HostName \| summarize count() by HostName, ProcessName, RemoteIP \| where count_ > 5`.<br>- **ELK**: `FROM logs-auditd-* \| WHERE process.exe : ("*httpd*" OR "*nginx*") AND process.args : ("*.php" OR "*.sh") \| JOIN logs-zeek.http-* ON host.name WHERE destination.ip IN ['web_servers'] \| STATS COUNT() BY host.name, process.exe, destination.ip HAVING COUNT() > 5`. |
| 6. Web Server Exploitation with Suspicious User Agents | Adversaries use non-standard user agents for exploitation, as in APT41. | - Network Traffic (DS0003: Zeek HTTP)<br>- Proxy Logs | - **Splunk**: `index=network sourcetype=zeek_http user_agent NOT IN (known_agents) AND dest_ip IN (web_servers) AND method=POST \| stats count by src_ip, user_agent, dest_ip \| where count > 10`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "HTTP" and AdditionalFields.UserAgent !in (knownAgents) and RemoteIP in (webServers) and HttpMethod == "POST" \| summarize count() by DeviceIP, AdditionalFields.UserAgent, RemoteIP \| where count_ > 10`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE http.user_agent NOT IN ['known_agents'] AND destination.ip IN ['web_servers'] AND http.method == "POST" \| STATS COUNT() BY source.ip, http.user_agent, destination.ip HAVING COUNT() > 10`. |
| 7. Web Server Exploitation Outside Business Hours | Exploitation attempts outside business hours, as in APT29. | - Network Traffic (DS0003: Zeek HTTP)<br>- Metrics | - **Splunk**: `index=network sourcetype=zeek_http dest_ip IN (web_servers) AND method=POST \| timechart span=1h count by src_ip \| where count > avg(count)*3 AND (_time < "08:00" OR _time > "18:00")`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "HTTP" and RemoteIP in (webServers) and HttpMethod == "POST" \| summarize HourlyCount=count() by bin(Timestamp, 1h), DeviceIP \| where HourlyCount > avg(HourlyCount) * 3 and (hour(Timestamp) < 8 or hour(Timestamp) > 18)`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE destination.ip IN ['web_servers'] AND http.method == "POST" \| STATS COUNT() BY date_histogram(@timestamp, '1h'), source.ip \| WHERE COUNT() > AVG(COUNT()) * 3 AND (HOUR(@timestamp) < 8 OR HOUR(@timestamp) > 18)`. |
| 8. Web Server Exploitation via Known CVEs | Adversaries target known CVEs in web servers, as in 2025 trends. | - Network Traffic (DS0003: Zeek HTTP)<br>- Threat Intelligence | - **Splunk**: `index=network sourcetype=zeek_http uri IN (known_vuln_paths) AND dest_ip IN (web_servers) \| stats count by src_ip, dest_ip, uri \| where count > 10`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "HTTP" and RemoteUrl in (knownVulnPaths) and RemoteIP in (webServers) \| summarize count() by DeviceIP, RemoteIP, RemoteUrl \| where count_ > 10`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE http.uri IN ['known_vuln_paths'] AND destination.ip IN ['web_servers'] \| STATS COUNT() BY source.ip, destination.ip, http.uri HAVING COUNT() > 10`. |
| 9. Web Server Exploitation with Suspicious File Uploads | Adversaries exploit file upload vulnerabilities in web servers, as in FIN7. | - Network Traffic (DS0003: Zeek HTTP) | - **Splunk**: `index=network sourcetype=zeek_http method=POST AND uri IN ("*upload*", "*file*") AND content IN ("*.php", "*.asp", "*.jsp") AND dest_ip IN (web_servers) \| stats count by src_ip, dest_ip, uri \| where count > 10`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "HTTP" and HttpMethod == "POST" and RemoteUrl has_any ("upload", "file") and HttpContent has_any (".php", ".asp", ".jsp") and RemoteIP in (webServers) \| summarize count() by DeviceIP, RemoteIP, RemoteUrl \| where count_ > 10`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE http.method == "POST" AND http.uri : ("*upload*" OR "*file*") AND http.content : ("*.php" OR "*.asp" OR "*.jsp") AND destination.ip IN ['web_servers'] \| STATS COUNT() BY source.ip, destination.ip, http.uri HAVING COUNT() > 10`. |
| 10. Web Server Exploitation in Cloud Environments | Adversaries exploit web servers in cloud environments, as in 2025 trends. | - Cloud Audit Logs (AWS CloudTrail)<br>- Network Traffic (DS0003: Zeek HTTP) | - **Splunk**: `index=cloud sourcetype=aws:cloudtrail eventName IN ("RunInstances", "StartInstances") AND requestParameters IN ("*httpd*", "*nginx*") AND src_ip NOT IN (trusted_ips) \| join src_ip [search index=network sourcetype=zeek_http dest_ip IN (web_servers)] \| stats count by src_ip, eventName, dest_ip \| where count > 5`.<br>- **KQL**: `AWSCloudTrail \| where EventName in ("RunInstances", "StartInstances") and RequestParameters has_any ("httpd", "nginx") and SourceIP !in (trustedIPs) \| join kind=inner (DeviceNetworkEvents \| where Protocol == "HTTP" and RemoteIP in (webServers)) on SourceIP \| summarize count() by SourceIP, EventName, RemoteIP \| where count_ > 5`.<br>- **ELK**: `FROM logs-aws.cloudtrail-* \| WHERE event.action IN ['RunInstances', 'StartInstances'] AND event.request_parameters : ("*httpd*" OR "*nginx*") AND source.ip NOT IN ['trusted_ips'] \| JOIN logs-zeek.http-* ON source.ip WHERE destination.ip IN ['web_servers'] \| STATS COUNT() BY source.ip, event.action, destination.ip HAVING COUNT() > 5`. |

### T1190.004: Client Application Vulnerability

| Hypothesis | Description | Data Sources | Hunting Queries |
|-----------|-------------|--------------|-----------------|
| 1. Client Application Exploitation via Browser Vulnerabilities | Adversaries exploit browser vulnerabilities, as in Cobalt Strike. | - Process Creation (DS0009: Sysmon ID 1)<br>- Network Traffic (DS0003: Zeek HTTP) | - **Splunk**: `index=endpoint sourcetype=sysmon EventCode=1 Image IN ("*chrome.exe*", "*firefox.exe*") \| join host [search index=network sourcetype=zeek_http content IN ("*script*", "*alert(*")] \| stats count by host, Image, content \| where count > 5`.<br>- **KQL**: `DeviceProcessEvents \| where ProcessName has_any ("chrome.exe", "firefox.exe") \| join kind=inner (DeviceNetworkEvents \| where Protocol == "HTTP" and HttpContent has_any ("script", "alert(")) on DeviceName \| summarize count() by DeviceName, ProcessName, HttpContent \| where count_ > 5`.<br>- **ELK**: `FROM logs-endpoint.process-* \| WHERE process.executable : ("*chrome.exe*" OR "*firefox.exe*") \| JOIN logs-zeek.http-* ON host.name WHERE http.content : ("*script*" OR "*alert(*") \| STATS COUNT() BY host.name, process.executable, http.content HAVING COUNT() > 5`. |
| 2. Client Application Exploitation from Malicious IPs | Adversaries exploit client applications from known malicious IPs, as in Volt Typhoon. | - Network Traffic (DS0003: Zeek HTTP)<br>- Threat Intelligence | - **Splunk**: `index=network sourcetype=zeek_http src_ip IN (threat_intel_ips) AND content IN ("*.exe", "*.dll") \| stats count by src_ip, dest_ip, content \| where count > 10`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "HTTP" and DeviceIP in (threatIntelIPs) and HttpContent has_any (".exe", ".dll") \| summarize count() by DeviceIP, RemoteIP, HttpContent \| where count_ > 10`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE source.ip IN ['threat_intel_ips'] AND http.content : ("*.exe" OR "*.dll") \| STATS COUNT() BY source.ip, destination.ip, http.content HAVING COUNT() > 10`. |
| 3. High-Frequency Client Application Requests | High-frequency requests from client applications indicating exploitation, as in FIN7. | - Network Traffic (DS0003: Zeek HTTP)<br>- Metrics | - **Splunk**: `index=network sourcetype=zeek_http user_agent IN ("*Chrome*", "*Firefox*") \| timechart span=1m count by src_ip \| where count > 50`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "HTTP" and AdditionalFields.UserAgent has_any ("Chrome", "Firefox") \| summarize MinuteCount=count() by bin(Timestamp, 1m), DeviceIP \| where MinuteCount > 50`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE http.user_agent : ("*Chrome*" OR "*Firefox*") \| STATS COUNT() BY date_histogram(@timestamp, '1m'), source.ip \| WHERE COUNT() > 50`. |
| 4. Client Application Exploitation with Suspicious User Agents | Adversaries use non-standard user agents for client exploitation, as in APT41. | - Network Traffic (DS0003: Zeek HTTP)<br>- Proxy Logs | - **Splunk**: `index=network sourcetype=zeek_http user_agent NOT IN (known_agents) AND content IN ("*.exe", "*.dll") \| stats count by src_ip, user_agent, content \| where count > 10`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "HTTP" and AdditionalFields.UserAgent !in (knownAgents) and HttpContent has_any (".exe", ".dll") \| summarize count() by DeviceIP, AdditionalFields.UserAgent, HttpContent \| where count_ > 10`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE http.user_agent NOT IN ['known_agents'] AND http.content : ("*.exe" OR "*.dll") \| STATS COUNT() BY source.ip, http.user_agent, http.content HAVING COUNT() > 10`. |
| 5. Client Application Exploitation via Malicious Downloads | Adversaries deliver malicious payloads via client applications, as in Volt Typhoon. | - Network Traffic (DS0003: Zeek HTTP)<br>- File Creation (DS0013: Sysmon ID 11) | - **Splunk**: `index=network sourcetype=zeek_http content IN ("*.exe", "*.dll") \| join host [search index=endpoint sourcetype=sysmon EventCode=11 FileName IN ("*.exe", "*.dll")] \| stats count by src_ip, host, FileName \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "HTTP" and HttpContent has_any (".exe", ".dll") \| join kind=inner (DeviceFileEvents \| where FileName has_any (".exe", ".dll")) on DeviceName \| summarize count() by DeviceIP, DeviceName, FileName \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE http.content : ("*.exe" OR "*.dll") \| JOIN logs-endpoint.file-* ON host.name WHERE file.name : ("*.exe" OR "*.dll") \| STATS COUNT() BY source.ip, host.name, file.name HAVING COUNT() > 5`. |
| 6. Client Application Exploitation Outside Business Hours | Exploitation attempts outside business hours, as in APT29. | - Network Traffic (DS0003: Zeek HTTP)<br>- Metrics | - **Splunk**: `index=network sourcetype=zeek_http user_agent IN ("*Chrome*", "*Firefox*") AND content IN ("*.exe", "*.dll") \| timechart span=1h count by src_ip \| where count > avg(count)*3 AND (_time < "08:00" OR _time > "18:00")`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "HTTP" and AdditionalFields.UserAgent has_any ("Chrome", "Firefox") and HttpContent has_any (".exe", ".dll") \| summarize HourlyCount=count() by bin(Timestamp, 1h), DeviceIP \| where HourlyCount > avg(HourlyCount) * 3 and (hour(Timestamp) < 8 or hour(Timestamp) > 18)`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE http.user_agent : ("*Chrome*" OR "*Firefox*") AND http.content : ("*.exe" OR "*.dll") \| STATS COUNT() BY date_histogram(@timestamp, '1h'), source.ip \| WHERE COUNT() > AVG(COUNT()) * 3 AND (HOUR(@timestamp) < 8 OR HOUR(@timestamp) > 18)`. |
| 7. Client Application Exploitation via Known CVEs | Adversaries target known CVEs in client applications, as in 2025 trends. | - Network Traffic (DS0003: Zeek HTTP)<br>- Threat Intelligence | - **Splunk**: `index=network sourcetype=zeek_http uri IN (known_vuln_paths) AND user_agent IN ("*Chrome*", "*Firefox*") \| stats count by src_ip, user_agent, uri \| where count > 10`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "HTTP" and RemoteUrl in (knownVulnPaths) and AdditionalFields.UserAgent has_any ("Chrome", "Firefox") \| summarize count() by DeviceIP, AdditionalFields.UserAgent, RemoteUrl \| where count_ > 10`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE http.uri IN ['known_vuln_paths'] AND http.user_agent : ("*Chrome*" OR "*Firefox*") \| STATS COUNT() BY source.ip, http.user_agent, http.uri HAVING COUNT() > 10`. |
| 8. Client Application Exploitation in Cloud Environments | Adversaries exploit client applications accessing cloud services, as in 2025 trends. | - Cloud Audit Logs (AWS CloudTrail)<br>- Network Traffic (DS0003: Zeek HTTP) | - **Splunk**: `index=cloud sourcetype=aws:cloudtrail eventName IN ("GetObject", "ListObjects") AND requestParameters IN ("*.exe", "*.dll") AND src_ip NOT IN (trusted_ips) \| join src_ip [search index=network sourcetype=zeek_http user_agent IN ("*Chrome*", "*Firefox*")] \| stats count by src_ip, eventName, user_agent \| where count > 5`.<br>- **KQL**: `AWSCloudTrail \| where EventName in ("GetObject", "ListObjects") and RequestParameters has_any (".exe", ".dll") and SourceIP !in (trustedIPs) \| join kind=inner (DeviceNetworkEvents \| where Protocol == "HTTP" and AdditionalFields.UserAgent has_any ("Chrome", "Firefox")) on SourceIP \| summarize count() by SourceIP, EventName, AdditionalFields.UserAgent \| where count_ > 5`.<br>- **ELK**: `FROM logs-aws.cloudtrail-* \| WHERE event.action IN ['GetObject', 'ListObjects'] AND event.request_parameters : ("*.exe" OR "*.dll") AND source.ip NOT IN ['trusted_ips'] \| JOIN logs-zeek.http-* ON source.ip WHERE http.user_agent : ("*Chrome*" OR "*Firefox*") \| STATS COUNT() BY source.ip, event.action, http.user_agent HAVING COUNT() > 5`. |
| 9. Client Application Exploitation with Suspicious File Downloads | Adversaries deliver malicious files to client applications, as in Volt Typhoon. | - Network Traffic (DS0003: Zeek HTTP)<br>- File Creation (DS0013: Sysmon ID 11) | - **Splunk**: `index=network sourcetype=zeek_http content IN ("*.exe", "*.dll") AND user_agent IN ("*Chrome*", "*Firefox*") \| join host [search index=endpoint sourcetype=sysmon EventCode=11 FileName IN ("*.exe", "*.dll")] \| stats count by src_ip, host, FileName \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "HTTP" and HttpContent has_any (".exe", ".dll") and AdditionalFields.UserAgent has_any ("Chrome", "Firefox") \| join kind=inner (DeviceFileEvents \| where FileName has_any (".exe", ".dll")) on DeviceName \| summarize count() by DeviceIP, DeviceName, FileName \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE http.content : ("*.exe" OR "*.dll") AND http.user_agent : ("*Chrome*" OR "*Firefox*") \| JOIN logs-endpoint.file-* ON host.name WHERE file.name : ("*.exe" OR "*.dll") \| STATS COUNT() BY source.ip, host.name, file.name HAVING COUNT() > 5`. |
| 10. Client Application Exploitation with Anomalous Ports | Adversaries exploit client applications on non-standard ports, as in 2025 trends. | - Network Traffic (DS0003: Zeek HTTP) | - **Splunk**: `index=network sourcetype=zeek_http dest_port NOT IN (80, 443) AND user_agent IN ("*Chrome*", "*Firefox*") AND content IN ("*.exe", "*.dll") \| stats count by src_ip, dest_port, user_agent \| where count > 10`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "HTTP" and RemotePort !in (80, 443) and AdditionalFields.UserAgent has_any ("Chrome", "Firefox") and HttpContent has_any (".exe", ".dll") \| summarize count() by DeviceIP, RemotePort, AdditionalFields.UserAgent \| where count_ > 10`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE destination.port NOT IN [80, 443] AND http.user_agent : ("*Chrome*" OR "*Firefox*") AND http.content : ("*.exe" OR "*.dll") \| STATS COUNT() BY source.ip, destination.port, http.user_agent HAVING COUNT() > 10`. |

### T1190.005: Container Service Vulnerability

| Hypothesis | Description | Data Sources | Hunting Queries |
|-----------|-------------|--------------|-----------------|
| 1. Container Service Exploitation via Malicious Images | Adversaries exploit container services with malicious images, as in Volt Typhoon. | - Cloud Audit Logs (AWS CloudTrail)<br>- Container Logs | - **Splunk**: `index=cloud sourcetype=aws:cloudtrail eventName IN ("RunTask", "CreateContainer") AND requestParameters IN ("*malicious_image*") AND src_ip NOT IN (trusted_ips) \| stats count by src_ip, eventName, requestParameters \| where count > 5`.<br>- **KQL**: `AWSCloudTrail \| where EventName in ("RunTask", "CreateContainer") and RequestParameters has "malicious_image" and SourceIP !in (trustedIPs) \| summarize count() by SourceIP, EventName, RequestParameters \| where count_ > 5`.<br>- **ELK**: `FROM logs-aws.cloudtrail-* \| WHERE event.action IN ['RunTask', 'CreateContainer'] AND event.request_parameters : '*malicious_image*' AND source.ip NOT IN ['trusted_ips'] \| STATS COUNT() BY source.ip, event.action, event.request_parameters HAVING COUNT() > 5`. |
| 2. Container Service Exploitation from Malicious IPs | Adversaries exploit container services from known malicious IPs, as in APT41. | - Network Traffic (DS0003: Zeek HTTP)<br>- Threat Intelligence | - **Splunk**: `index=network sourcetype=zeek_http src_ip IN (threat_intel_ips) AND uri IN ("*/api/v1/pods*", "*/api/v1/namespaces*") \| stats count by src_ip, dest_ip, uri \| where count > 10`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "HTTP" and DeviceIP in (threatIntelIPs) and RemoteUrl has_any ("/api/v1/pods", "/api/v1/namespaces") \| summarize count() by DeviceIP, RemoteIP, RemoteUrl \| where count_ > 10`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE source.ip IN ['threat_intel_ips'] AND http.uri : ("*/api/v1/pods*" OR "*/api/v1/namespaces*") \| STATS COUNT() BY source.ip, destination.ip, http.uri HAVING COUNT() > 10`. |
| 3. High-Frequency Container Service Requests | High-frequency requests to container services indicating scanning, as in FIN7. | - Network Traffic (DS0003: Zeek HTTP)<br>- Metrics | - **Splunk**: `index=network sourcetype=zeek_http uri IN ("*/api/v1/pods*", "*/api/v1/namespaces*") \| timechart span=1m count by src_ip \| where count > 50`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "HTTP" and RemoteUrl has_any ("/api/v1/pods", "/api/v1/namespaces") \| summarize MinuteCount=count() by bin(Timestamp, 1m), DeviceIP \| where MinuteCount > 50`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE http.uri : ("*/api/v1/pods*" OR "*/api/v1/namespaces*") \| STATS COUNT() BY date_histogram(@timestamp, '1m'), source.ip \| WHERE COUNT() > 50`. |
| 4. Container Service Exploitation with Suspicious Commands | Adversaries execute suspicious commands in containers, as in Turla. | - Container Logs (DS0007)<br>- Process Creation (Linux Auditd) | - **Splunk**: `index=container sourcetype=kubernetes_logs container_command IN ("*bash*", "*sh*", "*curl*", "*wget*") \| stats count by pod_name, container_command \| where count > 5`.<br>- **KQL**: `KubernetesLogs \| where ContainerCommand has_any ("bash", "sh", "curl", "wget") \| summarize count() by PodName, ContainerCommand \| where count_ > 5`.<br>- **ELK**: `FROM logs-kubernetes-* \| WHERE kubernetes.container.command : ("*bash*" OR "*sh*" OR "*curl*" OR "*wget*") \| STATS COUNT() BY kubernetes.pod.name, kubernetes.container.command HAVING COUNT() > 5`. |
| 5. Container Service Exploitation Outside Business Hours | Exploitation attempts outside business hours, as in APT29. | - Network Traffic (DS0003: Zeek HTTP)<br>- Metrics | - **Splunk**: `index=network sourcetype=zeek_http uri IN ("*/api/v1/pods*", "*/api/v1/namespaces*") \| timechart span=1h count by src_ip \| where count > avg(count)*3 AND (_time < "08:00" OR _time > "18:00")`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "HTTP" and RemoteUrl has_any ("/api/v1/pods", "/api/v1/namespaces") \| summarize HourlyCount=count() by bin(Timestamp, 1h), DeviceIP \| where HourlyCount > avg(HourlyCount) * 3 and (hour(Timestamp) < 8 or hour(Timestamp) > 18)`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE http.uri : ("*/api/v1/pods*" OR "*/api/v1/namespaces*") \| STATS COUNT() BY date_histogram(@timestamp, '1h'), source.ip \| WHERE COUNT() > AVG(COUNT()) * 3 AND (HOUR(@timestamp) < 8 OR HOUR(@timestamp) > 18)`. |
| 6. Container Service Exploitation with Suspicious User Agents | Adversaries use non-standard user agents for exploitation, as in APT41. | - Network Traffic (DS0003: Zeek HTTP)<br>- Proxy Logs | - **Splunk**: `index=network sourcetype=zeek_http user_agent NOT IN (known_agents) AND uri IN ("*/api/v1/pods*", "*/api/v1/namespaces*") \| stats count by src_ip, user_agent, uri \| where count > 10`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "HTTP" and AdditionalFields.UserAgent !in (knownAgents) and RemoteUrl has_any ("/api/v1/pods", "/api/v1/namespaces") \| summarize count() by DeviceIP, AdditionalFields.UserAgent, RemoteUrl \| where count_ > 10`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE http.user_agent NOT IN ['known_agents'] AND http.uri : ("*/api/v1/pods*" OR "*/api/v1/namespaces*") \| STATS COUNT() BY source.ip, http.user_agent, http.uri HAVING COUNT() > 10`. |
| 7. Container Service Exploitation via Known CVEs | Adversaries target known CVEs in container services, as in 2025 trends. | - Network Traffic (DS0003: Zeek HTTP)<br>- Threat Intelligence | - **Splunk**: `index=network sourcetype=zeek_http uri IN (known_vuln_paths) AND uri IN ("*/api/v1/pods*", "*/api/v1/namespaces*") \| stats count by src_ip, uri \| where count > 10`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "HTTP" and RemoteUrl in (knownVulnPaths) and RemoteUrl has_any ("/api/v1/pods", "/api/v1/namespaces") \| summarize count() by DeviceIP, RemoteUrl \| where count_ > 10`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE http.uri IN ['known_vuln_paths'] AND http.uri : ("*/api/v1/pods*" OR "*/api/v1/namespaces*") \| STATS COUNT() BY source.ip, http.uri HAVING COUNT() > 10`. |
| 8. Container Service Exploitation in Cloud Environments | Adversaries exploit container services in cloud environments, as in 2025 trends. | - Cloud Audit Logs (AWS CloudTrail)<br>- Network Traffic (DS0003: Zeek HTTP) | - **Splunk**: `index=cloud sourcetype=aws:cloudtrail eventName IN ("RunTask", "CreateContainer") AND src_ip NOT IN (trusted_ips) \| join src_ip [search index=network sourcetype=zeek_http uri IN ("*/api/v1/pods*", "*/api/v1/namespaces*")] \| stats count by src_ip, eventName, uri \| where count > 5`.<br>- **KQL**: `AWSCloudTrail \| where EventName in ("RunTask", "CreateContainer") and SourceIP !in (trustedIPs) \| join kind=inner (DeviceNetworkEvents \| where Protocol == "HTTP" and RemoteUrl has_any ("/api/v1/pods", "/api/v1/namespaces")) on SourceIP \| summarize count() by SourceIP, EventName, RemoteUrl \| where count_ > 5`.<br>- **ELK**: `FROM logs-aws.cloudtrail-* \| WHERE event.action IN ['RunTask', 'CreateContainer'] AND source.ip NOT IN ['trusted_ips'] \| JOIN logs-zeek.http-* ON source.ip WHERE http.uri : ("*/api/v1/pods*" OR "*/api/v1/namespaces*") \| STATS COUNT() BY source.ip, event.action, http.uri HAVING COUNT() > 5`. |
| 9. Container Service Exploitation with Suspicious File Downloads | Adversaries download malicious files post-exploitation, as in Volt Typhoon. | - Network Traffic (DS0003: Zeek HTTP)<br>- Container Logs | - **Splunk**: `index=network sourcetype=zeek_http uri IN ("*.exe", "*.sh") AND uri IN ("*/api/v1/pods*", "*/api/v1/namespaces*") \| stats count by src_ip, uri \| where count > 10`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "HTTP" and RemoteUrl has_any (".exe", ".sh") and RemoteUrl has_any ("/api/v1/pods", "/api/v1/namespaces") \| summarize count() by DeviceIP, RemoteUrl \| where count_ > 10`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE http.uri : ("*.exe" OR "*.sh") AND http.uri : ("*/api/v1/pods*" OR "*/api/v1/namespaces*") \| STATS COUNT() BY source.ip, http.uri HAVING COUNT() > 10`. |
| 10. Container Service Exploitation with Anomalous Ports | Adversaries exploit container services on non-standard ports, as in 2025 trends. | - Network Traffic (DS0003: Zeek HTTP) | - **Splunk**: `index=network sourcetype=zeek_http dest_port NOT IN (80, 443) AND uri IN ("*/api/v1/pods*", "*/api/v1/namespaces*") \| stats count by src_ip, dest_port, uri \| where count > 10`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "HTTP" and RemotePort !in (80, 443) and RemoteUrl has_any ("/api/v1/pods", "/api/v1/namespaces") \| summarize count() by DeviceIP, RemotePort, RemoteUrl \| where count_ > 10`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE destination.port NOT IN [80, 443] AND http.uri : ("*/api/v1/pods*" OR "*/api/v1/namespaces*") \| STATS COUNT() BY source.ip, destination.port, http.uri HAVING COUNT() > 10`. |

### T1189: Drive-by Compromise
### T1189.001: Malicious Link

| Hypothesis | Description | Data Sources | Hunting Queries |
|-----------|-------------|--------------|-----------------|
| 1. Malicious Links from Known Malicious IPs | Adversaries deliver malicious links from known malicious IPs, as in Volt Typhoon. | - Network Traffic (DS0003: Zeek HTTP)<br>- Threat Intelligence | - **Splunk**: `index=network sourcetype=zeek_http src_ip IN (threat_intel_ips) AND uri IN ("*.exe", "*.zip", "*.scr") \| stats count by src_ip, dest_ip, uri \| where count > 10`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "HTTP" and DeviceIP in (threatIntelIPs) and RemoteUrl has_any (".exe", ".zip", ".scr") \| summarize count() by DeviceIP, RemoteIP, RemoteUrl \| where count_ > 10`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE source.ip IN ['threat_intel_ips'] AND http.uri : ("*.exe" OR "*.zip" OR "*.scr") \| STATS COUNT() BY source.ip, destination.ip, http.uri HAVING COUNT() > 10`. |
| 2. High-Frequency Link Access | High-frequency access to suspicious URLs indicating drive-by compromise, as in APT41. | - Network Traffic (DS0003: Zeek HTTP)<br>- Metrics | - **Splunk**: `index=network sourcetype=zeek_http dest_port IN (80, 443) \| timechart span=1m count by src_ip, uri \| where count > 50`.<br>- **KQL**: `DeviceNetworkEvents \| where RemotePort in (80, 443) \| summarize MinuteCount=count() by bin(Timestamp, 1m), DeviceIP, RemoteUrl \| where MinuteCount > 50`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE destination.port IN [80, 443] \| STATS COUNT() BY date_histogram(@timestamp, '1m'), source.ip, http.uri \| WHERE COUNT() > 50`. |
| 3. Malicious Links with Suspicious User Agents | Adversaries use non-standard user agents to deliver malicious links, as in FIN7. | - Network Traffic (DS0003: Zeek HTTP)<br>- Proxy Logs | - **Splunk**: `index=network sourcetype=zeek_http user_agent NOT IN (known_agents) AND uri IN ("*.exe", "*.zip", "*.scr") \| stats count by src_ip, user_agent, uri \| where count > 10`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "HTTP" and AdditionalFields.UserAgent !in (knownAgents) and RemoteUrl has_any (".exe", ".zip", ".scr") \| summarize count() by DeviceIP, AdditionalFields.UserAgent, RemoteUrl \| where count_ > 10`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE http.user_agent NOT IN ['known_agents'] AND http.uri : ("*.exe" OR "*.zip" OR "*.scr") \| STATS COUNT() BY source.ip, http.user_agent, http.uri HAVING COUNT() > 10`. |
| 4. Malicious Links Outside Business Hours | Access to malicious links outside business hours, as in APT29. | - Network Traffic (DS0003: Zeek HTTP)<br>- Metrics | - **Splunk**: `index=network sourcetype=zeek_http uri IN ("*.exe", "*.zip", "*.scr") \| timechart span=1h count by src_ip \| where count > avg(count)*3 AND (_time < "08:00" OR _time > "18:00")`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "HTTP" and RemoteUrl has_any (".exe", ".zip", ".scr") \| summarize HourlyCount=count() by bin(Timestamp, 1h), DeviceIP \| where HourlyCount > avg(HourlyCount) * 3 and (hour(Timestamp) < 8 or hour(Timestamp) > 18)`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE http.uri : ("*.exe" OR "*.zip" OR "*.scr") \| STATS COUNT() BY date_histogram(@timestamp, '1h'), source.ip \| WHERE COUNT() > AVG(COUNT()) * 3 AND (HOUR(@timestamp) < 8 OR HOUR(@timestamp) > 18)`. |
| 5. Malicious Links Followed by File Downloads | Malicious links leading to file downloads, as in Volt Typhoon. | - Network Traffic (DS0003: Zeek HTTP)<br>- File Creation (DS0013: Sysmon ID 11) | - **Splunk**: `index=network sourcetype=zeek_http uri IN ("*.exe", "*.zip", "*.scr") \| join host [search index=endpoint sourcetype=sysmon EventCode=11 FileName IN ("*.exe", "*.zip", "*.scr")] \| stats count by src_ip, host, FileName \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "HTTP" and RemoteUrl has_any (".exe", ".zip", ".scr") \| join kind=inner (DeviceFileEvents \| where FileName has_any (".exe", ".zip", ".scr")) on DeviceName \| summarize count() by DeviceIP, DeviceName, FileName \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE http.uri : ("*.exe" OR "*.zip" OR "*.scr") \| JOIN logs-endpoint.file-* ON host.name WHERE file.name : ("*.exe" OR "*.zip" OR "*.scr") \| STATS COUNT() BY source.ip, host.name, file.name HAVING COUNT() > 5`. |
| 6. Malicious Links in Cloud Environments | Adversaries deliver malicious links to cloud-hosted clients, as in 2025 trends. | - Cloud Audit Logs (AWS CloudTrail)<br>- Network Traffic (DS0003: Zeek HTTP) | - **Splunk**: `index=cloud sourcetype=aws:cloudtrail eventName IN ("GetObject", "ListObjects") AND requestParameters IN ("*.exe", "*.zip", "*.scr") AND src_ip NOT IN (trusted_ips) \| join src_ip [search index=network sourcetype=zeek_http uri IN ("*.exe", "*.zip", "*.scr")] \| stats count by src_ip, eventName, uri \| where count > 5`.<br>- **KQL**: `AWSCloudTrail \| where EventName in ("GetObject", "ListObjects") and RequestParameters has_any (".exe", ".zip", ".scr") and SourceIP !in (trustedIPs) \| join kind=inner (DeviceNetworkEvents \| where Protocol == "HTTP" and RemoteUrl has_any (".exe", ".zip", ".scr")) on SourceIP \| summarize count() by SourceIP, EventName, RemoteUrl \| where count_ > 5`.<br>- **ELK**: `FROM logs-aws.cloudtrail-* \| WHERE event.action IN ['GetObject', 'ListObjects'] AND event.request_parameters : ("*.exe" OR "*.zip" OR "*.scr") AND source.ip NOT IN ['trusted_ips'] \| JOIN logs-zeek.http-* ON source.ip WHERE http.uri : ("*.exe" OR "*.zip" OR "*.scr") \| STATS COUNT() BY source.ip, event.action, http.uri HAVING COUNT() > 5`. |
| 7. Malicious Links via Suspicious Referrers | Malicious links accessed via suspicious referrers, as in FIN7. | - Network Traffic (DS0003: Zeek HTTP) | - **Splunk**: `index=network sourcetype=zeek_http referrer IN (malicious_referrers) AND uri IN ("*.exe", "*.zip", "*.scr") \| stats count by src_ip, referrer, uri \| where count > 10`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "HTTP" and AdditionalFields.Referrer in (maliciousReferrers) and RemoteUrl has_any (".exe", ".zip", ".scr") \| summarize count() by DeviceIP, AdditionalFields.Referrer, RemoteUrl \| where count_ > 10`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE http.referrer IN ['malicious_referrers'] AND http.uri : ("*.exe" OR "*.zip" OR "*.scr") \| STATS COUNT() BY source.ip, http.referrer, http.uri HAVING COUNT() > 10`. |
| 8. Malicious Links with Anomalous Ports | Malicious links accessed on non-standard ports, as in 2025 trends. | - Network Traffic (DS0003: Zeek HTTP) | - **Splunk**: `index=network sourcetype=zeek_http dest_port NOT IN (80, 443) AND uri IN ("*.exe", "*.zip", "*.scr") \| stats count by src_ip, dest_port, uri \| where count > 10`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "HTTP" and RemotePort !in (80, 443) and RemoteUrl has_any (".exe", ".zip", ".scr") \| summarize count() by DeviceIP, RemotePort, RemoteUrl \| where count_ > 10`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE destination.port NOT IN [80, 443] AND http.uri : ("*.exe" OR "*.zip" OR "*.scr") \| STATS COUNT() BY source.ip, destination.port, http.uri HAVING COUNT() > 10`. |
| 9. Malicious Links Leading to Suspicious Processes | Malicious links triggering suspicious process execution, as in Cobalt Strike. | - Process Creation (DS0009: Sysmon ID 1)<br>- Network Traffic (DS0003: Zeek HTTP) | - **Splunk**: `index=network sourcetype=zeek_http uri IN ("*.exe", "*.zip", "*.scr") \| join host [search index=endpoint sourcetype=sysmon EventCode=1 Image IN ("*powershell.exe*", "*cmd.exe*")] \| stats count by src_ip, host, Image \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "HTTP" and RemoteUrl has_any (".exe", ".zip", ".scr") \| join kind=inner (DeviceProcessEvents \| where ProcessName has_any ("powershell.exe", "cmd.exe")) on DeviceName \| summarize count() by DeviceIP, DeviceName, ProcessName \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE http.uri : ("*.exe" OR "*.zip" OR "*.scr") \| JOIN logs-endpoint.process-* ON host.name WHERE process.executable : ("*powershell.exe*" OR "*cmd.exe*") \| STATS COUNT() BY source.ip, host.name, process.executable HAVING COUNT() > 5`. |
| 10. Malicious Links via Known Vulnerable Endpoints | Adversaries target known vulnerable endpoints, as in 2025 trends. | - Network Traffic (DS0003: Zeek HTTP)<br>- Threat Intelligence | - **Splunk**: `index=network sourcetype=zeek_http uri IN (known_vuln_paths) AND src_ip NOT IN (trusted_ips) \| stats count by src_ip, uri \| where count > 10`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "HTTP" and RemoteUrl in (knownVulnPaths) and DeviceIP !in (trustedIPs) \| summarize count() by DeviceIP, RemoteUrl \| where count_ > 10`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE http.uri IN ['known_vuln_paths'] AND source.ip NOT IN ['trusted_ips'] \| STATS COUNT() BY source.ip, http.uri HAVING COUNT() > 10`. |

### T1189.002: Malicious Image

| Hypothesis | Description | Data Sources | Hunting Queries |
|-----------|-------------|--------------|-----------------|
| 1. Malicious Images from Known Malicious IPs | Adversaries deliver malicious images from known malicious IPs, as in Volt Typhoon. | - Network Traffic (DS0003: Zeek HTTP)<br>- Threat Intelligence | - **Splunk**: `index=network sourcetype=zeek_http src_ip IN (threat_intel_ips) AND content IN ("*.jpg", "*.png", "*.gif") AND content_type IN ("image/jpeg", "image/png", "image/gif") \| stats count by src_ip, dest_ip, content \| where count > 10`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "HTTP" and DeviceIP in (threatIntelIPs) and HttpContent has_any (".jpg", ".png", ".gif") and AdditionalFields.ContentType in ("image/jpeg", "image/png", "image/gif") \| summarize count() by DeviceIP, RemoteIP, HttpContent \| where count_ > 10`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE source.ip IN ['threat_intel_ips'] AND http.content : ("*.jpg" OR "*.png" OR "*.gif") AND http.content_type IN ['image/jpeg', 'image/png', 'image/gif'] \| STATS COUNT() BY source.ip, destination.ip, http.content HAVING COUNT() > 10`. |
| 2. High-Frequency Image Downloads | High-frequency image downloads indicating potential drive-by compromise, as in APT41. | - Network Traffic (DS0003: Zeek HTTP)<br>- Metrics | - **Splunk**: `index=network sourcetype=zeek_http content_type IN ("image/jpeg", "image/png", "image/gif") \| timechart span=1m count by src_ip, content \| where count > 50`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "HTTP" and AdditionalFields.ContentType in ("image/jpeg", "image/png", "image/gif") \| summarize MinuteCount=count() by bin(Timestamp, 1m), DeviceIP, HttpContent \| where MinuteCount > 50`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE http.content_type IN ['image/jpeg', 'image/png', 'image/gif'] \| STATS COUNT() BY date_histogram(@timestamp, '1m'), source.ip, http.content \| WHERE COUNT() > 50`. |
| 3. Malicious Images with Suspicious User Agents | Adversaries use non-standard user agents to deliver malicious images, as in FIN7. | - Network Traffic (DS0003: Zeek HTTP)<br>- Proxy Logs | - **Splunk**: `index=network sourcetype=zeek_http user_agent NOT IN (known_agents) AND content_type IN ("image/jpeg", "image/png", "image/gif") \| stats count by src_ip, user_agent, content \| where count > 10`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "HTTP" and AdditionalFields.UserAgent !in (knownAgents) and AdditionalFields.ContentType in ("image/jpeg", "image/png", "image/gif") \| summarize count() by DeviceIP, AdditionalFields.UserAgent, HttpContent \| where count_ > 10`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE http.user_agent NOT IN ['known_agents'] AND http.content_type IN ['image/jpeg', 'image/png', 'image/gif'] \| STATS COUNT() BY source.ip, http.user_agent, http.content HAVING COUNT() > 10`. |
| 4. Malicious Images Outside Business Hours | Malicious image downloads outside business hours, as in APT29. | - Network Traffic (DS0003: Zeek HTTP)<br>- Metrics | - **Splunk**: `index=network sourcetype=zeek_http content_type IN ("image/jpeg", "image/png", "image/gif") \| timechart span=1h count by src_ip \| where count > avg(count)*3 AND (_time < "08:00" OR _time > "18:00")`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "HTTP" and AdditionalFields.ContentType in ("image/jpeg", "image/png", "image/gif") \| summarize HourlyCount=count() by bin(Timestamp, 1h), DeviceIP \| where HourlyCount > avg(HourlyCount) * 3 and (hour(Timestamp) < 8 or hour(Timestamp) > 18)`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE http.content_type IN ['image/jpeg', 'image/png', 'image/gif'] \| STATS COUNT() BY date_histogram(@timestamp, '1h'), source.ip \| WHERE COUNT() > AVG(COUNT()) * 3 AND (HOUR(@timestamp) < 8 OR HOUR(@timestamp) > 18)`. |
| 5. Malicious Images Followed by Suspicious Processes | Malicious images triggering suspicious process execution, as in Cobalt Strike. | - Process Creation (DS0009: Sysmon ID 1)<br>- Network Traffic (DS0003: Zeek HTTP) | - **Splunk**: `index=network sourcetype=zeek_http content_type IN ("image/jpeg", "image/png", "image/gif") \| join host [search index=endpoint sourcetype=sysmon EventCode=1 Image IN ("*powershell.exe*", "*cmd.exe*")] \| stats count by src_ip, host, Image \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "HTTP" and AdditionalFields.ContentType in ("image/jpeg", "image/png", "image/gif") \| join kind=inner (DeviceProcessEvents \| where ProcessName has_any ("powershell.exe", "cmd.exe")) on DeviceName \| summarize count() by DeviceIP, DeviceName, ProcessName \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE http.content_type IN ['image/jpeg', 'image/png', 'image/gif'] \| JOIN logs-endpoint.process-* ON host.name WHERE process.executable : ("*powershell.exe*" OR "*cmd.exe*") \| STATS COUNT() BY source.ip, host.name, process.executable HAVING COUNT() > 5`. |
| 6. Malicious Images in Cloud Environments | Adversaries deliver malicious images via cloud-hosted services, as in 2025 trends. | - Cloud Audit Logs (AWS CloudTrail)<br>- Network Traffic (DS0003: Zeek HTTP) | - **Splunk**: `index=cloud sourcetype=aws:cloudtrail eventName IN ("GetObject", "ListObjects") AND requestParameters IN ("*.jpg", "*.png", "*.gif") AND src_ip NOT IN (trusted_ips) \| join src_ip [search index=network sourcetype=zeek_http content_type IN ("image/jpeg", "image/png", "image/gif")] \| stats count by src_ip, eventName, content_type \| where count > 5`.<br>- **KQL**: `AWSCloudTrail \| where EventName in ("GetObject", "ListObjects") and RequestParameters has_any (".jpg", ".png", ".gif") and SourceIP !in (trustedIPs) \| join kind=inner (DeviceNetworkEvents \| where Protocol == "HTTP" and AdditionalFields.ContentType in ("image/jpeg", "image/png", "image/gif")) on SourceIP \| summarize count() by SourceIP, EventName, AdditionalFields.ContentType \| where count_ > 5`.<br>- **ELK**: `FROM logs-aws.cloudtrail-* \| WHERE event.action IN ['GetObject', 'ListObjects'] AND event.request_parameters : ("*.jpg" OR "*.png" OR "*.gif") AND source.ip NOT IN ['trusted_ips'] \| JOIN logs-zeek.http-* ON source.ip WHERE http.content_type IN ['image/jpeg', 'image/png', 'image/gif'] \| STATS COUNT() BY source.ip, event.action, http.content_type HAVING COUNT() > 5`. |
| 7. Malicious Images via Suspicious Referrers | Malicious images accessed via suspicious referrers, as in FIN7. | - Network Traffic (DS0003: Zeek HTTP) | - **Splunk**: `index=network sourcetype=zeek_http referrer IN (malicious_referrers) AND content_type IN ("image/jpeg", "image/png", "image/gif") \| stats count by src_ip, referrer, content_type \| where count > 10`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "HTTP" and AdditionalFields.Referrer in (maliciousReferrers) and AdditionalFields.ContentType in ("image/jpeg", "image/png", "image/gif") \| summarize count() by DeviceIP, AdditionalFields.Referrer, AdditionalFields.ContentType \| where count_ > 10`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE http.referrer IN ['malicious_referrers'] AND http.content_type IN ['image/jpeg', 'image/png', 'image/gif'] \| STATS COUNT() BY source.ip, http.referrer, http.content_type HAVING COUNT() > 10`. |
| 8. Malicious Images with Anomalous Ports | Malicious images accessed on non-standard ports, as in 2025 trends. | - Network Traffic (DS0003: Zeek HTTP) | - **Splunk**: `index=network sourcetype=zeek_http dest_port NOT IN (80, 443) AND content_type IN ("image/jpeg", "image/png", "image/gif") \| stats count by src_ip, dest_port, content_type \| where count > 10`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "HTTP" and RemotePort !in (80, 443) and AdditionalFields.ContentType in ("image/jpeg", "image/png", "image/gif") \| summarize count() by DeviceIP, RemotePort, AdditionalFields.ContentType \| where count_ > 10`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE destination.port NOT IN [80, 443] AND http.content_type IN ['image/jpeg', 'image/png', 'image/gif'] \| STATS COUNT() BY source.ip, destination.port, http.content_type HAVING COUNT() > 10`. |
| 9. Malicious Images Followed by File Creation | Malicious images leading to file creation, as in Volt Typhoon. | - Network Traffic (DS0003: Zeek HTTP)<br>- File Creation (DS0013: Sysmon ID 11) | - **Splunk**: `index=network sourcetype=zeek_http content_type IN ("image/jpeg", "image/png", "image/gif") \| join host [search index=endpoint sourcetype=sysmon EventCode=11 FileName IN ("*.exe", "*.dll")] \| stats count by src_ip, host, FileName \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "HTTP" and AdditionalFields.ContentType in ("image/jpeg", "image/png", "image/gif") \| join kind=inner (DeviceFileEvents \| where FileName has_any (".exe", ".dll")) on DeviceName \| summarize count() by DeviceIP, DeviceName, FileName \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE http.content_type IN ['image/jpeg', 'image/png', 'image/gif'] \| JOIN logs-endpoint.file-* ON host.name WHERE file.name : ("*.exe" OR "*.dll") \| STATS COUNT() BY source.ip, host.name, file.name HAVING COUNT() > 5`. |
| 10. Malicious Images via Known Vulnerable Endpoints | Adversaries deliver malicious images via known vulnerable endpoints, as in 2025 trends. | - Network Traffic (DS0003: Zeek HTTP)<br>- Threat Intelligence | - **Splunk**: `index=network sourcetype=zeek_http uri IN (known_vuln_paths) AND content_type IN ("image/jpeg", "image/png", "image/gif") \| stats count by src_ip, uri, content_type \| where count > 10`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "HTTP" and RemoteUrl in (knownVulnPaths) and AdditionalFields.ContentType in ("image/jpeg", "image/png", "image/gif") \| summarize count() by DeviceIP, RemoteUrl, AdditionalFields.ContentType \| where count_ > 10`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE http.uri IN ['known_vuln_paths'] AND http.content_type IN ['image/jpeg', 'image/png', 'image/gif'] \| STATS COUNT() BY source.ip, http.uri, http.content_type HAVING COUNT() > 10`. |

### T1189.003: Malicious Script

| Hypothesis | Description | Data Sources | Hunting Queries |
|-----------|-------------|--------------|-----------------|
| 1. Malicious Scripts from Known Malicious IPs | Adversaries deliver malicious scripts from known malicious IPs, as in Volt Typhoon. | - Network Traffic (DS0003: Zeek HTTP)<br>- Threat Intelligence | - **Splunk**: `index=network sourcetype=zeek_http src_ip IN (threat_intel_ips) AND content_type IN ("application/javascript", "text/javascript") \| stats count by src_ip, dest_ip, uri \| where count > 10`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "HTTP" and DeviceIP in (threatIntelIPs) and AdditionalFields.ContentType in ("application/javascript", "text/javascript") \| summarize count() by DeviceIP, RemoteIP, RemoteUrl \| where count_ > 10`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE source.ip IN ['threat_intel_ips'] AND http.content_type IN ['application/javascript', 'text/javascript'] \| STATS COUNT() BY source.ip, destination.ip, http.uri HAVING COUNT() > 10`. |
| 2. High-Frequency Script Downloads | High-frequency script downloads indicating drive-by compromise, as in APT41. | - Network Traffic (DS0003: Zeek HTTP)<br>- Metrics | - **Splunk**: `index=network sourcetype=zeek_http content_type IN ("application/javascript", "text/javascript") \| timechart span=1m count by src_ip, uri \| where count > 50`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "HTTP" and AdditionalFields.ContentType in ("application/javascript", "text/javascript") \| summarize MinuteCount=count() by bin(Timestamp, 1m), DeviceIP, RemoteUrl \| where MinuteCount > 50`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE http.content_type IN ['application/javascript', 'text/javascript'] \| STATS COUNT() BY date_histogram(@timestamp, '1m'), source.ip, http.uri \| WHERE COUNT() > 50`. |
| 3. Malicious Scripts with Suspicious User Agents | Adversaries use non-standard user agents to deliver malicious scripts, as in FIN7. | - Network Traffic (DS0003: Zeek HTTP)<br>- Proxy Logs | - **Splunk**: `index=network sourcetype=zeek_http user_agent NOT IN (known_agents) AND content_type IN ("application/javascript", "text/javascript") \| stats count by src_ip, user_agent, uri \| where count > 10`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "HTTP" and AdditionalFields.UserAgent !in (knownAgents) and AdditionalFields.ContentType in ("application/javascript", "text/javascript") \| summarize count() by DeviceIP, AdditionalFields.UserAgent, RemoteUrl \| where count_ > 10`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE http.user_agent NOT IN ['known_agents'] AND http.content_type IN ['application/javascript', 'text/javascript'] \| STATS COUNT() BY source.ip, http.user_agent, http.uri HAVING COUNT() > 10`. |
| 4. Malicious Scripts Outside Business Hours | Malicious script downloads outside business hours, as in APT29. | - Network Traffic (DS0003: Zeek HTTP)<br>- Metrics | - **Splunk**: `index=network sourcetype=zeek_http content_type IN ("application/javascript", "text/javascript") \| timechart span=1h count by src_ip \| where count > avg(count)*3 AND (_time < "08:00" OR _time > "18:00")`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "HTTP" and AdditionalFields.ContentType in ("application/javascript", "text/javascript") \| summarize HourlyCount=count() by bin(Timestamp, 1h), DeviceIP \| where HourlyCount > avg(HourlyCount) * 3 and (hour(Timestamp) < 8 or hour(Timestamp) > 18)`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE http.content_type IN ['application/javascript', 'text/javascript'] \| STATS COUNT() BY date_histogram(@timestamp, '1h'), source.ip \| WHERE COUNT() > AVG(COUNT()) * 3 AND (HOUR(@timestamp) < 8 OR HOUR(@timestamp) > 18)`. |
| 5. Malicious Scripts Followed by Suspicious Processes | Malicious scripts triggering suspicious process execution, as in Cobalt Strike. | - Process Creation (DS0009: Sysmon ID 1)<br>- Network Traffic (DS0003: Zeek HTTP) | - **Splunk**: `index=network sourcetype=zeek_http content_type IN ("application/javascript", "text/javascript") \| join host [search index=endpoint sourcetype=sysmon EventCode=1 Image IN ("*powershell.exe*", "*cmd.exe*")] \| stats count by src_ip, host, Image \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "HTTP" and AdditionalFields.ContentType in ("application/javascript", "text/javascript") \| join kind=inner (DeviceProcessEvents \| where ProcessName has_any ("powershell.exe", "cmd.exe")) on DeviceName \| summarize count() by DeviceIP, DeviceName, ProcessName \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE http.content_type IN ['application/javascript', 'text/javascript'] \| JOIN logs-endpoint.process-* ON host.name WHERE process.executable : ("*powershell.exe*" OR "*cmd.exe*") \| STATS COUNT() BY source.ip, host.name, process.executable HAVING COUNT() > 5`. |
| 6. Malicious Scripts in Cloud Environments | Adversaries deliver malicious scripts via cloud-hosted services, as in 2025 trends. | - Cloud Audit Logs (AWS CloudTrail)<br>- Network Traffic (DS0003: Zeek HTTP) | - **Splunk**: `index=cloud sourcetype=aws:cloudtrail eventName IN ("GetObject", "ListObjects") AND requestParameters IN ("*.js") AND src_ip NOT IN (trusted_ips) \| join src_ip [search index=network sourcetype=zeek_http content_type IN ("application/javascript", "text/javascript")] \| stats count by src_ip, eventName, content_type \| where count > 5`.<br>- **KQL**: `AWSCloudTrail \| where EventName in ("GetObject", "ListObjects") and RequestParameters has ".js" and SourceIP !in (trustedIPs) \| join kind=inner (DeviceNetworkEvents \| where Protocol == "HTTP" and AdditionalFields.ContentType in ("application/javascript", "text/javascript")) on SourceIP \| summarize count() by SourceIP, EventName, AdditionalFields.ContentType \| where count_ > 5`.<br>- **ELK**: `FROM logs-aws.cloudtrail-* \| WHERE event.action IN ['GetObject', 'ListObjects'] AND event.request_parameters : "*.js" AND source.ip NOT IN ['trusted_ips'] \| JOIN logs-zeek.http-* ON source.ip WHERE http.content_type IN ['application/javascript', 'text/javascript'] \| STATS COUNT() BY source.ip, event.action, http.content_type HAVING COUNT() > 5`. |
| 7. Malicious Scripts via Suspicious Referrers | Malicious scripts accessed via suspicious referrers, as in FIN7. | - Network Traffic (DS0003: Zeek HTTP) | - **Splunk**: `index=network sourcetype=zeek_http referrer IN (malicious_referrers) AND content_type IN ("application/javascript", "text/javascript") \| stats count by src_ip, referrer, content_type \| where count > 10`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "HTTP" and AdditionalFields.Referrer in (maliciousReferrers) and AdditionalFields.ContentType in ("application/javascript", "text/javascript") \| summarize count() by DeviceIP, AdditionalFields.Referrer, AdditionalFields.ContentType \| where count_ > 10`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE http.referrer IN ['malicious_referrers'] AND http.content_type IN ['application/javascript', 'text/javascript'] \| STATS COUNT() BY source.ip, http.referrer, http.content_type HAVING COUNT() > 10`. |
| 8. Malicious Scripts with Anomalous Ports | Malicious scripts accessed on non-standard ports, as in 2025 trends. | - Network Traffic (DS0003: Zeek HTTP) | - **Splunk**: `index=network sourcetype=zeek_http dest_port NOT IN (80, 443) AND content_type IN ("application/javascript", "text/javascript") \| stats count by src_ip, dest_port, content_type \| where count > 10`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "HTTP" and RemotePort !in (80, 443) and AdditionalFields.ContentType in ("application/javascript", "text/javascript") \| summarize count() by DeviceIP, RemotePort, AdditionalFields.ContentType \| where count_ > 10`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE destination.port NOT IN [80, 443] AND http.content_type IN ['application/javascript', 'text/javascript'] \| STATS COUNT() BY source.ip, destination.port, http.content_type HAVING COUNT() > 10`. |
| 9. Malicious Scripts Followed by File Creation | Malicious scripts leading to file creation, as in Volt Typhoon. | - Network Traffic (DS0003: Zeek HTTP)<br>- File Creation (DS0013: Sysmon ID 11) | - **Splunk**: `index=network sourcetype=zeek_http content_type IN ("application/javascript", "text/javascript") \| join host [search index=endpoint sourcetype=sysmon EventCode=11 FileName IN ("*.exe", "*.dll")] \| stats count by src_ip, host, FileName \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "HTTP" and AdditionalFields.ContentType in ("application/javascript", "text/javascript") \| join kind=inner (DeviceFileEvents \| where FileName has_any (".exe", ".dll")) on DeviceName \| summarize count() by DeviceIP, DeviceName, FileName \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE http.content_type IN ['application/javascript', 'text/javascript'] \| JOIN logs-endpoint.file-* ON host.name WHERE file.name : ("*.exe" OR "*.dll") \| STATS COUNT() BY source.ip, host.name, file.name HAVING COUNT() > 5`. |
| 10. Malicious Scripts via Known Vulnerable Endpoints | Adversaries deliver malicious scripts via known vulnerable endpoints, as in 2025 trends. | - Network Traffic (DS0003: Zeek HTTP)<br>- Threat Intelligence | - **Splunk**: `index=network sourcetype=zeek_http uri IN (known_vuln_paths) AND content_type IN ("application/javascript", "text/javascript") \| stats count by src_ip, uri, content_type \| where count > 10`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "HTTP" and RemoteUrl in (knownVulnPaths) and AdditionalFields.ContentType in ("application/javascript", "text/javascript") \| summarize count() by DeviceIP, RemoteUrl, AdditionalFields.ContentType \| where count_ > 10`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE http.uri IN ['known_vuln_paths'] AND http.content_type IN ['application/javascript', 'text/javascript'] \| STATS COUNT() BY source.ip, http.uri, http.content_type HAVING COUNT() > 10`. |

### T1566: Phishing
