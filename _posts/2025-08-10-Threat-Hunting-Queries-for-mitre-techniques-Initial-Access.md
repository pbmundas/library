---
layout: default
title:  Initial Access
category: Threat-Hunting-Queries  # This becomes a main topic in sidebar
---

## Initial Access

### T1133: External Remote Services
### T1133.001: Remote Desktop Protocol (RDP)

| Hypothesis | Description | Data Sources | Hunting Queries |
|-----------|-------------|--------------|-----------------|
| 1. Unauthorized RDP Access from External IPs | Adversaries use compromised credentials for RDP access, as in Volt Typhoon. | - Network Traffic (DS0003: Zeek Conn)<br>- Windows Event Logs (DS0002: Event ID 4624) | - **Splunk**: `index=network sourcetype=zeek_conn dest_port=3389 AND src_ip NOT IN (trusted_ips) \| join src_ip [search index=windows sourcetype=WinEventLog EventCode=4624 LogonType=10] \| stats count by src_ip, dest_ip, Account_Name \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where RemotePort == 3389 and DeviceIP !in (trustedIPs) \| join kind=inner (SecurityEvent \| where EventID == 4624 and LogonType == 10) on DeviceIP \| summarize count() by DeviceIP, RemoteIP, AccountName \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.conn-* \| WHERE destination.port == 3389 AND source.ip NOT IN ['trusted_ips'] \| JOIN logs-windows.security-* ON source.ip WHERE event.code == '4624' AND winlog.event_data.LogonType == '10' \| STATS COUNT() BY source.ip, destination.ip, winlog.event_data.AccountName HAVING COUNT() > 5`. |
| 2. High-Frequency RDP Attempts | High-frequency RDP connection attempts indicating brute force, as in APT41. | - Network Traffic (DS0003: Zeek Conn)<br>- Metrics | - **Splunk**: `index=network sourcetype=zeek_conn dest_port=3389 \| timechart span=1m count by src_ip \| where count > 50`.<br>- **KQL**: `DeviceNetworkEvents \| where RemotePort == 3389 \| summarize MinuteCount=count() by bin(Timestamp, 1m), DeviceIP \| where MinuteCount > 50`.<br>- **ELK**: `FROM logs-zeek.conn-* \| WHERE destination.port == 3389 \| STATS COUNT() BY date_histogram(@timestamp, '1m'), source.ip \| WHERE COUNT() > 50`. |
| 3. RDP Access with Suspicious User Accounts | Adversaries use non-standard accounts for RDP access, as in FIN7. | - Windows Event Logs (DS0002: Event ID 4624) | - **Splunk**: `index=windows sourcetype=WinEventLog EventCode=4624 LogonType=10 Account_Name NOT IN (authorized_users) \| stats count by src_ip, Account_Name \| where count > 5`.<br>- **KQL**: `SecurityEvent \| where EventID == 4624 and LogonType == 10 and AccountName !in (authorizedUsers) \| summarize count() by ClientIP, AccountName \| where count_ > 5`.<br>- **ELK**: `FROM logs-windows.security-* \| WHERE event.code == '4624' AND winlog.event_data.LogonType == '10' AND winlog.event_data.AccountName NOT IN ['authorized_users'] \| STATS COUNT() BY source.ip, winlog.event_data.AccountName HAVING COUNT() > 5`. |
| 4. RDP Access Outside Business Hours | RDP connections outside business hours, as in APT29. | - Windows Event Logs (DS0002: Event ID 4624)<br>- Metrics | - **Splunk**: `index=windows sourcetype=WinEventLog EventCode=4624 LogonType=10 \| timechart span=1h count by src_ip \| where count > avg(count)*3 AND (_time < "08:00" OR _time > "18:00")`.<br>- **KQL**: `SecurityEvent \| where EventID == 4624 and LogonType == 10 \| summarize HourlyCount=count() by bin(Timestamp, 1h), ClientIP \| where HourlyCount > avg(HourlyCount) * 3 and (hour(Timestamp) < 8 or hour(Timestamp) > 18)`.<br>- **ELK**: `FROM logs-windows.security-* \| WHERE event.code == '4624' AND winlog.event_data.LogonType == '10' \| STATS COUNT() BY date_histogram(@timestamp, '1h'), source.ip \| WHERE COUNT() > AVG(COUNT()) * 3 AND (HOUR(@timestamp) < 8 OR HOUR(@timestamp) > 18)`. |
| 5. RDP Access with Anomalous Ports | Adversaries use non-standard ports for RDP, as in 2025 trends. | - Network Traffic (DS0003: Zeek Conn) | - **Splunk**: `index=network sourcetype=zeek_conn dest_port NOT IN (3389) AND protocol="tcp" AND service="rdp" \| stats count by src_ip, dest_ip, dest_port \| where count > 10`.<br>- **KQL**: `DeviceNetworkEvents \| where RemotePort !in (3389) and Protocol == "TCP" and Service == "rdp" \| summarize count() by DeviceIP, RemoteIP, RemotePort \| where count_ > 10`.<br>- **ELK**: `FROM logs-zeek.conn-* \| WHERE destination.port NOT IN [3389] AND protocol == 'tcp' AND service == 'rdp' \| STATS COUNT() BY source.ip, destination.ip, destination.port HAVING COUNT() > 10`. |
| 6. RDP Access in Cloud Environments | Adversaries use RDP to access compromised cloud instances, as in 2025 trends. | - Cloud Audit Logs (AWS CloudTrail)<br>- Network Traffic (DS0003: Zeek Conn) | - **Splunk**: `index=cloud sourcetype=aws:cloudtrail eventName IN ("AuthorizeSecurityGroupIngress") AND requestParameters IN ("3389") AND src_ip NOT IN (trusted_ips) \| join src_ip [search index=network sourcetype=zeek_conn dest_port=3389] \| stats count by src_ip, eventName, dest_ip \| where count > 5`.<br>- **KQL**: `AWSCloudTrail \| where EventName in ("AuthorizeSecurityGroupIngress") and RequestParameters has "3389" and SourceIP !in (trustedIPs) \| join kind=inner (DeviceNetworkEvents \| where RemotePort == 3389) on SourceIP \| summarize count() by SourceIP, EventName, RemoteIP \| where count_ > 5`.<br>- **ELK**: `FROM logs-aws.cloudtrail-* \| WHERE event.action IN ['AuthorizeSecurityGroupIngress'] AND event.request_parameters : '3389' AND source.ip NOT IN ['trusted_ips'] \| JOIN logs-zeek.conn-* ON source.ip WHERE destination.port == 3389 \| STATS COUNT() BY source.ip, event.action, destination.ip HAVING COUNT() > 5`. |
| 7. RDP Access with Suspicious User Agents | Adversaries use non-standard user agents for RDP connections, as in APT41. | - Network Traffic (DS0003: Zeek RDP)<br>- Proxy Logs | - **Splunk**: `index=network sourcetype=zeek_rdp user_agent NOT IN (known_agents) AND dest_port=3389 \| stats count by src_ip, user_agent, dest_ip \| where count > 10`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "RDP" and AdditionalFields.UserAgent !in (knownAgents) and RemotePort == 3389 \| summarize count() by DeviceIP, AdditionalFields.UserAgent, RemoteIP \| where count_ > 10`.<br>- **ELK**: `FROM logs-zeek.rdp-* \| WHERE rdp.user_agent NOT IN ['known_agents'] AND destination.port == 3389 \| STATS COUNT() BY source.ip, rdp.user_agent, destination.ip HAVING COUNT() > 10`. |
| 8. RDP Access with Failed Logins | Multiple failed RDP login attempts indicating credential stuffing, as in Volt Typhoon. | - Windows Event Logs (DS0002: Event ID 4625) | - **Splunk**: `index=windows sourcetype=WinEventLog EventCode=4625 LogonType=10 \| stats count by src_ip, Account_Name \| where count > 10`.<br>- **KQL**: `SecurityEvent \| where EventID == 4625 and LogonType == 10 \| summarize count() by ClientIP, AccountName \| where count_ > 10`.<br>- **ELK**: `FROM logs-windows.security-* \| WHERE event.code == '4625' AND winlog.event_data.LogonType == '10' \| STATS COUNT() BY source.ip, winlog.event_data.AccountName HAVING COUNT() > 10`. |
| 9. RDP Access from Compromised Endpoints | Compromised endpoints initiate RDP connections, as in FIN7. | - Process Creation (DS0009: Sysmon ID 1)<br>- Network Traffic (DS0003: Zeek Conn) | - **Splunk**: `index=endpoint sourcetype=sysmon EventCode=1 Image="*mstsc.exe" \| join host [search index=network sourcetype=zeek_conn dest_port=3389] \| stats count by host, Image, dest_ip \| where count > 5`.<br>- **KQL**: `DeviceProcessEvents \| where ProcessName == "mstsc.exe" \| join kind=inner (DeviceNetworkEvents \| where RemotePort == 3389) on DeviceName \| summarize count() by DeviceName, ProcessName, RemoteIP \| where count_ > 5`.<br>- **ELK**: `FROM logs-endpoint.process-* \| WHERE process.executable : '*mstsc.exe' \| JOIN logs-zeek.conn-* ON host.name WHERE destination.port == 3389 \| STATS COUNT() BY host.name, process.executable, destination.ip HAVING COUNT() > 5`. |
| 10. RDP Access with Anomalous Session Duration | RDP sessions with unusual durations indicating persistence, as in APT29. | - Windows Event Logs (DS0002: Event ID 4624, 4634) | - **Splunk**: `index=windows sourcetype=WinEventLog EventCode IN (4624, 4634) LogonType=10 \| eval session_duration=if(EventCode=4634, _time - mvindex(_time, -1), null) \| stats count, avg(session_duration) as avg_duration by src_ip, Account_Name \| where avg_duration > 3600`.<br>- **KQL**: `SecurityEvent \| where EventID in (4624, 4634) and LogonType == 10 \| summarize SessionDuration=make_list(Timestamp), count() by ClientIP, AccountName \| project ClientIP, AccountName, count_, AvgDuration=avg(datetime_diff('second', SessionDuration[-1], SessionDuration[-2])) \| where AvgDuration > 3600`.<br>- **ELK**: `FROM logs-windows.security-* \| WHERE event.code IN ['4624', '4634'] AND winlog.event_data.LogonType == '10' \| EVAL session_duration = IF(event.code == '4634', @timestamp - LAG(@timestamp), NULL) \| STATS COUNT(), AVG(session_duration) AS avg_duration BY source.ip, winlog.event_data.AccountName \| WHERE avg_duration > 3600`. |

### T1133.002: File Transfer Protocol (FTP)

| Hypothesis | Description | Data Sources | Hunting Queries |
|-----------|-------------|--------------|-----------------|
| 1. Unauthorized FTP Access from External IPs | Adversaries use compromised credentials for FTP access, as in Volt Typhoon. | - Network Traffic (DS0003: Zeek FTP)<br>- File Transfer Logs | - **Splunk**: `index=network sourcetype=zeek_ftp src_ip NOT IN (trusted_ips) AND dest_port IN (20, 21) \| stats count by src_ip, dest_ip, user \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where RemotePort in (20, 21) and DeviceIP !in (trustedIPs) \| summarize count() by DeviceIP, RemoteIP, AdditionalFields.User \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.ftp-* \| WHERE destination.port IN [20, 21] AND source.ip NOT IN ['trusted_ips'] \| STATS COUNT() BY source.ip, destination.ip, ftp.user HAVING COUNT() > 5`. |
| 2. High-Frequency FTP Transfers | High-frequency FTP transfers indicating data exfiltration, as in APT41. | - Network Traffic (DS0003: Zeek FTP)<br>- Metrics | - **Splunk**: `index=network sourcetype=zeek_ftp dest_port IN (20, 21) \| timechart span=1m count by src_ip \| where count > 50`.<br>- **KQL**: `DeviceNetworkEvents \| where RemotePort in (20, 21) \| summarize MinuteCount=count() by bin(Timestamp, 1m), DeviceIP \| where MinuteCount > 50`.<br>- **ELK**: `FROM logs-zeek.ftp-* \| WHERE destination.port IN [20, 21] \| STATS COUNT() BY date_histogram(@timestamp, '1m'), source.ip \| WHERE COUNT() > 50`. |
| 3. FTP Access with Suspicious File Types | Adversaries transfer sensitive file types via FTP, as in FIN7. | - Network Traffic (DS0003: Zeek FTP) | - **Splunk**: `index=network sourcetype=zeek_ftp file IN ("*.zip", "*.rar", "*.docx", "*.pdf") AND src_ip NOT IN (trusted_ips) \| stats count by src_ip, dest_ip, file \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "FTP" and AdditionalFields.FileName has_any (".zip", ".rar", ".docx", ".pdf") and DeviceIP !in (trustedIPs) \| summarize count() by DeviceIP, RemoteIP, AdditionalFields.FileName \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.ftp-* \| WHERE ftp.file : ("*.zip" OR "*.rar" OR "*.docx" OR "*.pdf") AND source.ip NOT IN ['trusted_ips'] \| STATS COUNT() BY source.ip, destination.ip, ftp.file HAVING COUNT() > 5`. |
| 4. FTP Access Outside Business Hours | FTP transfers outside business hours, as in APT29. | - Network Traffic (DS0003: Zeek FTP)<br>- Metrics | - **Splunk**: `index=network sourcetype=zeek_ftp dest_port IN (20, 21) \| timechart span=1h count by src_ip \| where count > avg(count)*3 AND (_time < "08:00" OR _time > "18:00")`.<br>- **KQL**: `DeviceNetworkEvents \| where RemotePort in (20, 21) \| summarize HourlyCount=count() by bin(Timestamp, 1h), DeviceIP \| where HourlyCount > avg(HourlyCount) * 3 and (hour(Timestamp) < 8 or hour(Timestamp) > 18)`.<br>- **ELK**: `FROM logs-zeek.ftp-* \| WHERE destination.port IN [20, 21] \| STATS COUNT() BY date_histogram(@timestamp, '1h'), source.ip \| WHERE COUNT() > AVG(COUNT()) * 3 AND (HOUR(@timestamp) < 8 OR HOUR(@timestamp) > 18)`. |
| 5. FTP Access in Linux Environments | Adversaries use FTP in Linux environments for exfiltration, as in Turla. | - Process Creation (Linux Auditd)<br>- Network Traffic (DS0003: Zeek FTP) | - **Splunk**: `index=linux sourcetype=auditd exe IN ("*ftp*", "*sftp*") AND args IN ("*get*", "*put*") \| join host [search index=network sourcetype=zeek_ftp dest_port IN (20, 21)] \| stats count by host, exe, dest_ip \| where count > 5`.<br>- **KQL**: `LinuxAuditd \| where ProcessName has_any ("ftp", "sftp") and CommandLine has_any ("get", "put") \| join kind=inner (DeviceNetworkEvents \| where RemotePort in (20, 21)) on HostName \| summarize count() by HostName, ProcessName, RemoteIP \| where count_ > 5`.<br>- **ELK**: `FROM logs-auditd-* \| WHERE process.exe : ("*ftp*" OR "*sftp*") AND process.args : ("*get*" OR "*put*") \| JOIN logs-zeek.ftp-* ON host.name WHERE destination.port IN [20, 21] \| STATS COUNT() BY host.name, process.exe, destination.ip HAVING COUNT() > 5`. |
| 6. FTP Access with Suspicious User Agents | Adversaries use non-standard user agents for FTP transfers, as in APT41. | - Network Traffic (DS0003: Zeek FTP)<br>- Proxy Logs | - **Splunk**: `index=network sourcetype=zeek_ftp user_agent NOT IN (known_agents) AND dest_port IN (20, 21) \| stats count by src_ip, user_agent, dest_ip \| where count > 10`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "FTP" and AdditionalFields.UserAgent !in (knownAgents) and RemotePort in (20, 21) \| summarize count() by DeviceIP, AdditionalFields.UserAgent, RemoteIP \| where count_ > 10`.<br>- **ELK**: `FROM logs-zeek.ftp-* \| WHERE ftp.user_agent NOT IN ['known_agents'] AND destination.port IN [20, 21] \| STATS COUNT() BY source.ip, ftp.user_agent, destination.ip HAVING COUNT() > 10`. |
| 7. FTP Access with Large Data Transfers | Large data transfers via FTP indicating exfiltration, as in Volt Typhoon. | - Network Traffic (DS0003: Zeek FTP) | - **Splunk**: `index=network sourcetype=zeek_ftp dest_port IN (20, 21) AND bytes_out > 1000000 \| stats count by src_ip, dest_ip, bytes_out \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "FTP" and RemotePort in (20, 21) and BytesSent > 1000000 \| summarize count() by DeviceIP, RemoteIP, BytesSent \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.ftp-* \| WHERE destination.port IN [20, 21] AND ftp.bytes_out > 1000000 \| STATS COUNT() BY source.ip, destination.ip, ftp.bytes_out HAVING COUNT() > 5`. |
| 8. FTP Access from Compromised Endpoints | Compromised endpoints initiate FTP transfers, as in FIN7. | - Process Creation (DS0009: Sysmon ID 1)<br>- Network Traffic (DS0003: Zeek FTP) | - **Splunk**: `index=endpoint sourcetype=sysmon EventCode=1 Image IN ("*ftp.exe*", "*filezilla.exe*") \| join host [search index=network sourcetype=zeek_ftp dest_port IN (20, 21)] \| stats count by host, Image, dest_ip \| where count > 5`.<br>- **KQL**: `DeviceProcessEvents \| where ProcessName has_any ("ftp.exe", "filezilla.exe") \| join kind=inner (DeviceNetworkEvents \| where RemotePort in (20, 21)) on DeviceName \| summarize count() by DeviceName, ProcessName, RemoteIP \| where count_ > 5`.<br>- **ELK**: `FROM logs-endpoint.process-* \| WHERE process.executable : ("*ftp.exe*" OR "*filezilla.exe*") \| JOIN logs-zeek.ftp-* ON host.name WHERE destination.port IN [20, 21] \| STATS COUNT() BY host.name, process.executable, destination.ip HAVING COUNT() > 5`. |
| 9. FTP Access with Failed Logins | Multiple failed FTP login attempts indicating credential stuffing, as in Volt Typhoon. | - Network Traffic (DS0003: Zeek FTP) | - **Splunk**: `index=network sourcetype=zeek_ftp status="failed" AND dest_port IN (20, 21) \| stats count by src_ip, user \| where count > 10`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "FTP" and AdditionalFields.Status == "failed" and RemotePort in (20, 21) \| summarize count() by DeviceIP, AdditionalFields.User \| where count_ > 10`.<br>- **ELK**: `FROM logs-zeek.ftp-* \| WHERE ftp.status == 'failed' AND destination.port IN [20, 21] \| STATS COUNT() BY source.ip, ftp.user HAVING COUNT() > 10`. |
| 10. FTP Access in Cloud Environments | Adversaries use FTP to access compromised cloud instances, as in 2025 trends. | - Cloud Audit Logs (AWS CloudTrail)<br>- Network Traffic (DS0003: Zeek FTP) | - **Splunk**: `index=cloud sourcetype=aws:cloudtrail eventName IN ("AuthorizeSecurityGroupIngress") AND requestParameters IN ("20", "21") AND src_ip NOT IN (trusted_ips) \| join src_ip [search index=network sourcetype=zeek_ftp dest_port IN (20, 21)] \| stats count by src_ip, eventName, dest_ip \| where count > 5`.<br>- **KQL**: `AWSCloudTrail \| where EventName in ("AuthorizeSecurityGroupIngress") and RequestParameters has_any ("20", "21") and SourceIP !in (trustedIPs) \| join kind=inner (DeviceNetworkEvents \| where RemotePort in (20, 21)) on SourceIP \| summarize count() by SourceIP, EventName, RemoteIP \| where count_ > 5`.<br>- **ELK**: `FROM logs-aws.cloudtrail-* \| WHERE event.action IN ['AuthorizeSecurityGroupIngress'] AND event.request_parameters : ('20' OR '21') AND source.ip NOT IN ['trusted_ips'] \| JOIN logs-zeek.ftp-* ON source.ip WHERE destination.port IN [20, 21] \| STATS COUNT() BY source.ip, event.action, destination.ip HAVING COUNT() > 5`. |

### T1133.003: Hypertext Transfer Protocol (HTTP)

| Hypothesis | Description | Data Sources | Hunting Queries |
|-----------|-------------|--------------|-----------------|
| 1. Unauthorized HTTP Access to C2 Servers | Adversaries use HTTP for C2 communication, as in Volt Typhoon. | - Network Traffic (DS0003: Zeek HTTP)<br>- Threat Intelligence | - **Splunk**: `index=network sourcetype=zeek_http dest_ip IN (malware_c2_ips) AND response_status_code IN ("200", "404") \| stats count by src_ip, dest_ip, uri \| where count > 10`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "HTTP" and RemoteIP in (malwareC2IPs) and ResponseStatusCode in ("200", "404") \| summarize count() by DeviceIP, RemoteIP, RemoteUrl \| where count_ > 10`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE destination.ip IN ['malware_c2_ips'] AND http.response.status_code IN ['200', '404'] \| STATS COUNT() BY source.ip, destination.ip, http.uri HAVING COUNT() > 10`. |
| 2. High-Frequency HTTP Requests | High-frequency HTTP requests to external servers, as in APT41. | - Network Traffic (DS0003: Zeek HTTP)<br>- Metrics | - **Splunk**: `index=network sourcetype=zeek_http dest_port IN (80, 443) \| timechart span=1m count by src_ip \| where count > 50`.<br>- **KQL**: `DeviceNetworkEvents \| where RemotePort in (80, 443) \| summarize MinuteCount=count() by bin(Timestamp, 1m), DeviceIP \| where MinuteCount > 50`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE destination.port IN [80, 443] \| STATS COUNT() BY date_histogram(@timestamp, '1m'), source.ip \| WHERE COUNT() > 50`. |
| 3. HTTP Access with Suspicious User Agents | Adversaries use non-standard user agents for HTTP C2, as in APT41. | - Network Traffic (DS0003: Zeek HTTP)<br>- Proxy Logs | - **Splunk**: `index=network sourcetype=zeek_http user_agent NOT IN (known_agents) AND dest_ip IN (malware_c2_ips) \| stats count by src_ip, user_agent, dest_ip \| where count > 10`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "HTTP" and AdditionalFields.UserAgent !in (knownAgents) and RemoteIP in (malwareC2IPs) \| summarize count() by DeviceIP, AdditionalFields.UserAgent, RemoteIP \| where count_ > 10`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE http.user_agent NOT IN ['known_agents'] AND destination.ip IN ['malware_c2_ips'] \| STATS COUNT() BY source.ip, http.user_agent, destination.ip HAVING COUNT() > 10`. |
| 4. HTTP Access Outside Business Hours | HTTP C2 activity outside business hours, as in APT29. | - Network Traffic (DS0003: Zeek HTTP)<br>- Metrics | - **Splunk**: `index=network sourcetype=zeek_http dest_ip IN (malware_c2_ips) \| timechart span=1h count by src_ip \| where count > avg(count)*3 AND (_time < "08:00" OR _time > "18:00")`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "HTTP" and RemoteIP in (malwareC2IPs) \| summarize HourlyCount=count() by bin(Timestamp, 1h), DeviceIP \| where HourlyCount > avg(HourlyCount) * 3 and (hour(Timestamp) < 8 or hour(Timestamp) > 18)`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE destination.ip IN ['malware_c2_ips'] \| STATS COUNT() BY date_histogram(@timestamp, '1h'), source.ip \| WHERE COUNT() > AVG(COUNT()) * 3 AND (HOUR(@timestamp) < 8 OR HOUR(@timestamp) > 18)`. |
| 5. HTTP Access with Suspicious File Downloads | Adversaries download malicious files via HTTP, as in FIN7. | - Network Traffic (DS0003: Zeek HTTP) | - **Splunk**: `index=network sourcetype=zeek_http dest_ip IN (malware_c2_ips) AND uri IN ("*.exe", "*.zip", "*.scr") \| stats count by src_ip, dest_ip, uri \| where count > 10`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "HTTP" and RemoteIP in (malwareC2IPs) and RemoteUrl has_any (".exe", ".zip", ".scr") \| summarize count() by DeviceIP, RemoteIP, RemoteUrl \| where count_ > 10`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE destination.ip IN ['malware_c2_ips'] AND http.uri : ("*.exe" OR "*.zip" OR "*.scr") \| STATS COUNT() BY source.ip, destination.ip, http.uri HAVING COUNT() > 10`. |
| 6. HTTP Access in Linux Environments | Adversaries use HTTP in Linux environments for C2, as in Turla. | - Process Creation (Linux Auditd)<br>- Network Traffic (DS0003: Zeek HTTP) | - **Splunk**: `index=linux sourcetype=auditd exe IN ("*curl*", "*wget*") AND args IN (malware_c2_ips) \| join host [search index=network sourcetype=zeek_http dest_ip IN (malware_c2_ips)] \| stats count by host, exe, dest_ip \| where count > 5`.<br>- **KQL**: `LinuxAuditd \| where ProcessName has_any ("curl", "wget") and CommandLine has_any (malwareC2IPs) \| join kind=inner (DeviceNetworkEvents \| where Protocol == "HTTP" and RemoteIP in (malwareC2IPs)) on HostName \| summarize count() by HostName, ProcessName, RemoteIP \| where count_ > 5`.<br>- **ELK**: `FROM logs-auditd-* \| WHERE process.exe : ("*curl*" OR "*wget*") AND process.args : ['malware_c2_ips'] \| JOIN logs-zeek.http-* ON host.name WHERE destination.ip IN ['malware_c2_ips'] \| STATS COUNT() BY host.name, process.exe, destination.ip HAVING COUNT() > 5`. |
| 7. HTTP Access with Suspicious Content Types | Adversaries use HTTP to transfer suspicious content types, as in Volt Typhoon. | - Network Traffic (DS0003: Zeek HTTP) | - **Splunk**: `index=network sourcetype=zeek_http content_type IN ("application/octet-stream", "application/x-msdownload") AND dest_ip IN (malware_c2_ips) \| stats count by src_ip, dest_ip, content_type \| where count > 10`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "HTTP" and AdditionalFields.ContentType in ("application/octet-stream", "application/x-msdownload") and RemoteIP in (malwareC2IPs) \| summarize count() by DeviceIP, RemoteIP, AdditionalFields.ContentType \| where count_ > 10`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE http.content_type IN ['application/octet-stream', 'application/x-msdownload'] AND destination.ip IN ['malware_c2_ips'] \| STATS COUNT() BY source.ip, destination.ip, http.content_type HAVING COUNT() > 10`. |
| 8. HTTP Access from Compromised Endpoints | Compromised endpoints initiate HTTP C2, as in FIN7. | - Process Creation (DS0009: Sysmon ID 1)<br>- Network Traffic (DS0003: Zeek HTTP) | - **Splunk**: `index=endpoint sourcetype=sysmon EventCode=1 Image IN ("*powershell.exe*", "*cmd.exe*") \| join host [search index=network sourcetype=zeek_http dest_ip IN (malware_c2_ips)] \| stats count by host, Image, dest_ip \| where count > 5`.<br>- **KQL**: `DeviceProcessEvents \| where ProcessName has_any ("powershell.exe", "cmd.exe") \| join kind=inner (DeviceNetworkEvents \| where Protocol == "HTTP" and RemoteIP in (malwareC2IPs)) on DeviceName \| summarize count() by DeviceName, ProcessName, RemoteIP \| where count_ > 5`.<br>- **ELK**: `FROM logs-endpoint.process-* \| WHERE process.executable : ("*powershell.exe*" OR "*cmd.exe*") \| JOIN logs-zeek.http-* ON host.name WHERE destination.ip IN ['malware_c2_ips'] \| STATS COUNT() BY host.name, process.executable, destination.ip HAVING COUNT() > 5`. |
| 9. HTTP Access with Anomalous Ports | Adversaries use non-standard ports for HTTP C2, as in 2025 trends. | - Network Traffic (DS0003: Zeek HTTP) | - **Splunk**: `index=network sourcetype=zeek_http dest_port NOT IN (80, 443) AND dest_ip IN (malware_c2_ips) \| stats count by src_ip, dest_ip, dest_port \| where count > 10`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "HTTP" and RemotePort !in (80, 443) and RemoteIP in (malwareC2IPs) \| summarize count() by DeviceIP, RemoteIP, RemotePort \| where count_ > 10`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE destination.port NOT IN [80, 443] AND destination.ip IN ['malware_c2_ips'] \| STATS COUNT() BY source.ip, destination.ip, destination.port HAVING COUNT() > 10`. |
| 10. HTTP Access in Cloud Environments | Adversaries use HTTP to access compromised cloud instances, as in 2025 trends. | - Cloud Audit Logs (AWS CloudTrail)<br>- Network Traffic (DS0003: Zeek HTTP) | - **Splunk**: `index=cloud sourcetype=aws:cloudtrail eventName IN ("AuthorizeSecurityGroupIngress") AND requestParameters IN ("80", "443") AND src_ip NOT IN (trusted_ips) \| join src_ip [search index=network sourcetype=zeek_http dest_ip IN (malware_c2_ips)] \| stats count by src_ip, eventName, dest_ip \| where count > 5`.<br>- **KQL**: `AWSCloudTrail \| where EventName in ("AuthorizeSecurityGroupIngress") and RequestParameters has_any ("80", "443") and SourceIP !in (trustedIPs) \| join kind=inner (DeviceNetworkEvents \| where Protocol == "HTTP" and RemoteIP in (malwareC2IPs)) on SourceIP \| summarize count() by SourceIP, EventName, RemoteIP \| where count_ > 5`.<br>- **ELK**: `FROM logs-aws.cloudtrail-* \| WHERE event.action IN ['AuthorizeSecurityGroupIngress'] AND event.request_parameters : ('80' OR '443') AND source.ip NOT IN ['trusted_ips'] \| JOIN logs-zeek.http-* ON source.ip WHERE destination.ip IN ['malware_c2_ips'] \| STATS COUNT() BY source.ip, event.action, destination.ip HAVING COUNT() > 5`. |

### T1133.004: SSH

| Hypothesis | Description | Data Sources | Hunting Queries |
|-----------|-------------|--------------|-----------------|
| 1. Unauthorized SSH Access from External IPs | Adversaries use compromised credentials for SSH access, as in Volt Typhoon. | - Network Traffic (DS0003: Zeek SSH)<br>- Linux Audit Logs | - **Splunk**: `index=network sourcetype=zeek_ssh src_ip NOT IN (trusted_ips) AND dest_port=22 \| stats count by src_ip, dest_ip, user \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where RemotePort == 22 and DeviceIP !in (trustedIPs) \| summarize count() by DeviceIP, RemoteIP, AdditionalFields.User \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.ssh-* \| WHERE destination.port == 22 AND source.ip NOT IN ['trusted_ips'] \| STATS COUNT() BY source.ip, destination.ip, ssh.user HAVING COUNT() > 5`. |
| 2. High-Frequency SSH Attempts | High-frequency SSH connection attempts indicating brute force, as in APT41. | - Network Traffic (DS0003: Zeek SSH)<br>- Metrics | - **Splunk**: `index=network sourcetype=zeek_ssh dest_port=22 \| timechart span=1m count by src_ip \| where count > 50`.<br>- **KQL**: `DeviceNetworkEvents \| where RemotePort == 22 \| summarize MinuteCount=count() by bin(Timestamp, 1m), DeviceIP \| where MinuteCount > 50`.<br>- **ELK**: `FROM logs-zeek.ssh-* \| WHERE destination.port == 22 \| STATS COUNT() BY date_histogram(@timestamp, '1m'), source.ip \| WHERE COUNT() > 50`. |
| 3. SSH Access with Suspicious User Accounts | Adversaries use non-standard accounts for SSH access, as in Turla. | - Linux Audit Logs (DS0007) | - **Splunk**: `index=linux sourcetype=auditd type=USER_LOGIN user NOT IN (authorized_users) AND success="yes" \| stats count by src_ip, user \| where count > 5`.<br>- **KQL**: `LinuxAuditd \| where EventType == "USER_LOGIN" and User !in (authorizedUsers) and Success == "yes" \| summarize count() by SourceIP, User \| where count_ > 5`.<br>- **ELK**: `FROM logs-auditd-* \| WHERE auditd.type == 'USER_LOGIN' AND user.name NOT IN ['authorized_users'] AND auditd.success == 'yes' \| STATS COUNT() BY source.ip, user.name HAVING COUNT() > 5`. |
| 4. SSH Access Outside Business Hours | SSH connections outside business hours, as in APT29. | - Network Traffic (DS0003: Zeek SSH)<br>- Metrics | - **Splunk**: `index=network sourcetype=zeek_ssh dest_port=22 \| timechart span=1h count by src_ip \| where count > avg(count)*3 AND (_time < "08:00" OR _time > "18:00")`.<br>- **KQL**: `DeviceNetworkEvents \| where RemotePort == 22 \| summarize HourlyCount=count() by bin(Timestamp, 1h), DeviceIP \| where HourlyCount > avg(HourlyCount) * 3 and (hour(Timestamp) < 8 or hour(Timestamp) > 18)`.<br>- **ELK**: `FROM logs-zeek.ssh-* \| WHERE destination.port == 22 \| STATS COUNT() BY date_histogram(@timestamp, '1h'), source.ip \| WHERE COUNT() > AVG(COUNT()) * 3 AND (HOUR(@timestamp) < 8 OR HOUR(@timestamp) > 18)`. |
| 5. SSH Access with Anomalous Ports | Adversaries use non-standard ports for SSH, as in 2025 trends. | - Network Traffic (DS0003: Zeek SSH) | - **Splunk**: `index=network sourcetype=zeek_ssh dest_port NOT IN (22) AND protocol="tcp" AND service="ssh" \| stats count by src_ip, dest_ip, dest_port \| where count > 10`.<br>- **KQL**: `DeviceNetworkEvents \| where RemotePort !in (22) and Protocol == "TCP" and Service == "ssh" \| summarize count() by DeviceIP, RemoteIP, RemotePort \| where count_ > 10`.<br>- **ELK**: `FROM logs-zeek.ssh-* \| WHERE destination.port NOT IN [22] AND protocol == 'tcp' AND service == 'ssh' \| STATS COUNT() BY source.ip, destination.ip, destination.port HAVING COUNT() > 10`. |
| 6. SSH Access in Cloud Environments | Adversaries use SSH to access compromised cloud instances, as in 2025 trends. | - Cloud Audit Logs (AWS CloudTrail)<br>- Network Traffic (DS0003: Zeek SSH) | - **Splunk**: `index=cloud sourcetype=aws:cloudtrail eventName IN ("AuthorizeSecurityGroupIngress") AND requestParameters IN ("22") AND src_ip NOT IN (trusted_ips) \| join src_ip [search index=network sourcetype=zeek_ssh dest_port=22] \| stats count by src_ip, eventName, dest_ip \| where count > 5`.<br>- **KQL**: `AWSCloudTrail \| where EventName in ("AuthorizeSecurityGroupIngress") and RequestParameters has "22" and SourceIP !in (trustedIPs) \| join kind=inner (DeviceNetworkEvents \| where RemotePort == 22) on SourceIP \| summarize count() by SourceIP, EventName, RemoteIP \| where count_ > 5`.<br>- **ELK**: `FROM logs-aws.cloudtrail-* \| WHERE event.action IN ['AuthorizeSecurityGroupIngress'] AND event.request_parameters : '22' AND source.ip NOT IN ['trusted_ips'] \| JOIN logs-zeek.ssh-* ON source.ip WHERE destination.port == 22 \| STATS COUNT() BY source.ip, event.action, destination.ip HAVING COUNT() > 5`. |
| 7. SSH Access with Suspicious Commands | Adversaries execute suspicious commands via SSH, as in Turla. | - Process Creation (Linux Auditd) | - **Splunk**: `index=linux sourcetype=auditd exe IN ("*ssh*", "*sshd*") AND args IN ("*whoami*", "*wget*", "*curl*") \| stats count by host, exe, args \| where count > 5`.<br>- **KQL**: `LinuxAuditd \| where ProcessName has_any ("ssh", "sshd") and CommandLine has_any ("whoami", "wget", "curl") \| summarize count() by HostName, ProcessName, CommandLine \| where count_ > 5`.<br>- **ELK**: `FROM logs-auditd-* \| WHERE process.exe : ("*ssh*" OR "*sshd*") AND process.args : ("*whoami*" OR "*wget*" OR "*curl*") \| STATS COUNT() BY host.name, process.exe, process.args HAVING COUNT() > 5`. |
| 8. SSH Access with Failed Logins | Multiple failed SSH login attempts indicating credential stuffing, as in Volt Typhoon. | - Linux Audit Logs (DS0007) | - **Splunk**: `index=linux sourcetype=auditd type=USER_LOGIN success="no" \| stats count by src_ip, user \| where count > 10`.<br>- **KQL**: `LinuxAuditd \| where EventType == "USER_LOGIN" and Success == "no" \| summarize count() by SourceIP, User \| where count_ > 10`.<br>- **ELK**: `FROM logs-auditd-* \| WHERE auditd.type == 'USER_LOGIN' AND auditd.success == 'no' \| STATS COUNT() BY source.ip, user.name HAVING COUNT() > 10`. |
| 9. SSH Access from Compromised Endpoints | Compromised endpoints initiate SSH connections, as in FIN7. | - Process Creation (Linux Auditd)<br>- Network Traffic (DS0003: Zeek SSH) | - **Splunk**: `index=linux sourcetype=auditd exe IN ("*ssh*", "*scp*") \| join host [search index=network sourcetype=zeek_ssh dest_port=22] \| stats count by host, exe, dest_ip \| where count > 5`.<br>- **KQL**: `LinuxAuditd \| where ProcessName has_any ("ssh", "scp") \| join kind=inner (DeviceNetworkEvents \| where RemotePort == 22) on HostName \| summarize count() by HostName, ProcessName, RemoteIP \| where count_ > 5`.<br>- **ELK**: `FROM logs-auditd-* \| WHERE process.exe : ("*ssh*" OR "*scp*") \| JOIN logs-zeek.ssh-* ON host.name WHERE destination.port == 22 \| STATS COUNT() BY host.name, process.exe, destination.ip HAVING COUNT() > 5`. |
| 10. SSH Access with Anomalous Session Duration | SSH sessions with unusual durations indicating persistence, as in APT29. | - Network Traffic (DS0003: Zeek SSH) | - **Splunk**: `index=network sourcetype=zeek_ssh dest_port=22 \| eval session_duration=duration \| stats count, avg(session_duration) as avg_duration by src_ip, dest_ip \| where avg_duration > 3600`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "SSH" and RemotePort == 22 \| summarize SessionDuration=make_list(Duration), count() by DeviceIP, RemoteIP \| project DeviceIP, RemoteIP, count_, AvgDuration=avg(Duration) \| where AvgDuration > 3600`.<br>- **ELK**: `FROM logs-zeek.ssh-* \| WHERE destination.port == 22 \| EVAL session_duration = ssh.duration \| STATS COUNT(), AVG(session_duration) AS avg_duration BY source.ip, destination.ip \| WHERE avg_duration > 3600`. |

### T1133.005: Virtual Private Network (VPN)

| Hypothesis | Description | Data Sources | Hunting Queries |
|-----------|-------------|--------------|-----------------|
| 1. Unauthorized VPN Access from External IPs | Adversaries use compromised credentials for VPN access, as in Volt Typhoon. | - Network Traffic (DS0003: Zeek VPN)<br>- VPN Logs | - **Splunk**: `index=network sourcetype=zeek_vpn src_ip NOT IN (trusted_ips) AND dest_port IN (1194, 500, 4500) \| stats count by src_ip, dest_ip, user \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where RemotePort in (1194, 500, 4500) and DeviceIP !in (trustedIPs) \| summarize count() by DeviceIP, RemoteIP, AdditionalFields.User \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.vpn-* \| WHERE destination.port IN [1194, 500, 4500] AND source.ip NOT IN ['trusted_ips'] \| STATS COUNT() BY source.ip, destination.ip, vpn.user HAVING COUNT() > 5`. |
| 2. High-Frequency VPN Connections | High-frequency VPN connections indicating brute force, as in APT41. | - Network Traffic (DS0003: Zeek VPN)<br>- Metrics | - **Splunk**: `index=network sourcetype=zeek_vpn dest_port IN (1194, 500, 4500) \| timechart span=1m count by src_ip \| where count > 50`.<br>- **KQL**: `DeviceNetworkEvents \| where RemotePort in (1194, 500, 4500) \| summarize MinuteCount=count() by bin(Timestamp, 1m), DeviceIP \| where MinuteCount > 50`.<br>- **ELK**: `FROM logs-zeek.vpn-* \| WHERE destination.port IN [1194, 500, 4500] \| STATS COUNT() BY date_histogram(@timestamp, '1m'), source.ip \| WHERE COUNT() > 50`. |
| 3. VPN Access with Suspicious User Accounts | Adversaries use non-standard accounts for VPN access, as in FIN7. | - VPN Logs (DS0007) | - **Splunk**: `index=vpn sourcetype=vpn_log user NOT IN (authorized_users) AND status="connected" \| stats count by src_ip, user \| where count > 5`.<br>- **KQL**: `VpnLog \| where User !in (authorizedUsers) and Status == "connected" \| summarize count() by ClientIP, User \| where count_ > 5`.<br>- **ELK**: `FROM logs-vpn-* \| WHERE vpn.user NOT IN ['authorized_users'] AND vpn.status == 'connected' \| STATS COUNT() BY source.ip, vpn.user HAVING COUNT() > 5`. |
| 4. VPN Access Outside Business Hours | VPN connections outside business hours, as in APT29. | - VPN Logs (DS0007)<br>- Metrics | - **Splunk**: `index=vpn sourcetype=vpn_log status="connected" \| timechart span=1h count by src_ip \| where count > avg(count)*3 AND (_time < "08:00" OR _time > "18:00")`.<br>- **KQL**: `VpnLog \| where Status == "connected" \| summarize HourlyCount=count() by bin(Timestamp, 1h), ClientIP \| where HourlyCount > avg(HourlyCount) * 3 and (hour(Timestamp) < 8 or hour(Timestamp) > 18)`.<br>- **ELK**: `FROM logs-vpn-* \| WHERE vpn.status == 'connected' \| STATS COUNT() BY date_histogram(@timestamp, '1h'), source.ip \| WHERE COUNT() > AVG(COUNT()) * 3 AND (HOUR(@timestamp) < 8 OR HOUR(@timestamp) > 18)`. |
| 5. VPN Access with Anomalous Ports | Adversaries use non-standard ports for VPN, as in 2025 trends. | - Network Traffic (DS0003: Zeek VPN) | - **Splunk**: `index=network sourcetype=zeek_vpn dest_port NOT IN (1194, 500, 4500) AND protocol IN ("udp", "tcp") AND service="vpn" \| stats count by src_ip, dest_ip, dest_port \| where count > 10`.<br>- **KQL**: `DeviceNetworkEvents \| where RemotePort !in (1194, 500, 4500) and Protocol in ("UDP", "TCP") and Service == "vpn" \| summarize count() by DeviceIP, RemoteIP, RemotePort \| where count_ > 10`.<br>- **ELK**: `FROM logs-zeek.vpn-* \| WHERE destination.port NOT IN [1194, 500, 4500] AND protocol IN ['udp', 'tcp'] AND service == 'vpn' \| STATS COUNT() BY source.ip, destination.ip, destination.port HAVING COUNT() > 10`. |
| 6. VPN Access in Cloud Environments | Adversaries use VPN to access compromised cloud instances, as in 2025 trends. | - Cloud Audit Logs (AWS CloudTrail)<br>- Network Traffic (DS0003: Zeek VPN) | - **Splunk**: `index=cloud sourcetype=aws:cloudtrail eventName IN ("CreateVpnConnection", "AuthorizeSecurityGroupIngress") AND requestParameters IN ("1194", "500", "4500") AND src_ip NOT IN (trusted_ips) \| join src_ip [search index=network sourcetype=zeek_vpn dest_port IN (1194, 500, 4500)] \| stats count by src_ip, eventName, dest_ip \| where count > 5`.<br>- **KQL**: `AWSCloudTrail \| where EventName in ("CreateVpnConnection", "AuthorizeSecurityGroupIngress") and RequestParameters has_any ("1194", "500", "4500") and SourceIP !in (trustedIPs) \| join kind=inner (DeviceNetworkEvents \| where RemotePort in (1194, 500, 4500)) on SourceIP \| summarize count() by SourceIP, EventName, RemoteIP \| where count_ > 5`.<br>- **ELK**: `FROM logs-aws.cloudtrail-* \| WHERE event.action IN ['CreateVpnConnection', 'AuthorizeSecurityGroupIngress'] AND event.request_parameters : ('1194' OR '500' OR '4500') AND source.ip NOT IN ['trusted_ips'] \| JOIN logs-zeek.vpn-* ON source.ip WHERE destination.port IN [1194, 500, 4500] \| STATS COUNT() BY source.ip, event.action, destination.ip HAVING COUNT() > 5`. |
| 7. VPN Access with Suspicious User Agents | Adversaries use non-standard user agents for VPN connections, as in APT41. | - Network Traffic (DS0003: Zeek VPN)<br>- Proxy Logs | - **Splunk**: `index=network sourcetype=zeek_vpn user_agent NOT IN (known_agents) AND dest_port IN (1194, 500, 4500) \| stats count by src_ip, user_agent, dest_ip \| where count > 10`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "VPN" and AdditionalFields.UserAgent !in (knownAgents) and RemotePort in (1194, 500, 4500) \| summarize count() by DeviceIP, AdditionalFields.UserAgent, RemoteIP \| where count_ > 10`.<br>- **ELK**: `FROM logs-zeek.vpn-* \| WHERE vpn.user_agent NOT IN ['known_agents'] AND destination.port IN [1194, 500, 4500] \| STATS COUNT() BY source.ip, vpn.user_agent, destination.ip HAVING COUNT() > 10`. |
| 8. VPN Access with Failed Logins | Multiple failed VPN login attempts indicating credential stuffing, as in Volt Typhoon. | - VPN Logs (DS0007) | - **Splunk**: `index=vpn sourcetype=vpn_log status="failed" \| stats count by src_ip, user \| where count > 10`.<br>- **KQL**: `VpnLog \| where Status == "failed" \| summarize count() by ClientIP, User \| where count_ > 10`.<br>- **ELK**: `FROM logs-vpn-* \| WHERE vpn.status == 'failed' \| STATS COUNT() BY source.ip, vpn.user HAVING COUNT() > 10`. |
| 9. VPN Access from Compromised Endpoints | Compromised endpoints initiate VPN connections, as in FIN7. | - Process Creation (DS0009: Sysmon ID 1)<br>- Network Traffic (DS0003: Zeek VPN) | - **Splunk**: `index=endpoint sourcetype=sysmon EventCode=1 Image IN ("*openvpn.exe*", "*vpnclient.exe*") \| join host [search index=network sourcetype=zeek_vpn dest_port IN (1194, 500, 4500)] \| stats count by host, Image, dest_ip \| where count > 5`.<br>- **KQL**: `DeviceProcessEvents \| where ProcessName has_any ("openvpn.exe", "vpnclient.exe") \| join kind=inner (DeviceNetworkEvents \| where RemotePort in (1194, 500, 4500)) on DeviceName \| summarize count() by DeviceName, ProcessName, RemoteIP \| where count_ > 5`.<br>- **ELK**: `FROM logs-endpoint.process-* \| WHERE process.executable : ("*openvpn.exe*" OR "*vpnclient.exe*") \| JOIN logs-zeek.vpn-* ON host.name WHERE destination.port IN [1194, 500, 4500] \| STATS COUNT() BY host.name, process.executable, destination.ip HAVING COUNT() > 5`. |
| 10. VPN Access with Anomalous Session Duration | VPN sessions with unusual durations indicating persistence, as in APT29. | - Network Traffic (DS0003: Zeek VPN) | - **Splunk**: `index=network sourcetype=zeek_vpn dest_port IN (1194, 500, 4500) \| eval session_duration=duration \| stats count, avg(session_duration) as avg_duration by src_ip, dest_ip \| where avg_duration > 3600`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "VPN" and RemotePort in (1194, 500, 4500) \| summarize SessionDuration=make_list(Duration), count() by DeviceIP, RemoteIP \| project DeviceIP, RemoteIP, count_, AvgDuration=avg(Duration) \| where AvgDuration > 3600`.<br>- **ELK**: `FROM logs-zeek.vpn-* \| WHERE destination.port IN [1194, 500, 4500] \| EVAL session_duration = vpn.duration \| STATS COUNT(), AVG(session_duration) AS avg_duration BY source.ip, destination.ip \| WHERE avg_duration > 3600`. |

### T1190: Exploit Public-Facing Application
