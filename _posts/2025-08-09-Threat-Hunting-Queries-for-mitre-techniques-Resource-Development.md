---
layout: default
title:  Resource Development
category: Threat-Hunting-Queries  # This becomes a main topic in sidebar
---

## Resource Development
### T1583: Acquire Infrastructure

### T1583.001: Domains

| Hypothesis | Description | Data Sources | Hunting Queries |
|-----------|-------------|--------------|-----------------|
| 1. Suspicious Domain Registrations | Adversaries register domains mimicking legitimate ones for phishing, as in Volt Typhoon. | - DNS Logs (DS0001)<br>- Threat Intelligence | - **Splunk**: `index=dns sourcetype=zeek_dns query IN ("*login*", "*secure*") AND domain_age < 30 days AND src_ip NOT IN (trusted_ips) \| stats count by src_ip, query \| where count > 10`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "DNS" and DnsQueryName has_any ("login", "secure") and DomainAge < 30 and DeviceIP !in (trustedIPs) \| summarize count() by DeviceIP, DnsQueryName \| where count_ > 10`.<br>- **ELK**: `FROM logs-zeek.dns-* \| WHERE dns.query : ("*login*" OR "*secure*") AND dns.domain_age < 30 AND source.ip NOT IN ['trusted_ips'] \| STATS COUNT() BY source.ip, dns.query HAVING COUNT() > 10`. |
| 2. DNS Queries to Newly Registered Domains | Adversaries query newly registered domains for C2, as in APT41. | - DNS Logs (DS0001)<br>- Threat Intelligence | - **Splunk**: `index=dns sourcetype=zeek_dns domain_age < 7 days AND src_ip NOT IN (trusted_ips) \| stats count by src_ip, query \| where count > 10`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "DNS" and DomainAge < 7 and DeviceIP !in (trustedIPs) \| summarize count() by DeviceIP, DnsQueryName \| where count_ > 10`.<br>- **ELK**: `FROM logs-zeek.dns-* \| WHERE dns.domain_age < 7 AND source.ip NOT IN ['trusted_ips'] \| STATS COUNT() BY source.ip, dns.query HAVING COUNT() > 10`. |
| 3. Domains Used in Phishing Campaigns | Adversaries use domains for phishing emails, as in 2025 trends. | - Email Logs (DS0004)<br>- DNS Logs (DS0001) | - **Splunk**: `index=email sourcetype=zeek_smtp src_domain IN (new_domains) AND src_ip NOT IN (trusted_ips) \| stats count by src_ip, src_domain \| where count > 10`.<br>- **KQL**: `EmailEvents \| where SenderDomain in (newDomains) and SenderIP !in (trustedIPs) \| summarize count() by SenderIP, SenderDomain \| where count_ > 10`.<br>- **ELK**: `FROM logs-zeek.smtp-* \| WHERE email.from_domain IN ['new_domains'] AND source.ip NOT IN ['trusted_ips'] \| STATS COUNT() BY source.ip, email.from_domain HAVING COUNT() > 10`. |
| 4. Anomalous DNS Queries to Suspicious Domains | High-frequency DNS queries to suspicious domains, as in APT29. | - DNS Logs (DS0001)<br>- Metrics | - **Splunk**: `index=dns sourcetype=zeek_dns query NOT IN (known_domains) \| timechart span=1m count by src_ip \| where count > 50`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "DNS" and DnsQueryName !in (knownDomains) \| summarize MinuteCount=count() by bin(Timestamp, 1m), DeviceIP \| where MinuteCount > 50`.<br>- **ELK**: `FROM logs-zeek.dns-* \| WHERE dns.query NOT IN ['known_domains'] \| STATS COUNT() BY date_histogram(@timestamp, '1m'), source.ip \| WHERE COUNT() > 50`. |
| 5. Domain Access from Compromised Endpoints | Compromised endpoints query malicious domains, as in FIN7. | - Process Creation (DS0009: Sysmon ID 1)<br>- DNS Logs (DS0001) | - **Splunk**: `index=endpoint sourcetype=sysmon EventCode=1 CommandLine IN ("*curl*", "*wget*") \| join host [search index=dns sourcetype=zeek_dns query IN (suspicious_domains)] \| stats count by host, CommandLine, query \| where count > 5`.<br>- **KQL**: `DeviceProcessEvents \| where ProcessCommandLine has_any ("curl", "wget") \| join kind=inner (DeviceNetworkEvents \| where Protocol == "DNS" and DnsQueryName in (suspiciousDomains)) on DeviceName \| summarize count() by DeviceName, ProcessCommandLine, DnsQueryName \| where count_ > 5`.<br>- **ELK**: `FROM logs-endpoint.process-* \| WHERE process.command_line : ("*curl*" OR "*wget*") \| JOIN logs-zeek.dns-* ON host.name WHERE dns.query IN ['suspicious_domains'] \| STATS COUNT() BY host.name, process.command_line, dns.query HAVING COUNT() > 5`. |
| 6. Domain Access via Browser Automation | Adversaries use browser automation to access malicious domains, as in Cobalt Strike. | - Process Creation (DS0009: Sysmon ID 1)<br>- DNS Logs (DS0001) | - **Splunk**: `index=endpoint sourcetype=sysmon EventCode=1 CommandLine IN ("*selenium*", "*puppeteer*") \| join host [search index=dns sourcetype=zeek_dns query IN (suspicious_domains)] \| stats count by host, CommandLine, query \| where count > 5`.<br>- **KQL**: `DeviceProcessEvents \| where ProcessCommandLine has_any ("selenium", "puppeteer") \| join kind=inner (DeviceNetworkEvents \| where Protocol == "DNS" and DnsQueryName in (suspiciousDomains)) on DeviceName \| summarize count() by DeviceName, ProcessCommandLine, DnsQueryName \| where count_ > 5`.<br>- **ELK**: `FROM logs-endpoint.process-* \| WHERE process.command_line : ("*selenium*" OR "*puppeteer*") \| JOIN logs-zeek.dns-* ON host.name WHERE dns.query IN ['suspicious_domains'] \| STATS COUNT() BY host.name, process.command_line, dns.query HAVING COUNT() > 5`. |
| 7. Domain Access in Linux Environments | Adversaries use Linux tools to query malicious domains, as in Turla. | - Process Creation (Linux Auditd)<br>- DNS Logs (DS0001) | - **Splunk**: `index=linux sourcetype=auditd exe IN ("*curl*", "*wget*") AND args IN (suspicious_domains) \| stats count by host, exe \| where count > 5`.<br>- **KQL**: `LinuxAuditd \| where ProcessName has_any ("curl", "wget") and CommandLine has_any (suspiciousDomains) \| summarize count() by HostName, ProcessName \| where count_ > 5`.<br>- **ELK**: `FROM logs-auditd-* \| WHERE process.exe : ("*curl*" OR "*wget*") AND process.args IN ['suspicious_domains'] \| STATS COUNT() BY host.name, process.exe HAVING COUNT() > 5`. |
| 8. Suspicious Domain Access with Non-Standard User Agents | Adversaries use non-standard user agents to access domains, as in APT41. | - Network Traffic (DS0003: Zeek HTTP)<br>- DNS Logs (DS0001) | - **Splunk**: `index=network sourcetype=zeek_http user_agent NOT IN (known_agents) AND uri IN (suspicious_domains) \| stats count by src_ip, user_agent, uri \| where count > 10`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "HTTP" and AdditionalFields.UserAgent !in (knownAgents) and RemoteUrl in (suspiciousDomains) \| summarize count() by DeviceIP, AdditionalFields.UserAgent, RemoteUrl \| where count_ > 10`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE http.user_agent NOT IN ['known_agents'] AND http.uri IN ['suspicious_domains'] \| STATS COUNT() BY source.ip, http.user_agent, http.uri HAVING COUNT() > 10`. |
| 9. High-Frequency Domain Queries | High-frequency DNS queries to suspicious domains, as in APT41. | - DNS Logs (DS0001)<br>- Metrics | - **Splunk**: `index=dns sourcetype=zeek_dns query IN (suspicious_domains) \| timechart span=1m count by src_ip \| where count > 50`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "DNS" and DnsQueryName in (suspiciousDomains) \| summarize MinuteCount=count() by bin(Timestamp, 1m), DeviceIP \| where MinuteCount > 50`.<br>- **ELK**: `FROM logs-zeek.dns-* \| WHERE dns.query IN ['suspicious_domains'] \| STATS COUNT() BY date_histogram(@timestamp, '1m'), source.ip \| WHERE COUNT() > 50`. |
| 10. Domain Access via Known Malicious IPs | Access to suspicious domains from known malicious IPs, as in Volt Typhoon. | - DNS Logs (DS0001)<br>- Threat Intelligence | - **Splunk**: `index=dns sourcetype=zeek_dns src_ip IN (threat_intel_ips) AND query IN (suspicious_domains) \| stats count by src_ip, query \| where count > 10`.<br>- **KQL**: `DeviceNetworkEvents \| where DeviceIP in (threatIntelIPs) and DnsQueryName in (suspiciousDomains) \| summarize count() by DeviceIP, DnsQueryName \| where count_ > 10`.<br>- **ELK**: `FROM logs-zeek.dns-* \| WHERE source.ip IN ['threat_intel_ips'] AND dns.query IN ['suspicious_domains'] \| STATS COUNT() BY source.ip, dns.query HAVING COUNT() > 10`. |

### T1583.002: Server

| Hypothesis | Description | Data Sources | Hunting Queries |
|-----------|-------------|--------------|-----------------|
| 1. Suspicious Server Connections | Adversaries use compromised servers for C2 communication, as in Volt Typhoon. | - Network Traffic (DS0003: Zeek HTTP)<br>- Firewall Logs | - **Splunk**: `index=network sourcetype=zeek_http dest_ip NOT IN (trusted_ips) AND response_status_code IN ("200", "404") \| stats count by src_ip, dest_ip \| where count > 10`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "HTTP" and RemoteIP !in (trustedIPs) and ResponseStatusCode in ("200", "404") \| summarize count() by DeviceIP, RemoteIP \| where count_ > 10`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE destination.ip NOT IN ['trusted_ips'] AND http.response.status_code IN ['200', '404'] \| STATS COUNT() BY source.ip, destination.ip HAVING COUNT() > 10`. |
| 2. Anomalous Server Traffic Patterns | High-frequency connections to unknown servers, as in APT41. | - Network Traffic (DS0003: Zeek HTTP)<br>- Metrics | - **Splunk**: `index=network sourcetype=zeek_http dest_ip NOT IN (known_servers) \| timechart span=1m count by src_ip \| where count > 50`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "HTTP" and RemoteIP !in (knownServers) \| summarize MinuteCount=count() by bin(Timestamp, 1m), DeviceIP \| where MinuteCount > 50`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE destination.ip NOT IN ['known_servers'] \| STATS COUNT() BY date_histogram(@timestamp, '1m'), source.ip \| WHERE COUNT() > 50`. |
| 3. Server Access via Cloud APIs | Adversaries access cloud-hosted servers via APIs, as in 2025 trends. | - Cloud Audit Logs (AWS CloudTrail)<br>- Authentication Logs | - **Splunk**: `index=cloud sourcetype=aws:cloudtrail eventName IN ("RunInstances", "DescribeInstances") AND userIdentity NOT IN (authorized_users) \| stats count by src_ip, eventName \| where count > 10`.<br>- **KQL**: `AWSCloudTrail \| where EventName in ("RunInstances", "DescribeInstances") and Caller !in (authorizedUsers) \| summarize count() by SourceIP, EventName \| where count_ > 10`.<br>- **ELK**: `FROM logs-aws.cloudtrail-* \| WHERE event.action IN ['RunInstances', 'DescribeInstances'] AND user.identity NOT IN ['authorized_users'] \| STATS COUNT() BY source.ip, event.action HAVING COUNT() > 10`. |
| 4. Server Connections from Compromised Endpoints | Compromised endpoints connect to malicious servers, as in FIN7. | - Process Creation (DS0009: Sysmon ID 1)<br>- Network Traffic (DS0003: Zeek HTTP) | - **Splunk**: `index=endpoint sourcetype=sysmon EventCode=1 CommandLine IN ("*curl*", "*wget*") \| join host [search index=network sourcetype=zeek_http dest_ip NOT IN (trusted_ips)] \| stats count by host, CommandLine, dest_ip \| where count > 5`.<br>- **KQL**: `DeviceProcessEvents \| where ProcessCommandLine has_any ("curl", "wget") \| join kind=inner (DeviceNetworkEvents \| where Protocol == "HTTP" and RemoteIP !in (trustedIPs)) on DeviceName \| summarize count() by DeviceName, ProcessCommandLine, RemoteIP \| where count_ > 5`.<br>- **ELK**: `FROM logs-endpoint.process-* \| WHERE process.command_line : ("*curl*" OR "*wget*") \| JOIN logs-zeek.http-* ON host.name WHERE destination.ip NOT IN ['trusted_ips'] \| STATS COUNT() BY host.name, process.command_line, destination.ip HAVING COUNT() > 5`. |
| 5. Server Access via Browser Automation | Adversaries use browser automation to access servers, as in Cobalt Strike. | - Process Creation (DS0009: Sysmon ID 1)<br>- Network Traffic (DS0003: Zeek HTTP) | - **Splunk**: `index=endpoint sourcetype=sysmon EventCode=1 CommandLine IN ("*selenium*", "*puppeteer*") \| join host [search index=network sourcetype=zeek_http dest_ip NOT IN (trusted_ips)] \| stats count by host, CommandLine, dest_ip \| where count > 5`.<br>- **KQL**: `DeviceProcessEvents \| where ProcessCommandLine has_any ("selenium", "puppeteer") \| join kind=inner (DeviceNetworkEvents \| where Protocol == "HTTP" and RemoteIP !in (trustedIPs)) on DeviceName \| summarize count() by DeviceName, ProcessCommandLine, RemoteIP \| where count_ > 5`.<br>- **ELK**: `FROM logs-endpoint.process-* \| WHERE process.command_line : ("*selenium*" OR "*puppeteer*") \| JOIN logs-zeek.http-* ON host.name WHERE destination.ip NOT IN ['trusted_ips'] \| STATS COUNT() BY host.name, process.command_line, destination.ip HAVING COUNT() > 5`. |
| 6. Server Connections in Linux Environments | Adversaries use Linux tools to connect to malicious servers, as in Turla. | - Process Creation (Linux Auditd)<br>- Network Traffic (DS0003: Zeek HTTP) | - **Splunk**: `index=linux sourcetype=auditd exe IN ("*curl*", "*wget*") AND args NOT IN (trusted_ips) \| stats count by host, exe \| where count > 5`.<br>- **KQL**: `LinuxAuditd \| where ProcessName has_any ("curl", "wget") and CommandLine !has_any (trustedIPs) \| summarize count() by HostName, ProcessName \| where count_ > 5`.<br>- **ELK**: `FROM logs-auditd-* \| WHERE process.exe : ("*curl*" OR "*wget*") AND process.args NOT IN ['trusted_ips'] \| STATS COUNT() BY host.name, process.exe HAVING COUNT() > 5`. |
| 7. Server Access with Suspicious User Agents | Adversaries use non-standard user agents to access servers, as in APT41. | - Network Traffic (DS0003: Zeek HTTP)<br>- Proxy Logs | - **Splunk**: `index=network sourcetype=zeek_http user_agent NOT IN (known_agents) AND dest_ip NOT IN (trusted_ips) \| stats count by src_ip, user_agent, dest_ip \| where count > 10`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "HTTP" and AdditionalFields.UserAgent !in (knownAgents) and RemoteIP !in (trustedIPs) \| summarize count() by DeviceIP, AdditionalFields.UserAgent, RemoteIP \| where count_ > 10`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE http.user_agent NOT IN ['known_agents'] AND destination.ip NOT IN ['trusted_ips'] \| STATS COUNT() BY source.ip, http.user_agent, destination.ip HAVING COUNT() > 10`. |
| 8. High-Frequency Server Connections | High-frequency connections to unknown servers, as in APT41. | - Network Traffic (DS0003: Zeek HTTP)<br>- Metrics | - **Splunk**: `index=network sourcetype=zeek_http dest_ip NOT IN (trusted_ips) \| timechart span=1m count by src_ip \| where count > 50`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "HTTP" and RemoteIP !in (trustedIPs) \| summarize MinuteCount=count() by bin(Timestamp, 1m), DeviceIP \| where MinuteCount > 50`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE destination.ip NOT IN ['trusted_ips'] \| STATS COUNT() BY date_histogram(@timestamp, '1m'), source.ip \| WHERE COUNT() > 50`. |
| 9. Server Connections via Known Malicious IPs | Connections to servers from known malicious IPs, as in Volt Typhoon. | - Network Traffic (DS0003: Zeek HTTP)<br>- Threat Intelligence | - **Splunk**: `index=network sourcetype=zeek_http src_ip IN (threat_intel_ips) AND dest_ip NOT IN (trusted_ips) \| stats count by src_ip, dest_ip \| where count > 10`.<br>- **KQL**: `DeviceNetworkEvents \| where DeviceIP in (threatIntelIPs) and RemoteIP !in (trustedIPs) \| summarize count() by DeviceIP, RemoteIP \| where count_ > 10`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE source.ip IN ['threat_intel_ips'] AND destination.ip NOT IN ['trusted_ips'] \| STATS COUNT() BY source.ip, destination.ip HAVING COUNT() > 10`. |
| 10. Server Access with Anomalous Ports | Adversaries use non-standard ports to access servers, as in 2025 trends. | - Network Traffic (DS0003: Zeek Conn)<br>- Firewall Logs | - **Splunk**: `index=network sourcetype=zeek_conn dest_port NOT IN (80, 443) AND dest_ip NOT IN (trusted_ips) \| stats count by src_ip, dest_ip, dest_port \| where count > 10`.<br>- **KQL**: `DeviceNetworkEvents \| where RemotePort !in (80, 443) and RemoteIP !in (trustedIPs) \| summarize count() by DeviceIP, RemoteIP, RemotePort \| where count_ > 10`.<br>- **ELK**: `FROM logs-zeek.conn-* \| WHERE destination.port NOT IN [80, 443] AND destination.ip NOT IN ['trusted_ips'] \| STATS COUNT() BY source.ip, destination.ip, destination.port HAVING COUNT() > 10`. |

### T1583.003: Virtual Private Server (VPS)

| Hypothesis | Description | Data Sources | Hunting Queries |
|-----------|-------------|--------------|-----------------|
| 1. VPS Connections for C2 | Adversaries use VPS for C2 communication, as in Volt Typhoon. | - Network Traffic (DS0003: Zeek HTTP)<br>- Firewall Logs | - **Splunk**: `index=network sourcetype=zeek_http dest_ip IN (vps_providers) AND response_status_code IN ("200", "404") \| stats count by src_ip, dest_ip \| where count > 10`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "HTTP" and RemoteIP in (vpsProviders) and ResponseStatusCode in ("200", "404") \| summarize count() by DeviceIP, RemoteIP \| where count_ > 10`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE destination.ip IN ['vps_providers'] AND http.response.status_code IN ['200', '404'] \| STATS COUNT() BY source.ip, destination.ip HAVING COUNT() > 10`. |
| 2. Anomalous VPS Traffic Patterns | High-frequency connections to VPS providers, as in APT41. | - Network Traffic (DS0003: Zeek HTTP)<br>- Metrics | - **Splunk**: `index=network sourcetype=zeek_http dest_ip IN (vps_providers) \| timechart span=1m count by src_ip \| where count > 50`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "HTTP" and RemoteIP in (vpsProviders) \| summarize MinuteCount=count() by bin(Timestamp, 1m), DeviceIP \| where MinuteCount > 50`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE destination.ip IN ['vps_providers'] \| STATS COUNT() BY date_histogram(@timestamp, '1m'), source.ip \| WHERE COUNT() > 50`. |
| 3. VPS Access via Cloud APIs | Adversaries access VPS via cloud APIs, as in 2025 trends. | - Cloud Audit Logs (AWS CloudTrail)<br>- Authentication Logs | - **Splunk**: `index=cloud sourcetype=aws:cloudtrail eventName IN ("RunInstances", "DescribeInstances") AND requestParameters IN ("*vps*") AND userIdentity NOT IN (authorized_users) \| stats count by src_ip, eventName \| where count > 10`.<br>- **KQL**: `AWSCloudTrail \| where EventName in ("RunInstances", "DescribeInstances") and RequestParameters has_any ("vps") and Caller !in (authorizedUsers) \| summarize count() by SourceIP, EventName \| where count_ > 10`.<br>- **ELK**: `FROM logs-aws.cloudtrail-* \| WHERE event.action IN ['RunInstances', 'DescribeInstances'] AND event.request_parameters : ("*vps*") AND user.identity NOT IN ['authorized_users'] \| STATS COUNT() BY source.ip, event.action HAVING COUNT() > 10`. |
| 4. VPS Connections from Compromised Endpoints | Compromised endpoints connect to VPS, as in FIN7. | - Process Creation (DS0009: Sysmon ID 1)<br>- Network Traffic (DS0003: Zeek HTTP) | - **Splunk**: `index=endpoint sourcetype=sysmon EventCode=1 CommandLine IN ("*curl*", "*wget*") \| join host [search index=network sourcetype=zeek_http dest_ip IN (vps_providers)] \| stats count by host, CommandLine, dest_ip \| where count > 5`.<br>- **KQL**: `DeviceProcessEvents \| where ProcessCommandLine has_any ("curl", "wget") \| join kind=inner (DeviceNetworkEvents \| where Protocol == "HTTP" and RemoteIP in (vpsProviders)) on DeviceName \| summarize count() by DeviceName, ProcessCommandLine, RemoteIP \| where count_ > 5`.<br>- **ELK**: `FROM logs-endpoint.process-* \| WHERE process.command_line : ("*curl*" OR "*wget*") \| JOIN logs-zeek.http-* ON host.name WHERE destination.ip IN ['vps_providers'] \| STATS COUNT() BY host.name, process.command_line, destination.ip HAVING COUNT() > 5`. |
| 5. VPS Access via Browser Automation | Adversaries use browser automation to access VPS, as in Cobalt Strike. | - Process Creation (DS0009: Sysmon ID 1)<br>- Network Traffic (DS0003: Zeek HTTP) | - **Splunk**: `index=endpoint sourcetype=sysmon EventCode=1 CommandLine IN ("*selenium*", "*puppeteer*") \| join host [search index=network sourcetype=zeek_http dest_ip IN (vps_providers)] \| stats count by host, CommandLine, dest_ip \| where count > 5`.<br>- **KQL**: `DeviceProcessEvents \| where ProcessCommandLine has_any ("selenium", "puppeteer") \| join kind=inner (DeviceNetworkEvents \| where Protocol == "HTTP" and RemoteIP in (vpsProviders)) on DeviceName \| summarize count() by DeviceName, ProcessCommandLine, RemoteIP \| where count_ > 5`.<br>- **ELK**: `FROM logs-endpoint.process-* \| WHERE process.command_line : ("*selenium*" OR "*puppeteer*") \| JOIN logs-zeek.http-* ON host.name WHERE destination.ip IN ['vps_providers'] \| STATS COUNT() BY host.name, process.command_line, destination.ip HAVING COUNT() > 5`. |
| 6. VPS Connections in Linux Environments | Adversaries use Linux tools to connect to VPS, as in Turla. | - Process Creation (Linux Auditd)<br>- Network Traffic (DS0003: Zeek HTTP) | - **Splunk**: `index=linux sourcetype=auditd exe IN ("*curl*", "*wget*") AND args IN (vps_providers) \| stats count by host, exe \| where count > 5`.<br>- **KQL**: `LinuxAuditd \| where ProcessName has_any ("curl", "wget") and CommandLine has_any (vpsProviders) \| summarize count() by HostName, ProcessName \| where count_ > 5`.<br>- **ELK**: `FROM logs-auditd-* \| WHERE process.exe : ("*curl*" OR "*wget*") AND process.args IN ['vps_providers'] \| STATS COUNT() BY host.name, process.exe HAVING COUNT() > 5`. |
| 7. VPS Access with Suspicious User Agents | Adversaries use non-standard user agents to access VPS, as in APT41. | - Network Traffic (DS0003: Zeek HTTP)<br>- Proxy Logs | - **Splunk**: `index=network sourcetype=zeek_http user_agent NOT IN (known_agents) AND dest_ip IN (vps_providers) \| stats count by src_ip, user_agent, dest_ip \| where count > 10`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "HTTP" and AdditionalFields.UserAgent !in (knownAgents) and RemoteIP in (vpsProviders) \| summarize count() by DeviceIP, AdditionalFields.UserAgent, RemoteIP \| where count_ > 10`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE http.user_agent NOT IN ['known_agents'] AND destination.ip IN ['vps_providers'] \| STATS COUNT() BY source.ip, http.user_agent, destination.ip HAVING COUNT() > 10`. |
| 8. High-Frequency VPS Connections | High-frequency connections to VPS providers, as in APT41. | - Network Traffic (DS0003: Zeek HTTP)<br>- Metrics | - **Splunk**: `index=network sourcetype=zeek_http dest_ip IN (vps_providers) \| timechart span=1m count by src_ip \| where count > 50`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "HTTP" and RemoteIP in (vpsProviders) \| summarize MinuteCount=count() by bin(Timestamp, 1m), DeviceIP \| where MinuteCount > 50`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE destination.ip IN ['vps_providers'] \| STATS COUNT() BY date_histogram(@timestamp, '1m'), source.ip \| WHERE COUNT() > 50`. |
| 9. VPS Connections via Known Malicious IPs | Connections to VPS from known malicious IPs, as in Volt Typhoon. | - Network Traffic (DS0003: Zeek HTTP)<br>- Threat Intelligence | - **Splunk**: `index=network sourcetype=zeek_http src_ip IN (threat_intel_ips) AND dest_ip IN (vps_providers) \| stats count by src_ip, dest_ip \| where count > 10`.<br>- **KQL**: `DeviceNetworkEvents \| where DeviceIP in (threatIntelIPs) and RemoteIP in (vpsProviders) \| summarize count() by DeviceIP, RemoteIP \| where count_ > 10`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE source.ip IN ['threat_intel_ips'] AND destination.ip IN ['vps_providers'] \| STATS COUNT() BY source.ip, destination.ip HAVING COUNT() > 10`. |
| 10. VPS Access with Anomalous Ports | Adversaries use non-standard ports to access VPS, as in 2025 trends. | - Network Traffic (DS0003: Zeek Conn)<br>- Firewall Logs | - **Splunk**: `index=network sourcetype=zeek_conn dest_port NOT IN (80, 443) AND dest_ip IN (vps_providers) \| stats count by src_ip, dest_ip, dest_port \| where count > 10`.<br>- **KQL**: `DeviceNetworkEvents \| where RemotePort !in (80, 443) and RemoteIP in (vpsProviders) \| summarize count() by DeviceIP, RemoteIP, RemotePort \| where count_ > 10`.<br>- **ELK**: `FROM logs-zeek.conn-* \| WHERE destination.port NOT IN [80, 443] AND destination.ip IN ['vps_providers'] \| STATS COUNT() BY source.ip, destination.ip, destination.port HAVING COUNT() > 10`. |

### T1583.004: Serverless

| Hypothesis | Description | Data Sources | Hunting Queries |
|-----------|-------------|--------------|-----------------|
| 1. Serverless Function Abuse for C2 | Adversaries use serverless functions (e.g., AWS Lambda) for C2, as in Volt Typhoon. | - Cloud Audit Logs (AWS CloudTrail)<br>- Network Traffic (DS0003: Zeek HTTP) | - **Splunk**: `index=cloud sourcetype=aws:cloudtrail eventName IN ("Invoke", "CreateFunction") AND userIdentity NOT IN (authorized_users) \| stats count by src_ip, eventName \| where count > 10`.<br>- **KQL**: `AWSCloudTrail \| where EventName in ("Invoke", "CreateFunction") and Caller !in (authorizedUsers) \| summarize count() by SourceIP, EventName \| where count_ > 10`.<br>- **ELK**: `FROM logs-aws.cloudtrail-* \| WHERE event.action IN ['Invoke', 'CreateFunction'] AND user.identity NOT IN ['authorized_users'] \| STATS COUNT() BY source.ip, event.action HAVING COUNT() > 10`. |
| 2. Anomalous Serverless Function Invocations | High-frequency serverless function invocations, as in APT41. | - Cloud Audit Logs (AWS CloudTrail)<br>- Metrics | - **Splunk**: `index=cloud sourcetype=aws:cloudtrail eventName="Invoke" \| timechart span=1m count by src_ip \| where count > 50`.<br>- **KQL**: `AWSCloudTrail \| where EventName == "Invoke" \| summarize MinuteCount=count() by bin(Timestamp, 1m), SourceIP \| where MinuteCount > 50`.<br>- **ELK**: `FROM logs-aws.cloudtrail-* \| WHERE event.action == 'Invoke' \| STATS COUNT() BY date_histogram(@timestamp, '1m'), source.ip \| WHERE COUNT() > 50`. |
| 3. Serverless Access from Compromised Endpoints | Compromised endpoints invoke serverless functions, as in FIN7. | - Process Creation (DS0009: Sysmon ID 1)<br>- Cloud Audit Logs (AWS CloudTrail) | - **Splunk**: `index=endpoint sourcetype=sysmon EventCode=1 CommandLine IN ("*aws cli*", "*boto3*") \| join host [search index=cloud sourcetype=aws:cloudtrail eventName="Invoke"] \| stats count by host, CommandLine, eventName \| where count > 5`.<br>- **KQL**: `DeviceProcessEvents \| where ProcessCommandLine has_any ("aws cli", "boto3") \| join kind=inner (AWSCloudTrail \| where EventName == "Invoke") on DeviceName \| summarize count() by DeviceName, ProcessCommandLine, EventName \| where count_ > 5`.<br>- **ELK**: `FROM logs-endpoint.process-* \| WHERE process.command_line : ("*aws cli*" OR "*boto3*") \| JOIN logs-aws.cloudtrail-* ON host.name WHERE event.action == 'Invoke' \| STATS COUNT() BY host.name, process.command_line, event.action HAVING COUNT() > 5`. |
| 4. Serverless Function Creation by Unauthorized Users | Unauthorized users create serverless functions, as in 2025 trends. | - Cloud Audit Logs (AWS CloudTrail)<br>- Authentication Logs | - **Splunk**: `index=cloud sourcetype=aws:cloudtrail eventName="CreateFunction" AND userIdentity NOT IN (authorized_users) \| stats count by src_ip, userIdentity \| where count > 5`.<br>- **KQL**: `AWSCloudTrail \| where EventName == "CreateFunction" and Caller !in (authorizedUsers) \| summarize count() by SourceIP, Caller \| where count_ > 5`.<br>- **ELK**: `FROM logs-aws.cloudtrail-* \| WHERE event.action == 'CreateFunction' AND user.identity NOT IN ['authorized_users'] \| STATS COUNT() BY source.ip, user.identity HAVING COUNT() > 5`. |
| 5. Serverless Access via Browser Automation | Adversaries use browser automation to invoke serverless functions, as in Cobalt Strike. | - Process Creation (DS0009: Sysmon ID 1)<br>- Cloud Audit Logs (AWS CloudTrail) | - **Splunk**: `index=endpoint sourcetype=sysmon EventCode=1 CommandLine IN ("*selenium*", "*puppeteer*") \| join host [search index=cloud sourcetype=aws:cloudtrail eventName="Invoke"] \| stats count by host, CommandLine, eventName \| where count > 5`.<br>- **KQL**: `DeviceProcessEvents \| where ProcessCommandLine has_any ("selenium", "puppeteer") \| join kind=inner (AWSCloudTrail \| where EventName == "Invoke") on DeviceName \| summarize count() by DeviceName, ProcessCommandLine, EventName \| where count_ > 5`.<br>- **ELK**: `FROM logs-endpoint.process-* \| WHERE process.command_line : ("*selenium*" OR "*puppeteer*") \| JOIN logs-aws.cloudtrail-* ON host.name WHERE event.action == 'Invoke' \| STATS COUNT() BY host.name, process.command_line, event.action HAVING COUNT() > 5`. |
| 6. Serverless Access in Linux Environments | Adversaries use Linux tools to invoke serverless functions, as in Turla. | - Process Creation (Linux Auditd)<br>- Cloud Audit Logs (AWS CloudTrail) | - **Splunk**: `index=linux sourcetype=auditd exe IN ("*aws*", "*boto3*") AND args IN ("*lambda*") \| stats count by host, exe \| where count > 5`.<br>- **KQL**: `LinuxAuditd \| where ProcessName has_any ("aws", "boto3") and CommandLine has_any ("lambda") \| summarize count() by HostName, ProcessName \| where count_ > 5`.<br>- **ELK**: `FROM logs-auditd-* \| WHERE process.exe : ("*aws*" OR "*boto3*") AND process.args : ("*lambda*") \| STATS COUNT() BY host.name, process.exe HAVING COUNT() > 5`. |
| 7. Serverless Access with Suspicious User Agents | Adversaries use non-standard user agents to invoke serverless functions, as in APT41. | - Network Traffic (DS0003: Zeek HTTP)<br>- Cloud Audit Logs (AWS CloudTrail) | - **Splunk**: `index=network sourcetype=zeek_http user_agent NOT IN (known_agents) AND uri IN ("*lambda*") \| join src_ip [search index=cloud sourcetype=aws:cloudtrail eventName="Invoke"] \| stats count by src_ip, user_agent, eventName \| where count > 10`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "HTTP" and AdditionalFields.UserAgent !in (knownAgents) and RemoteUrl has_any ("lambda") \| join kind=inner (AWSCloudTrail \| where EventName == "Invoke") on SourceIP \| summarize count() by SourceIP, AdditionalFields.UserAgent, EventName \| where count_ > 10`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE http.user_agent NOT IN ['known_agents'] AND http.uri : ("*lambda*") \| JOIN logs-aws.cloudtrail-* ON source.ip WHERE event.action == 'Invoke' \| STATS COUNT() BY source.ip, http.user_agent, event.action HAVING COUNT() > 10`. |
| 8. High-Frequency Serverless Invocations | High-frequency serverless function invocations, as in APT41. | - Cloud Audit Logs (AWS CloudTrail)<br>- Metrics | - **Splunk**: `index=cloud sourcetype=aws:cloudtrail eventName="Invoke" \| timechart span=1m count by src_ip \| where count > 50`.<br>- **KQL**: `AWSCloudTrail \| where EventName == "Invoke" \| summarize MinuteCount=count() by bin(Timestamp, 1m), SourceIP \| where MinuteCount > 50`.<br>- **ELK**: `FROM logs-aws.cloudtrail-* \| WHERE event.action == 'Invoke' \| STATS COUNT() BY date_histogram(@timestamp, '1m'), source.ip \| WHERE COUNT() > 50`. |
| 9. Serverless Access via Known Malicious IPs | Serverless function invocations from known malicious IPs, as in Volt Typhoon. | - Cloud Audit Logs (AWS CloudTrail)<br>- Threat Intelligence | - **Splunk**: `index=cloud sourcetype=aws:cloudtrail eventName="Invoke" AND src_ip IN (threat_intel_ips) \| stats count by src_ip, eventName \| where count > 10`.<br>- **KQL**: `AWSCloudTrail \| where EventName == "Invoke" and SourceIP in (threatIntelIPs) \| summarize count() by SourceIP, EventName \| where count_ > 10`.<br>- **ELK**: `FROM logs-aws.cloudtrail-* \| WHERE event.action == 'Invoke' AND source.ip IN ['threat_intel_ips'] \| STATS COUNT() BY source.ip, event.action HAVING COUNT() > 10`. |
| 10. Serverless Access with Anomalous Timing | Serverless function invocations outside business hours, as in APT29. | - Cloud Audit Logs (AWS CloudTrail)<br>- Metrics | - **Splunk**: `index=cloud sourcetype=aws:cloudtrail eventName="Invoke" \| timechart span=1h count by src_ip \| where count > avg(count)*3 AND (_time < "08:00" OR _time > "18:00")`.<br>- **KQL**: `AWSCloudTrail \| where EventName == "Invoke" \| summarize HourlyCount=count() by bin(Timestamp, 1h), SourceIP \| where HourlyCount > avg(HourlyCount) * 3 and (hour(Timestamp) < 8 or hour(Timestamp) > 18)`.<br>- **ELK**: `FROM logs-aws.cloudtrail-* \| WHERE event.action == 'Invoke' \| STATS COUNT() BY date_histogram(@timestamp, '1h'), source.ip \| WHERE COUNT() > AVG(COUNT()) * 3 AND (HOUR(@timestamp) < 8 OR HOUR(@timestamp) > 18)`. |

### T1583.005: Botnet

| Hypothesis | Description | Data Sources | Hunting Queries |
|-----------|-------------|--------------|-----------------|
| 1. Botnet C2 Communication | Adversaries use botnets for C2 communication, as in Volt Typhoon. | - Network Traffic (DS0003: Zeek HTTP)<br>- DNS Logs (DS0001) | - **Splunk**: `index=network sourcetype=zeek_http dest_ip IN (botnet_ips) AND response_status_code IN ("200", "404") \| stats count by src_ip, dest_ip \| where count > 10`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "HTTP" and RemoteIP in (botnetIPs) and ResponseStatusCode in ("200", "404") \| summarize count() by DeviceIP, RemoteIP \| where count_ > 10`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE destination.ip IN ['botnet_ips'] AND http.response.status_code IN ['200', '404'] \| STATS COUNT() BY source.ip, destination.ip HAVING COUNT() > 10`. |
| 2. Botnet DNS Queries | High-frequency DNS queries to botnet C2 domains, as in APT41. | - DNS Logs (DS0001)<br>- Metrics | - **Splunk**: `index=dns sourcetype=zeek_dns query IN (botnet_domains) \| timechart span=1m count by src_ip \| where count > 50`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "DNS" and DnsQueryName in (botnetDomains) \| summarize MinuteCount=count() by bin(Timestamp, 1m), DeviceIP \| where MinuteCount > 50`.<br>- **ELK**: `FROM logs-zeek.dns-* \| WHERE dns.query IN ['botnet_domains'] \| STATS COUNT() BY date_histogram(@timestamp, '1m'), source.ip \| WHERE COUNT() > 50`. |
| 3. Botnet Activity from Compromised Endpoints | Compromised endpoints participate in botnet activity, as in FIN7. | - Process Creation (DS0009: Sysmon ID 1)<br>- Network Traffic (DS0003: Zeek HTTP) | - **Splunk**: `index=endpoint sourcetype=sysmon EventCode=1 CommandLine IN ("*curl*", "*wget*") \| join host [search index=network sourcetype=zeek_http dest_ip IN (botnet_ips)] \| stats count by host, CommandLine, dest_ip \| where count > 5`.<br>- **KQL**: `DeviceProcessEvents \| where ProcessCommandLine has_any ("curl", "wget") \| join kind=inner (DeviceNetworkEvents \| where Protocol == "HTTP" and RemoteIP in (botnetIPs)) on DeviceName \| summarize count() by DeviceName, ProcessCommandLine, RemoteIP \| where count_ > 5`.<br>- **ELK**: `FROM logs-endpoint.process-* \| WHERE process.command_line : ("*curl*" OR "*wget*") \| JOIN logs-zeek.http-* ON host.name WHERE destination.ip IN ['botnet_ips'] \| STATS COUNT() BY host.name, process.command_line, destination.ip HAVING COUNT() > 5`. |
| 4. Botnet Activity via Browser Automation | Adversaries use browser automation for botnet C2, as in Cobalt Strike. | - Process Creation (DS0009: Sysmon ID 1)<br>- Network Traffic (DS0003: Zeek HTTP) | - **Splunk**: `index=endpoint sourcetype=sysmon EventCode=1 CommandLine IN ("*selenium*", "*puppeteer*") \| join host [search index=network sourcetype=zeek_http dest_ip IN (botnet_ips)] \| stats count by host, CommandLine, dest_ip \| where count > 5`.<br>- **KQL**: `DeviceProcessEvents \| where ProcessCommandLine has_any ("selenium", "puppeteer") \| join kind=inner (DeviceNetworkEvents \| where Protocol == "HTTP" and RemoteIP in (botnetIPs)) on DeviceName \| summarize count() by DeviceName, ProcessCommandLine, RemoteIP \| where count_ > 5`.<br>- **ELK**: `FROM logs-endpoint.process-* \| WHERE process.command_line : ("*selenium*" OR "*puppeteer*") \| JOIN logs-zeek.http-* ON host.name WHERE destination.ip IN ['botnet_ips'] \| STATS COUNT() BY host.name, process.command_line, destination.ip HAVING COUNT() > 5`. |
| 5. Botnet Activity in Linux Environments | Adversaries use Linux tools for botnet activity, as in Turla. | - Process Creation (Linux Auditd)<br>- Network Traffic (DS0003: Zeek HTTP) | - **Splunk**: `index=linux sourcetype=auditd exe IN ("*curl*", "*wget*") AND args IN (botnet_ips) \| stats count by host, exe \| where count > 5`.<br>- **KQL**: `LinuxAuditd \| where ProcessName has_any ("curl", "wget") and CommandLine has_any (botnetIPs) \| summarize count() by HostName, ProcessName \| where count_ > 5`.<br>- **ELK**: `FROM logs-auditd-* \| WHERE process.exe : ("*curl*" OR "*wget*") AND process.args IN ['botnet_ips'] \| STATS COUNT() BY host.name, process.exe HAVING COUNT() > 5`. |
| 6. Botnet Activity with Suspicious User Agents | Adversaries use non-standard user agents for botnet activity, as in APT41. | - Network Traffic (DS0003: Zeek HTTP)<br>- Proxy Logs | - **Splunk**: `index=network sourcetype=zeek_http user_agent NOT IN (known_agents) AND dest_ip IN (botnet_ips) \| stats count by src_ip, user_agent, dest_ip \| where count > 10`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "HTTP" and AdditionalFields.UserAgent !in (knownAgents) and RemoteIP in (botnetIPs) \| summarize count() by DeviceIP, AdditionalFields.UserAgent, RemoteIP \| where count_ > 10`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE http.user_agent NOT IN ['known_agents'] AND destination.ip IN ['botnet_ips'] \| STATS COUNT() BY source.ip, http.user_agent, destination.ip HAVING COUNT() > 10`. |
| 7. High-Frequency Botnet Connections | High-frequency connections to botnet IPs, as in APT41. | - Network Traffic (DS0003: Zeek HTTP)<br>- Metrics | - **Splunk**: `index=network sourcetype=zeek_http dest_ip IN (botnet_ips) \| timechart span=1m count by src_ip \| where count > 50`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "HTTP" and RemoteIP in (botnetIPs) \| summarize MinuteCount=count() by bin(Timestamp, 1m), DeviceIP \| where MinuteCount > 50`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE destination.ip IN ['botnet_ips'] \| STATS COUNT() BY date_histogram(@timestamp, '1m'), source.ip \| WHERE COUNT() > 50`. |
| 8. Botnet Connections via Known Malicious IPs | Connections to botnet IPs from known malicious IPs, as in Volt Typhoon. | - Network Traffic (DS0003: Zeek HTTP)<br>- Threat Intelligence | - **Splunk**: `index=network sourcetype=zeek_http src_ip IN (threat_intel_ips) AND dest_ip IN (botnet_ips) \| stats count by src_ip, dest_ip \| where count > 10`.<br>- **KQL**: `DeviceNetworkEvents \| where DeviceIP in (threatIntelIPs) and RemoteIP in (botnetIPs) \| summarize count() by DeviceIP, RemoteIP \| where count_ > 10`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE source.ip IN ['threat_intel_ips'] AND destination.ip IN ['botnet_ips'] \| STATS COUNT() BY source.ip, destination.ip HAVING COUNT() > 10`. |
| 9. Botnet DNS Queries to Suspicious Domains | Botnet-related DNS queries to suspicious domains, as in 2025 trends. | - DNS Logs (DS0001)<br>- Threat Intelligence | - **Splunk**: `index=dns sourcetype=zeek_dns query IN (botnet_domains) AND src_ip IN (threat_intel_ips) \| stats count by src_ip, query \| where count > 10`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "DNS" and DnsQueryName in (botnetDomains) and DeviceIP in (threatIntelIPs) \| summarize count() by DeviceIP, DnsQueryName \| where count_ > 10`.<br>- **ELK**: `FROM logs-zeek.dns-* \| WHERE dns.query IN ['botnet_domains'] AND source.ip IN ['threat_intel_ips'] \| STATS COUNT() BY source.ip, dns.query HAVING COUNT() > 10`. |
| 10. Botnet Activity with Anomalous Ports | Botnet activity using non-standard ports, as in 2025 trends. | - Network Traffic (DS0003: Zeek Conn)<br>- Firewall Logs | - **Splunk**: `index=network sourcetype=zeek_conn dest_port NOT IN (80, 443) AND dest_ip IN (botnet_ips) \| stats count by src_ip, dest_ip, dest_port \| where count > 10`.<br>- **KQL**: `DeviceNetworkEvents \| where RemotePort !in (80, 443) and RemoteIP in (botnetIPs) \| summarize count() by DeviceIP, RemoteIP, RemotePort \| where count_ > 10`.<br>- **ELK**: `FROM logs-zeek.conn-* \| WHERE destination.port NOT IN [80, 443] AND destination.ip IN ['botnet_ips'] \| STATS COUNT() BY source.ip, destination.ip, destination.port HAVING COUNT() > 10`. |

### T1583.006: DNS Server

| Hypothesis | Description | Data Sources | Hunting Queries |
|-----------|-------------|--------------|-----------------|
| 1. DNS Server Queries for C2 | Adversaries use compromised DNS servers for C2, as in Volt Typhoon. | - DNS Logs (DS0001)<br>- Network Traffic (DS0003: Zeek DNS) | - **Splunk**: `index=dns sourcetype=zeek_dns dest_ip IN (dns_servers) AND query IN (suspicious_domains) \| stats count by src_ip, dest_ip, query \| where count > 10`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "DNS" and RemoteIP in (dnsServers) and DnsQueryName in (suspiciousDomains) \| summarize count() by DeviceIP, RemoteIP, DnsQueryName \| where count_ > 10`.<br>- **ELK**: `FROM logs-zeek.dns-* \| WHERE destination.ip IN ['dns_servers'] AND dns.query IN ['suspicious_domains'] \| STATS COUNT() BY source.ip, destination.ip, dns.query HAVING COUNT() > 10`. |
| 2. Anomalous DNS Server Queries | High-frequency queries to compromised DNS servers, as in APT41. | - DNS Logs (DS0001)<br>- Metrics | - **Splunk**: `index=dns sourcetype=zeek_dns dest_ip IN (dns_servers) \| timechart span=1m count by src_ip \| where count > 50`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "DNS" and RemoteIP in (dnsServers) \| summarize MinuteCount=count() by bin(Timestamp, 1m), DeviceIP \| where MinuteCount > 50`.<br>- **ELK**: `FROM logs-zeek.dns-* \| WHERE destination.ip IN ['dns_servers'] \| STATS COUNT() BY date_histogram(@timestamp, '1m'), source.ip \| WHERE COUNT() > 50`. |
| 3. DNS Server Queries from Compromised Endpoints | Compromised endpoints query malicious DNS servers, as in FIN7. | - Process Creation (DS0009: Sysmon ID 1)<br>- DNS Logs (DS0001) | - **Splunk**: `index=endpoint sourcetype=sysmon EventCode=1 CommandLine IN ("*nslookup*", "*dig*") \| join host [search index=dns sourcetype=zeek_dns dest_ip IN (dns_servers)] \| stats count by host, CommandLine, dest_ip \| where count > 5`.<br>- **KQL**: `DeviceProcessEvents \| where ProcessCommandLine has_any ("nslookup", "dig") \| join kind=inner (DeviceNetworkEvents \| where Protocol == "DNS" and RemoteIP in (dnsServers)) on DeviceName \| summarize count() by DeviceName, ProcessCommandLine, RemoteIP \| where count_ > 5`.<br>- **ELK**: `FROM logs-endpoint.process-* \| WHERE process.command_line : ("*nslookup*" OR "*dig*") \| JOIN logs-zeek.dns-* ON host.name WHERE destination.ip IN ['dns_servers'] \| STATS COUNT() BY host.name, process.command_line, destination.ip HAVING COUNT() > 5`. |
| 4. DNS Server Queries via Browser Automation | Adversaries use browser automation to query DNS servers, as in Cobalt Strike. | - Process Creation (DS0009: Sysmon ID 1)<br>- DNS Logs (DS0001) | - **Splunk**: `index=endpoint sourcetype=sysmon EventCode=1 CommandLine IN ("*selenium*", "*puppeteer*") \| join host [search index=dns sourcetype=zeek_dns dest_ip IN (dns_servers)] \| stats count by host, CommandLine, dest_ip \| where count > 5`.<br>- **KQL**: `DeviceProcessEvents \| where ProcessCommandLine has_any ("selenium", "puppeteer") \| join kind=inner (DeviceNetworkEvents \| where Protocol == "DNS" and RemoteIP in (dnsServers)) on DeviceName \| summarize count() by DeviceName, ProcessCommandLine, RemoteIP \| where count_ > 5`.<br>- **ELK**: `FROM logs-endpoint.process-* \| WHERE process.command_line : ("*selenium*" OR "*puppeteer*") \| JOIN logs-zeek.dns-* ON host.name WHERE destination.ip IN ['dns_servers'] \| STATS COUNT() BY host.name, process.command_line, destination.ip HAVING COUNT() > 5`. |
| 5. DNS Server Queries in Linux Environments | Adversaries use Linux tools to query malicious DNS servers, as in Turla. | - Process Creation (Linux Auditd)<br>- DNS Logs (DS0001) | - **Splunk**: `index=linux sourcetype=auditd exe IN ("*dig*", "*nslookup*") AND args IN (dns_servers) \| stats count by host, exe \| where count > 5`.<br>- **KQL**: `LinuxAuditd \| where ProcessName has_any ("dig", "nslookup") and CommandLine has_any (dnsServers) \| summarize count() by HostName, ProcessName \| where count_ > 5`.<br>- **ELK**: `FROM logs-auditd-* \| WHERE process.exe : ("*dig*" OR "*nslookup*") AND process.args IN ['dns_servers'] \| STATS COUNT() BY host.name, process.exe HAVING COUNT() > 5`. |
| 6. DNS Server Queries with Suspicious User Agents | Adversaries use non-standard user agents to query DNS servers, as in APT41. | - Network Traffic (DS0003: Zeek HTTP)<br>- DNS Logs (DS0001) | - **Splunk**: `index=network sourcetype=zeek_http user_agent NOT IN (known_agents) AND uri IN (dns_servers) \| join src_ip [search index=dns sourcetype=zeek_dns dest_ip IN (dns_servers)] \| stats count by src_ip, user_agent, dest_ip \| where count > 10`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "HTTP" and AdditionalFields.UserAgent !in (knownAgents) and RemoteUrl in (dnsServers) \| join kind=inner (DeviceNetworkEvents \| where Protocol == "DNS" and RemoteIP in (dnsServers)) on DeviceIP \| summarize count() by DeviceIP, AdditionalFields.UserAgent, RemoteIP \| where count_ > 10`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE http.user_agent NOT IN ['known_agents'] AND http.uri IN ['dns_servers'] \| JOIN logs-zeek.dns-* ON source.ip WHERE destination.ip IN ['dns_servers'] \| STATS COUNT() BY source.ip, http.user_agent, destination.ip HAVING COUNT() > 10`. |
| 7. High-Frequency DNS Server Queries | High-frequency queries to compromised DNS servers, as in APT41. | - DNS Logs (DS0001)<br>- Metrics | - **Splunk**: `index=dns sourcetype=zeek_dns dest_ip IN (dns_servers) \| timechart span=1m count by src_ip \| where count > 50`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "DNS" and RemoteIP in (dnsServers) \| summarize MinuteCount=count() by bin(Timestamp, 1m), DeviceIP \| where MinuteCount > 50`.<br>- **ELK**: `FROM logs-zeek.dns-* \| WHERE destination.ip IN ['dns_servers'] \| STATS COUNT() BY date_histogram(@timestamp, '1m'), source.ip \| WHERE COUNT() > 50`. |
| 8. DNS Server Queries via Known Malicious IPs | Queries to DNS servers from known malicious IPs, as in Volt Typhoon. | - DNS Logs (DS0001)<br>- Threat Intelligence | - **Splunk**: `index=dns sourcetype=zeek_dns src_ip IN (threat_intel_ips) AND dest_ip IN (dns_servers) \| stats count by src_ip, dest_ip \| where count > 10`.<br>- **KQL**: `DeviceNetworkEvents \| where DeviceIP in (threatIntelIPs) and RemoteIP in (dnsServers) \| summarize count() by DeviceIP, RemoteIP \| where count_ > 10`.<br>- **ELK**: `FROM logs-zeek.dns-* \| WHERE source.ip IN ['threat_intel_ips'] AND destination.ip IN ['dns_servers'] \| STATS COUNT() BY source.ip, destination.ip HAVING COUNT() > 10`. |
| 9. DNS Server Queries with Suspicious Domains | DNS server queries for suspicious domains, as in 2025 trends. | - DNS Logs (DS0001)<br>- Threat Intelligence | - **Splunk**: `index=dns sourcetype=zeek_dns query IN (suspicious_domains) AND dest_ip IN (dns_servers) \| stats count by src_ip, query, dest_ip \| where count > 10`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "DNS" and DnsQueryName in (suspiciousDomains) and RemoteIP in (dnsServers) \| summarize count() by DeviceIP, DnsQueryName, RemoteIP \| where count_ > 10`.<br>- **ELK**: `FROM logs-zeek.dns-* \| WHERE dns.query IN ['suspicious_domains'] AND destination.ip IN ['dns_servers'] \| STATS COUNT() BY source.ip, dns.query, destination.ip HAVING COUNT() > 10`. |
| 10. DNS Server Queries with Anomalous Ports | DNS queries using non-standard ports, as in 2025 trends. | - Network Traffic (DS0003: Zeek Conn)<br>- DNS Logs (DS0001) | - **Splunk**: `index=network sourcetype=zeek_conn dest_port NOT IN (53) AND dest_ip IN (dns_servers) \| stats count by src_ip, dest_ip, dest_port \| where count > 10`.<br>- **KQL**: `DeviceNetworkEvents \| where RemotePort !in (53) and RemoteIP in (dnsServers) \| summarize count() by DeviceIP, RemoteIP, RemotePort \| where count_ > 10`.<br>- **ELK**: `FROM logs-zeek.conn-* \| WHERE destination.port NOT IN [53] AND destination.ip IN ['dns_servers'] \| STATS COUNT() BY source.ip, destination.ip, destination.port HAVING COUNT() > 10`. |

### T1583.007: Email Account

| Hypothesis | Description | Data Sources | Hunting Queries |
|-----------|-------------|--------------|-----------------|
| 1. Compromised Email Accounts for Phishing | Adversaries use compromised email accounts for phishing, as in Volt Typhoon. | - Email Logs (DS0004)<br>- Authentication Logs (DS0029) | - **Splunk**: `index=email sourcetype=zeek_smtp src_ip NOT IN (trusted_ips) AND user NOT IN (known_users) \| stats count by src_ip, user \| where count > 10`.<br>- **KQL**: `EmailEvents \| where SenderIP !in (trustedIPs) and UserId !in (knownUsers) \| summarize count() by SenderIP, UserId \| where count_ > 10`.<br>- **ELK**: `FROM logs-zeek.smtp-* \| WHERE source.ip NOT IN ['trusted_ips'] AND user.name NOT IN ['known_users'] \| STATS COUNT() BY source.ip, user.name HAVING COUNT() > 10`. |
| 2. Email Account Access via Webmail | Adversaries access email accounts via webmail for phishing, as in APT41. | - Network Traffic (DS0003: Zeek HTTP)<br>- Proxy Logs | - **Splunk**: `index=network sourcetype=zeek_http uri IN ("*mail.google.com*", "*outlook.office365.com*") AND user_agent NOT IN (known_agents) \| stats count by src_ip, uri, user_agent \| where count > 10`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "HTTP" and RemoteUrl has_any ("mail.google.com", "outlook.office365.com") and AdditionalFields.UserAgent !in (knownAgents) \| summarize count() by DeviceIP, RemoteUrl, AdditionalFields.UserAgent \| where count_ > 10`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE http.uri : ("*mail.google.com*" OR "*outlook.office365.com*") AND http.user_agent NOT IN ['known_agents'] \| STATS COUNT() BY source.ip, http.uri, http.user_agent HAVING COUNT() > 10`. |
| 3. Email Account Access via Cloud APIs | Adversaries access email accounts via cloud APIs, as in 2025 trends. | - Cloud Audit Logs (AWS CloudTrail, Azure AD)<br>- Authentication Logs | - **Splunk**: `index=cloud sourcetype=aws:cloudtrail eventName IN ("ListMessages", "GetEmail") AND userIdentity NOT IN (authorized_users) \| stats count by src_ip, eventName \| where count > 10`.<br>- **KQL**: `AWSCloudTrail \| where EventName in ("ListMessages", "GetEmail") and Caller !in (authorizedUsers) \| summarize count() by SourceIP, EventName \| where count_ > 10`.<br>- **ELK**: `FROM logs-aws.cloudtrail-* \| WHERE event.action IN ['ListMessages', 'GetEmail'] AND user.identity NOT IN ['authorized_users'] \| STATS COUNT() BY source.ip, event.action HAVING COUNT() > 10`. |
| 4. Email Account Access with Anomalous Timing | Email account access outside business hours, as in APT29. | - Email Logs (DS0004)<br>- Metrics | - **Splunk**: `index=email sourcetype=zeek_smtp user NOT IN (known_users) \| timechart span=1h count by src_ip \| where count > avg(count)*3 AND (_time < "08:00" OR _time > "18:00")`.<br>- **KQL**: `EmailEvents \| where UserId !in (knownUsers) \| summarize HourlyCount=count() by bin(Timestamp, 1h), SenderIP \| where HourlyCount > avg(HourlyCount) * 3 and (hour(Timestamp) < 8 or hour(Timestamp) > 18)`.<br>- **ELK**: `FROM logs-zeek.smtp-* \| WHERE user.name NOT IN ['known_users'] \| STATS COUNT() BY date_histogram(@timestamp, '1h'), source.ip \| WHERE COUNT() > AVG(COUNT()) * 3 AND (HOUR(@timestamp) < 8 OR HOUR(@timestamp) > 18)`. |
| 5. Email Account Access from Compromised Endpoints | Compromised endpoints access email accounts, as in FIN7. | - Process Creation (DS0009: Sysmon ID 1)<br>- Email Logs (DS0004) | - **Splunk**: `index=endpoint sourcetype=sysmon EventCode=1 CommandLine IN ("*outlook.exe*", "*thunderbird*") \| join host [search index=email sourcetype=zeek_smtp user NOT IN (known_users)] \| stats count by host, CommandLine, user \| where count > 5`.<br>- **KQL**: `DeviceProcessEvents \| where ProcessCommandLine has_any ("outlook.exe", "thunderbird") \| join kind=inner (EmailEvents \| where UserId !in (knownUsers)) on DeviceName \| summarize count() by DeviceName, ProcessCommandLine, UserId \| where count_ > 5`.<br>- **ELK**: `FROM logs-endpoint.process-* \| WHERE process.command_line : ("*outlook.exe*" OR "*thunderbird*") \| JOIN logs-zeek.smtp-* ON host.name WHERE user.name NOT IN ['known_users'] \| STATS COUNT() BY host.name, process.command_line, user.name HAVING COUNT() > 5`. |
| 6. Email Account Access via Browser Automation | Adversaries use browser automation to access email accounts, as in Cobalt Strike. | - Process Creation (DS0009: Sysmon ID 1)<br>- Network Traffic (DS0003: Zeek HTTP) | - **Splunk**: `index=endpoint sourcetype=sysmon EventCode=1 CommandLine IN ("*selenium*", "*puppeteer*") \| join host [search index=network sourcetype=zeek_http uri IN ("*mail.google.com*", "*outlook.office365.com*")] \| stats count by host, CommandLine, uri \| where count > 5`.<br>- **KQL**: `DeviceProcessEvents \| where ProcessCommandLine has_any ("selenium", "puppeteer") \| join kind=inner (DeviceNetworkEvents \| where Protocol == "HTTP" and RemoteUrl has_any ("mail.google.com", "outlook.office365.com")) on DeviceName \| summarize count() by DeviceName, ProcessCommandLine, RemoteUrl \| where count_ > 5`.<br>- **ELK**: `FROM logs-endpoint.process-* \| WHERE process.command_line : ("*selenium*" OR "*puppeteer*") \| JOIN logs-zeek.http-* ON host.name WHERE http.uri : ("*mail.google.com*" OR "*outlook.office365.com*") \| STATS COUNT() BY host.name, process.command_line, http.uri HAVING COUNT() > 5`. |
| 7. Email Account Access in Linux Environments | Adversaries use Linux tools to access email accounts, as in Turla. | - Process Creation (Linux Auditd)<br>- Email Logs (DS0004) | - **Splunk**: `index=linux sourcetype=auditd exe IN ("*mutt*", "*thunderbird*") AND args IN ("*imap*", "*smtp*") \| stats count by host, exe \| where count > 5`.<br>- **KQL**: `LinuxAuditd \| where ProcessName has_any ("mutt", "thunderbird") and CommandLine has_any ("imap", "smtp") \| summarize count() by HostName, ProcessName \| where count_ > 5`.<br>- **ELK**: `FROM logs-auditd-* \| WHERE process.exe : ("*mutt*" OR "*thunderbird*") AND process.args : ("*imap*" OR "*smtp*") \| STATS COUNT() BY host.name, process.exe HAVING COUNT() > 5`. |
| 8. Email Account Access with Suspicious User Agents | Adversaries use non-standard user agents to access email accounts, as in APT41. | - Network Traffic (DS0003: Zeek HTTP)<br>- Proxy Logs | - **Splunk**: `index=network sourcetype=zeek_http user_agent NOT IN (known_agents) AND uri IN ("*mail.google.com*", "*outlook.office365.com*") \| stats count by src_ip, user_agent, uri \| where count > 10`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "HTTP" and AdditionalFields.UserAgent !in (knownAgents) and RemoteUrl has_any ("mail.google.com", "outlook.office365.com") \| summarize count() by DeviceIP, AdditionalFields.UserAgent, RemoteUrl \| where count_ > 10`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE http.user_agent NOT IN ['known_agents'] AND http.uri : ("*mail.google.com*" OR "*outlook.office365.com*") \| STATS COUNT() BY source.ip, http.user_agent, http.uri HAVING COUNT() > 10`. |
| 9. High-Frequency Email Account Access | High-frequency email account access, as in APT41. | - Email Logs (DS0004)<br>- Metrics | - **Splunk**: `index=email sourcetype=zeek_smtp user NOT IN (known_users) \| timechart span=1m count by src_ip \| where count > 50`.<br>- **KQL**: `EmailEvents \| where UserId !in (knownUsers) \| summarize MinuteCount=count() by bin(Timestamp, 1m), SenderIP \| where MinuteCount > 50`.<br>- **ELK**: `FROM logs-zeek.smtp-* \| WHERE user.name NOT IN ['known_users'] \| STATS COUNT() BY date_histogram(@timestamp, '1m'), source.ip \| WHERE COUNT() > 50`. |
| 10. Email Account Access via Known Malicious IPs | Email account access from known malicious IPs, as in Volt Typhoon. | - Email Logs (DS0004)<br>- Threat Intelligence | - **Splunk**: `index=email sourcetype=zeek_smtp src_ip IN (threat_intel_ips) \| stats count by src_ip, user \| where count > 10`.<br>- **KQL**: `EmailEvents \| where SenderIP in (threatIntelIPs) \| summarize count() by SenderIP, UserId \| where count_ > 10`.<br>- **ELK**: `FROM logs-zeek.smtp-* \| WHERE source.ip IN ['threat_intel_ips'] \| STATS COUNT() BY source.ip, user.name HAVING COUNT() > 10`. |


### T1583.008: Malware

| Hypothesis | Description | Data Sources | Hunting Queries |
|-----------|-------------|--------------|-----------------|
| 1. Malware Distribution via Phishing Emails | Adversaries distribute malware via phishing emails, as in Volt Typhoon. | - Email Logs (DS0004)<br>- Email Attachments (DS0004) | - **Splunk**: `index=email sourcetype=zeek_smtp attachment IN ("*.exe", "*.zip", "*.scr") AND src_ip NOT IN (trusted_ips) \| stats count by src_ip, recipient, attachment \| where count > 5`.<br>- **KQL**: `EmailEvents \| where AttachmentName has_any (".exe", ".zip", ".scr") and SenderIP !in (trustedIPs) \| summarize count() by SenderIP, RecipientEmailAddress, AttachmentName \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.smtp-* \| WHERE email.attachment : ("*.exe" OR "*.zip" OR "*.scr") AND source.ip NOT IN ['trusted_ips'] \| STATS COUNT() BY source.ip, email.recipient, email.attachment HAVING COUNT() > 5`. |
| 2. Malware C2 Communication | Adversaries use malware to establish C2 communication, as in APT41. | - Network Traffic (DS0003: Zeek HTTP)<br>- DNS Logs (DS0001) | - **Splunk**: `index=network sourcetype=zeek_http dest_ip IN (malware_c2_ips) AND response_status_code IN ("200", "404") \| stats count by src_ip, dest_ip \| where count > 10`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "HTTP" and RemoteIP in (malwareC2IPs) and ResponseStatusCode in ("200", "404") \| summarize count() by DeviceIP, RemoteIP \| where count_ > 10`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE destination.ip IN ['malware_c2_ips'] AND http.response.status_code IN ['200', '404'] \| STATS COUNT() BY source.ip, destination.ip HAVING COUNT() > 10`. |
| 3. Malware Execution on Compromised Endpoints | Compromised endpoints execute malware, as in FIN7. | - Process Creation (DS0009: Sysmon ID 1)<br>- File Creation (DS0013: Sysmon ID 11) | - **Splunk**: `index=endpoint sourcetype=sysmon EventCode=1 CommandLine IN ("*powershell.exe*", "*cmd.exe*") AND Image NOT IN (trusted_paths) \| join host [search index=endpoint sourcetype=sysmon EventCode=11 FileName IN ("*.exe", "*.dll")] \| stats count by host, Image, FileName \| where count > 5`.<br>- **KQL**: `DeviceProcessEvents \| where ProcessCommandLine has_any ("powershell.exe", "cmd.exe") and ProcessName !in (trustedPaths) \| join kind=inner (DeviceFileEvents \| where FileName has_any (".exe", ".dll")) on DeviceName \| summarize count() by DeviceName, ProcessName, FileName \| where count_ > 5`.<br>- **ELK**: `FROM logs-endpoint.process-* \| WHERE process.command_line : ("*powershell.exe*" OR "*cmd.exe*") AND process.executable NOT IN ['trusted_paths'] \| JOIN logs-endpoint.file-* ON host.name WHERE file.name : ("*.exe" OR "*.dll") \| STATS COUNT() BY host.name, process.executable, file.name HAVING COUNT() > 5`. |
| 4. Malware Execution via Browser Automation | Adversaries use browser automation tools to execute malware, as in Cobalt Strike. | - Process Creation (DS0009: Sysmon ID 1)<br>- Network Traffic (DS0003: Zeek HTTP) | - **Splunk**: `index=endpoint sourcetype=sysmon EventCode=1 CommandLine IN ("*selenium*", "*puppeteer*") \| join host [search index=network sourcetype=zeek_http dest_ip IN (malware_c2_ips)] \| stats count by host, CommandLine, dest_ip \| where count > 5`.<br>- **KQL**: `DeviceProcessEvents \| where ProcessCommandLine has_any ("selenium", "puppeteer") \| join kind=inner (DeviceNetworkEvents \| where Protocol == "HTTP" and RemoteIP in (malwareC2IPs)) on DeviceName \| summarize count() by DeviceName, ProcessCommandLine, RemoteIP \| where count_ > 5`.<br>- **ELK**: `FROM logs-endpoint.process-* \| WHERE process.command_line : ("*selenium*" OR "*puppeteer*") \| JOIN logs-zeek.http-* ON host.name WHERE destination.ip IN ['malware_c2_ips'] \| STATS COUNT() BY host.name, process.command_line, destination.ip HAVING COUNT() > 5`. |
| 5. Malware Execution in Linux Environments | Adversaries deploy malware using Linux tools, as in Turla. | - Process Creation (Linux Auditd)<br>- File Creation (Linux Auditd) | - **Splunk**: `index=linux sourcetype=auditd exe IN ("*bash*", "*sh*") AND args IN ("*.sh", "*.elf") \| stats count by host, exe, args \| where count > 5`.<br>- **KQL**: `LinuxAuditd \| where ProcessName has_any ("bash", "sh") and CommandLine has_any (".sh", ".elf") \| summarize count() by HostName, ProcessName, CommandLine \| where count_ > 5`.<br>- **ELK**: `FROM logs-auditd-* \| WHERE process.exe : ("*bash*" OR "*sh*") AND process.args : ("*.sh" OR "*.elf") \| STATS COUNT() BY host.name, process.exe, process.args HAVING COUNT() > 5`. |
| 6. Malware Communication with Suspicious User Agents | Malware uses non-standard user agents for C2 communication, as in APT41. | - Network Traffic (DS0003: Zeek HTTP)<br>- Proxy Logs | - **Splunk**: `index=network sourcetype=zeek_http user_agent NOT IN (known_agents) AND dest_ip IN (malware_c2_ips) \| stats count by src_ip, user_agent, dest_ip \| where count > 10`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "HTTP" and AdditionalFields.UserAgent !in (knownAgents) and RemoteIP in (malwareC2IPs) \| summarize count() by DeviceIP, AdditionalFields.UserAgent, RemoteIP \| where count_ > 10`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE http.user_agent NOT IN ['known_agents'] AND destination.ip IN ['malware_c2_ips'] \| STATS COUNT() BY source.ip, http.user_agent, destination.ip HAVING COUNT() > 10`. |
| 7. High-Frequency Malware C2 Connections | High-frequency connections to malware C2 servers, as in APT41. | - Network Traffic (DS0003: Zeek HTTP)<br>- Metrics | - **Splunk**: `index=network sourcetype=zeek_http dest_ip IN (malware_c2_ips) \| timechart span=1m count by src_ip \| where count > 50`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "HTTP" and RemoteIP in (malwareC2IPs) \| summarize MinuteCount=count() by bin(Timestamp, 1m), DeviceIP \| where MinuteCount > 50`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE destination.ip IN ['malware_c2_ips'] \| STATS COUNT() BY date_histogram(@timestamp, '1m'), source.ip \| WHERE COUNT() > 50`. |
| 8. Malware Communication via Known Malicious IPs | Malware communicates with known malicious IPs, as in Volt Typhoon. | - Network Traffic (DS0003: Zeek HTTP)<br>- Threat Intelligence | - **Splunk**: `index=network sourcetype=zeek_http src_ip IN (threat_intel_ips) AND dest_ip IN (malware_c2_ips) \| stats count by src_ip, dest_ip \| where count > 10`.<br>- **KQL**: `DeviceNetworkEvents \| where DeviceIP in (threatIntelIPs) and RemoteIP in (malwareC2IPs) \| summarize count() by DeviceIP, RemoteIP \| where count_ > 10`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE source.ip IN ['threat_intel_ips'] AND destination.ip IN ['malware_c2_ips'] \| STATS COUNT() BY source.ip, destination.ip HAVING COUNT() > 10`. |
| 9. Malware DNS Queries to Suspicious Domains | Malware queries suspicious domains for C2, as in 2025 trends. | - DNS Logs (DS0001)<br>- Threat Intelligence | - **Splunk**: `index=dns sourcetype=zeek_dns query IN (malware_c2_domains) AND src_ip IN (threat_intel_ips) \| stats count by src_ip, query \| where count > 10`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "DNS" and DnsQueryName in (malwareC2Domains) and DeviceIP in (threatIntelIPs) \| summarize count() by DeviceIP, DnsQueryName \| where count_ > 10`.<br>- **ELK**: `FROM logs-zeek.dns-* \| WHERE dns.query IN ['malware_c2_domains'] AND source.ip IN ['threat_intel_ips'] \| STATS COUNT() BY source.ip, dns.query HAVING COUNT() > 10`. |
| 10. Malware Communication with Anomalous Ports | Malware uses non-standard ports for C2 communication, as in 2025 trends. | - Network Traffic (DS0003: Zeek Conn)<br>- Firewall Logs | - **Splunk**: `index=network sourcetype=zeek_conn dest_port NOT IN (80, 443) AND dest_ip IN (malware_c2_ips) \| stats count by src_ip, dest_ip, dest_port \| where count > 10`.<br>- **KQL**: `DeviceNetworkEvents \| where RemotePort !in (80, 443) and RemoteIP in (malwareC2IPs) \| summarize count() by DeviceIP, RemoteIP, RemotePort \| where count_ > 10`.<br>- **ELK**: `FROM logs-zeek.conn-* \| WHERE destination.port NOT IN [80, 443] AND destination.ip IN ['malware_c2_ips'] \| STATS COUNT() BY source.ip, destination.ip, destination.port HAVING COUNT() > 10`. |

### T1586: Compromise Accounts
