---
layout: default
title: Command and Control
category: Threat-Hunting-Queries  # This becomes a main topic in sidebar
---

## Command and Control

### Application Layer Protocol (T1071)

| Hypothesis | Description | Data Sources | Hunting Queries |
|------------|-------------|--------------|-----------------|
| 1. Anomalous HTTP Traffic for C2 Communication | Adversaries use HTTP/HTTPS for command and control, often with unusual patterns like high-frequency requests, as in Cobalt Strike beacons. High risk in Windows and cloud environments with limited visibility. | - Network Traffic (DS0003: Zeek HTTP)<br>- Proxy Logs | - **Splunk**: `index=network sourcetype=zeek_http method="POST" AND uri="*beacon*" \| timechart span=60s count by src_ip \| where count > 5` (Detects periodic beaconing).<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "HTTP" and AdditionalFields.Method == "POST" and RemoteUrl contains "beacon" \| summarize BeaconCount=count() by bin(Timestamp, 60s), DeviceIP \| where BeaconCount > 5`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE http.method = 'POST' AND http.uri : "*beacon*" \| STATS COUNT() BY date_histogram(@timestamp, '60s'), source.ip \| WHERE COUNT() > 5`. |
| 2. DNS Tunneling over Application Layer | Adversaries tunnel data over DNS (T1071.004), using long query strings for C2, as in APT41 attacks. | - DNS Logs (DS0003: Zeek DNS)<br>- Network Traffic | - **Splunk**: `index=network sourcetype=zeek_dns query_length > 200 AND NOT query IN (known_domains) \| stats count by src_ip, query \| where count > 10`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "DNS" and AdditionalFields.QueryLength > 200 and AdditionalFields.Query !in (knownDomains) \| summarize count() by DeviceIP, AdditionalFields.Query \| where count_ > 10`.<br>- **ELK**: `FROM logs-zeek.dns-* \| WHERE dns.query.length > 200 AND dns.query NOT IN ['known_domains'] \| STATS COUNT() BY source.ip, dns.query HAVING COUNT() > 10`. |
| 3. FTP C2 Communication | Adversaries use FTP for C2 (T1071.002), often for data exfiltration, as in FIN7. | - Network Traffic (DS0003: Zeek FTP)<br>- Proxy Logs | - **Splunk**: `index=network sourcetype=zeek_ftp command IN ("STOR", "RETR") AND dest_ip NOT IN (known_servers) \| stats count by src_ip, dest_ip \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "FTP" and AdditionalFields.Command in ("STOR", "RETR") and RemoteIP !in (knownServers) \| summarize count() by DeviceIP, RemoteIP \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.ftp-* \| WHERE ftp.command IN ['STOR', 'RETR'] AND destination.ip NOT IN ['known_servers'] \| STATS COUNT() BY source.ip, destination.ip HAVING COUNT() > 5`. |
| 4. SMTP C2 Communication | Adversaries use SMTP for C2 (T1071.003), sending emails to exfil data, as in APT41. | - Network Traffic (DS0003: Zeek SMTP)<br>- Email Logs | - **Splunk**: `index=network sourcetype=zeek_smtp attachment="*data*" AND src_ip NOT IN (known_clients) \| stats count by src_ip, recipient \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "SMTP" and AdditionalFields.Attachment contains "data" and DeviceIP !in (knownClients) \| summarize count() by DeviceIP, AdditionalFields.Recipient \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.smtp-* \| WHERE smtp.attachment : "*data*" AND source.ip NOT IN ['known_clients'] \| STATS COUNT() BY source.ip, smtp.recipient HAVING COUNT() > 5`. |
| 5. Application Layer Protocol Traffic from Compromised Endpoints | Compromised endpoints initiate application layer traffic for C2, as in Turla. | - Process Creation (Sysmon ID 1)<br>- Network Traffic | - **Splunk**: `index=endpoint sourcetype=sysmon EventCode=1 CommandLine="*http*" \| join host [search index=network sourcetype=zeek_http method="POST"] \| stats count by host, CommandLine, uri \| where count > 5`.<br>- **KQL**: `DeviceProcessEvents \| where ProcessCommandLine contains "http" \| join kind=inner (DeviceNetworkEvents \| where Protocol == "HTTP" and AdditionalFields.Method == "POST") on DeviceName \| summarize count() by DeviceName, ProcessCommandLine, RemoteUrl \| where count_ > 5`.<br>- **ELK**: `FROM logs-endpoint.process-* \| WHERE process.command_line : "*http*" \| JOIN logs-zeek.http-* ON host.name WHERE http.method = 'POST' \| STATS COUNT() BY host.name, process.command_line, http.uri HAVING COUNT() > 5`. |
| 6. C2 over WebSockets | Adversaries use WebSockets for bidirectional C2 (T1071.001), as in 2025 trends. | - Network Traffic (DS0003: Zeek WebSocket)<br>- Proxy Logs | - **Splunk**: `index=network sourcetype=zeek_websocket opcode=1 AND src_ip NOT IN (known_clients) \| stats count by src_ip, dest_ip \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "WebSocket" and AdditionalFields.OpCode == 1 and DeviceIP !in (knownClients) \| summarize count() by DeviceIP, RemoteIP \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.websocket-* \| WHERE websocket.opcode = 1 AND source.ip NOT IN ['known_clients'] \| STATS COUNT() BY source.ip, destination.ip HAVING COUNT() > 5`. |
| 7. C2 via HTTP with Encrypted Payloads | Encrypted HTTP payloads for C2, as in APT41. | - Network Traffic (DS0003: Zeek HTTP)<br>- Packet Analysis | - **Splunk**: `index=network sourcetype=zeek_http method="POST" AND payload_entropy > 7 \| stats count by src_ip, uri \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "HTTP" and AdditionalFields.Method == "POST" and AdditionalFields.PayloadEntropy > 7 \| summarize count() by DeviceIP, RemoteUrl \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE http.method = 'POST' AND http.payload.entropy > 7 \| STATS COUNT() BY source.ip, http.uri HAVING COUNT() > 5`. |
| 8. C2 via FTP with Unusual Ports | FTP C2 on non-standard ports, as in FIN7. | - Network Traffic (DS0003: Zeek FTP)<br>- Firewall Logs | - **Splunk**: `index=network sourcetype=zeek_ftp dest_port NOT IN (21, 22) \| stats count by src_ip, dest_port \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "FTP" and RemotePort !in (21, 22) \| summarize count() by DeviceIP, RemotePort \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.ftp-* \| WHERE destination.port NOT IN [21, 22] \| STATS COUNT() BY source.ip, destination.port HAVING COUNT() > 5`. |
| 9. C2 with Anomalous User Behavior | Application layer C2 by users with unusual patterns, as in 2025 trends. | - User Behavior Analytics (UBA)<br>- Network Traffic | - **Splunk**: `index=security sourcetype=uba:anomaly event_type="web_access" AND user NOT IN (known_users) \| join user [search index=network sourcetype=zeek_http method="POST"] \| stats count by user, src_ip, method \| where count > 3`.<br>- **KQL**: `UbaAnomalies \| where EventType == "web_access" and User !in (knownUsers) \| join kind=inner (DeviceNetworkEvents \| where Protocol == "HTTP" and AdditionalFields.Method == "POST") on UserId \| summarize count() by UserId, DeviceIP, AdditionalFields.Method \| where count_ > 3`.<br>- **ELK**: `FROM logs-uba.anomaly-* \| WHERE event.type = "web_access" AND user.name NOT IN ['known_users'] \| JOIN logs-zeek.http-* ON user.id WHERE http.method = 'POST' \| STATS COUNT() BY user.id, source.ip, http.method HAVING COUNT() > 3`. |
| 10. C2 via SMTP with Attachments | SMTP used for C2 with attachments, as in APT41. | - Network Traffic (DS0003: Zeek SMTP)<br>- Email Logs | - **Splunk**: `index=network sourcetype=zeek_smtp attachment="*payload*" \| stats count by src_ip, recipient \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "SMTP" and AdditionalFields.Attachment contains "payload" \| summarize count() by DeviceIP, AdditionalFields.Recipient \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.smtp-* \| WHERE smtp.attachment : "*payload*" \| STATS COUNT() BY source.ip, smtp.recipient HAVING COUNT() > 5`. |
| 11. C2 via FTP Data Channels | FTP data channels for C2, as in FIN7. | - Network Traffic (DS0003: Zeek FTP)<br>- Firewall Logs | - **Splunk**: `index=network sourcetype=zeek_ftp command="PORT" \| stats count by src_ip, dest_ip \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "FTP" and AdditionalFields.Command == "PORT" \| summarize count() by DeviceIP, RemoteIP \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.ftp-* \| WHERE ftp.command = 'PORT' \| STATS COUNT() BY source.ip, destination.ip HAVING COUNT() > 5`. |
| 12. C2 with Suspicious TLS Certificates | Application layer C2 using self-signed TLS certificates, as in APT41. | - Network Traffic (DS0003: Zeek SSL)<br>- Certificate Logs | - **Splunk**: `index=network sourcetype=zeek_ssl cert_issuer="CN=*" AND NOT cert_issuer IN (known_issuers) \| stats count by src_ip, cert_issuer \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "SSL" and AdditionalFields.CertIssuer contains "CN=" and AdditionalFields.CertIssuer !in (knownIssuers) \| summarize count() by DeviceIP, AdditionalFields.CertIssuer \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.ssl-* \| WHERE ssl.certificate.issuer : "CN=*" AND ssl.certificate.issuer NOT IN ['known_issuers'] \| STATS COUNT() BY source.ip, ssl.certificate.issuer HAVING COUNT() > 5`. |
| 13. C2 via Cloud API Calls | Adversaries use cloud APIs for C2, as in 2025 trends. | - Cloud Audit Logs (AWS CloudTrail)<br>- Network Traffic | - **Splunk**: `index=cloud sourcetype=aws:cloudtrail eventName="Invoke" AND userIdentity NOT IN (authorized_users) \| stats count by userIdentity, src_ip \| where count > 5`.<br>- **KQL**: `AWSCloudTrail \| where EventName == "Invoke" and Caller !in (authorizedUsers) \| summarize count() by Caller, SourceIP \| where count_ > 5`.<br>- **ELK**: `FROM logs-aws.cloudtrail-* \| WHERE event.action = 'Invoke' AND user.identity NOT IN ['authorized_users'] \| STATS COUNT() BY user.identity, source.ip HAVING COUNT() > 5`. |
| 14. C2 with Multi-Stage Payloads | Multi-stage HTTP payloads for C2, as in APT41. | - Network Traffic (DS0003: Zeek HTTP)<br>- Packet Analysis | - **Splunk**: `index=network sourcetype=zeek_http method="GET" AND uri="*stage1*" \| stats count by src_ip, uri \| where count > 3`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "HTTP" and AdditionalFields.Method == "GET" and RemoteUrl contains "stage1" \| summarize count() by DeviceIP, RemoteUrl \| where count_ > 3`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE http.method = 'GET' AND http.uri : "*stage1*" \| STATS COUNT() BY source.ip, http.uri HAVING COUNT() > 3`. |
| 15. C2 with Suspicious Headers | HTTP C2 with custom headers, as in Cobalt Strike. | - Network Traffic (DS0003: Zeek HTTP)<br>- Proxy Logs | - **Splunk**: `index=network sourcetype=zeek_http header IN ("*X-Cobalt*", "*Custom-Header*") \| stats count by src_ip, header \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "HTTP" and AdditionalFields.Header has_any ("X-Cobalt", "Custom-Header") \| summarize count() by DeviceIP, AdditionalFields.Header \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE http.header : ("*X-Cobalt*" OR "*Custom-Header*") \| STATS COUNT() BY source.ip, http.header HAVING COUNT() > 5`. |

### Asymmetric Cryptography (T1573.002)

| Hypothesis | Description | Data Sources | Hunting Queries |
|------------|-------------|--------------|-----------------|
| 1. Suspicious Asymmetric Encryption in Traffic | Adversaries use asymmetric cryptography for C2 channels, as in APT41. High risk in encrypted traffic without standard certs. | - Network Traffic (DS0003: Zeek SSL)<br>- Certificate Logs | - **Splunk**: `index=network sourcetype=zeek_ssl cert_algorithm="RSA" AND cert_issuer NOT IN (known_issuers) \| stats count by src_ip, cert_algorithm \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "SSL" and AdditionalFields.CertAlgorithm == "RSA" and AdditionalFields.CertIssuer !in (knownIssuers) \| summarize count() by DeviceIP, AdditionalFields.CertAlgorithm \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.ssl-* \| WHERE ssl.certificate.algorithm = 'RSA' AND ssl.certificate.issuer NOT IN ['known_issuers'] \| STATS COUNT() BY source.ip, ssl.certificate.algorithm HAVING COUNT() > 5`. |
| 2. C2 with Custom Asymmetric Keys | Custom asymmetric keys for C2, as in Turla. | - Network Traffic (DS0003: Zeek SSL)<br>- Packet Analysis | - **Splunk**: `index=network sourcetype=zeek_ssl cert_key_length NOT IN (1024, 2048) \| stats count by src_ip, cert_key_length \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "SSL" and AdditionalFields.CertKeyLength !in (1024, 2048) \| summarize count() by DeviceIP, AdditionalFields.CertKeyLength \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.ssl-* \| WHERE ssl.certificate.key.length NOT IN [1024, 2048] \| STATS COUNT() BY source.ip, ssl.certificate.key.length HAVING COUNT() > 5`. |
| 3. Asymmetric Encryption in Non-Standard Ports | Asymmetric encryption on non-HTTPS ports for C2, as in APT41. | - Network Traffic (DS0003: Zeek Conn)<br>- SSL Logs | - **Splunk**: `index=network sourcetype=zeek_conn dest_port NOT IN (443) AND protocol="ssl" \| stats count by src_ip, dest_port \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "SSL" and RemotePort !in (443) \| summarize count() by DeviceIP, RemotePort \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.conn-* \| WHERE network.protocol = 'ssl' AND destination.port NOT IN [443] \| STATS COUNT() BY source.ip, destination.port HAVING COUNT() > 5`. |
| 4. C2 with Asymmetric Key Exchange Anomalies | Anomalous key exchanges in asymmetric C2, as in 2025 trends. | - Network Traffic (DS0003: Zeek SSL)<br>- Packet Analysis | - **Splunk**: `index=network sourcetype=zeek_ssl handshake_time < 100 AND src_ip NOT IN (known_clients) \| stats count by src_ip \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "SSL" and AdditionalFields.HandshakeTime < 100 and DeviceIP !in (knownClients) \| summarize count() by DeviceIP \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.ssl-* \| WHERE ssl.handshake.time < 100 AND source.ip NOT IN ['known_clients'] \| STATS COUNT() BY source.ip HAVING COUNT() > 5`. |
| 5. Asymmetric C2 with Self-Signed Certs | Self-signed certificates in C2 traffic, as in Turla. | - Network Traffic (DS0003: Zeek SSL)<br>- Certificate Logs | - **Splunk**: `index=network sourcetype=zeek_ssl cert_issuer=cert_subject \| stats count by src_ip, cert_issuer \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "SSL" and AdditionalFields.CertIssuer == AdditionalFields.CertSubject \| summarize count() by DeviceIP, AdditionalFields.CertIssuer \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.ssl-* \| WHERE ssl.certificate.issuer = ssl.certificate.subject \| STATS COUNT() BY source.ip, ssl.certificate.issuer HAVING COUNT() > 5`. |
| 6. C2 with Asymmetric Encryption in Cloud | Asymmetric C2 in cloud environments, as in APT41. | - Cloud Audit Logs (AWS CloudTrail)<br>- Network Traffic | - **Splunk**: `index=cloud sourcetype=aws:cloudtrail eventName="Decrypt" AND userIdentity NOT IN (authorized_users) \| stats count by userIdentity, src_ip \| where count > 5`.<br>- **KQL**: `AWSCloudTrail \| where EventName == "Decrypt" and Caller !in (authorizedUsers) \| summarize count() by Caller, SourceIP \| where count_ > 5`.<br>- **ELK**: `FROM logs-aws.cloudtrail-* \| WHERE event.action = 'Decrypt' AND user.identity NOT IN ['authorized_users'] \| STATS COUNT() BY user.identity, source.ip HAVING COUNT() > 5`. |
| 7. C2 with Asymmetric Key Reuse | Reuse of asymmetric keys in C2 traffic, as in FIN7. | - Network Traffic (DS0003: Zeek SSL)<br>- Certificate Logs | - **Splunk**: `index=network sourcetype=zeek_ssl cert_fingerprint=duplicate \| stats count by cert_fingerprint \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "SSL" and AdditionalFields.CertFingerprint == "duplicate" \| summarize count() by AdditionalFields.CertFingerprint \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.ssl-* \| WHERE ssl.certificate.fingerprint = 'duplicate' \| STATS COUNT() BY ssl.certificate.fingerprint HAVING COUNT() > 5`. |
| 8. C2 with Asymmetric Encryption Anomalies | Anomalous asymmetric encryption in traffic, as in 2025 trends. | - Network Traffic (DS0003: Zeek SSL)<br>- Packet Analysis | - **Splunk**: `index=network sourcetype=zeek_ssl cert_algorithm NOT IN (known_algorithms) \| stats count by src_ip, cert_algorithm \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "SSL" and AdditionalFields.CertAlgorithm !in (knownAlgorithms) \| summarize count() by DeviceIP, AdditionalFields.CertAlgorithm \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.ssl-* \| WHERE ssl.certificate.algorithm NOT IN ['known_algorithms'] \| STATS COUNT() BY source.ip, ssl.certificate.algorithm HAVING COUNT() > 5`. |
| 9. C2 with Asymmetric Encryption in Non-Standard Environments | Asymmetric C2 in Linux environments, as in Turla. | - Network Traffic (DS0003: Zeek SSL)<br>- Linux Logs | - **Splunk**: `index=linux sourcetype=auditd syscall="connect" AND dest_port=443 AND exe NOT IN (known_apps) \| stats count by exe, dest_ip \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "SSL" and RemotePort == 443 and InitiatingProcessName !in (knownApps) \| summarize count() by InitiatingProcessName, RemoteIP \| where count_ > 5`.<br>- **ELK**: `FROM logs-auditd-* \| WHERE syscall.name = "connect" AND destination.port = 443 AND process.exe NOT IN ['known_apps'] \| STATS COUNT() BY process.exe, destination.ip HAVING COUNT() > 5`. |
| 10. C2 with Asymmetric Encryption and Data Exfiltration | Asymmetric C2 with data exfil, as in APT41. | - Network Traffic (DS0003: Zeek SSL)<br>- File Logs | - **Splunk**: `index=network sourcetype=zeek_ssl bytes_out>1000000 \| join src_ip [search index=endpoint sourcetype=sysmon EventCode=11 "*exfil*"] \| stats count by src_ip, bytes_out \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "SSL" and OutboundBytes > 1000000 \| join kind=inner (DeviceFileEvents \| where FileName contains "exfil") on DeviceIP \| summarize count() by DeviceIP, OutboundBytes \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.ssl-* \| WHERE network.bytes_out > 1000000 \| JOIN logs-endpoint.file-* ON source.ip WHERE file.name : "*exfil*" \| STATS COUNT() BY source.ip, network.bytes_out HAVING COUNT() > 5`. |
| 11. C2 with Asymmetric Encryption in Cloud | Asymmetric C2 in cloud, as in 2025 trends. | - Cloud Audit Logs (AWS CloudTrail)<br>- Network Traffic | - **Splunk**: `index=cloud sourcetype=aws:cloudtrail eventName="Decrypt" AND userIdentity NOT IN (authorized_users) \| stats count by userIdentity, src_ip \| where count > 5`.<br>- **KQL**: `AWSCloudTrail \| where EventName == "Decrypt" and Caller !in (authorizedUsers) \| summarize count() by Caller, SourceIP \| where count_ > 5`.<br>- **ELK**: `FROM logs-aws.cloudtrail-* \| WHERE event.action = 'Decrypt' AND user.identity NOT IN ['authorized_users'] \| STATS COUNT() BY user.identity, source.ip HAVING COUNT() > 5`. |
| 12. C2 with Asymmetric Key Reuse | Key reuse in asymmetric C2, as in FIN7. | - Network Traffic (DS0003: Zeek SSL)<br>- Certificate Logs | - **Splunk**: `index=network sourcetype=zeek_ssl cert_fingerprint=duplicate \| stats count by cert_fingerprint \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "SSL" and AdditionalFields.CertFingerprint == "duplicate" \| summarize count() by AdditionalFields.CertFingerprint \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.ssl-* \| WHERE ssl.certificate.fingerprint = 'duplicate' \| STATS COUNT() BY ssl.certificate.fingerprint HAVING COUNT() > 5`. |
| 13. C2 with Asymmetric Encryption Anomalies | Anomalous asymmetric encryption, as in 2025 trends. | - Network Traffic (DS0003: Zeek SSL)<br>- Packet Analysis | - **Splunk**: `index=network sourcetype=zeek_ssl cert_algorithm NOT IN (known_algorithms) \| stats count by src_ip, cert_algorithm \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "SSL" and AdditionalFields.CertAlgorithm !in (knownAlgorithms) \| summarize count() by DeviceIP, AdditionalFields.CertAlgorithm \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.ssl-* \| WHERE ssl.certificate.algorithm NOT IN ['known_algorithms'] \| STATS COUNT() BY source.ip, ssl.certificate.algorithm HAVING COUNT() > 5`. |
| 14. C2 with Asymmetric Encryption in Non-Standard Environments | Asymmetric C2 in Linux, as in Turla. | - Network Traffic (DS0003: Zeek SSL)<br>- Linux Logs | - **Splunk**: `index=linux sourcetype=auditd syscall="connect" AND dest_port=443 AND exe NOT IN (known_apps) \| stats count by exe, dest_ip \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "SSL" and RemotePort == 443 and InitiatingProcessName !in (knownApps) \| summarize count() by InitiatingProcessName, RemoteIP \| where count_ > 5`.<br>- **ELK**: `FROM logs-auditd-* \| WHERE syscall.name = "connect" AND destination.port = 443 AND process.exe NOT IN ['known_apps'] \| STATS COUNT() BY process.exe, destination.ip HAVING COUNT() > 5`. |
| 15. C2 with Asymmetric Encryption and Data Exfiltration | Asymmetric C2 with exfil, as in APT41. | - Network Traffic (DS0003: Zeek SSL)<br>- File Logs | - **Splunk**: `index=network sourcetype=zeek_ssl bytes_out>1000000 \| join src_ip [search index=endpoint sourcetype=sysmon EventCode=11 "*exfil*"] \| stats count by src_ip, bytes_out \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "SSL" and OutboundBytes > 1000000 \| join kind=inner (DeviceFileEvents \| where FileName contains "exfil") on DeviceIP \| summarize count() by DeviceIP, OutboundBytes \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.ssl-* \| WHERE network.bytes_out > 1000000 \| JOIN logs-endpoint.file-* ON source.ip WHERE file.name : "*exfil*" \| STATS COUNT() BY source.ip, network.bytes_out HAVING COUNT() > 5`. |

### Bidirectional Communication (T1102.002)

| Hypothesis | Description | Data Sources | Hunting Queries |
|------------|-------------|--------------|-----------------|
| 1. Bidirectional C2 via Web Services | Adversaries use web services for bidirectional C2, as in Cobalt Strike. | - Network Traffic (DS0003: Zeek HTTP)<br>- Proxy Logs | - **Splunk**: `index=network sourcetype=zeek_http method IN ("GET", "POST") AND uri="*c2*" \| stats count by src_ip, method \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "HTTP" and AdditionalFields.Method in ("GET", "POST") and RemoteUrl contains "c2" \| summarize count() by DeviceIP, AdditionalFields.Method \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE http.method IN ['GET', 'POST'] AND http.uri : "*c2*" \| STATS COUNT() BY source.ip, http.method HAVING COUNT() > 5`. |
| 2. Bidirectional C2 with Data Exfil | Bidirectional C2 with exfil, as in APT41. | - Network Traffic (DS0003: Zeek HTTP)<br>- File Logs | - **Splunk**: `index=network sourcetype=zeek_http method="POST" AND bytes_out>1000000 \| stats count by src_ip, uri \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "HTTP" and AdditionalFields.Method == "POST" and OutboundBytes > 1000000 \| summarize count() by DeviceIP, RemoteUrl \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE http.method = 'POST' AND network.bytes_out > 1000000 \| STATS COUNT() BY source.ip, http.uri HAVING COUNT() > 5`. |
| 3. Bidirectional C2 with Anomalous Timing | Bidirectional C2 with unusual timing, as in 2025 trends. | - Network Traffic (DS0003: Zeek HTTP)<br>- Metrics | - **Splunk**: `index=network sourcetype=zeek_http method IN ("GET", "POST") \| timechart span=1h count by src_ip \| where count > avg(count)*4`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "HTTP" and AdditionalFields.Method in ("GET", "POST") \| summarize HourlyCount=count() by bin(Timestamp, 1h), DeviceIP \| where HourlyCount > avg(HourlyCount) * 4`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE http.method IN ['GET', 'POST'] \| STATS COUNT() BY date_histogram(@timestamp, '1h'), source.ip \| WHERE COUNT() > AVG(COUNT()) * 4`. |
| 4. Bidirectional C2 via Cloud Services | Bidirectional C2 via cloud, as in APT41. | - Cloud Audit Logs (AWS CloudTrail)<br>- Network Traffic | - **Splunk**: `index=cloud sourcetype=aws:cloudtrail eventName="Invoke" AND userIdentity NOT IN (authorized_users) \| stats count by userIdentity, src_ip \| where count > 5`.<br>- **KQL**: `AWSCloudTrail \| where EventName == "Invoke" and Caller !in (authorizedUsers) \| summarize count() by Caller, SourceIP \| where count_ > 5`.<br>- **ELK**: `FROM logs-aws.cloudtrail-* \| WHERE event.action = 'Invoke' AND user.identity NOT IN ['authorized_users'] \| STATS COUNT() BY user.identity, source.ip HAVING COUNT() > 5`. |
| 5. Bidirectional C2 with Suspicious Headers | Bidirectional C2 with custom headers, as in Cobalt Strike. | - Network Traffic (DS0003: Zeek HTTP)<br>- Proxy Logs | - **Splunk**: `index=network sourcetype=zeek_http header IN ("*X-Cobalt*", "*Custom-Header*") \| stats count by src_ip, header \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "HTTP" and AdditionalFields.Header has_any ("X-Cobalt", "Custom-Header") \| summarize count() by DeviceIP, AdditionalFields.Header \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE http.header : ("*X-Cobalt*" OR "*Custom-Header*") \| STATS COUNT() BY source.ip, http.header HAVING COUNT() > 5`. |
| 6. Bidirectional C2 via Web Sockets | Bidirectional C2 via WebSockets, as in 2025 trends. | - Network Traffic (DS0003: Zeek WebSocket)<br>- Proxy Logs | - **Splunk**: `index=network sourcetype=zeek_websocket opcode=1 AND src_ip NOT IN (known_clients) \| stats count by src_ip, dest_ip \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "WebSocket" and AdditionalFields.OpCode == 1 and DeviceIP !in (knownClients) \| summarize count() by DeviceIP, RemoteIP \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.websocket-* \| WHERE websocket.opcode = 1 AND source.ip NOT IN ['known_clients'] \| STATS COUNT() BY source.ip, destination.ip HAVING COUNT() > 5`. |
| 7. Bidirectional C2 with Encrypted Payloads | Encrypted payloads in bidirectional C2, as in APT41. | - Network Traffic (DS0003: Zeek HTTP)<br>- Packet Analysis | - **Splunk**: `index=network sourcetype=zeek_http method="POST" AND payload_entropy > 7 \| stats count by src_ip, uri \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "HTTP" and AdditionalFields.Method == "POST" and AdditionalFields.PayloadEntropy > 7 \| summarize count() by DeviceIP, RemoteUrl \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE http.method = 'POST' AND http.payload.entropy > 7 \| STATS COUNT() BY source.ip, http.uri HAVING COUNT() > 5`. |
| 8. Bidirectional C2 via Non-Standard Ports | Bidirectional C2 on non-standard ports, as in FIN7. | - Network Traffic (DS0003: Zeek Conn)<br>- Firewall Logs | - **Splunk**: `index=network sourcetype=zeek_conn dest_port NOT IN (80, 443) \| stats count by src_ip, dest_port \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where RemotePort !in (80, 443) \| summarize count() by DeviceIP, RemotePort \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.conn-* \| WHERE destination.port NOT IN [80, 443] \| STATS COUNT() BY source.ip, destination.port HAVING COUNT() > 5`. |
| 9. Bidirectional C2 with Anomalous User Agents | Bidirectional C2 with unusual user agents, as in Cobalt Strike. | - Network Traffic (DS0003: Zeek HTTP)<br>- Proxy Logs | - **Splunk**: `index=network sourcetype=zeek_http user_agent NOT IN (known_agents) \| stats count by src_ip, user_agent \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "HTTP" and AdditionalFields.UserAgent !in (knownAgents) \| summarize count() by DeviceIP, AdditionalFields.UserAgent \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE http.user_agent NOT IN ['known_agents'] \| STATS COUNT() BY source.ip, http.user_agent HAVING COUNT() > 5`. |
| 10. Bidirectional C2 via Cloud Services | Bidirectional C2 via cloud, as in APT41. | - Cloud Audit Logs (AWS CloudTrail)<br>- Network Traffic | - **Splunk**: `index=cloud sourcetype=aws:cloudtrail eventName="Invoke" AND userIdentity NOT IN (authorized_users) \| stats count by userIdentity, src_ip \| where count > 5`.<br>- **KQL**: `AWSCloudTrail \| where EventName == "Invoke" and Caller !in (authorizedUsers) \| summarize count() by Caller, SourceIP \| where count_ > 5`.<br>- **ELK**: `FROM logs-aws.cloudtrail-* \| WHERE event.action = 'Invoke' AND user.identity NOT IN ['authorized_users'] \| STATS COUNT() BY user.identity, source.ip HAVING COUNT() > 5`. |
| 11. Bidirectional C2 with Suspicious Headers | Bidirectional C2 with custom headers, as in Cobalt Strike. | - Network Traffic (DS0003: Zeek HTTP)<br>- Proxy Logs | - **Splunk**: `index=network sourcetype=zeek_http header IN ("*X-Cobalt*", "*Custom-Header*") \| stats count by src_ip, header \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "HTTP" and AdditionalFields.Header has_any ("X-Cobalt", "Custom-Header") \| summarize count() by DeviceIP, AdditionalFields.Header \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE http.header : ("*X-Cobalt*" OR "*Custom-Header*") \| STATS COUNT() BY source.ip, http.header HAVING COUNT() > 5`. |
| 12. Bidirectional C2 via Web Sockets | Bidirectional C2 via WebSockets, as in 2025 trends. | - Network Traffic (DS0003: Zeek WebSocket)<br>- Proxy Logs | - **Splunk**: `index=network sourcetype=zeek_websocket opcode=1 AND src_ip NOT IN (known_clients) \| stats count by src_ip, dest_ip \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "WebSocket" and AdditionalFields.OpCode == 1 and DeviceIP !in (knownClients) \| summarize count() by DeviceIP, RemoteIP \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.websocket-* \| WHERE websocket.opcode = 1 AND source.ip NOT IN ['known_clients'] \| STATS COUNT() BY source.ip, destination.ip HAVING COUNT() > 5`. |
| 13. Bidirectional C2 with Encrypted Payloads | Encrypted payloads in bidirectional C2, as in APT41. | - Network Traffic (DS0003: Zeek HTTP)<br>- Packet Analysis | - **Splunk**: `index=network sourcetype=zeek_http method="POST" AND payload_entropy > 7 \| stats count by src_ip, uri \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "HTTP" and AdditionalFields.Method == "POST" and AdditionalFields.PayloadEntropy > 7 \| summarize count() by DeviceIP, RemoteUrl \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE http.method = 'POST' AND http.payload.entropy > 7 \| STATS COUNT() BY source.ip, http.uri HAVING COUNT() > 5`. |
| 14. Bidirectional C2 via Non-Standard Ports | Bidirectional C2 on non-standard ports, as in FIN7. | - Network Traffic (DS0003: Zeek Conn)<br>- Firewall Logs | - **Splunk**: `index=network sourcetype=zeek_conn dest_port NOT IN (80, 443) \| stats count by src_ip, dest_port \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where RemotePort !in (80, 443) \| summarize count() by DeviceIP, RemotePort \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.conn-* \| WHERE destination.port NOT IN [80, 443] \| STATS COUNT() BY source.ip, destination.port HAVING COUNT() > 5`. |
| 15. Bidirectional C2 with Anomalous User Agents | Bidirectional C2 with unusual user agents, as in Cobalt Strike. | - Network Traffic (DS0003: Zeek HTTP)<br>- Proxy Logs | - **Splunk**: `index=network sourcetype=zeek_http user_agent NOT IN (known_agents) \| stats count by src_ip, user_agent \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "HTTP" and AdditionalFields.UserAgent !in (knownAgents) \| summarize count() by DeviceIP, AdditionalFields.UserAgent \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE http.user_agent NOT IN ['known_agents'] \| STATS COUNT() BY source.ip, http.user_agent HAVING COUNT() > 5`.

### Commonly Used Port (T1571)

| Hypothesis | Description | Data Sources | Hunting Queries |
|------------|-------------|--------------|-----------------|
| 1. C2 Over Common Ports | Adversaries use common ports (e.g., 80, 443) for C2 to blend with legitimate traffic, as in APT41 campaigns. High risk in environments with limited traffic inspection. | - Network Traffic (DS0003: Zeek Conn)<br>- Firewall Logs | - **Splunk**: `index=network sourcetype=zeek_conn dest_port IN (80, 443) AND bytes_out > 100000 AND src_ip NOT IN (known_servers) \| stats count by src_ip, dest_port \| where count > 5` (Detects high-volume outbound traffic on common ports).<br>- **KQL**: `DeviceNetworkEvents \| where RemotePort in (80, 443) and OutboundBytes > 100000 and RemoteIP !in (knownServers) \| summarize count() by DeviceIP, RemotePort \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.conn-* \| WHERE destination.port IN [80, 443] AND network.bytes_out > 100000 AND destination.ip NOT IN ['known_servers'] \| STATS COUNT() BY source.ip, destination.port HAVING COUNT() > 5`. |
| 2. C2 on Non-Standard Ports | Adversaries use non-standard ports for C2 to evade detection, as in Turla attacks. | - Network Traffic (DS0003: Zeek Conn)<br>- Firewall Logs | - **Splunk**: `index=network sourcetype=zeek_conn dest_port NOT IN (80, 443, 53) AND bytes > 10000 \| stats count by src_ip, dest_port \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where RemotePort !in (80, 443, 53) and TotalBytes > 10000 \| summarize count() by DeviceIP, RemotePort \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.conn-* \| WHERE destination.port NOT IN [80, 443, 53] AND network.bytes > 10000 \| STATS COUNT() BY source.ip, destination.port HAVING COUNT() > 5`. |
| 3. C2 on Well-Known Ports with Anomalous Traffic | Traffic on common ports (e.g., 80) with non-HTTP protocol, indicating masquerading, as in APT41. | - Network Traffic (DS0003: Zeek Conn)<br>- Protocol Analysis | - **Splunk**: `index=network sourcetype=zeek_conn dest_port=80 AND protocol!="http" \| stats count by src_ip, dest_ip \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where RemotePort == 80 and Protocol != "HTTP" \| summarize count() by DeviceIP, RemoteIP \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.conn-* \| WHERE destination.port = 80 AND network.protocol != 'http' \| STATS COUNT() BY source.ip, destination.ip HAVING COUNT() > 5`. |
| 4. C2 on Common Ports with High Frequency | High-frequency connections on common ports, indicating beaconing, as in Cobalt Strike. | - Network Traffic (DS0003: Zeek Conn)<br>- Metrics | - **Splunk**: `index=network sourcetype=zeek_conn dest_port IN (80, 443) \| timechart span=60s count by src_ip \| where count > avg(count)*4`.<br>- **KQL**: `DeviceNetworkEvents \| where RemotePort in (80, 443) \| summarize HourlyCount=count() by bin(Timestamp, 60s), DeviceIP \| where HourlyCount > avg(HourlyCount) * 4`.<br>- **ELK**: `FROM logs-zeek.conn-* \| WHERE destination.port IN [80, 443] \| STATS COUNT() BY date_histogram(@timestamp, '60s'), source.ip \| WHERE COUNT() > AVG(COUNT()) * 4`. |
| 5. C2 on Common Ports with Suspicious User Agents | C2 traffic on common ports with unusual user agents, as in APT41. | - Network Traffic (DS0003: Zeek HTTP)<br>- Proxy Logs | - **Splunk**: `index=network sourcetype=zeek_http dest_port IN (80, 443) AND user_agent NOT IN (known_agents) \| stats count by src_ip, user_agent \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where RemotePort in (80, 443) and AdditionalFields.UserAgent !in (knownAgents) \| summarize count() by DeviceIP, AdditionalFields.UserAgent \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE destination.port IN [80, 443] AND http.user_agent NOT IN ['known_agents'] \| STATS COUNT() BY source.ip, http.user_agent HAVING COUNT() > 5`. |
| 6. C2 on Common Ports from Compromised Endpoints | C2 traffic on common ports from endpoints with suspicious processes, as in FIN7. | - Process Creation (DS0009: Sysmon ID 1)<br>- Network Traffic | - **Splunk**: `index=endpoint sourcetype=sysmon EventCode=1 CommandLine="*c2*" \| join host [search index=network sourcetype=zeek_conn dest_port IN (80, 443)] \| stats count by host, CommandLine, dest_ip \| where count > 3`.<br>- **KQL**: `DeviceProcessEvents \| where ProcessCommandLine contains "c2" \| join kind=inner (DeviceNetworkEvents \| where RemotePort in (80, 443)) on DeviceName \| summarize count() by DeviceName, ProcessCommandLine, RemoteIP \| where count_ > 3`.<br>- **ELK**: `FROM logs-endpoint.process-* \| WHERE process.command_line : "*c2*" \| JOIN logs-zeek.conn-* ON host.name WHERE destination.port IN [80, 443] \| STATS COUNT() BY host.name, process.command_line, destination.ip HAVING COUNT() > 3`. |
| 7. C2 on Common Ports with Encrypted Payloads | Encrypted payloads on common ports, as in 2025 trends. | - Network Traffic (DS0003: Zeek HTTP)<br>- Packet Analysis | - **Splunk**: `index=network sourcetype=zeek_http dest_port IN (80, 443) AND payload_entropy > 7 \| stats count by src_ip, uri \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where RemotePort in (80, 443) and AdditionalFields.PayloadEntropy > 7 \| summarize count() by DeviceIP, RemoteUrl \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE destination.port IN [80, 443] AND http.payload.entropy > 7 \| STATS COUNT() BY source.ip, http.uri HAVING COUNT() > 5`. |
| 8. C2 on Common Ports in Linux Environments | C2 on common ports in Linux, as in Turla. | - Network Traffic (DS0003: Zeek Conn)<br>- Linux Logs | - **Splunk**: `index=linux sourcetype=auditd syscall="connect" AND dest_port IN (80, 443) AND exe NOT IN (known_apps) \| stats count by exe, dest_ip \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where RemotePort in (80, 443) and InitiatingProcessName !in (knownApps) \| summarize count() by InitiatingProcessName, RemoteIP \| where count_ > 5`.<br>- **ELK**: `FROM logs-auditd-* \| WHERE syscall.name = "connect" AND destination.port IN [80, 443] AND process.exe NOT IN ['known_apps'] \| STATS COUNT() BY process.exe, destination.ip HAVING COUNT() > 5`. |
| 9. C2 on Common Ports with Anomalous Timing | C2 on common ports with unusual timing, as in 2025 trends. | - Network Traffic (DS0003: Zeek Conn)<br>- Metrics | - **Splunk**: `index=network sourcetype=zeek_conn dest_port IN (80, 443) \| timechart span=1h count \| where count > avg(count)*4`.<br>- **KQL**: `DeviceNetworkEvents \| where RemotePort in (80, 443) \| summarize HourlyCount=count() by bin(Timestamp, 1h) \| where HourlyCount > avg(HourlyCount) * 4`.<br>- **ELK**: `FROM logs-zeek.conn-* \| WHERE destination.port IN [80, 443] \| STATS COUNT() BY date_histogram(@timestamp, '1h') \| WHERE COUNT() > AVG(COUNT()) * 4`. |
| 10. C2 on Common Ports with Suspicious Headers | C2 on common ports with custom headers, as in Cobalt Strike. | - Network Traffic (DS0003: Zeek HTTP)<br>- Proxy Logs | - **Splunk**: `index=network sourcetype=zeek_http dest_port IN (80, 443) AND header IN ("*X-Cobalt*", "*Custom-Header*") \| stats count by src_ip, header \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where RemotePort in (80, 443) and AdditionalFields.Header has_any ("X-Cobalt", "Custom-Header") \| summarize count() by DeviceIP, AdditionalFields.Header \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE destination.port IN [80, 443] AND http.header : ("*X-Cobalt*" OR "*Custom-Header*") \| STATS COUNT() BY source.ip, http.header HAVING COUNT() > 5`. |
| 11. C2 on Common Ports with Encrypted Payloads | Encrypted payloads on common ports, as in APT41. | - Network Traffic (DS0003: Zeek HTTP)<br>- Packet Analysis | - **Splunk**: `index=network sourcetype=zeek_http dest_port IN (80, 443) AND payload_entropy > 7 \| stats count by src_ip, uri \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where RemotePort in (80, 443) and AdditionalFields.PayloadEntropy > 7 \| summarize count() by DeviceIP, RemoteUrl \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE destination.port IN [80, 443] AND http.payload.entropy > 7 \| STATS COUNT() BY source.ip, http.uri HAVING COUNT() > 5`. |
| 12. C2 on Common Ports in Cloud Environments | C2 on common ports in cloud, as in 2025 trends. | - Cloud Audit Logs (AWS CloudTrail)<br>- Network Traffic | - **Splunk**: `index=cloud sourcetype=aws:cloudtrail eventName="Invoke" AND userIdentity NOT IN (authorized_users) \| stats count by userIdentity, src_ip \| where count > 5`.<br>- **KQL**: `AWSCloudTrail \| where EventName == "Invoke" and Caller !in (authorizedUsers) \| summarize count() by Caller, SourceIP \| where count_ > 5`.<br>- **ELK**: `FROM logs-aws.cloudtrail-* \| WHERE event.action = 'Invoke' AND user.identity NOT IN ['authorized_users'] \| STATS COUNT() BY user.identity, source.ip HAVING COUNT() > 5`. |
| 13. C2 on Common Ports with Anomalous User Agents | C2 with unusual user agents on common ports, as in Cobalt Strike. | - Network Traffic (DS0003: Zeek HTTP)<br>- Proxy Logs | - **Splunk**: `index=network sourcetype=zeek_http dest_port IN (80, 443) AND user_agent NOT IN (known_agents) \| stats count by src_ip, user_agent \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where RemotePort in (80, 443) and AdditionalFields.UserAgent !in (knownAgents) \| summarize count() by DeviceIP, AdditionalFields.UserAgent \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE destination.port IN [80, 443] AND http.user_agent NOT IN ['known_agents'] \| STATS COUNT() BY source.ip, http.user_agent HAVING COUNT() > 5`. |
| 14. C2 on Common Ports with Multi-Stage Redirects | C2 with redirects on common ports, as in APT41. | - Network Traffic (DS0003: Zeek HTTP)<br>- Redirect Analysis | - **Splunk**: `index=network sourcetype=zeek_http dest_port IN (80, 443) AND status_code=302 \| stats count by src_ip, uri \| where count > 3`.<br>- **KQL**: `DeviceNetworkEvents \| where RemotePort in (80, 443) and AdditionalFields.StatusCode == 302 \| summarize count() by DeviceIP, RemoteUrl \| where count_ > 3`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE destination.port IN [80, 443] AND http.status = 302 \| STATS COUNT() BY source.ip, http.uri HAVING COUNT() > 3`. |
| 15. C2 on Common Ports with Anomalous Timing | C2 with unusual timing on common ports, as in 2025 trends. | - Network Traffic (DS0003: Zeek Conn)<br>- Metrics | - **Splunk**: `index=network sourcetype=zeek_conn dest_port IN (80, 443) \| timechart span=1h count \| where count > avg(count)*4`.<br>- **KQL**: `DeviceNetworkEvents \| where RemotePort in (80, 443) \| summarize HourlyCount=count() by bin(Timestamp, 1h) \| where HourlyCount > avg(HourlyCount) * 4`.<br>- **ELK**: `FROM logs-zeek.conn-* \| WHERE destination.port IN [80, 443] \| STATS COUNT() BY date_histogram(@timestamp, '1h') \| WHERE COUNT() > AVG(COUNT()) * 4`. |

### Communication Through Removable Media (T1092)

| Hypothesis | Description | Data Sources | Hunting Queries |
|------------|-------------|--------------|-----------------|
| 1. Suspicious Removable Media Insertion | Adversaries use removable media for C2, as in APT41. High risk in environments with USB devices. | - Device Insertion (DS0001: Windows Event ID 2003)<br>- File Access | - **Splunk**: `index=windows EventID=2003 DriveType="Removable" AND NOT User IN (authorized_users) \| stats count by DriveLetter, User, host \| where count > 3`.<br>- **KQL**: `DeviceEvents \| where ActionType == "UsbDriveMounted" and AdditionalFields.DriveType == "Removable" and AccountName !in (authorizedUsers) \| summarize count() by AdditionalFields.DriveLetter, AccountName, DeviceName \| where count_ > 3`.<br>- **ELK**: `FROM logs-windows-* \| WHERE winlog.event_id = 2003 AND drive.type = 'Removable' AND user.name NOT IN ['authorized_users'] \| STATS COUNT() BY drive.letter, user.name, host.name HAVING COUNT() > 3`. |
| 2. C2 via USB Data Channels | C2 through USB data channels, as in FIN7. | - File Access (DS0022: Sysmon ID 11)<br>- Network Traffic | - **Splunk**: `index=endpoint sourcetype=sysmon EventCode=11 TargetFilename IN ("D:\\*", "E:\\*") AND ProcessImage="*c2*" \| stats count by TargetFilename, ProcessImage, host \| where count > 3`.<br>- **KQL**: `DeviceFileEvents \| where ActionType == "FileAccessed" and FolderPath has_any ("D:\\", "E:\\") and InitiatingProcessFolderPath contains "c2" \| summarize count() by FileName, InitiatingProcessFolderPath, DeviceName \| where count_ > 3`.<br>- **ELK**: `FROM logs-endpoint.file-* \| WHERE event.action = "access" AND file.path : ("D:\\*" OR "E:\\*") AND process.executable : "*c2*" \| STATS COUNT() BY file.name, process.executable, host.name HAVING COUNT() > 3`. |
| 3. C2 with Removable Media in Linux | C2 via removable media in Linux, as in Turla. | - File Access (DS0022: auditd openat)<br>- Device Logs | - **Splunk**: `index=linux sourcetype=auditd syscall="openat" path="/media/*" AND exe="*c2*" \| stats count by path, exe, host \| where count > 3`.<br>- **KQL**: `DeviceFileEvents \| where ActionType == "FileAccessed" and FolderPath contains "/media/" and InitiatingProcessFolderPath contains "c2" \| summarize count() by FileName, InitiatingProcessFolderPath, DeviceName \| where count_ > 3`.<br>- **ELK**: `FROM logs-auditd-* \| WHERE syscall.name = "openat" AND file.path : "/media/*" AND process.exe : "*c2*" \| STATS COUNT() BY file.path, process.exe, host.name HAVING COUNT() > 3`. |
| 4. C2 with Removable Media Exfil | Data exfil via removable media, as in 2025 trends. | - File Creation (DS0022: Sysmon ID 11)<br>- Device Logs | - **Splunk**: `index=endpoint sourcetype=sysmon EventCode=11 TargetFilename IN ("D:\\*", "E:\\*") AND TargetFilename="*exfil*" \| stats count by TargetFilename, host \| where count > 3`.<br>- **KQL**: `DeviceFileEvents \| where ActionType == "FileCreated" and FolderPath has_any ("D:\\", "E:\\") and FileName contains "exfil" \| summarize count() by FileName, DeviceName \| where count_ > 3`.<br>- **ELK**: `FROM logs-endpoint.file-* \| WHERE event.action = "creation" AND file.path : ("D:\\*" OR "E:\\*") AND file.name : "*exfil*" \| STATS COUNT() BY file.name, host.name HAVING COUNT() > 3`. |
| 5. C2 via Removable Media in Cloud | C2 via removable media in cloud VMs, as in APT41. | - Cloud Audit Logs (AWS CloudTrail)<br>- Device Logs | - **Splunk**: `index=cloud sourcetype=aws:cloudtrail eventName="AttachVolume" AND userIdentity NOT IN (authorized_users) \| stats count by userIdentity, volumeId \| where count > 3`.<br>- **KQL**: `AWSCloudTrail \| where EventName == "AttachVolume" and Caller !in (authorizedUsers) \| summarize count() by Caller, VolumeId \| where count_ > 3`.<br>- **ELK**: `FROM logs-aws.cloudtrail-* \| WHERE event.action = 'AttachVolume' AND user.identity NOT IN ['authorized_users'] \| STATS COUNT() BY user.identity, volume.id HAVING COUNT() > 3`. |
| 6. C2 with Removable Media with Anomalous Timing | Removable media C2 with unusual timing, as in 2025 trends. | - Device Logs (DS0001: Windows Event ID 2003)<br>- Time Analysis | - **Splunk**: `index=windows EventID=2003 \| timechart span=1h count \| where count > avg(count)*4`.<br>- **KQL**: `DeviceEvents \| where ActionType == "UsbDriveMounted" \| summarize HourlyCount=count() by bin(Timestamp, 1h) \| where HourlyCount > avg(HourlyCount) * 4`.<br>- **ELK**: `FROM logs-windows-* \| WHERE winlog.event_id = 2003 \| STATS COUNT() BY date_histogram(@timestamp, '1h') \| WHERE COUNT() > AVG(COUNT()) * 4`. |
| 7. C2 via Removable Media with Encrypted Data | Encrypted data on removable media for C2, as in Turla. | - File Creation (DS0022: Sysmon ID 11)<br>- File Metadata | - **Splunk**: `index=endpoint sourcetype=sysmon EventCode=11 TargetFilename IN ("D:\\*", "E:\\*") AND FileSize>100000 \| stats count by TargetFilename, host \| where count > 3`.<br>- **KQL**: `DeviceFileEvents \| where ActionType == "FileCreated" and FolderPath has_any ("D:\\", "E:\\") and AdditionalFields.FileSize > 100000 \| summarize count() by FileName, DeviceName \| where count_ > 3`.<br>- **ELK**: `FROM logs-endpoint.file-* \| WHERE event.action = "creation" AND file.path : ("D:\\*" OR "E:\\*") AND file.size > 100000 \| STATS COUNT() BY file.name, host.name HAVING COUNT() > 3`. |
| 8. C2 via Removable Media in Non-Standard Environments | Removable media C2 in Linux, as in Turla. | - File Access (DS0022: auditd openat)<br>- Device Logs | - **Splunk**: `index=linux sourcetype=auditd syscall="openat" path="/media/*" \| stats count by path, exe, host \| where count > 5`.<br>- **KQL**: `DeviceFileEvents \| where ActionType == "FileAccessed" and FolderPath contains "/media/" \| summarize count() by FileName, InitiatingProcessFolderPath, DeviceName \| where count_ > 5`.<br>- **ELK**: `FROM logs-auditd-* \| WHERE syscall.name = "openat" AND file.path : "/media/*" \| STATS COUNT() BY file.path, process.exe, host.name HAVING COUNT() > 5`. |
| 9. C2 via Removable Media with Anomalous User Behavior | Removable media C2 with unusual user patterns, as in 2025 trends. | - User Behavior Analytics (UBA)<br>- Device Logs | - **Splunk**: `index=security sourcetype=uba:anomaly event_type="device_access" AND user NOT IN (known_users) \| join user [search index=windows EventID=2003] \| stats count by user, host \| where count > 3`.<br>- **KQL**: `UbaAnomalies \| where EventType == "device_access" and User !in (knownUsers) \| join kind=inner (DeviceEvents \| where ActionType == "UsbDriveMounted") on UserId \| summarize count() by UserId, DeviceName \| where count_ > 3`.<br>- **ELK**: `FROM logs-uba.anomaly-* \| WHERE event.type = "device_access" AND user.name NOT IN ['known_users'] \| JOIN logs-windows-* ON user.id WHERE winlog.event_id = 2003 \| STATS COUNT() BY user.id, host.name HAVING COUNT() > 3`. |
| 10. C2 via Removable Media with File Creation | Files created on removable media for C2, as in FIN7. | - File Creation (DS0022: Sysmon ID 11)<br>- Device Logs | - **Splunk**: `index=endpoint sourcetype=sysmon EventCode=11 TargetFilename IN ("D:\\*", "E:\\*") AND TargetFilename="*c2*" \| stats count by TargetFilename, host \| where count > 3`.<br>- **KQL**: `DeviceFileEvents \| where ActionType == "FileCreated" and FolderPath has_any ("D:\\", "E:\\") and FileName contains "c2" \| summarize count() by FileName, DeviceName \| where count_ > 3`.<br>- **ELK**: `FROM logs-endpoint.file-* \| WHERE event.action = "creation" AND file.path : ("D:\\*" OR "E:\\*") AND file.name : "*c2*" \| STATS COUNT() BY file.name, host.name HAVING COUNT() > 3`. |
| 11. C2 via Removable Media with Encrypted Payloads | Encrypted payloads on removable media, as in Turla. | - File Creation (DS0022: Sysmon ID 11)<br>- File Metadata | - **Splunk**: `index=endpoint sourcetype=sysmon EventCode=11 TargetFilename IN ("D:\\*", "E:\\*") AND payload_entropy > 7 \| stats count by TargetFilename, host \| where count > 3`.<br>- **KQL**: `DeviceFileEvents \| where ActionType == "FileCreated" and FolderPath has_any ("D:\\", "E:\\") and AdditionalFields.PayloadEntropy > 7 \| summarize count() by FileName, DeviceName \| where count_ > 3`.<br>- **ELK**: `FROM logs-endpoint.file-* \| WHERE event.action = "creation" AND file.path : ("D:\\*" OR "E:\\*") AND file.payload.entropy > 7 \| STATS COUNT() BY file.name, host.name HAVING COUNT() > 3`. |
| 12. C2 via Removable Media in Non-Standard Environments | Removable media C2 in cloud VMs, as in APT41. | - Cloud Audit Logs (AWS CloudTrail)<br>- Device Logs | - **Splunk**: `index=cloud sourcetype=aws:cloudtrail eventName="AttachVolume" AND userIdentity NOT IN (authorized_users) \| stats count by userIdentity, volumeId \| where count > 3`.<br>- **KQL**: `AWSCloudTrail \| where EventName == "AttachVolume" and Caller !in (authorizedUsers) \| summarize count() by Caller, VolumeId \| where count_ > 3`.<br>- **ELK**: `FROM logs-aws.cloudtrail-* \| WHERE event.action = 'AttachVolume' AND user.identity NOT IN ['authorized_users'] \| STATS COUNT() BY user.identity, volume.id HAVING COUNT() > 3`. |
| 13. C2 via Removable Media with Anomalous Timing | Removable media C2 with unusual timing, as in 2025 trends. | - Device Logs (DS0001: Windows Event ID 2003)<br>- Time Analysis | - **Splunk**: `index=windows EventID=2003 \| timechart span=1h count \| where count > avg(count)*4`.<br>- **KQL**: `DeviceEvents \| where ActionType == "UsbDriveMounted" \| summarize HourlyCount=count() by bin(Timestamp, 1h) \| where HourlyCount > avg(HourlyCount) * 4`.<br>- **ELK**: `FROM logs-windows-* \| WHERE winlog.event_id = 2003 \| STATS COUNT() BY date_histogram(@timestamp, '1h') \| WHERE COUNT() > AVG(COUNT()) * 4`. |
| 14. C2 via Removable Media with File Creation | Files created on removable media for C2, as in FIN7. | - File Creation (DS0022: Sysmon ID 11)<br>- Device Logs | - **Splunk**: `index=endpoint sourcetype=sysmon EventCode=11 TargetFilename IN ("D:\\*", "E:\\*") AND TargetFilename="*c2*" \| stats count by TargetFilename, host \| where count > 3`.<br>- **KQL**: `DeviceFileEvents \| where ActionType == "FileCreated" and FolderPath has_any ("D:\\", "E:\\") and FileName contains "c2" \| summarize count() by FileName, DeviceName \| where count_ > 3`.<br>- **ELK**: `FROM logs-endpoint.file-* \| WHERE event.action = "creation" AND file.path : ("D:\\*" OR "E:\\*") AND file.name : "*c2*" \| STATS COUNT() BY file.name, host.name HAVING COUNT() > 3`. |
| 15. C2 via Removable Media with Encrypted Payloads | Encrypted payloads on removable media, as in Turla. | - File Creation (DS0022: Sysmon ID 11)<br>- File Metadata | - **Splunk**: `index=endpoint sourcetype=sysmon EventCode=11 TargetFilename IN ("D:\\*", "E:\\*") AND payload_entropy > 7 \| stats count by TargetFilename, host \| where count > 3`.<br>- **KQL**: `DeviceFileEvents \| where ActionType == "FileCreated" and FolderPath has_any ("D:\\", "E:\\") and AdditionalFields.PayloadEntropy > 7 \| summarize count() by FileName, DeviceName \| where count_ > 3`.<br>- **ELK**: `FROM logs-endpoint.file-* \| WHERE event.action = "creation" AND file.path : ("D:\\*" OR "E:\\*") AND file.payload.entropy > 7 \| STATS COUNT() BY file.name, host.name HAVING COUNT() > 3`. |

### Content Injection (T1659)

| Hypothesis | Description | Data Sources | Hunting Queries |
|------------|-------------|--------------|-----------------|
| 1. Suspicious Content Injection in Web Traffic | Adversaries inject malicious content into web responses, as in Man-in-the-Browser attacks. High risk in environments with limited web traffic inspection. | - Network Traffic (DS0003: Zeek HTTP)<br>- Proxy Logs | - **Splunk**: `index=network sourcetype=zeek_http uri="*inject*" \| stats count by src_ip, uri \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "HTTP" and RemoteUrl contains "inject" \| summarize count() by DeviceIP, RemoteUrl \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE http.uri : "*inject*" \| STATS COUNT() BY source.ip, http.uri HAVING COUNT() > 5`. |
| 2. Content Injection in DNS Responses | Adversaries inject malicious content into DNS responses, as in DNS hijacking. | - DNS Logs (DS0003: Zeek DNS)<br>- Network Traffic | - **Splunk**: `index=network sourcetype=zeek_dns answer NOT IN (known_ips) \| stats count by src_ip, answer \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "DNS" and AdditionalFields.Answer !in (knownIPs) \| summarize count() by DeviceIP, AdditionalFields.Answer \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.dns-* \| WHERE dns.answer NOT IN ['known_ips'] \| STATS COUNT() BY source.ip, dns.answer HAVING COUNT() > 5`. |
| 3. Content Injection in HTTP Responses | Adversaries inject scripts in HTTP responses, as in MITM attacks. | - Network Traffic (DS0003: Zeek HTTP)<br>- Packet Analysis | - **Splunk**: `index=network sourcetype=zeek_http status_code=200 AND response_body_length > 1000 \| stats count by src_ip, uri \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "HTTP" and AdditionalFields.StatusCode == 200 and AdditionalFields.ResponseBodyLength > 1000 \| summarize count() by DeviceIP, RemoteUrl \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE http.status = 200 AND http.response.body.length > 1000 \| STATS COUNT() BY source.ip, http.uri HAVING COUNT() > 5`. |
| 4. Content Injection with Anomalous Timing | Content injection during unusual times, as in 2025 trends. | - Network Traffic (DS0003: Zeek HTTP)<br>- Metrics | - **Splunk**: `index=network sourcetype=zeek_http \| timechart span=1h count \| where count > avg(count)*4`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "HTTP" \| summarize HourlyCount=count() by bin(Timestamp, 1h) \| where HourlyCount > avg(HourlyCount) * 4`.<br>- **ELK**: `FROM logs-zeek.http-* \| STATS COUNT() BY date_histogram(@timestamp, '1h') \| WHERE COUNT() > AVG(COUNT()) * 4`. |
| 5. Content Injection via Compromised Endpoints | Compromised endpoints inject content, as in Turla. | - Process Creation (DS0009: Sysmon ID 1)<br>- Network Traffic | - **Splunk**: `index=endpoint sourcetype=sysmon EventCode=1 CommandLine="*inject*" \| join host [search index=network sourcetype=zeek_http uri="*inject*"] \| stats count by host, CommandLine, uri \| where count > 3`.<br>- **KQL**: `DeviceProcessEvents \| where ProcessCommandLine contains "inject" \| join kind=inner (DeviceNetworkEvents \| where RemoteUrl contains "inject") on DeviceName \| summarize count() by DeviceName, ProcessCommandLine, RemoteUrl \| where count_ > 3`.<br>- **ELK**: `FROM logs-endpoint.process-* \| WHERE process.command_line : "*inject*" \| JOIN logs-zeek.http-* ON host.name WHERE http.uri : "*inject*" \| STATS COUNT() BY host.name, process.command_line, http.uri HAVING COUNT() > 3`. |
| 6. Content Injection in Cloud Environments | Content injection in cloud, as in 2025 trends. | - Cloud Audit Logs (AWS CloudTrail)<br>- Network Traffic | - **Splunk**: `index=cloud sourcetype=aws:cloudtrail eventName="PutObject" AND userIdentity NOT IN (authorized_users) \| stats count by userIdentity, src_ip \| where count > 5`.<br>- **KQL**: `AWSCloudTrail \| where EventName == "PutObject" and Caller !in (authorizedUsers) \| summarize count() by Caller, SourceIP \| where count_ > 5`.<br>- **ELK**: `FROM logs-aws.cloudtrail-* \| WHERE event.action = 'PutObject' AND user.identity NOT IN ['authorized_users'] \| STATS COUNT() BY user.identity, source.ip HAVING COUNT() > 5`. |
| 7. Content Injection with Encrypted Payloads | Encrypted payloads in injected content, as in APT41. | - Network Traffic (DS0003: Zeek HTTP)<br>- Packet Analysis | - **Splunk**: `index=network sourcetype=zeek_http payload_entropy > 7 \| stats count by src_ip, uri \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "HTTP" and AdditionalFields.PayloadEntropy > 7 \| summarize count() by DeviceIP, RemoteUrl \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE http.payload.entropy > 7 \| STATS COUNT() BY source.ip, http.uri HAVING COUNT() > 5`. |
| 8. Content Injection in Non-Standard Environments | Content injection in Linux, as in Turla. | - Network Traffic (DS0003: Zeek HTTP)<br>- Linux Logs | - **Splunk**: `index=linux sourcetype=auditd syscall="sendto" AND dest_port IN (80, 443) AND exe NOT IN (known_apps) \| stats count by exe, dest_ip \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where RemotePort in (80, 443) and InitiatingProcessName !in (knownApps) \| summarize count() by InitiatingProcessName, RemoteIP \| where count_ > 5`.<br>- **ELK**: `FROM logs-auditd-* \| WHERE syscall.name = "sendto" AND destination.port IN [80, 443] AND process.exe NOT IN ['known_apps'] \| STATS COUNT() BY process.exe, destination.ip HAVING COUNT() > 5`. |
| 9. Content Injection with Anomalous Timing | Content injection with unusual timing, as in 2025 trends. | - Network Traffic (DS0003: Zeek HTTP)<br>- Metrics | - **Splunk**: `index=network sourcetype=zeek_http \| timechart span=1h count \| where count > avg(count)*4`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "HTTP" \| summarize HourlyCount=count() by bin(Timestamp, 1h) \| where HourlyCount > avg(HourlyCount) * 4`.<br>- **ELK**: `FROM logs-zeek.http-* \| STATS COUNT() BY date_histogram(@timestamp, '1h') \| WHERE COUNT() > AVG(COUNT()) * 4`. |
| 10. Content Injection with Suspicious Headers | Content injection with custom headers, as in Cobalt Strike. | - Network Traffic (DS0003: Zeek HTTP)<br>- Proxy Logs | - **Splunk**: `index=network sourcetype=zeek_http header IN ("*X-Cobalt*", "*Custom-Header*") \| stats count by src_ip, header \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "HTTP" and AdditionalFields.Header has_any ("X-Cobalt", "Custom-Header") \| summarize count() by DeviceIP, AdditionalFields.Header \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE http.header : ("*X-Cobalt*" OR "*Custom-Header*") \| STATS COUNT() BY source.ip, http.header HAVING COUNT() > 5`. |
| 11. Content Injection with Encrypted Payloads | Encrypted payloads in injected content, as in APT41. | - Network Traffic (DS0003: Zeek HTTP)<br>- Packet Analysis | - **Splunk**: `index=network sourcetype=zeek_http payload_entropy > 7 \| stats count by src_ip, uri \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "HTTP" and AdditionalFields.PayloadEntropy > 7 \| summarize count() by DeviceIP, RemoteUrl \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE http.payload.entropy > 7 \| STATS COUNT() BY source.ip, http.uri HAVING COUNT() > 5`. |
| 12. Content Injection in Non-Standard Environments | Content injection in Linux, as in Turla. | - Network Traffic (DS0003: Zeek HTTP)<br>- Linux Logs | - **Splunk**: `index=linux sourcetype=auditd syscall="sendto" AND dest_port IN (80, 443) AND exe NOT IN (known_apps) \| stats count by exe, dest_ip \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where RemotePort in (80, 443) and InitiatingProcessName !in (knownApps) \| summarize count() by InitiatingProcessName, RemoteIP \| where count_ > 5`.<br>- **ELK**: `FROM logs-auditd-* \| WHERE syscall.name = "sendto" AND destination.port IN [80, 443] AND process.exe NOT IN ['known_apps'] \| STATS COUNT() BY process.exe, destination.ip HAVING COUNT() > 5`. |
| 13. Content Injection with Anomalous Timing | Content injection with unusual timing, as in 2025 trends. | - Network Traffic (DS0003: Zeek HTTP)<br>- Metrics | - **Splunk**: `index=network sourcetype=zeek_http \| timechart span=1h count \| where count > avg(count)*4`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "HTTP" \| summarize HourlyCount=count() by bin(Timestamp, 1h) \| where HourlyCount > avg(HourlyCount) * 4`.<br>- **ELK**: `FROM logs-zeek.http-* \| STATS COUNT() BY date_histogram(@timestamp, '1h') \| WHERE COUNT() > AVG(COUNT()) * 4`. |
| 14. Content Injection with Suspicious Headers | Content injection with custom headers, as in Cobalt Strike. | - Network Traffic (DS0003: Zeek HTTP)<br>- Proxy Logs | - **Splunk**: `index=network sourcetype=zeek_http header IN ("*X-Cobalt*", "*Custom-Header*") \| stats count by src_ip, header \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "HTTP" and AdditionalFields.Header has_any ("X-Cobalt", "Custom-Header") \| summarize count() by DeviceIP, AdditionalFields.Header \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE http.header : ("*X-Cobalt*" OR "*Custom-Header*") \| STATS COUNT() BY source.ip, http.header HAVING COUNT() > 5`. |
| 15. Content Injection with Encrypted Payloads | Encrypted payloads in injected content, as in APT41. | - Network Traffic (DS0003: Zeek HTTP)<br>- Packet Analysis | - **Splunk**: `index=network sourcetype=zeek_http payload_entropy > 7 \| stats count by src_ip, uri \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "HTTP" and AdditionalFields.PayloadEntropy > 7 \| summarize count() by DeviceIP, RemoteUrl \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE http.payload.entropy > 7 \| STATS COUNT() BY source.ip, http.uri HAVING COUNT() > 5`. |

### Custom Command and Control Protocol (T1094)

| Hypothesis | Description | Data Sources | Hunting Queries |
|------------|-------------|--------------|-----------------|
| 1. Custom Protocol Traffic Anomalies | Adversaries use custom protocols for C2, as in APT41. High risk in environments with limited protocol inspection. | - Network Traffic (DS0003: Zeek Conn)<br>- Firewall Logs | - **Splunk**: `index=network sourcetype=zeek_conn protocol NOT IN ("tcp", "udp", "icmp") \| stats count by src_ip, protocol \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol !in ("TCP", "UDP", "ICMP") \| summarize count() by DeviceIP, Protocol \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.conn-* \| WHERE network.protocol NOT IN ['tcp', 'udp', 'icmp'] \| STATS COUNT() BY source.ip, network.protocol HAVING COUNT() > 5`. |
| 2. Custom C2 with Encrypted Payloads | Encrypted custom C2 payloads, as in Turla. | - Network Traffic (DS0003: Zeek Conn)<br>- Packet Analysis | - **Splunk**: `index=network sourcetype=zeek_conn payload_entropy > 7 \| stats count by src_ip \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where AdditionalFields.PayloadEntropy > 7 \| summarize count() by DeviceIP \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.conn-* \| WHERE network.payload.entropy > 7 \| STATS COUNT() BY source.ip HAVING COUNT() > 5`. |
| 3. Custom C2 with Anomalous Timing | Custom C2 with unusual timing, as in 2025 trends. | - Network Traffic (DS0003: Zeek Conn)<br>- Metrics | - **Splunk**: `index=network sourcetype=zeek_conn \| timechart span=1h count \| where count > avg(count)*4`.<br>- **KQL**: `DeviceNetworkEvents \| summarize HourlyCount=count() by bin(Timestamp, 1h) \| where HourlyCount > avg(HourlyCount) * 4`.<br>- **ELK**: `FROM logs-zeek.conn-* \| STATS COUNT() BY date_histogram(@timestamp, '1h') \| WHERE COUNT() > AVG(COUNT()) * 4`. |
| 4. Custom C2 from Compromised Endpoints | Compromised endpoints initiate custom C2, as in FIN7. | - Process Creation (DS0009: Sysmon ID 1)<br>- Network Traffic | - **Splunk**: `index=endpoint sourcetype=sysmon EventCode=1 CommandLine="*c2*" \| join host [search index=network sourcetype=zeek_conn protocol NOT IN ("tcp", "udp")] \| stats count by host, CommandLine, protocol \| where count > 3`.<br>- **KQL**: `DeviceProcessEvents \| where ProcessCommandLine contains "c2" \| join kind=inner (DeviceNetworkEvents \| where Protocol !in ("TCP", "UDP")) on DeviceName \| summarize count() by DeviceName, ProcessCommandLine, Protocol \| where count_ > 3`.<br>- **ELK**: `FROM logs-endpoint.process-* \| WHERE process.command_line : "*c2*" \| JOIN logs-zeek.conn-* ON host.name WHERE network.protocol NOT IN ['tcp', 'udp'] \| STATS COUNT() BY host.name, process.command_line, network.protocol HAVING COUNT() > 3`. |
| 5. Custom C2 with High Packet Frequency | High-frequency custom C2 traffic, as in APT41. | - Network Traffic (DS0003: Zeek Conn)<br>- Metrics | - **Splunk**: `index=network sourcetype=zeek_conn protocol NOT IN ("tcp", "udp") \| timechart span=5m count by src_ip \| where count > avg(count)*4`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol !in ("TCP", "UDP") \| summarize PacketCount=count() by bin(Timestamp, 5m), DeviceIP \| where PacketCount > avg(PacketCount) * 4`.<br>- **ELK**: `FROM logs-zeek.conn-* \| WHERE network.protocol NOT IN ['tcp', 'udp'] \| STATS COUNT() BY date_histogram(@timestamp, '5m'), source.ip \| WHERE COUNT() > AVG(COUNT()) * 4`. |
| 6. Custom C2 in Cloud Environments | Custom C2 in cloud, as in 2025 trends. | - Cloud Audit Logs (AWS CloudTrail)<br>- Network Traffic | - **Splunk**: `index=cloud sourcetype=aws:cloudtrail eventName="Invoke" AND userIdentity NOT IN (authorized_users) \| stats count by userIdentity, src_ip \| where count > 5`.<br>- **KQL**: `AWSCloudTrail \| where EventName == "Invoke" and Caller !in (authorizedUsers) \| summarize count() by Caller, SourceIP \| where count_ > 5`.<br>- **ELK**: `FROM logs-aws.cloudtrail-* \| WHERE event.action = 'Invoke' AND user.identity NOT IN ['authorized_users'] \| STATS COUNT() BY user.identity, source.ip HAVING COUNT() > 5`. |
| 7. Custom C2 with Encrypted Payloads | Encrypted payloads in custom C2, as in APT41. | - Network Traffic (DS0003: Zeek Conn)<br>- Packet Analysis | - **Splunk**: `index=network sourcetype=zeek_conn payload_entropy > 7 \| stats count by src_ip \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where AdditionalFields.PayloadEntropy > 7 \| summarize count() by DeviceIP \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.conn-* \| WHERE network.payload.entropy > 7 \| STATS COUNT() BY source.ip HAVING COUNT() > 5`. |
| 8. Custom C2 in Non-Standard Environments | Custom C2 in Linux, as in Turla. | - Network Traffic (DS0003: Zeek Conn)<br>- Linux Logs | - **Splunk**: `index=linux sourcetype=auditd syscall="sendto" AND dest_port NOT IN (80, 443) AND exe NOT IN (known_apps) \| stats count by exe, dest_ip \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where RemotePort !in (80, 443) and InitiatingProcessName !in (knownApps) \| summarize count() by InitiatingProcessName, RemoteIP \| where count_ > 5`.<br>- **ELK**: `FROM logs-auditd-* \| WHERE syscall.name = "sendto" AND destination.port NOT IN [80, 443] AND process.exe NOT IN ['known_apps'] \| STATS COUNT() BY process.exe, destination.ip HAVING COUNT() > 5`. |
| 9. Custom C2 with Anomalous Timing | Custom C2 with unusual timing, as in 2025 trends. | - Network Traffic (DS0003: Zeek Conn)<br>- Metrics | - **Splunk**: `index=network sourcetype=zeek_conn protocol NOT IN ("tcp", "udp") \| timechart span=1h count \| where count > avg(count)*4`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol !in ("TCP", "UDP") \| summarize HourlyCount=count() by bin(Timestamp, 1h) \| where HourlyCount > avg(HourlyCount) * 4`.<br>- **ELK**: `FROM logs-zeek.conn-* \| WHERE network.protocol NOT IN ['tcp', 'udp'] \| STATS COUNT() BY date_histogram(@timestamp, '1h') \| WHERE COUNT() > AVG(COUNT()) * 4`. |
| 10. Custom C2 with Suspicious Headers | Custom C2 with custom headers, as in Cobalt Strike. | - Network Traffic (DS0003: Zeek HTTP)<br>- Proxy Logs | - **Splunk**: `index=network sourcetype=zeek_http header IN ("*X-Cobalt*", "*Custom-Header*") \| stats count by src_ip, header \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "HTTP" and AdditionalFields.Header has_any ("X-Cobalt", "Custom-Header") \| summarize count() by DeviceIP, AdditionalFields.Header \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE http.header : ("*X-Cobalt*" OR "*Custom-Header*") \| STATS COUNT() BY source.ip, http.header HAVING COUNT() > 5`. |
| 11. Custom C2 with Encrypted Payloads | Encrypted payloads in custom C2, as in APT41. | - Network Traffic (DS0003: Zeek Conn)<br>- Packet Analysis | - **Splunk**: `index=network sourcetype=zeek_conn payload_entropy > 7 \| stats count by src_ip \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where AdditionalFields.PayloadEntropy > 7 \| summarize count() by DeviceIP \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.conn-* \| WHERE network.payload.entropy > 7 \| STATS COUNT() BY source.ip HAVING COUNT() > 5`. |
| 12. Custom C2 in Non-Standard Environments | Custom C2 in cloud, as in 2025 trends. | - Cloud Audit Logs (AWS CloudTrail)<br>- Network Traffic | - **Splunk**: `index=cloud sourcetype=aws:cloudtrail eventName="Invoke" AND userIdentity NOT IN (authorized_users) \| stats count by userIdentity, src_ip \| where count > 5`.<br>- **KQL**: `AWSCloudTrail \| where EventName == "Invoke" and Caller !in (authorizedUsers) \| summarize count() by Caller, SourceIP \| where count_ > 5`.<br>- **ELK**: `FROM logs-aws.cloudtrail-* \| WHERE event.action = 'Invoke' AND user.identity NOT IN ['authorized_users'] \| STATS COUNT() BY user.identity, source.ip HAVING COUNT() > 5`. |
| 13. Custom C2 with Anomalous Timing | Custom C2 with unusual timing, as in 2025 trends. | - Network Traffic (DS0003: Zeek Conn)<br>- Metrics | - **Splunk**: `index=network sourcetype=zeek_conn \| timechart span=1h count \| where count > avg(count)*4`.<br>- **KQL**: `DeviceNetworkEvents \| summarize HourlyCount=count() by bin(Timestamp, 1h) \| where HourlyCount > avg(HourlyCount) * 4`.<br>- **ELK**: `FROM logs-zeek.conn-* \| STATS COUNT() BY date_histogram(@timestamp, '1h') \| WHERE COUNT() > AVG(COUNT()) * 4`. |
| 14. Custom C2 with Suspicious Headers | Custom C2 with custom headers, as in Cobalt Strike. | - Network Traffic (DS0003: Zeek HTTP)<br>- Proxy Logs | - **Splunk**: `index=network sourcetype=zeek_http header IN ("*X-Cobalt*", "*Custom-Header*") \| stats count by src_ip, header \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "HTTP" and AdditionalFields.Header has_any ("X-Cobalt", "Custom-Header") \| summarize count() by DeviceIP, AdditionalFields.Header \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE http.header : ("*X-Cobalt*" OR "*Custom-Header*") \| STATS COUNT() BY source.ip, http.header HAVING COUNT() > 5`. |
| 15. Custom C2 with Encrypted Payloads | Encrypted payloads in custom C2, as in APT41. | - Network Traffic (DS0003: Zeek Conn)<br>- Packet Analysis | - **Splunk**: `index=network sourcetype=zeek_conn payload_entropy > 7 \| stats count by src_ip \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where AdditionalFields.PayloadEntropy > 7 \| summarize count() by DeviceIP \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.conn-* \| WHERE network.payload.entropy > 7 \| STATS COUNT() BY source.ip HAVING COUNT() > 5`.

### DNS (T1071.004)

| Hypothesis | Description | Data Sources | Hunting Queries |
|------------|-------------|--------------|-----------------|
| 1. Anomalous DNS Query Volume for C2 | Adversaries use DNS for C2 communication with high query volumes to evade detection, as in APT41 campaigns. High risk in environments with limited DNS monitoring. | - DNS Logs (DS0003: Zeek DNS)<br>- Network Traffic | - **Splunk**: `index=network sourcetype=zeek_dns \| timechart span=1h count by src_ip \| where count > avg(count)*4` (Detects spikes in DNS queries).<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "DNS" \| summarize HourlyCount=count() by bin(Timestamp, 1h), DeviceIP \| where HourlyCount > avg(HourlyCount) * 4`.<br>- **ELK**: `FROM logs-zeek.dns-* \| STATS COUNT() BY date_histogram(@timestamp, '1h'), source.ip \| WHERE COUNT() > AVG(COUNT()) * 4`. |
| 2. DNS Tunneling with Long Queries | Adversaries tunnel data over DNS with unusually long queries, as in FIN7 attacks. | - DNS Logs (DS0003: Zeek DNS)<br>- Network Traffic | - **Splunk**: `index=network sourcetype=zeek_dns query_length > 200 AND NOT query IN (known_domains) \| stats count by src_ip, query \| where count > 10`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "DNS" and AdditionalFields.QueryLength > 200 and AdditionalFields.Query !in (knownDomains) \| summarize count() by DeviceIP, AdditionalFields.Query \| where count_ > 10`.<br>- **ELK**: `FROM logs-zeek.dns-* \| WHERE dns.query.length > 200 AND dns.query NOT IN ['known_domains'] \| STATS COUNT() BY source.ip, dns.query HAVING COUNT() > 10`. |
| 3. DNS C2 with Base64 Encoded Queries | DNS queries with encoded payloads for C2, as in APT29. | - DNS Logs (DS0003: Zeek DNS)<br>- Packet Analysis | - **Splunk**: `index=network sourcetype=zeek_dns query="*base64*" \| stats count by src_ip, query \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "DNS" and AdditionalFields.Query contains "base64" \| summarize count() by DeviceIP, AdditionalFields.Query \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.dns-* \| WHERE dns.query : "*base64*" \| STATS COUNT() BY source.ip, dns.query HAVING COUNT() > 5`. |
| 4. DNS C2 from Compromised Endpoints | Compromised endpoints initiate DNS C2, as in Turla. | - Process Creation (DS0009: Sysmon ID 1)<br>- DNS Logs | - **Splunk**: `index=endpoint sourcetype=sysmon EventCode=1 CommandLine="*dns*" \| join host [search index=network sourcetype=zeek_dns query_length > 200] \| stats count by host, CommandLine, query \| where count > 3`.<br>- **KQL**: `DeviceProcessEvents \| where ProcessCommandLine contains "dns" \| join kind=inner (DeviceNetworkEvents \| where Protocol == "DNS" and AdditionalFields.QueryLength > 200) on DeviceName \| summarize count() by DeviceName, ProcessCommandLine, AdditionalFields.Query \| where count_ > 3`.<br>- **ELK**: `FROM logs-endpoint.process-* \| WHERE process.command_line : "*dns*" \| JOIN logs-zeek.dns-* ON host.name WHERE dns.query.length > 200 \| STATS COUNT() BY host.name, process.command_line, dns.query HAVING COUNT() > 3`. |
| 5. DNS C2 with Anomalous Timing | DNS C2 with unusual timing, as in 2025 trends. | - DNS Logs (DS0003: Zeek DNS)<br>- Metrics | - **Splunk**: `index=network sourcetype=zeek_dns \| timechart span=1h count \| where count > avg(count)*4`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "DNS" \| summarize HourlyCount=count() by bin(Timestamp, 1h) \| where HourlyCount > avg(HourlyCount) * 4`.<br>- **ELK**: `FROM logs-zeek.dns-* \| STATS COUNT() BY date_histogram(@timestamp, '1h') \| WHERE COUNT() > AVG(COUNT()) * 4`. |
| 6. DNS C2 with Encrypted Payloads | Encrypted payloads in DNS queries for C2, as in APT41. | - DNS Logs (DS0003: Zeek DNS)<br>- Packet Analysis | - **Splunk**: `index=network sourcetype=zeek_dns payload_entropy > 7 \| stats count by src_ip, query \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "DNS" and AdditionalFields.PayloadEntropy > 7 \| summarize count() by DeviceIP, RemoteUrl \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.dns-* \| WHERE dns.payload.entropy > 7 \| STATS COUNT() BY source.ip, dns.query HAVING COUNT() > 5`. |
| 7. DNS C2 in Cloud Environments | DNS C2 in cloud, as in 2025 trends. | - Cloud Audit Logs (AWS CloudTrail)<br>- DNS Logs | - **Splunk**: `index=cloud sourcetype=aws:cloudtrail eventName="Resolve" AND userIdentity NOT IN (authorized_users) \| stats count by userIdentity, src_ip \| where count > 5`.<br>- **KQL**: `AWSCloudTrail \| where EventName == "Resolve" and Caller !in (authorizedUsers) \| summarize count() by Caller, SourceIP \| where count_ > 5`.<br>- **ELK**: `FROM logs-aws.cloudtrail-* \| WHERE event.action = 'Resolve' AND user.identity NOT IN ['authorized_users'] \| STATS COUNT() BY user.identity, source.ip HAVING COUNT() > 5`. |
| 8. DNS C2 with Suspicious Headers | DNS C2 with custom headers, as in Cobalt Strike. | - DNS Logs (DS0003: Zeek DNS)<br>- Proxy Logs | - **Splunk**: `index=network sourcetype=zeek_dns header IN ("*X-Cobalt*", "*Custom-Header*") \| stats count by src_ip, header \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "DNS" and AdditionalFields.Header has_any ("X-Cobalt", "Custom-Header") \| summarize count() by DeviceIP, AdditionalFields.Header \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.dns-* \| WHERE dns.header : ("*X-Cobalt*" OR "*Custom-Header*") \| STATS COUNT() BY source.ip, dns.header HAVING COUNT() > 5`. |
| 9. DNS C2 in Non-Standard Environments | DNS C2 in Linux, as in Turla. | - DNS Logs (DS0003: Zeek DNS)<br>- Linux Logs | - **Splunk**: `index=linux sourcetype=auditd syscall="sendto" AND dest_port=53 AND exe NOT IN (known_apps) \| stats count by exe, dest_ip \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where RemotePort == 53 and InitiatingProcessName !in (knownApps) \| summarize count() by InitiatingProcessName, RemoteIP \| where count_ > 5`.<br>- **ELK**: `FROM logs-auditd-* \| WHERE syscall.name = "sendto" AND destination.port = 53 AND process.exe NOT IN ['known_apps'] \| STATS COUNT() BY process.exe, destination.ip HAVING COUNT() > 5`. |
| 10. DNS C2 with Multi-Stage Redirects | DNS C2 with redirects, as in APT41. | - DNS Logs (DS0003: Zeek DNS)<br>- Redirect Analysis | - **Splunk**: `index=network sourcetype=zeek_dns status_code=302 \| stats count by src_ip, query \| where count > 3`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "DNS" and AdditionalFields.StatusCode == 302 \| summarize count() by DeviceIP, AdditionalFields.Query \| where count_ > 3`.<br>- **ELK**: `FROM logs-zeek.dns-* \| WHERE dns.status = 302 \| STATS COUNT() BY source.ip, dns.query HAVING COUNT() > 3`. |
| 11. DNS C2 with Anomalous User Agents | DNS C2 with unusual user agents, as in Cobalt Strike. | - DNS Logs (DS0003: Zeek DNS)<br>- Proxy Logs | - **Splunk**: `index=network sourcetype=zeek_dns user_agent NOT IN (known_agents) \| stats count by src_ip, user_agent \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "DNS" and AdditionalFields.UserAgent !in (knownAgents) \| summarize count() by DeviceIP, AdditionalFields.UserAgent \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.dns-* \| WHERE dns.user_agent NOT IN ['known_agents'] \| STATS COUNT() BY source.ip, dns.user_agent HAVING COUNT() > 5`. |
| 12. DNS C2 in Cloud Environments | DNS C2 in cloud, as in 2025 trends. | - Cloud Audit Logs (AWS CloudTrail)<br>- DNS Logs | - **Splunk**: `index=cloud sourcetype=aws:cloudtrail eventName="Resolve" AND userIdentity NOT IN (authorized_users) \| stats count by userIdentity, src_ip \| where count > 5`.<br>- **KQL**: `AWSCloudTrail \| where EventName == "Resolve" and Caller !in (authorizedUsers) \| summarize count() by Caller, SourceIP \| where count_ > 5`.<br>- **ELK**: `FROM logs-aws.cloudtrail-* \| WHERE event.action = 'Resolve' AND user.identity NOT IN ['authorized_users'] \| STATS COUNT() BY user.identity, source.ip HAVING COUNT() > 5`. |
| 13. DNS C2 with Anomalous Timing | DNS C2 with unusual timing, as in 2025 trends. | - DNS Logs (DS0003: Zeek DNS)<br>- Metrics | - **Splunk**: `index=network sourcetype=zeek_dns \| timechart span=1h count \| where count > avg(count)*4`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "DNS" \| summarize HourlyCount=count() by bin(Timestamp, 1h) \| where HourlyCount > avg(HourlyCount) * 4`.<br>- **ELK**: `FROM logs-zeek.dns-* \| STATS COUNT() BY date_histogram(@timestamp, '1h') \| WHERE COUNT() > AVG(COUNT()) * 4`. |
| 14. DNS C2 with Suspicious Headers | DNS C2 with custom headers, as in Cobalt Strike. | - DNS Logs (DS0003: Zeek DNS)<br>- Proxy Logs | - **Splunk**: `index=network sourcetype=zeek_dns header IN ("*X-Cobalt*", "*Custom-Header*") \| stats count by src_ip, header \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "DNS" and AdditionalFields.Header has_any ("X-Cobalt", "Custom-Header") \| summarize count() by DeviceIP, AdditionalFields.Header \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.dns-* \| WHERE dns.header : ("*X-Cobalt*" OR "*Custom-Header*") \| STATS COUNT() BY source.ip, dns.header HAVING COUNT() > 5`. |
| 15. DNS C2 with Encrypted Payloads | Encrypted payloads in DNS C2, as in APT41. | - DNS Logs (DS0003: Zeek DNS)<br>- Packet Analysis | - **Splunk**: `index=network sourcetype=zeek_dns payload_entropy > 7 \| stats count by src_ip, query \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "DNS" and AdditionalFields.PayloadEntropy > 7 \| summarize count() by DeviceIP, AdditionalFields.Query \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.dns-* \| WHERE dns.payload.entropy > 7 \| STATS COUNT() BY source.ip, dns.query HAVING COUNT() > 5`. |

### DNS Calculation (T1568.002)

| Hypothesis | Description | Data Sources | Hunting Queries |
|------------|-------------|--------------|-----------------|
| 1. Domain Generation Algorithm (DGA) Traffic | Adversaries use DGA for DNS C2, generating many domains, as in APT41. High risk in environments with limited DNS monitoring. | - DNS Logs (DS0003: Zeek DNS)<br>- Network Traffic | - **Splunk**: `index=network sourcetype=zeek_dns query NOT IN (known_domains) AND query_entropy > 3 \| stats count by src_ip, query \| where count > 10`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "DNS" and AdditionalFields.Query !in (knownDomains) and AdditionalFields.QueryEntropy > 3 \| summarize count() by DeviceIP, AdditionalFields.Query \| where count_ > 10`.<br>- **ELK**: `FROM logs-zeek.dns-* \| WHERE dns.query NOT IN ['known_domains'] AND dns.query.entropy > 3 \| STATS COUNT() BY source.ip, dns.query HAVING COUNT() > 10`. |
| 2. DGA with Failed Resolutions | High failed DNS resolutions, indicating DGA C2, as in Turla. | - DNS Logs (DS0003: Zeek DNS)<br>- Network Traffic | - **Splunk**: `index=network sourcetype=zeek_dns rcode_name="NXDOMAIN" \| stats count by src_ip, query \| where count > 10`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "DNS" and AdditionalFields.RCodeName == "NXDOMAIN" \| summarize count() by DeviceIP, AdditionalFields.Query \| where count_ > 10`.<br>- **ELK**: `FROM logs-zeek.dns-* \| WHERE dns.rcode.name = "NXDOMAIN" \| STATS COUNT() BY source.ip, dns.query HAVING COUNT() > 10`. |
| 3. DGA with Random Domain Patterns | DNS queries with random-like domains, as in APT29. | - DNS Logs (DS0003: Zeek DNS)<br>- Packet Analysis | - **Splunk**: `index=network sourcetype=zeek_dns query="*random*" \| stats count by src_ip, query \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "DNS" and AdditionalFields.Query contains "random" \| summarize count() by DeviceIP, AdditionalFields.Query \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.dns-* \| WHERE dns.query : "*random*" \| STATS COUNT() BY source.ip, dns.query HAVING COUNT() > 5`. |
| 4. DGA from Compromised Endpoints | Compromised endpoints generate DGA DNS queries, as in Turla. | - Process Creation (DS0009: Sysmon ID 1)<br>- DNS Logs | - **Splunk**: `index=endpoint sourcetype=sysmon EventCode=1 CommandLine="*dns*" \| join host [search index=network sourcetype=zeek_dns rcode_name="NXDOMAIN"] \| stats count by host, CommandLine, query \| where count > 3`.<br>- **KQL**: `DeviceProcessEvents \| where ProcessCommandLine contains "dns" \| join kind=inner (DeviceNetworkEvents \| where Protocol == "DNS" and AdditionalFields.RCodeName == "NXDOMAIN") on DeviceName \| summarize count() by DeviceName, ProcessCommandLine, AdditionalFields.Query \| where count_ > 3`.<br>- **ELK**: `FROM logs-endpoint.process-* \| WHERE process.command_line : "*dns*" \| JOIN logs-zeek.dns-* ON host.name WHERE dns.rcode.name = "NXDOMAIN" \| STATS COUNT() BY host.name, process.command_line, dns.query HAVING COUNT() > 3`. |
| 5. DGA with Anomalous Timing | DGA DNS C2 with unusual timing, as in 2025 trends. | - DNS Logs (DS0003: Zeek DNS)<br>- Metrics | - **Splunk**: `index=network sourcetype=zeek_dns \| timechart span=1h count \| where count > avg(count)*4`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "DNS" \| summarize HourlyCount=count() by bin(Timestamp, 1h) \| where HourlyCount > avg(HourlyCount) * 4`.<br>- **ELK**: `FROM logs-zeek.dns-* \| STATS COUNT() BY date_histogram(@timestamp, '1h') \| WHERE COUNT() > AVG(COUNT()) * 4`. |
| 6. DGA with Encrypted Payloads | Encrypted payloads in DGA DNS queries, as in APT41. | - DNS Logs (DS0003: Zeek DNS)<br>- Packet Analysis | - **Splunk**: `index=network sourcetype=zeek_dns payload_entropy > 7 \| stats count by src_ip, query \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "DNS" and AdditionalFields.PayloadEntropy > 7 \| summarize count() by DeviceIP, AdditionalFields.Query \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.dns-* \| WHERE dns.payload.entropy > 7 \| STATS COUNT() BY source.ip, dns.query HAVING COUNT() > 5`. |
| 7. DGA in Cloud Environments | DGA DNS C2 in cloud, as in 2025 trends. | - Cloud Audit Logs (AWS CloudTrail)<br>- DNS Logs | - **Splunk**: `index=cloud sourcetype=aws:cloudtrail eventName="Resolve" AND userIdentity NOT IN (authorized_users) \| stats count by userIdentity, src_ip \| where count > 5`.<br>- **KQL**: `AWSCloudTrail \| where EventName == "Resolve" and Caller !in (authorizedUsers) \| summarize count() by Caller, SourceIP \| where count_ > 5`.<br>- **ELK**: `FROM logs-aws.cloudtrail-* \| WHERE event.action = 'Resolve' AND user.identity NOT IN ['authorized_users'] \| STATS COUNT() BY user.identity, source.ip HAVING COUNT() > 5`. |
| 8. DGA with Suspicious Headers | DGA DNS C2 with custom headers, as in Cobalt Strike. | - DNS Logs (DS0003: Zeek DNS)<br>- Proxy Logs | - **Splunk**: `index=network sourcetype=zeek_dns header IN ("*X-Cobalt*", "*Custom-Header*") \| stats count by src_ip, header \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "DNS" and AdditionalFields.Header has_any ("X-Cobalt", "Custom-Header") \| summarize count() by DeviceIP, AdditionalFields.Header \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.dns-* \| WHERE dns.header : ("*X-Cobalt*" OR "*Custom-Header*") \| STATS COUNT() BY source.ip, dns.header HAVING COUNT() > 5`. |
| 9. DGA in Non-Standard Environments | DGA DNS C2 in Linux, as in Turla. | - DNS Logs (DS0003: Zeek DNS)<br>- Linux Logs | - **Splunk**: `index=linux sourcetype=auditd syscall="sendto" AND dest_port=53 AND exe NOT IN (known_apps) \| stats count by exe, dest_ip \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where RemotePort == 53 and InitiatingProcessName !in (knownApps) \| summarize count() by InitiatingProcessName, RemoteIP \| where count_ > 5`.<br>- **ELK**: `FROM logs-auditd-* \| WHERE syscall.name = "sendto" AND destination.port = 53 AND process.exe NOT IN ['known_apps'] \| STATS COUNT() BY process.exe, destination.ip HAVING COUNT() > 5`. |
| 10. DGA with Multi-Stage Redirects | DGA DNS C2 with redirects, as in APT41. | - DNS Logs (DS0003: Zeek DNS)<br>- Redirect Analysis | - **Splunk**: `index=network sourcetype=zeek_dns status_code=302 \| stats count by src_ip, query \| where count > 3`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "DNS" and AdditionalFields.StatusCode == 302 \| summarize count() by DeviceIP, AdditionalFields.Query \| where count_ > 3`.<br>- **ELK**: `FROM logs-zeek.dns-* \| WHERE dns.status = 302 \| STATS COUNT() BY source.ip, dns.query HAVING COUNT() > 3`. |
| 11. DGA with Anomalous User Agents | DGA DNS C2 with unusual user agents, as in Cobalt Strike. | - DNS Logs (DS0003: Zeek DNS)<br>- Proxy Logs | - **Splunk**: `index=network sourcetype=zeek_dns user_agent NOT IN (known_agents) \| stats count by src_ip, user_agent \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "DNS" and AdditionalFields.UserAgent !in (knownAgents) \| summarize count() by DeviceIP, AdditionalFields.UserAgent \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.dns-* \| WHERE dns.user_agent NOT IN ['known_agents'] \| STATS COUNT() BY source.ip, dns.user_agent HAVING COUNT() > 5`. |
| 12. DGA in Cloud Environments | DGA DNS C2 in cloud, as in 2025 trends. | - Cloud Audit Logs (AWS CloudTrail)<br>- DNS Logs | - **Splunk**: `index=cloud sourcetype=aws:cloudtrail eventName="Resolve" AND userIdentity NOT IN (authorized_users) \| stats count by userIdentity, src_ip \| where count > 5`.<br>- **KQL**: `AWSCloudTrail \| where EventName == "Resolve" and Caller !in (authorizedUsers) \| summarize count() by Caller, SourceIP \| where count_ > 5`.<br>- **ELK**: `FROM logs-aws.cloudtrail-* \| WHERE event.action = 'Resolve' AND user.identity NOT IN ['authorized_users'] \| STATS COUNT() BY user.identity, source.ip HAVING COUNT() > 5`. |
| 13. DGA with Anomalous Timing | DGA DNS C2 with unusual timing, as in 2025 trends. | - DNS Logs (DS0003: Zeek DNS)<br>- Metrics | - **Splunk**: `index=network sourcetype=zeek_dns \| timechart span=1h count \| where count > avg(count)*4`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "DNS" \| summarize HourlyCount=count() by bin(Timestamp, 1h) \| where HourlyCount > avg(HourlyCount) * 4`.<br>- **ELK**: `FROM logs-zeek.dns-* \| STATS COUNT() BY date_histogram(@timestamp, '1h') \| WHERE COUNT() > AVG(COUNT()) * 4`. |
| 14. DGA with Suspicious Headers | DGA DNS C2 with custom headers, as in Cobalt Strike. | - DNS Logs (DS0003: Zeek DNS)<br>- Proxy Logs | - **Splunk**: `index=network sourcetype=zeek_dns header IN ("*X-Cobalt*", "*Custom-Header*") \| stats count by src_ip, header \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "DNS" and AdditionalFields.Header has_any ("X-Cobalt", "Custom-Header") \| summarize count() by DeviceIP, AdditionalFields.Header \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.dns-* \| WHERE dns.header : ("*X-Cobalt*" OR "*Custom-Header*") \| STATS COUNT() BY source.ip, dns.header HAVING COUNT() > 5`. |
| 15. DGA with Encrypted Payloads | Encrypted payloads in DGA DNS C2, as in APT41. | - DNS Logs (DS0003: Zeek DNS)<br>- Packet Analysis | - **Splunk**: `index=network sourcetype=zeek_dns payload_entropy > 7 \| stats count by src_ip, query \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "DNS" and AdditionalFields.PayloadEntropy > 7 \| summarize count() by DeviceIP, AdditionalFields.Query \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.dns-* \| WHERE dns.payload.entropy > 7 \| STATS COUNT() BY source.ip, dns.query HAVING COUNT() > 5`. |

### Data Encoding (T1132)

| Hypothesis | Description | Data Sources | Hunting Queries |
|------------|-------------|--------------|-----------------|
| 1. Base64 Encoded Payloads in Traffic | Adversaries use Base64 encoding for C2 data, as in APT41. High risk in environments with limited payload inspection. | - Network Traffic (DS0003: Zeek HTTP)<br>- Packet Analysis | - **Splunk**: `index=network sourcetype=zeek_http payload="*base64*" \| stats count by src_ip, uri \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "HTTP" and AdditionalFields.Payload contains "base64" \| summarize count() by DeviceIP, RemoteUrl \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE http.payload : "*base64*" \| STATS COUNT() BY source.ip, http.uri HAVING COUNT() > 5`. |
| 2. URL Encoded Data in C2 | URL encoding in C2 payloads, as in Turla. | - Network Traffic (DS0003: Zeek HTTP)<br>- Proxy Logs | - **Splunk**: `index=network sourcetype=zeek_http uri="*%20*" \| stats count by src_ip, uri \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "HTTP" and RemoteUrl contains "%20" \| summarize count() by DeviceIP, RemoteUrl \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE http.uri : "*%20*" \| STATS COUNT() BY source.ip, http.uri HAVING COUNT() > 5`. |
| 3. Data Encoding in DNS Queries | Encoded data in DNS queries for C2, as in APT29. | - DNS Logs (DS0003: Zeek DNS)<br>- Network Traffic | - **Splunk**: `index=network sourcetype=zeek_dns query="*base64*" \| stats count by src_ip, query \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "DNS" and AdditionalFields.Query contains "base64" \| summarize count() by DeviceIP, AdditionalFields.Query \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.dns-* \| WHERE dns.query : "*base64*" \| STATS COUNT() BY source.ip, dns.query HAVING COUNT() > 5`. |
| 4. Data Encoding with Anomalous Timing | Encoded data transfers with unusual timing, as in 2025 trends. | - Network Traffic (DS0003: Zeek HTTP)<br>- Metrics | - **Splunk**: `index=network sourcetype=zeek_http payload="*base64*" \| timechart span=1h count \| where count > avg(count)*4`.<br>- **KQL**: `DeviceNetworkEvents \| where AdditionalFields.Payload contains "base64" \| summarize HourlyCount=count() by bin(Timestamp, 1h) \| where HourlyCount > avg(HourlyCount) * 4`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE http.payload : "*base64*" \| STATS COUNT() BY date_histogram(@timestamp, '1h') \| WHERE COUNT() > AVG(COUNT()) * 4`. |
| 5. Data Encoding via Compromised Endpoints | Compromised endpoints encode data for C2, as in Turla. | - Process Creation (DS0009: Sysmon ID 1)<br>- Network Traffic | - **Splunk**: `index=endpoint sourcetype=sysmon EventCode=1 CommandLine="*base64*" \| join host [search index=network sourcetype=zeek_http payload="*base64*"] \| stats count by host, CommandLine, uri \| where count > 3`.<br>- **KQL**: `DeviceProcessEvents \| where ProcessCommandLine contains "base64" \| join kind=inner (DeviceNetworkEvents \| where AdditionalFields.Payload contains "base64") on DeviceName \| summarize count() by DeviceName, ProcessCommandLine, RemoteUrl \| where count_ > 3`.<br>- **ELK**: `FROM logs-endpoint.process-* \| WHERE process.command_line : "*base64*" \| JOIN logs-zeek.http-* ON host.name WHERE http.payload : "*base64*" \| STATS COUNT() BY host.name, process.command_line, http.uri HAVING COUNT() > 3`. |
| 6. Data Encoding in Cloud Environments | Encoded data in cloud C2, as in 2025 trends. | - Cloud Audit Logs (AWS CloudTrail)<br>- Network Traffic | - **Splunk**: `index=cloud sourcetype=aws:cloudtrail eventName="Invoke" AND userIdentity NOT IN (authorized_users) \| stats count by userIdentity, src_ip \| where count > 5`.<br>- **KQL**: `AWSCloudTrail \| where EventName == "Invoke" and Caller !in (authorizedUsers) \| summarize count() by Caller, SourceIP \| where count_ > 5`.<br>- **ELK**: `FROM logs-aws.cloudtrail-* \| WHERE event.action = 'Invoke' AND user.identity NOT IN ['authorized_users'] \| STATS COUNT() BY user.identity, source.ip HAVING COUNT() > 5`. |
| 7. Data Encoding with Encrypted Payloads | Encoded and encrypted payloads, as in APT41. | - Network Traffic (DS0003: Zeek HTTP)<br>- Packet Analysis | - **Splunk**: `index=network sourcetype=zeek_http payload_entropy > 7 \| stats count by src_ip, uri \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "HTTP" and AdditionalFields.PayloadEntropy > 7 \| summarize count() by DeviceIP, RemoteUrl \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE http.payload.entropy > 7 \| STATS COUNT() BY source.ip, http.uri HAVING COUNT() > 5`. |
| 8. Data Encoding in Non-Standard Environments | Data encoding in Linux, as in Turla. | - Network Traffic (DS0003: Zeek HTTP)<br>- Linux Logs | - **Splunk**: `index=linux sourcetype=auditd syscall="sendto" AND dest_port IN (80, 443) AND exe NOT IN (known_apps) \| stats count by exe, dest_ip \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where RemotePort in (80, 443) and InitiatingProcessName !in (knownApps) \| summarize count() by InitiatingProcessName, RemoteIP \| where count_ > 5`.<br>- **ELK**: `FROM logs-auditd-* \| WHERE syscall.name = "sendto" AND destination.port IN [80, 443] AND process.exe NOT IN ['known_apps'] \| STATS COUNT() BY process.exe, destination.ip HAVING COUNT() > 5`. |
| 9. Data Encoding with Anomalous Timing | Data encoding with unusual timing, as in 2025 trends. | - Network Traffic (DS0003: Zeek HTTP)<br>- Metrics | - **Splunk**: `index=network sourcetype=zeek_http \| timechart span=1h count \| where count > avg(count)*4`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "HTTP" \| summarize HourlyCount=count() by bin(Timestamp, 1h) \| where HourlyCount > avg(HourlyCount) * 4`.<br>- **ELK**: `FROM logs-zeek.http-* \| STATS COUNT() BY date_histogram(@timestamp, '1h') \| WHERE COUNT() > AVG(COUNT()) * 4`. |
| 10. Data Encoding with Suspicious Headers | Data encoding with custom headers, as in Cobalt Strike. | - Network Traffic (DS0003: Zeek HTTP)<br>- Proxy Logs | - **Splunk**: `index=network sourcetype=zeek_http header IN ("*X-Cobalt*", "*Custom-Header*") \| stats count by src_ip, header \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "HTTP" and AdditionalFields.Header has_any ("X-Cobalt", "Custom-Header") \| summarize count() by DeviceIP, AdditionalFields.Header \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE http.header : ("*X-Cobalt*" OR "*Custom-Header*") \| STATS COUNT() BY source.ip, http.header HAVING COUNT() > 5`. |
| 11. Data Encoding with Encrypted Payloads | Encrypted payloads in encoded data, as in APT41. | - Network Traffic (DS0003: Zeek HTTP)<br>- Packet Analysis | - **Splunk**: `index=network sourcetype=zeek_http payload_entropy > 7 \| stats count by src_ip, uri \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "HTTP" and AdditionalFields.PayloadEntropy > 7 \| summarize count() by DeviceIP, RemoteUrl \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE http.payload.entropy > 7 \| STATS COUNT() BY source.ip, http.uri HAVING COUNT() > 5`. |
| 12. Data Encoding in Non-Standard Environments | Data encoding in Linux, as in Turla. | - Network Traffic (DS0003: Zeek HTTP)<br>- Linux Logs | - **Splunk**: `index=linux sourcetype=auditd syscall="sendto" AND dest_port IN (80, 443) AND exe NOT IN (known_apps) \| stats count by exe, dest_ip \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where RemotePort in (80, 443) and InitiatingProcessName !in (knownApps) \| summarize count() by InitiatingProcessName, RemoteIP \| where count_ > 5`.<br>- **ELK**: `FROM logs-auditd-* \| WHERE syscall.name = "sendto" AND destination.port IN [80, 443] AND process.exe NOT IN ['known_apps'] \| STATS COUNT() BY process.exe, destination.ip HAVING COUNT() > 5`. |
| 13. Data Encoding with Anomalous Timing | Data encoding with unusual timing, as in 2025 trends. | - Network Traffic (DS0003: Zeek HTTP)<br>- Metrics | - **Splunk**: `index=network sourcetype=zeek_http \| timechart span=1h count \| where count > avg(count)*4`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "HTTP" \| summarize HourlyCount=count() by bin(Timestamp, 1h) \| where HourlyCount > avg(HourlyCount) * 4`.<br>- **ELK**: `FROM logs-zeek.http-* \| STATS COUNT() BY date_histogram(@timestamp, '1h') \| WHERE COUNT() > AVG(COUNT()) * 4`. |
| 14. Data Encoding with Suspicious Headers | Data encoding with custom headers, as in Cobalt Strike. | - Network Traffic (DS0003: Zeek HTTP)<br>- Proxy Logs | - **Splunk**: `index=network sourcetype=zeek_http header IN ("*X-Cobalt*", "*Custom-Header*") \| stats count by src_ip, header \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "HTTP" and AdditionalFields.Header has_any ("X-Cobalt", "Custom-Header") \| summarize count() by DeviceIP, AdditionalFields.Header \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE http.header : ("*X-Cobalt*" OR "*Custom-Header*") \| STATS COUNT() BY source.ip, http.header HAVING COUNT() > 5`. |
| 15. Data Encoding with Encrypted Payloads | Encrypted payloads in encoded data, as in APT41. | - Network Traffic (DS0003: Zeek HTTP)<br>- Packet Analysis | - **Splunk**: `index=network sourcetype=zeek_http payload_entropy > 7 \| stats count by src_ip, uri \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "HTTP" and AdditionalFields.PayloadEntropy > 7 \| summarize count() by DeviceIP, RemoteUrl \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE http.payload.entropy > 7 \| STATS COUNT() BY source.ip, http.uri HAVING COUNT() > 5`. |

### Data Obfuscation (T1001)

| Hypothesis | Description | Data Sources | Hunting Queries |
|------------|-------------|--------------|-----------------|
| 1. Obfuscated Payloads in Traffic | Adversaries obfuscate C2 payloads, as in APT41. High risk in environments with limited payload inspection. | - Network Traffic (DS0003: Zeek HTTP)<br>- Packet Analysis | - **Splunk**: `index=network sourcetype=zeek_http payload_entropy > 7 \| stats count by src_ip, uri \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "HTTP" and AdditionalFields.PayloadEntropy > 7 \| summarize count() by DeviceIP, RemoteUrl \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE http.payload.entropy > 7 \| STATS COUNT() BY source.ip, http.uri HAVING COUNT() > 5`. |
| 2. Obfuscated Data in DNS Queries | Obfuscated data in DNS for C2, as in Turla. | - DNS Logs (DS0003: Zeek DNS)<br>- Network Traffic | - **Splunk**: `index=network sourcetype=zeek_dns query="*obfuscate*" \| stats count by src_ip, query \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "DNS" and AdditionalFields.Query contains "obfuscate" \| summarize count() by DeviceIP, AdditionalFields.Query \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.dns-* \| WHERE dns.query : "*obfuscate*" \| STATS COUNT() BY source.ip, dns.query HAVING COUNT() > 5`. |
| 3. Obfuscated Data with Anomalous Timing | Obfuscated data transfers with unusual timing, as in 2025 trends. | - Network Traffic (DS0003: Zeek HTTP)<br>- Metrics | - **Splunk**: `index=network sourcetype=zeek_http payload_entropy > 7 \| timechart span=1h count \| where count > avg(count)*4`.<br>- **KQL**: `DeviceNetworkEvents \| where AdditionalFields.PayloadEntropy > 7 \| summarize HourlyCount=count() by bin(Timestamp, 1h) \| where HourlyCount > avg(HourlyCount) * 4`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE http.payload.entropy > 7 \| STATS COUNT() BY date_histogram(@timestamp, '1h') \| WHERE COUNT() > AVG(COUNT()) * 4`. |
| 4. Obfuscated Data via Compromised Endpoints | Compromised endpoints obfuscate data for C2, as in Turla. | - Process Creation (DS0009: Sysmon ID 1)<br>- Network Traffic | - **Splunk**: `index=endpoint sourcetype=sysmon EventCode=1 CommandLine="*obfuscate*" \| join host [search index=network sourcetype=zeek_http payload_entropy > 7] \| stats count by host, CommandLine, uri \| where count > 3`.<br>- **KQL**: `DeviceProcessEvents \| where ProcessCommandLine contains "obfuscate" \| join kind=inner (DeviceNetworkEvents \| where AdditionalFields.PayloadEntropy > 7) on DeviceName \| summarize count() by DeviceName, ProcessCommandLine, RemoteUrl \| where count_ > 3`.<br>- **ELK**: `FROM logs-endpoint.process-* \| WHERE process.command_line : "*obfuscate*" \| JOIN logs-zeek.http-* ON host.name WHERE http.payload.entropy > 7 \| STATS COUNT() BY host.name, process.command_line, http.uri HAVING COUNT() > 3`. |
| 5. Obfuscated Data in Cloud Environments | Obfuscated data in cloud C2, as in 2025 trends. | - Cloud Audit Logs (AWS CloudTrail)<br>- Network Traffic | - **Splunk**: `index=cloud sourcetype=aws:cloudtrail eventName="Invoke" AND userIdentity NOT IN (authorized_users) \| stats count by userIdentity, src_ip \| where count > 5`.<br>- **KQL**: `AWSCloudTrail \| where EventName == "Invoke" and Caller !in (authorizedUsers) \| summarize count() by Caller, SourceIP \| where count_ > 5`.<br>- **ELK**: `FROM logs-aws.cloudtrail-* \| WHERE event.action = 'Invoke' AND user.identity NOT IN ['authorized_users'] \| STATS COUNT() BY user.identity, source.ip HAVING COUNT() > 5`. |
| 6. Obfuscated Data with Encrypted Payloads | Obfuscated and encrypted payloads, as in APT41. | - Network Traffic (DS0003: Zeek HTTP)<br>- Packet Analysis | - **Splunk**: `index=network sourcetype=zeek_http payload_entropy > 7 \| stats count by src_ip, uri \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "HTTP" and AdditionalFields.PayloadEntropy > 7 \| summarize count() by DeviceIP, RemoteUrl \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE http.payload.entropy > 7 \| STATS COUNT() BY source.ip, http.uri HAVING COUNT() > 5`. |
| 7. Obfuscated Data in Non-Standard Environments | Obfuscated data in Linux, as in Turla. | - Network Traffic (DS0003: Zeek HTTP)<br>- Linux Logs | - **Splunk**: `index=linux sourcetype=auditd syscall="sendto" AND dest_port IN (80, 443) AND exe NOT IN (known_apps) \| stats count by exe, dest_ip \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where RemotePort in (80, 443) and InitiatingProcessName !in (knownApps) \| summarize count() by InitiatingProcessName, RemoteIP \| where count_ > 5`.<br>- **ELK**: `FROM logs-auditd-* \| WHERE syscall.name = "sendto" AND destination.port IN [80, 443] AND process.exe NOT IN ['known_apps'] \| STATS COUNT() BY process.exe, destination.ip HAVING COUNT() > 5`. |
| 8. Obfuscated Data with Anomalous Timing | Obfuscated data with unusual timing, as in 2025 trends. | - Network Traffic (DS0003: Zeek HTTP)<br>- Metrics | - **Splunk**: `index=network sourcetype=zeek_http \| timechart span=1h count \| where count > avg(count)*4`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "HTTP" \| summarize HourlyCount=count() by bin(Timestamp, 1h) \| where HourlyCount > avg(HourlyCount) * 4`.<br>- **ELK**: `FROM logs-zeek.http-* \| STATS COUNT() BY date_histogram(@timestamp, '1h') \| WHERE COUNT() > AVG(COUNT()) * 4`. |
| 9. Obfuscated Data with Suspicious Headers | Obfuscated data with custom headers, as in Cobalt Strike. | - Network Traffic (DS0003: Zeek HTTP)<br>- Proxy Logs | - **Splunk**: `index=network sourcetype=zeek_http header IN ("*X-Cobalt*", "*Custom-Header*") \| stats count by src_ip, header \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "HTTP" and AdditionalFields.Header has_any ("X-Cobalt", "Custom-Header") \| summarize count() by DeviceIP, AdditionalFields.Header \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE http.header : ("*X-Cobalt*" OR "*Custom-Header*") \| STATS COUNT() BY source.ip, http.header HAVING COUNT() > 5`. |
| 10. Obfuscated Data with Encrypted Payloads | Encrypted payloads in obfuscated data, as in APT41. | - Network Traffic (DS0003: Zeek HTTP)<br>- Packet Analysis | - **Splunk**: `index=network sourcetype=zeek_http payload_entropy > 7 \| stats count by src_ip, uri \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "HTTP" and AdditionalFields.PayloadEntropy > 7 \| summarize count() by DeviceIP, RemoteUrl \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE http.payload.entropy > 7 \| STATS COUNT() BY source.ip, http.uri HAVING COUNT() > 5`. |
| 11. Obfuscated Data in Non-Standard Environments | Obfuscated data in Linux, as in Turla. | - Network Traffic (DS0003: Zeek HTTP)<br>- Linux Logs | - **Splunk**: `index=linux sourcetype=auditd syscall="sendto" AND dest_port IN (80, 443) AND exe NOT IN (known_apps) \| stats count by exe, dest_ip \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where RemotePort in (80, 443) and InitiatingProcessName !in (knownApps) \| summarize count() by InitiatingProcessName, RemoteIP \| where count_ > 5`.<br>- **ELK**: `FROM logs-auditd-* \| WHERE syscall.name = "sendto" AND destination.port IN [80, 443] AND process.exe NOT IN ['known_apps'] \| STATS COUNT() BY process.exe, destination.ip HAVING COUNT() > 5`. |
| 12. Obfuscated Data with Anomalous Timing | Obfuscated data with unusual timing, as in 2025 trends. | - Network Traffic (DS0003: Zeek HTTP)<br>- Metrics | - **Splunk**: `index=network sourcetype=zeek_http \| timechart span=1h count \| where count > avg(count)*4`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "HTTP" \| summarize HourlyCount=count() by bin(Timestamp, 1h) \| where HourlyCount > avg(HourlyCount) * 4`.<br>- **ELK**: `FROM logs-zeek.http-* \| STATS COUNT() BY date_histogram(@timestamp, '1h') \| WHERE COUNT() > AVG(COUNT()) * 4`. |
| 13. Obfuscated Data with Suspicious Headers | Obfuscated data with custom headers, as in Cobalt Strike. | - Network Traffic (DS0003: Zeek HTTP)<br>- Proxy Logs | - **Splunk**: `index=network sourcetype=zeek_http header IN ("*X-Cobalt*", "*Custom-Header*") \| stats count by src_ip, header \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "HTTP" and AdditionalFields.Header has_any ("X-Cobalt", "Custom-Header") \| summarize count() by DeviceIP, AdditionalFields.Header \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE http.header : ("*X-Cobalt*" OR "*Custom-Header*") \| STATS COUNT() BY source.ip, http.header HAVING COUNT() > 5`. |
| 14. Obfuscated Data with Encrypted Payloads | Encrypted payloads in obfuscated data, as in APT41. | - Network Traffic (DS0003: Zeek HTTP)<br>- Packet Analysis | - **Splunk**: `index=network sourcetype=zeek_http payload_entropy > 7 \| stats count by src_ip, uri \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "HTTP" and AdditionalFields.PayloadEntropy > 7 \| summarize count() by DeviceIP, RemoteUrl \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE http.payload.entropy > 7 \| STATS COUNT() BY source.ip, http.uri HAVING COUNT() > 5`. |
| 15. Obfuscated Data in Non-Standard Environments | Obfuscated data in Linux, as in Turla. | - Network Traffic (DS0003: Zeek HTTP)<br>- Linux Logs | - **Splunk**: `index=linux sourcetype=auditd syscall="sendto" AND dest_port IN (80, 443) AND exe NOT IN (known_apps) \| stats count by exe, dest_ip \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where RemotePort in (80, 443) and InitiatingProcessName !in (knownApps) \| summarize count() by InitiatingProcessName, RemoteIP \| where count_ > 5`.<br>- **ELK**: `FROM logs-auditd-* \| WHERE syscall.name = "sendto" AND destination.port IN [80, 443] AND process.exe NOT IN ['known_apps'] \| STATS COUNT() BY process.exe, destination.ip HAVING COUNT() > 5`.

### Dead Drop Resolver (T1102.003)

| Hypothesis | Description | Data Sources | Hunting Queries |
|------------|-------------|--------------|-----------------|
| 1. Suspicious Access to Dead Drop Sites | Adversaries use dead drop resolvers like pastebin or GitHub Gists for C2, as in APT41 campaigns. High risk in environments with limited web traffic monitoring. | - Network Traffic (DS0003: Zeek HTTP)<br>- Proxy Logs | - **Splunk**: `index=network sourcetype=zeek_http uri IN ("*pastebin.com*", "*gist.github.com*") AND method="GET" \| stats count by src_ip, uri \| where count > 5` (Detects frequent access to dead drop sites).<br>- **KQL**: `DeviceNetworkEvents \| where RemoteUrl has_any ("pastebin.com", "gist.github.com") and AdditionalFields.Method == "GET" \| summarize count() by DeviceIP, RemoteUrl \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE http.uri : ("*pastebin.com*" OR "*gist.github.com*") AND http.method = 'GET' \| STATS COUNT() BY source.ip, http.uri HAVING COUNT() > 5`. |
| 2. Dead Drop Resolver with Encoded Data | Encoded data retrieved from dead drop sites for C2, as in Turla. | - Network Traffic (DS0003: Zeek HTTP)<br>- Packet Analysis | - **Splunk**: `index=network sourcetype=zeek_http uri IN ("*pastebin.com*", "*gist.github.com*") AND payload_entropy > 7 \| stats count by src_ip, uri \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where RemoteUrl has_any ("pastebin.com", "gist.github.com") and AdditionalFields.PayloadEntropy > 7 \| summarize count() by DeviceIP, RemoteUrl \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE http.uri : ("*pastebin.com*" OR "*gist.github.com*") AND http.payload.entropy > 7 \| STATS COUNT() BY source.ip, http.uri HAVING COUNT() > 5`. |
| 3. Dead Drop Resolver Access from Compromised Endpoints | Compromised endpoints access dead drop sites, as in FIN7. | - Process Creation (DS0009: Sysmon ID 1)<br>- Network Traffic | - **Splunk**: `index=endpoint sourcetype=sysmon EventCode=1 CommandLine="*dead drop*" \| join host [search index=network sourcetype=zeek_http uri="*pastebin.com*"] \| stats count by host, CommandLine, uri \| where count > 3`.<br>- **KQL**: `DeviceProcessEvents \| where ProcessCommandLine contains "dead drop" \| join kind=inner (DeviceNetworkEvents \| where RemoteUrl contains "pastebin.com") on DeviceName \| summarize count() by DeviceName, ProcessCommandLine, RemoteUrl \| where count_ > 3`.<br>- **ELK**: `FROM logs-endpoint.process-* \| WHERE process.command_line : "*dead drop*" \| JOIN logs-zeek.http-* ON host.name WHERE http.uri : "*pastebin.com*" \| STATS COUNT() BY host.name, process.command_line, http.uri HAVING COUNT() > 3`. |
| 4. Dead Drop Resolver with Anomalous Timing | Dead drop access with unusual timing, as in 2025 trends. | - Network Traffic (DS0003: Zeek HTTP)<br>- Metrics | - **Splunk**: `index=network sourcetype=zeek_http uri IN ("*pastebin.com*", "*gist.github.com*") \| timechart span=1h count \| where count > avg(count)*4`.<br>- **KQL**: `DeviceNetworkEvents \| where RemoteUrl has_any ("pastebin.com", "gist.github.com") \| summarize HourlyCount=count() by bin(Timestamp, 1h) \| where HourlyCount > avg(HourlyCount) * 4`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE http.uri : ("*pastebin.com*" OR "*gist.github.com*") \| STATS COUNT() BY date_histogram(@timestamp, '1h') \| WHERE COUNT() > AVG(COUNT()) * 4`. |
| 5. Dead Drop Resolver with Encrypted Payloads | Encrypted payloads retrieved from dead drop sites, as in APT41. | - Network Traffic (DS0003: Zeek HTTP)<br>- Packet Analysis | - **Splunk**: `index=network sourcetype=zeek_http uri IN ("*pastebin.com*", "*gist.github.com*") AND payload_entropy > 7 \| stats count by src_ip, uri \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where RemoteUrl has_any ("pastebin.com", "gist.github.com") and AdditionalFields.PayloadEntropy > 7 \| summarize count() by DeviceIP, RemoteUrl \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE http.uri : ("*pastebin.com*" OR "*gist.github.com*") AND http.payload.entropy > 7 \| STATS COUNT() BY source.ip, http.uri HAVING COUNT() > 5`. |
| 6. Dead Drop Resolver in Cloud Environments | Dead drop access in cloud, as in 2025 trends. | - Cloud Audit Logs (AWS CloudTrail)<br>- Network Traffic | - **Splunk**: `index=cloud sourcetype=aws:cloudtrail eventName="Invoke" AND userIdentity NOT IN (authorized_users) \| stats count by userIdentity, src_ip \| where count > 5`.<br>- **KQL**: `AWSCloudTrail \| where EventName == "Invoke" and Caller !in (authorizedUsers) \| summarize count() by Caller, SourceIP \| where count_ > 5`.<br>- **ELK**: `FROM logs-aws.cloudtrail-* \| WHERE event.action = 'Invoke' AND user.identity NOT IN ['authorized_users'] \| STATS COUNT() BY user.identity, source.ip HAVING COUNT() > 5`. |
| 7. Dead Drop Resolver with Suspicious Headers | Dead drop access with custom headers, as in Cobalt Strike. | - Network Traffic (DS0003: Zeek HTTP)<br>- Proxy Logs | - **Splunk**: `index=network sourcetype=zeek_http uri IN ("*pastebin.com*", "*gist.github.com*") AND header IN ("*X-Cobalt*", "*Custom-Header*") \| stats count by src_ip, header \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where RemoteUrl has_any ("pastebin.com", "gist.github.com") and AdditionalFields.Header has_any ("X-Cobalt", "Custom-Header") \| summarize count() by DeviceIP, AdditionalFields.Header \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE http.uri : ("*pastebin.com*" OR "*gist.github.com*") AND http.header : ("*X-Cobalt*" OR "*Custom-Header*") \| STATS COUNT() BY source.ip, http.header HAVING COUNT() > 5`. |
| 8. Dead Drop Resolver in Non-Standard Environments | Dead drop access in Linux, as in Turla. | - Network Traffic (DS0003: Zeek HTTP)<br>- Linux Logs | - **Splunk**: `index=linux sourcetype=auditd syscall="sendto" AND dest_port IN (80, 443) AND exe NOT IN (known_apps) \| stats count by exe, dest_ip \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where RemotePort in (80, 443) and InitiatingProcessName !in (knownApps) \| summarize count() by InitiatingProcessName, RemoteIP \| where count_ > 5`.<br>- **ELK**: `FROM logs-auditd-* \| WHERE syscall.name = "sendto" AND destination.port IN [80, 443] AND process.exe NOT IN ['known_apps'] \| STATS COUNT() BY process.exe, destination.ip HAVING COUNT() > 5`. |
| 9. Dead Drop Resolver with Anomalous Timing | Dead drop access with unusual timing, as in 2025 trends. | - Network Traffic (DS0003: Zeek HTTP)<br>- Metrics | - **Splunk**: `index=network sourcetype=zeek_http uri IN ("*pastebin.com*", "*gist.github.com*") \| timechart span=1h count \| where count > avg(count)*4`.<br>- **KQL**: `DeviceNetworkEvents \| where RemoteUrl has_any ("pastebin.com", "gist.github.com") \| summarize HourlyCount=count() by bin(Timestamp, 1h) \| where HourlyCount > avg(HourlyCount) * 4`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE http.uri : ("*pastebin.com*" OR "*gist.github.com*") \| STATS COUNT() BY date_histogram(@timestamp, '1h') \| WHERE COUNT() > AVG(COUNT()) * 4`. |
| 10. Dead Drop Resolver with Suspicious Headers | Dead drop access with custom headers, as in Cobalt Strike. | - Network Traffic (DS0003: Zeek HTTP)<br>- Proxy Logs | - **Splunk**: `index=network sourcetype=zeek_http uri IN ("*pastebin.com*", "*gist.github.com*") AND header IN ("*X-Cobalt*", "*Custom-Header*") \| stats count by src_ip, header \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where RemoteUrl has_any ("pastebin.com", "gist.github.com") and AdditionalFields.Header has_any ("X-Cobalt", "Custom-Header") \| summarize count() by DeviceIP, AdditionalFields.Header \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE http.uri : ("*pastebin.com*" OR "*gist.github.com*") AND http.header : ("*X-Cobalt*" OR "*Custom-Header*") \| STATS COUNT() BY source.ip, http.header HAVING COUNT() > 5`. |
| 11. Dead Drop Resolver with Encrypted Payloads | Encrypted payloads retrieved from dead drop sites, as in APT41. | - Network Traffic (DS0003: Zeek HTTP)<br>- Packet Analysis | - **Splunk**: `index=network sourcetype=zeek_http uri IN ("*pastebin.com*", "*gist.github.com*") AND payload_entropy > 7 \| stats count by src_ip, uri \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where RemoteUrl has_any ("pastebin.com", "gist.github.com") and AdditionalFields.PayloadEntropy > 7 \| summarize count() by DeviceIP, RemoteUrl \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE http.uri : ("*pastebin.com*" OR "*gist.github.com*") AND http.payload.entropy > 7 \| STATS COUNT() BY source.ip, http.uri HAVING COUNT() > 5`. |
| 12. Dead Drop Resolver in Cloud Environments | Dead drop access in cloud, as in 2025 trends. | - Cloud Audit Logs (AWS CloudTrail)<br>- Network Traffic | - **Splunk**: `index=cloud sourcetype=aws:cloudtrail eventName="Invoke" AND userIdentity NOT IN (authorized_users) \| stats count by userIdentity, src_ip \| where count > 5`.<br>- **KQL**: `AWSCloudTrail \| where EventName == "Invoke" and Caller !in (authorizedUsers) \| summarize count() by Caller, SourceIP \| where count_ > 5`.<br>- **ELK**: `FROM logs-aws.cloudtrail-* \| WHERE event.action = 'Invoke' AND user.identity NOT IN ['authorized_users'] \| STATS COUNT() BY user.identity, source.ip HAVING COUNT() > 5`. |
| 13. Dead Drop Resolver with Anomalous Timing | Dead drop access with unusual timing, as in 2025 trends. | - Network Traffic (DS0003: Zeek HTTP)<br>- Metrics | - **Splunk**: `index=network sourcetype=zeek_http uri IN ("*pastebin.com*", "*gist.github.com*") \| timechart span=1h count \| where count > avg(count)*4`.<br>- **KQL**: `DeviceNetworkEvents \| where RemoteUrl has_any ("pastebin.com", "gist.github.com") \| summarize HourlyCount=count() by bin(Timestamp, 1h) \| where HourlyCount > avg(HourlyCount) * 4`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE http.uri : ("*pastebin.com*" OR "*gist.github.com*") \| STATS COUNT() BY date_histogram(@timestamp, '1h') \| WHERE COUNT() > AVG(COUNT()) * 4`. |
| 14. Dead Drop Resolver with Suspicious Headers | Dead drop access with custom headers, as in Cobalt Strike. | - Network Traffic (DS0003: Zeek HTTP)<br>- Proxy Logs | - **Splunk**: `index=network sourcetype=zeek_http uri IN ("*pastebin.com*", "*gist.github.com*") AND header IN ("*X-Cobalt*", "*Custom-Header*") \| stats count by src_ip, header \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where RemoteUrl has_any ("pastebin.com", "gist.github.com") and AdditionalFields.Header has_any ("X-Cobalt", "Custom-Header") \| summarize count() by DeviceIP, AdditionalFields.Header \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE http.uri : ("*pastebin.com*" OR "*gist.github.com*") AND http.header : ("*X-Cobalt*" OR "*Custom-Header*") \| STATS COUNT() BY source.ip, http.header HAVING COUNT() > 5`. |
| 15. Dead Drop Resolver with Encrypted Payloads | Encrypted payloads retrieved from dead drop sites, as in APT41. | - Network Traffic (DS0003: Zeek HTTP)<br>- Packet Analysis | - **Splunk**: `index=network sourcetype=zeek_http uri IN ("*pastebin.com*", "*gist.github.com*") AND payload_entropy > 7 \| stats count by src_ip, uri \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where RemoteUrl has_any ("pastebin.com", "gist.github.com") and AdditionalFields.PayloadEntropy > 7 \| summarize count() by DeviceIP, RemoteUrl \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE http.uri : ("*pastebin.com*" OR "*gist.github.com*") AND http.payload.entropy > 7 \| STATS COUNT() BY source.ip, http.uri HAVING COUNT() > 5`. |

### Domain Fronting (T1090.004)

| Hypothesis | Description | Data Sources | Hunting Queries |
|------------|-------------|--------------|-----------------|
| 1. Domain Fronting via CDN Traffic | Adversaries use domain fronting through CDNs for C2, as in APT41. High risk in environments with limited TLS inspection. | - Network Traffic (DS0003: Zeek SSL)<br>- Proxy Logs | - **Splunk**: `index=network sourcetype=zeek_ssl sni NOT IN (host) AND dest_ip IN (cdn_ips) \| stats count by src_ip, sni, host \| where count > 5` (Detects SNI mismatch in CDN traffic).<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "SSL" and AdditionalFields.SNI !in AdditionalFields.Host and RemoteIP in (cdnIPs) \| summarize count() by DeviceIP, AdditionalFields.SNI, AdditionalFields.Host \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.ssl-* \| WHERE ssl.sni NOT IN ssl.host AND destination.ip IN ['cdn_ips'] \| STATS COUNT() BY source.ip, ssl.sni, ssl.host HAVING COUNT() > 5`. |
| 2. Domain Fronting with High TLS Traffic | High TLS traffic to CDNs with mismatched SNI, as in Turla. | - Network Traffic (DS0003: Zeek SSL)<br>- Metrics | - **Splunk**: `index=network sourcetype=zeek_ssl dest_port=443 AND sni NOT IN (host) \| timechart span=1h count \| where count > avg(count)*4`.<br>- **KQL**: `DeviceNetworkEvents \| where RemotePort == 443 and AdditionalFields.SNI !in AdditionalFields.Host \| summarize HourlyCount=count() by bin(Timestamp, 1h) \| where HourlyCount > avg(HourlyCount) * 4`.<br>- **ELK**: `FROM logs-zeek.ssl-* \| WHERE destination.port = 443 AND ssl.sni NOT IN ssl.host \| STATS COUNT() BY date_histogram(@timestamp, '1h') \| WHERE COUNT() > AVG(COUNT()) * 4`. |
| 3. Domain Fronting from Compromised Endpoints | Compromised endpoints use domain fronting for C2, as in FIN7. | - Process Creation (DS0009: Sysmon ID 1)<br>- Network Traffic | - **Splunk**: `index=endpoint sourcetype=sysmon EventCode=1 CommandLine="*fronting*" \| join host [search index=network sourcetype=zeek_ssl sni NOT IN (host)] \| stats count by host, CommandLine, sni \| where count > 3`.<br>- **KQL**: `DeviceProcessEvents \| where ProcessCommandLine contains "fronting" \| join kind=inner (DeviceNetworkEvents \| where Protocol == "SSL" and AdditionalFields.SNI !in AdditionalFields.Host) on DeviceName \| summarize count() by DeviceName, ProcessCommandLine, AdditionalFields.SNI \| where count_ > 3`.<br>- **ELK**: `FROM logs-endpoint.process-* \| WHERE process.command_line : "*fronting*" \| JOIN logs-zeek.ssl-* ON host.name WHERE ssl.sni NOT IN ssl.host \| STATS COUNT() BY host.name, process.command_line, ssl.sni HAVING COUNT() > 3`. |
| 4. Domain Fronting with Anomalous Timing | Domain fronting with unusual timing, as in 2025 trends. | - Network Traffic (DS0003: Zeek SSL)<br>- Metrics | - **Splunk**: `index=network sourcetype=zeek_ssl sni NOT IN (host) \| timechart span=1h count \| where count > avg(count)*4`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "SSL" and AdditionalFields.SNI !in AdditionalFields.Host \| summarize HourlyCount=count() by bin(Timestamp, 1h) \| where HourlyCount > avg(HourlyCount) * 4`.<br>- **ELK**: `FROM logs-zeek.ssl-* \| WHERE ssl.sni NOT IN ssl.host \| STATS COUNT() BY date_histogram(@timestamp, '1h') \| WHERE COUNT() > AVG(COUNT()) * 4`. |
| 5. Domain Fronting with Encrypted Payloads | Encrypted payloads in domain fronting traffic, as in APT41. | - Network Traffic (DS0003: Zeek SSL)<br>- Packet Analysis | - **Splunk**: `index=network sourcetype=zeek_ssl sni NOT IN (host) AND payload_entropy > 7 \| stats count by src_ip, sni \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "SSL" and AdditionalFields.SNI !in AdditionalFields.Host and AdditionalFields.PayloadEntropy > 7 \| summarize count() by DeviceIP, AdditionalFields.SNI \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.ssl-* \| WHERE ssl.sni NOT IN ssl.host AND ssl.payload.entropy > 7 \| STATS COUNT() BY source.ip, ssl.sni HAVING COUNT() > 5`. |
| 6. Domain Fronting in Cloud Environments | Domain fronting in cloud, as in 2025 trends. | - Cloud Audit Logs (AWS CloudTrail)<br>- Network Traffic | - **Splunk**: `index=cloud sourcetype=aws:cloudtrail eventName="Invoke" AND userIdentity NOT IN (authorized_users) \| stats count by userIdentity, src_ip \| where count > 5`.<br>- **KQL**: `AWSCloudTrail \| where EventName == "Invoke" and Caller !in (authorizedUsers) \| summarize count() by Caller, SourceIP \| where count_ > 5`.<br>- **ELK**: `FROM logs-aws.cloudtrail-* \| WHERE event.action = 'Invoke' AND user.identity NOT IN ['authorized_users'] \| STATS COUNT() BY user.identity, source.ip HAVING COUNT() > 5`. |
| 7. Domain Fronting with Suspicious Headers | Domain fronting with custom headers, as in Cobalt Strike. | - Network Traffic (DS0003: Zeek HTTP)<br>- Proxy Logs | - **Splunk**: `index=network sourcetype=zeek_http header IN ("*X-Cobalt*", "*Custom-Header*") \| stats count by src_ip, header \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "HTTP" and AdditionalFields.Header has_any ("X-Cobalt", "Custom-Header") \| summarize count() by DeviceIP, AdditionalFields.Header \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE http.header : ("*X-Cobalt*" OR "*Custom-Header*") \| STATS COUNT() BY source.ip, http.header HAVING COUNT() > 5`. |
| 8. Domain Fronting in Non-Standard Environments | Domain fronting in Linux, as in Turla. | - Network Traffic (DS0003: Zeek SSL)<br>- Linux Logs | - **Splunk**: `index=linux sourcetype=auditd syscall="connect" AND dest_port=443 AND exe NOT IN (known_apps) \| stats count by exe, dest_ip \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where RemotePort == 443 and InitiatingProcessName !in (knownApps) \| summarize count() by InitiatingProcessName, RemoteIP \| where count_ > 5`.<br>- **ELK**: `FROM logs-auditd-* \| WHERE syscall.name = "connect" AND destination.port = 443 AND process.exe NOT IN ['known_apps'] \| STATS COUNT() BY process.exe, destination.ip HAVING COUNT() > 5`. |
| 9. Domain Fronting with Anomalous Timing | Domain fronting with unusual timing, as in 2025 trends. | - Network Traffic (DS0003: Zeek SSL)<br>- Metrics | - **Splunk**: `index=network sourcetype=zeek_ssl \| timechart span=1h count \| where count > avg(count)*4`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "SSL" \| summarize HourlyCount=count() by bin(Timestamp, 1h) \| where HourlyCount > avg(HourlyCount) * 4`.<br>- **ELK**: `FROM logs-zeek.ssl-* \| STATS COUNT() BY date_histogram(@timestamp, '1h') \| WHERE COUNT() > AVG(COUNT()) * 4`. |
| 10. Domain Fronting with Suspicious Headers | Domain fronting with custom headers, as in Cobalt Strike. | - Network Traffic (DS0003: Zeek HTTP)<br>- Proxy Logs | - **Splunk**: `index=network sourcetype=zeek_http header IN ("*X-Cobalt*", "*Custom-Header*") \| stats count by src_ip, header \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "HTTP" and AdditionalFields.Header has_any ("X-Cobalt", "Custom-Header") \| summarize count() by DeviceIP, AdditionalFields.Header \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE http.header : ("*X-Cobalt*" OR "*Custom-Header*") \| STATS COUNT() BY source.ip, http.header HAVING COUNT() > 5`. |
| 11. Domain Fronting with Encrypted Payloads | Encrypted payloads in domain fronting, as in APT41. | - Network Traffic (DS0003: Zeek SSL)<br>- Packet Analysis | - **Splunk**: `index=network sourcetype=zeek_ssl payload_entropy > 7 \| stats count by src_ip, sni \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "SSL" and AdditionalFields.PayloadEntropy > 7 \| summarize count() by DeviceIP, AdditionalFields.SNI \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.ssl-* \| WHERE ssl.payload.entropy > 7 \| STATS COUNT() BY source.ip, ssl.sni HAVING COUNT() > 5`. |
| 12. Domain Fronting in Non-Standard Environments | Domain fronting in Linux, as in Turla. | - Network Traffic (DS0003: Zeek SSL)<br>- Linux Logs | - **Splunk**: `index=linux sourcetype=auditd syscall="connect" AND dest_port=443 AND exe NOT IN (known_apps) \| stats count by exe, dest_ip \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where RemotePort == 443 and InitiatingProcessName !in (knownApps) \| summarize count() by InitiatingProcessName, RemoteIP \| where count_ > 5`.<br>- **ELK**: `FROM logs-auditd-* \| WHERE syscall.name = "connect" AND destination.port = 443 AND process.exe NOT IN ['known_apps'] \| STATS COUNT() BY process.exe, destination.ip HAVING COUNT() > 5`. |
| 13. Domain Fronting with Anomalous Timing | Domain fronting with unusual timing, as in 2025 trends. | - Network Traffic (DS0003: Zeek SSL)<br>- Metrics | - **Splunk**: `index=network sourcetype=zeek_ssl \| timechart span=1h count \| where count > avg(count)*4`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "SSL" \| summarize HourlyCount=count() by bin(Timestamp, 1h) \| where HourlyCount > avg(HourlyCount) * 4`.<br>- **ELK**: `FROM logs-zeek.ssl-* \| STATS COUNT() BY date_histogram(@timestamp, '1h') \| WHERE COUNT() > AVG(COUNT()) * 4`. |
| 14. Domain Fronting with Suspicious Headers | Domain fronting with custom headers, as in Cobalt Strike. | - Network Traffic (DS0003: Zeek HTTP)<br>- Proxy Logs | - **Splunk**: `index=network sourcetype=zeek_http header IN ("*X-Cobalt*", "*Custom-Header*") \| stats count by src_ip, header \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "HTTP" and AdditionalFields.Header has_any ("X-Cobalt", "Custom-Header") \| summarize count() by DeviceIP, AdditionalFields.Header \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE http.header : ("*X-Cobalt*" OR "*Custom-Header*") \| STATS COUNT() BY source.ip, http.header HAVING COUNT() > 5`. |
| 15. Domain Fronting with Encrypted Payloads | Encrypted payloads in domain fronting, as in APT41. | - Network Traffic (DS0003: Zeek SSL)<br>- Packet Analysis | - **Splunk**: `index=network sourcetype=zeek_ssl payload_entropy > 7 \| stats count by src_ip, sni \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "SSL" and AdditionalFields.PayloadEntropy > 7 \| summarize count() by DeviceIP, RemoteUrl \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.ssl-* \| WHERE ssl.payload.entropy > 7 \| STATS COUNT() BY source.ip, ssl.sni HAVING COUNT() > 5`. |

### Domain Generation Algorithms (T1568.002)

| Hypothesis | Description | Data Sources | Hunting Queries |
|------------|-------------|--------------|-----------------|
| 1. DGA Traffic with High Failed Resolutions | Adversaries use DGA for C2 with many NXDOMAIN responses, as in APT41. High risk in environments with limited DNS monitoring. | - DNS Logs (DS0003: Zeek DNS)<br>- Network Traffic | - **Splunk**: `index=network sourcetype=zeek_dns rcode_name="NXDOMAIN" \| stats count by src_ip, query \| where count > 10`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "DNS" and AdditionalFields.RCodeName == "NXDOMAIN" \| summarize count() by DeviceIP, AdditionalFields.Query \| where count_ > 10`.<br>- **ELK**: `FROM logs-zeek.dns-* \| WHERE dns.rcode.name = "NXDOMAIN" \| STATS COUNT() BY source.ip, dns.query HAVING COUNT() > 10`. |
| 2. DGA with Random Domain Patterns | DGA-generated domains with random strings, as in Turla. | - DNS Logs (DS0003: Zeek DNS)<br>- Network Traffic | - **Splunk**: `index=network sourcetype=zeek_dns query="*random*" \| stats count by src_ip, query \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "DNS" and AdditionalFields.Query contains "random" \| summarize count() by DeviceIP, AdditionalFields.Query \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.dns-* \| WHERE dns.query : "*random*" \| STATS COUNT() BY source.ip, dns.query HAVING COUNT() > 5`. |
| 3. DGA with High Entropy Queries | DGA queries with high entropy, as in APT29. | - DNS Logs (DS0003: Zeek DNS)<br>- Packet Analysis | - **Splunk**: `index=network sourcetype=zeek_dns query_entropy > 3 \| stats count by src_ip, query \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "DNS" and AdditionalFields.QueryEntropy > 3 \| summarize count() by DeviceIP, AdditionalFields.Query \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.dns-* \| WHERE dns.query.entropy > 3 \| STATS COUNT() BY source.ip, dns.query HAVING COUNT() > 5`. |
| 4. DGA from Compromised Endpoints | Compromised endpoints generate DGA queries, as in Turla. | - Process Creation (DS0009: Sysmon ID 1)<br>- DNS Logs | - **Splunk**: `index=endpoint sourcetype=sysmon EventCode=1 CommandLine="*dga*" \| join host [search index=network sourcetype=zeek_dns rcode_name="NXDOMAIN"] \| stats count by host, CommandLine, query \| where count > 3`.<br>- **KQL**: `DeviceProcessEvents \| where ProcessCommandLine contains "dga" \| join kind=inner (DeviceNetworkEvents \| where Protocol == "DNS" and AdditionalFields.RCodeName == "NXDOMAIN") on DeviceName \| summarize count() by DeviceName, ProcessCommandLine, AdditionalFields.Query \| where count_ > 3`.<br>- **ELK**: `FROM logs-endpoint.process-* \| WHERE process.command_line : "*dga*" \| JOIN logs-zeek.dns-* ON host.name WHERE dns.rcode.name = "NXDOMAIN" \| STATS COUNT() BY host.name, process.command_line, dns.query HAVING COUNT() > 3`. |
| 5. DGA with Anomalous Timing | DGA C2 with unusual timing, as in 2025 trends. | - DNS Logs (DS0003: Zeek DNS)<br>- Metrics | - **Splunk**: `index=network sourcetype=zeek_dns \| timechart span=1h count \| where count > avg(count)*4`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "DNS" \| summarize HourlyCount=count() by bin(Timestamp, 1h) \| where HourlyCount > avg(HourlyCount) * 4`.<br>- **ELK**: `FROM logs-zeek.dns-* \| STATS COUNT() BY date_histogram(@timestamp, '1h') \| WHERE COUNT() > AVG(COUNT()) * 4`. |
| 6. DGA with Encrypted Payloads | Encrypted payloads in DGA queries, as in APT41. | - DNS Logs (DS0003: Zeek DNS)<br>- Packet Analysis | - **Splunk**: `index=network sourcetype=zeek_dns payload_entropy > 7 \| stats count by src_ip, query \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "DNS" and AdditionalFields.PayloadEntropy > 7 \| summarize count() by DeviceIP, AdditionalFields.Query \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.dns-* \| WHERE dns.payload.entropy > 7 \| STATS COUNT() BY source.ip, dns.query HAVING COUNT() > 5`. |
| 7. DGA in Cloud Environments | DGA C2 in cloud, as in 2025 trends. | - Cloud Audit Logs (AWS CloudTrail)<br>- DNS Logs | - **Splunk**: `index=cloud sourcetype=aws:cloudtrail eventName="Resolve" AND userIdentity NOT IN (authorized_users) \| stats count by userIdentity, src_ip \| where count > 5`.<br>- **KQL**: `AWSCloudTrail \| where EventName == "Resolve" and Caller !in (authorizedUsers) \| summarize count() by Caller, SourceIP \| where count_ > 5`.<br>- **ELK**: `FROM logs-aws.cloudtrail-* \| WHERE event.action = 'Resolve' AND user.identity NOT IN ['authorized_users'] \| STATS COUNT() BY user.identity, source.ip HAVING COUNT() > 5`. |
| 8. DGA with Suspicious Headers | DGA C2 with custom headers, as in Cobalt Strike. | - DNS Logs (DS0003: Zeek DNS)<br>- Proxy Logs | - **Splunk**: `index=network sourcetype=zeek_dns header IN ("*X-Cobalt*", "*Custom-Header*") \| stats count by src_ip, header \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "DNS" and AdditionalFields.Header has_any ("X-Cobalt", "Custom-Header") \| summarize count() by DeviceIP, AdditionalFields.Header \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.dns-* \| WHERE dns.header : ("*X-Cobalt*" OR "*Custom-Header*") \| STATS COUNT() BY source.ip, dns.header HAVING COUNT() > 5`. |
| 9. DGA in Non-Standard Environments | DGA C2 in Linux, as in Turla. | - DNS Logs (DS0003: Zeek DNS)<br>- Linux Logs | - **Splunk**: `index=linux sourcetype=auditd syscall="sendto" AND dest_port=53 AND exe NOT IN (known_apps) \| stats count by exe, dest_ip \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where RemotePort == 53 and InitiatingProcessName !in (knownApps) \| summarize count() by InitiatingProcessName, RemoteIP \| where count_ > 5`.<br>- **ELK**: `FROM logs-auditd-* \| WHERE syscall.name = "sendto" AND destination.port = 53 AND process.exe NOT IN ['known_apps'] \| STATS COUNT() BY process.exe, destination.ip HAVING COUNT() > 5`. |
| 10. DGA with Multi-Stage Redirects | DGA C2 with redirects, as in APT41. | - DNS Logs (DS0003: Zeek DNS)<br>- Redirect Analysis | - **Splunk**: `index=network sourcetype=zeek_dns status_code=302 \| stats count by src_ip, query \| where count > 3`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "DNS" and AdditionalFields.StatusCode == 302 \| summarize count() by DeviceIP, AdditionalFields.Query \| where count_ > 3`.<br>- **ELK**: `FROM logs-zeek.dns-* \| WHERE dns.status = 302 \| STATS COUNT() BY source.ip, dns.query HAVING COUNT() > 3`. |
| 11. DGA with Anomalous User Agents | DGA C2 with unusual user agents, as in Cobalt Strike. | - DNS Logs (DS0003: Zeek DNS)<br>- Proxy Logs | - **Splunk**: `index=network sourcetype=zeek_dns user_agent NOT IN (known_agents) \| stats count by src_ip, user_agent \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "DNS" and AdditionalFields.UserAgent !in (knownAgents) \| summarize count() by DeviceIP, AdditionalFields.UserAgent \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.dns-* \| WHERE dns.user_agent NOT IN ['known_agents'] \| STATS COUNT() BY source.ip, dns.user_agent HAVING COUNT() > 5`. |
| 12. DGA in Cloud Environments | DGA C2 in cloud, as in 2025 trends. | - Cloud Audit Logs (AWS CloudTrail)<br>- DNS Logs | - **Splunk**: `index=cloud sourcetype=aws:cloudtrail eventName="Resolve" AND userIdentity NOT IN (authorized_users) \| stats count by userIdentity, src_ip \| where count > 5`.<br>- **KQL**: `AWSCloudTrail \| where EventName == "Resolve" and Caller !in (authorizedUsers) \| summarize count() by Caller, SourceIP \| where count_ > 5`.<br>- **ELK**: `FROM logs-aws.cloudtrail-* \| WHERE event.action = 'Resolve' AND user.identity NOT IN ['authorized_users'] \| STATS COUNT() BY user.identity, source.ip HAVING COUNT() > 5`. |
| 13. DGA with Anomalous Timing | DGA C2 with unusual timing, as in 2025 trends. | - DNS Logs (DS0003: Zeek DNS)<br>- Metrics | - **Splunk**: `index=network sourcetype=zeek_dns \| timechart span=1h count \| where count > avg(count)*4`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "DNS" \| summarize HourlyCount=count() by bin(Timestamp, 1h) \| where HourlyCount > avg(HourlyCount) * 4`.<br>- **ELK**: `FROM logs-zeek.dns-* \| STATS COUNT() BY date_histogram(@timestamp, '1h') \| WHERE COUNT() > AVG(COUNT()) * 4`. |
| 14. DGA with Suspicious Headers | DGA C2 with custom headers, as in Cobalt Strike. | - DNS Logs (DS0003: Zeek DNS)<br>- Proxy Logs | - **Splunk**: `index=network sourcetype=zeek_dns header IN ("*X-Cobalt*", "*Custom-Header*") \| stats count by src_ip, header \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "DNS" and AdditionalFields.Header has_any ("X-Cobalt", "Custom-Header") \| summarize count() by DeviceIP, AdditionalFields.Header \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.dns-* \| WHERE dns.header : ("*X-Cobalt*" OR "*Custom-Header*") \| STATS COUNT() BY source.ip, dns.header HAVING COUNT() > 5`. |
| 15. DGA with Encrypted Payloads | Encrypted payloads in DGA C2, as in APT41. | - DNS Logs (DS0003: Zeek DNS)<br>- Packet Analysis | - **Splunk**: `index=network sourcetype=zeek_dns payload_entropy > 7 \| stats count by src_ip, query \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "DNS" and AdditionalFields.PayloadEntropy > 7 \| summarize count() by DeviceIP, AdditionalFields.Query \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.dns-* \| WHERE dns.payload.entropy > 7 \| STATS COUNT() BY source.ip, dns.query HAVING COUNT() > 5`.

### Dynamic Resolution

### Encrypted Channel

### External Proxy

### Fallback Channels

### Fast Flux DNS

### File Transfer Protocols

### Hide Infrastructure

### IDE Tunneling

### Ingress Tool Transfer

### Internal Proxy

### Junk Data

### Mail Protocols

### Multi-Stage Channels

### Multi-hop Proxy

### Multi-hop Proxy

### Multiband Communication

### Multilayer Encryption

### Non-Application Layer Protocol

### Non-Standard Encoding

### Non-Standard Port

### One-Way Communication

### Port Knocking

### Protocol Tunneling

### Protocol or Service Impersonation

### Proxy

### Publish/Subscribe Protocols

### Remote Access Hardware

### Remote Access Tools

### Remote Desktop Software

### Socket Filters

### Standard Cryptographic Protocol

### Standard Encoding

### Steganography

### Symmetric Cryptography

### Traffic Signaling

### Uncommonly Used Port

### Web Protocols

### Web Service
