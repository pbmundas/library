---
layout: default
title: Command and Control
category: Threat-Hunting-Queries  # This becomes a main topic in sidebar
---

## Command and Control

### Application Layer Protocol (T1071)

| Hypothesis | Description | Data Sources | Hunting Queries |
|------------|-------------|--------------|-----------------|
| 1. Anomalous HTTP Traffic for C2 Communication | Adversaries use HTTP/HTTPS for command and control, often with unusual patterns like high-frequency requests, as in Cobalt Strike beacons. High risk in Windows and cloud environments with limited visibility. | - Network Traffic (DS0003: Zeek HTTP)<br>- Proxy Logs | - **Splunk**: `index=network sourcetype=zeek_http method="POST" AND uri="*beacon*" \| timechart span=60s count by src_ip \| where count > 5` (Detects periodic beaconing).<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "HTTP" and AdditionalFields.Method == "POST" and RemoteUrl contains "beacon" \| summarize BeaconCount=count() by bin(Timestamp, 60s), DeviceIP \| where BeaconCount > 5`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE http.method = 'POST' AND http.uri : "*beacon*" \| STATS COUNT() BY date_histogram(@timestamp, '60s'), source.ip \| WHERE COUNT() > 5`. |
| 2. DNS Tunneling over Application Layer | Adversaries tunnel data over DNS (T1071.004), using long query strings for C2, as in APT41 attacks. | - DNS Logs (DS0003: Zeek DNS)<br>- Network Traffic | - **Splunk**: `index=network sourcetype=zeek_dns query_length > 200 AND NOT query IN (known_domains) \| stats count by src_ip, query \| where count > 10`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "DNS" and AdditionalFields.QueryLength > 200 and AdditionalFields.Query !in (knownDomains) \| summarize count() by DeviceIP, AdditionalFields.Query \| where count_ > 10`.<br>- **ELK**: `FROM logs-zeek.dns-* \| WHERE dns.query.length > 200 AND dns.query NOT IN ['known_domains'] \| STATS COUNT() BY source.ip, dns.query HAVING COUNT() > 10`. |
| 3. FTP C2 Communication | Adversaries use FTP for C2 (T1071.002), often for data exfiltration, as in FIN7. | - Network Traffic (DS0003: Zeek FTP)<br>- Proxy Logs | - **Splunk**: `index=network sourcetype=zeek_ftp command IN ("STOR", "RETR") AND dest_ip NOT IN (known_servers) \| stats count by src_ip, dest_ip \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "FTP" and AdditionalFields.Command in ("STOR", "RETR") and RemoteIP !in (knownServers) \| summarize count() by DeviceIP, RemoteIP \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.ftp-* \| WHERE ftp.command IN ['STOR', 'RETR'] AND destination.ip NOT IN ['known_servers'] \| STATS COUNT() BY source.ip, destination.ip HAVING COUNT() > 5`. |
| 4. SMTP C2 Communication | Adversaries use SMTP for C2 (T1071.003), sending emails to exfil data, as in APT41. | - Network Traffic (DS0003: Zeek SMTP)<br>- Email Logs | - **Splunk**: `index=network sourcetype=zeek_smtp attachment="*data*" AND src_ip NOT IN (known_clients) \| stats count by src_ip, recipient \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "SMTP" and AdditionalFields.Attachment contains "data" and DeviceIP !in (knownClients) \| summarize count() by DeviceIP, AdditionalFields.Recipient \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.smtp-* \| WHERE smtp.attachment : "*data*" AND source.ip NOT IN ['known_clients'] \| STATS COUNT() BY source.ip, smtp.recipient HAVING COUNT() > 5`. |
| 5. Application Layer Protocol Traffic from Compromised Endpoints | Compromised endpoints initiate application layer traffic for C2, as in Turla. | - Process Creation (Sysmon ID 1)<br>- Network Traffic | - **Splunk**: `index=endpoint sourcetype=sysmon EventCode=1 CommandLine="*http*" \| join host [search index=network sourcetype=zeek_http method="POST"] \| stats count by host, CommandLine, uri \| where count > 5`.<br>- **KQL**: `DeviceProcessEvents \| where ProcessCommandLine contains "http" \| join kind=inner (DeviceNetworkEvents \| where Protocol == "HTTP" and AdditionalFields.Method == "POST") on DeviceName \| summarize count() by DeviceName, ProcessCommandLine, RemoteUrl \| where count_ > 5`.<br>- **ELK**: `FROM logs-endpoint.process-* \| WHERE process.command_line : "*http*" \| JOIN logs-zeek.http-* ON host.name WHERE http.method = 'POST' \| STATS COUNT() BY host.name, process.command_line, http.uri HAVING COUNT() > 5`. |
| 6. C2 over WebSockets | Adversaries use WebSockets for bidirectional C2 (T1071.001), as in 2025 trends. | - Network Traffic (DS0003: Zeek WebSocket)<br>- Proxy Logs | - **Splunk**: `index=network sourcetype=zeek_websocket opcode=1 AND src_ip NOT IN (known_clients) \| stats count by src_ip, dest_ip \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "WebSocket" and AdditionalFields.OpCode == 1 and DeviceIP !in (knownClients) \| summarize count() by DeviceIP, RemoteIP \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.websocket-* \| WHERE websocket.opcode = 1 AND source.ip NOT IN ['known_clients'] \| STATS COUNT() BY source.ip, destination.ip HAVING COUNT() > 5`. |
| 7. C2 via HTTP with Encrypted Payloads | Encrypted HTTP payloads for C2, as in APT41. | - Network Traffic (DS0003: Zeek HTTP)<br>- Packet Analysis | - **Splunk**: `index=network sourcetype=zeek_http method="POST" AND payload_entropy > 7 \| stats count by src_ip, uri \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "HTTP" and AdditionalFields.Method == "POST" and AdditionalFields.PayloadEntropy > 7 \| summarize count() by DeviceIP, RemoteUrl \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE http.method = 'POST' AND http.payload.entropy > 7 \| STATS COUNT() BY source.ip, http.uri HAVING COUNT() > 5`. |
| 8. C2 via FTP with Unusual Ports | FTP C2 on non-standard ports, as in FIN7. | - Network Traffic (DS0003: Zeek FTP)<br>- Firewall Logs | - **Splunk**: `index=network sourcetype=zeek_ftp dest_port NOT IN (21, 22) \| stats count by src_ip, dest_port \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "FTP" and RemotePort !in (21, 22) \| summarize count() by DeviceIP, RemotePort \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.ftp-* \| WHERE destination.port NOT IN [21, 22] \| STATS COUNT() BY source.ip, destination.port HAVING COUNT() > 5`. |
| 9. C2 with Anomalous User Behavior | Application layer C2 by users with unusual patterns, as in 2025 trends. | - User Behavior Analytics (UBA)<br>- Network Traffic | - **Splunk**: `index=security sourcetype=uba:anomaly event_type="web_access" AND user NOT IN (known_users) \| join user [search index=network sourcetype=zeek_http method="POST"] \| stats count by user, src_ip, method \| where count > 3`.<br>- **KQL**: `UbaAnomalies \| where EventType == "web_access" and User !in (knownUsers) \| join kind=inner (DeviceNetworkEvents \| where Protocol == "HTTP" and AdditionalFields.Method == "POST") on UserId \| summarize count() by UserId, DeviceIP, AdditionalFields.Method \| where count_ > 3`.<br>- **ELK**: `FROM logs-uba.anomaly-* \| WHERE event.type = "web_access" AND user.name NOT IN ['known_users'] \| JOIN logs-zeek.http-* ON user.id WHERE http.method = 'POST' \| STATS COUNT() BY user.id, source.ip, http.method HAVING COUNT() > 3`. |
| 10. C2 via SMTP with Attachments | SMTP used for C2 with attachments, as in APT41. | - Network Traffic (DS0003: Zeek SMTP)<br>- Email Logs | - **Splunk**: `index=network sourcetype=zeek_smtp attachment="*payload*" \| stats count by src_ip, recipient \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "SMTP" and AdditionalFields.Attachment contains "payload" \| summarize count() by DeviceIP, AdditionalFields.Recipient \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.smtp-* \| WHERE smtp.attachment : "*payload*" \| STATS COUNT() BY source.ip, smtp.recipient HAVING COUNT() > 5`. |
| 11. C2 via FTP Data Channels | FTP data channels for C2, as in FIN7. | - Network Traffic (DS0003: Zeek FTP)<br>- Firewall Logs | - **Splunk**: `index=network sourcetype=zeek_ftp command="PORT" \| stats count by src_ip, dest_ip \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "FTP" and AdditionalFields.Command == "PORT" \| summarize count() by DeviceIP, RemoteIP \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.ftp-* \| WHERE ftp.command = 'PORT' \| STATS COUNT() BY source.ip, destination.ip HAVING COUNT() > 5`. |
| 12. C2 with Suspicious TLS Certificates | Application layer C2 using self-signed TLS certificates, as in APT41. | - Network Traffic (DS0003: Zeek SSL)<br>- Certificate Logs | - **Splunk**: `index=network sourcetype=zeek_ssl cert_issuer="CN=*" AND NOT cert_issuer IN (known_issuers) \| stats count by src_ip, cert_issuer \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "SSL" and AdditionalFields.CertIssuer contains "CN=" and AdditionalFields.CertIssuer !in (knownIssuers) \| summarize count() by DeviceIP, AdditionalFields.CertIssuer \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.ssl-* \| WHERE ssl.certificate.issuer : "CN=*" AND ssl.certificate.issuer NOT IN ['known_issuers'] \| STATS COUNT() BY source.ip, ssl.certificate.issuer HAVING COUNT() > 5`. |
| 13. C2 via Cloud API Calls | Adversaries use cloud APIs for C2, as in 2025 trends. | - Cloud Audit Logs (AWS CloudTrail)<br>- Network Traffic | - **Splunk**: `index=cloud sourcetype=aws:cloudtrail eventName="Invoke" AND userIdentity NOT IN (authorized_users) \| stats count by userIdentity, src_ip \| where count > 5`.<br>- **KQL**: `AWSCloudTrail \| where EventName == "Invoke" and Caller !in (authorizedUsers) \| summarize count() by Caller, SourceIP \| where count_ > 5`.<br>- **ELK**: `FROM logs-aws.cloudtrail-* \| WHERE event.action = 'Invoke' AND user.identity NOT IN ['authorized_users'] \| STATS COUNT() BY user.identity, source.ip HAVING COUNT() > 5`. |
| 14. C2 with Multi-Stage Payloads | Multi-stage HTTP payloads for C2, as in APT41. | - Network Traffic (DS0003: Zeek HTTP)<br>- Packet Analysis | - **Splunk**: `index=network sourcetype=zeek_http method="GET" AND uri="*stage1*" \| stats count by src_ip, uri \| where count > 3`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "HTTP" and AdditionalFields.Method == "GET" and RemoteUrl contains "stage1" \| summarize count() by DeviceIP, RemoteUrl \| where count_ > 3`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE http.method = 'GET' AND http.uri : "*stage1*" \| STATS COUNT() BY source.ip, http.uri HAVING COUNT() > 3`. |
| 15. C2 with Suspicious Headers | HTTP C2 with custom headers, as in Cobalt Strike. | - Network Traffic (DS0003: Zeek HTTP)<br>- Proxy Logs | - **Splunk**: `index=network sourcetype=zeek_http header IN ("*X-Cobalt*", "*Custom-Header*") \| stats count by src_ip, header \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "HTTP" and AdditionalFields.Header has_any ("X-Cobalt", "Custom-Header") \| summarize count() by DeviceIP, AdditionalFields.Header \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE http.header : ("*X-Cobalt*" OR "*Custom-Header*") \| STATS COUNT() BY source.ip, http.header HAVING COUNT() > 5`. |

### Asymmetric Cryptography (T1573.002)

| Hypothesis | Description | Data Sources | Hunting Queries |
|------------|-------------|--------------|-----------------|
| 1. Suspicious Asymmetric Encryption in Traffic | Adversaries use asymmetric cryptography for C2 channels, as in APT41. High risk in encrypted traffic without standard certs. | - Network Traffic (DS0003: Zeek SSL)<br>- Certificate Logs | - **Splunk**: `index=network sourcetype=zeek_ssl cert_algorithm="RSA" AND cert_issuer NOT IN (known_issuers) \| stats count by src_ip, cert_algorithm \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "SSL" and AdditionalFields.CertAlgorithm == "RSA" and AdditionalFields.CertIssuer !in (knownIssuers) \| summarize count() by DeviceIP, AdditionalFields.CertAlgorithm \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.ssl-* \| WHERE ssl.certificate.algorithm = 'RSA' AND ssl.certificate.issuer NOT IN ['known_issuers'] \| STATS COUNT() BY source.ip, ssl.certificate.algorithm HAVING COUNT() > 5`. |
| 2. C2 with Custom Asymmetric Keys | Custom asymmetric keys for C2, as in Turla. | - Network Traffic (DS0003: Zeek SSL)<br>- Packet Analysis | - **Splunk**: `index=network sourcetype=zeek_ssl cert_key_length NOT IN (1024, 2048) \| stats count by src_ip, cert_key_length \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "SSL" and AdditionalFields.CertKeyLength !in (1024, 2048) \| summarize count() by DeviceIP, AdditionalFields.CertKeyLength \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.ssl-* \| WHERE ssl.certificate.key.length NOT IN [1024, 2048] \| STATS COUNT() BY source.ip, ssl.certificate.key.length HAVING COUNT() > 5`. |
| 3. Asymmetric Encryption in Non-Standard Ports | Asymmetric encryption on non-HTTPS ports for C2, as in APT41. | - Network Traffic (DS0003: Zeek Conn)<br>- SSL Logs | - **Splunk**: `index=network sourcetype=zeek_conn dest_port NOT IN (443) AND protocol="ssl" \| stats count by src_ip, dest_port \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "SSL" and RemotePort !in (443) \| summarize count() by DeviceIP, RemotePort \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.conn-* \| WHERE network.protocol = 'ssl' AND destination.port NOT IN [443] \| STATS COUNT() BY source.ip, destination.port HAVING COUNT() > 5`. |
| 4. C2 with Asymmetric Key Exchange Anomalies | Anomalous key exchanges in asymmetric C2, as in 2025 trends. | - Network Traffic (DS0003: Zeek SSL)<br>- Packet Analysis | - **Splunk**: `index=network sourcetype=zeek_ssl handshake_time < 100 AND src_ip NOT IN (known_clients) \| stats count by src_ip \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "SSL" and AdditionalFields.HandshakeTime < 100 and DeviceIP !in (knownClients) \| summarize count() by DeviceIP \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.ssl-* \| WHERE ssl.handshake.time < 100 AND source.ip NOT IN ['known_clients'] \| STATS COUNT() BY source.ip HAVING COUNT() > 5`. |
| 5. Asymmetric C2 with Self-Signed Certs | Self-signed certificates in C2 traffic, as in Turla. | - Network Traffic (DS0003: Zeek SSL)<br>- Certificate Logs | - **Splunk**: `index=network sourcetype=zeek_ssl cert_issuer=cert_subject \| stats count by src_ip, cert_issuer \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "SSL" and AdditionalFields.CertIssuer == AdditionalFields.CertSubject \| summarize count() by DeviceIP, AdditionalFields.CertIssuer \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.ssl-* \| WHERE ssl.certificate.issuer = ssl.certificate.subject \| STATS COUNT() BY source.ip, ssl.certificate.issuer HAVING COUNT() > 5`. |
| 6. C2 with Asymmetric Encryption in Cloud | Asymmetric C2 in cloud environments, as in APT41. | - Cloud Audit Logs (AWS CloudTrail)<br>- Network Traffic | - **Splunk**: `index=cloud sourcetype=aws:cloudtrail eventName="Decrypt" AND userIdentity NOT IN (authorized_users) \| stats count by userIdentity, src_ip \| where count > 5`.<br>- **KQL**: `AWSCloudTrail \| where EventName == "Decrypt" and Caller !in (authorizedUsers) \| summarize count() by Caller, SourceIP \| where count_ > 5`.<br>- **ELK**: `FROM logs-aws.cloudtrail-* \| WHERE event.action = 'Decrypt' AND user.identity NOT IN ['authorized_users'] \| STATS COUNT() BY user.identity, source.ip HAVING COUNT() > 5`. |
| 7. C2 with Asymmetric Key Reuse | Reuse of asymmetric keys in C2 traffic, as in FIN7. | - Network Traffic (DS0003: Zeek SSL)<br>- Certificate Logs | - **Splunk**: `index=network sourcetype=zeek_ssl cert_fingerprint=duplicate \| stats count by cert_fingerprint \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "SSL" and AdditionalFields.CertFingerprint == "duplicate" \| summarize count() by AdditionalFields.CertFingerprint \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.ssl-* \| WHERE ssl.certificate.fingerprint = 'duplicate' \| STATS COUNT() BY ssl.certificate.fingerprint HAVING COUNT() > 5`. |
| 8. C2 with Asymmetric Encryption Anomalies | Anomalous asymmetric encryption in traffic, as in 2025 trends. | - Network Traffic (DS0003: Zeek SSL)<br>- Packet Analysis | - **Splunk**: `index=network sourcetype=zeek_ssl cert_algorithm NOT IN (known_algorithms) \| stats count by src_ip, cert_algorithm \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "SSL" and AdditionalFields.CertAlgorithm !in (knownAlgorithms) \| summarize count() by DeviceIP, AdditionalFields.CertAlgorithm \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.ssl-* \| WHERE ssl.certificate.algorithm NOT IN ['known_algorithms'] \| STATS COUNT() BY source.ip, ssl.certificate.algorithm HAVING COUNT() > 5`. |
| 9. C2 with Asymmetric Encryption in Non-Standard Environments | Asymmetric C2 in Linux environments, as in Turla. | - Network Traffic (DS0003: Zeek SSL)<br>- Linux Logs | - **Splunk**: `index=linux sourcetype=auditd syscall="connect" AND dest_port=443 AND exe NOT IN (known_apps) \| stats count by exe, dest_ip \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "SSL" and RemotePort == 443 and InitiatingProcessName !in (knownApps) \| summarize count() by InitiatingProcessName, RemoteIP \| where count_ > 5`.<br>- **ELK**: `FROM logs-auditd-* \| WHERE syscall.name = "connect" AND destination.port = 443 AND process.exe NOT IN ['known_apps'] \| STATS COUNT() BY process.exe, destination.ip HAVING COUNT() > 5`. |
| 10. C2 with Asymmetric Encryption and Data Exfiltration | Asymmetric C2 with data exfil, as in APT41. | - Network Traffic (DS0003: Zeek SSL)<br>- File Logs | - **Splunk**: `index=network sourcetype=zeek_ssl bytes_out>1000000 \| join src_ip [search index=endpoint sourcetype=sysmon EventCode=11 "*exfil*"] \| stats count by src_ip, bytes_out \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "SSL" and OutboundBytes > 1000000 \| join kind=inner (DeviceFileEvents \| where FileName contains "exfil") on DeviceIP \| summarize count() by DeviceIP, OutboundBytes \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.ssl-* \| WHERE network.bytes_out > 1000000 \| JOIN logs-endpoint.file-* ON source.ip WHERE file.name : "*exfil*" \| STATS COUNT() BY source.ip, network.bytes_out HAVING COUNT() > 5`. |
| 11. C2 with Asymmetric Encryption in Cloud | Asymmetric C2 in cloud, as in 2025 trends. | - Cloud Audit Logs (AWS CloudTrail)<br>- Network Traffic | - **Splunk**: `index=cloud sourcetype=aws:cloudtrail eventName="Decrypt" AND userIdentity NOT IN (authorized_users) \| stats count by userIdentity, src_ip \| where count > 5`.<br>- **KQL**: `AWSCloudTrail \| where EventName == "Decrypt" and Caller !in (authorizedUsers) \| summarize count() by Caller, SourceIP \| where count_ > 5`.<br>- **ELK**: `FROM logs-aws.cloudtrail-* \| WHERE event.action = 'Decrypt' AND user.identity NOT IN ['authorized_users'] \| STATS COUNT() BY user.identity, source.ip HAVING COUNT() > 5`. |
| 12. C2 with Asymmetric Key Reuse | Key reuse in asymmetric C2, as in FIN7. | - Network Traffic (DS0003: Zeek SSL)<br>- Certificate Logs | - **Splunk**: `index=network sourcetype=zeek_ssl cert_fingerprint=duplicate \| stats count by cert_fingerprint \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "SSL" and AdditionalFields.CertFingerprint == "duplicate" \| summarize count() by AdditionalFields.CertFingerprint \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.ssl-* \| WHERE ssl.certificate.fingerprint = 'duplicate' \| STATS COUNT() BY ssl.certificate.fingerprint HAVING COUNT() > 5`. |
| 13. C2 with Asymmetric Encryption Anomalies | Anomalous asymmetric encryption, as in 2025 trends. | - Network Traffic (DS0003: Zeek SSL)<br>- Packet Analysis | - **Splunk**: `index=network sourcetype=zeek_ssl cert_algorithm NOT IN (known_algorithms) \| stats count by src_ip, cert_algorithm \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "SSL" and AdditionalFields.CertAlgorithm !in (knownAlgorithms) \| summarize count() by DeviceIP, AdditionalFields.CertAlgorithm \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.ssl-* \| WHERE ssl.certificate.algorithm NOT IN ['known_algorithms'] \| STATS COUNT() BY source.ip, ssl.certificate.algorithm HAVING COUNT() > 5`. |
| 14. C2 with Asymmetric Encryption in Non-Standard Environments | Asymmetric C2 in Linux, as in Turla. | - Network Traffic (DS0003: Zeek SSL)<br>- Linux Logs | - **Splunk**: `index=linux sourcetype=auditd syscall="connect" AND dest_port=443 AND exe NOT IN (known_apps) \| stats count by exe, dest_ip \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "SSL" and RemotePort == 443 and InitiatingProcessName !in (knownApps) \| summarize count() by InitiatingProcessName, RemoteIP \| where count_ > 5`.<br>- **ELK**: `FROM logs-auditd-* \| WHERE syscall.name = "connect" AND destination.port = 443 AND process.exe NOT IN ['known_apps'] \| STATS COUNT() BY process.exe, destination.ip HAVING COUNT() > 5`. |
| 15. C2 with Asymmetric Encryption and Data Exfiltration | Asymmetric C2 with exfil, as in APT41. | - Network Traffic (DS0003: Zeek SSL)<br>- File Logs | - **Splunk**: `index=network sourcetype=zeek_ssl bytes_out>1000000 \| join src_ip [search index=endpoint sourcetype=sysmon EventCode=11 "*exfil*"] \| stats count by src_ip, bytes_out \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "SSL" and OutboundBytes > 1000000 \| join kind=inner (DeviceFileEvents \| where FileName contains "exfil") on DeviceIP \| summarize count() by DeviceIP, OutboundBytes \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.ssl-* \| WHERE network.bytes_out > 1000000 \| JOIN logs-endpoint.file-* ON source.ip WHERE file.name : "*exfil*" \| STATS COUNT() BY source.ip, network.bytes_out HAVING COUNT() > 5`. |

### Bidirectional Communication (T1102.002)

| Hypothesis | Description | Data Sources | Hunting Queries |
|------------|-------------|--------------|-----------------|
| 1. Bidirectional C2 via Web Services | Adversaries use web services for bidirectional C2, as in Cobalt Strike. | - Network Traffic (DS0003: Zeek HTTP)<br>- Proxy Logs | - **Splunk**: `index=network sourcetype=zeek_http method IN ("GET", "POST") AND uri="*c2*" \| stats count by src_ip, method \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "HTTP" and AdditionalFields.Method in ("GET", "POST") and RemoteUrl contains "c2" \| summarize count() by DeviceIP, AdditionalFields.Method \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE http.method IN ['GET', 'POST'] AND http.uri : "*c2*" \| STATS COUNT() BY source.ip, http.method HAVING COUNT() > 5`. |
| 2. Bidirectional C2 with Data Exfil | Bidirectional C2 with exfil, as in APT41. | - Network Traffic (DS0003: Zeek HTTP)<br>- File Logs | - **Splunk**: `index=network sourcetype=zeek_http method="POST" AND bytes_out>1000000 \| stats count by src_ip, uri \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "HTTP" and AdditionalFields.Method == "POST" and OutboundBytes > 1000000 \| summarize count() by DeviceIP, RemoteUrl \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE http.method = 'POST' AND network.bytes_out > 1000000 \| STATS COUNT() BY source.ip, http.uri HAVING COUNT() > 5`. |
| 3. Bidirectional C2 with Anomalous Timing | Bidirectional C2 with unusual timing, as in 2025 trends. | - Network Traffic (DS0003: Zeek HTTP)<br>- Metrics | - **Splunk**: `index=network sourcetype=zeek_http method IN ("GET", "POST") \| timechart span=1h count by src_ip \| where count > avg(count)*4`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "HTTP" and AdditionalFields.Method in ("GET", "POST") \| summarize HourlyCount=count() by bin(Timestamp, 1h), DeviceIP \| where HourlyCount > avg(HourlyCount) * 4`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE http.method IN ['GET', 'POST'] \| STATS COUNT() BY date_histogram(@timestamp, '1h'), source.ip \| WHERE COUNT() > AVG(COUNT()) * 4`. |
| 4. Bidirectional C2 via Cloud Services | Bidirectional C2 via cloud, as in APT41. | - Cloud Audit Logs (AWS CloudTrail)<br>- Network Traffic | - **Splunk**: `index=cloud sourcetype=aws:cloudtrail eventName="Invoke" AND userIdentity NOT IN (authorized_users) \| stats count by userIdentity, src_ip \| where count > 5`.<br>- **KQL**: `AWSCloudTrail \| where EventName == "Invoke" and Caller !in (authorizedUsers) \| summarize count() by Caller, SourceIP \| where count_ > 5`.<br>- **ELK**: `FROM logs-aws.cloudtrail-* \| WHERE event.action = 'Invoke' AND user.identity NOT IN ['authorized_users'] \| STATS COUNT() BY user.identity, source.ip HAVING COUNT() > 5`. |
| 5. Bidirectional C2 with Suspicious Headers | Bidirectional C2 with custom headers, as in Cobalt Strike. | - Network Traffic (DS0003: Zeek HTTP)<br>- Proxy Logs | - **Splunk**: `index=network sourcetype=zeek_http header IN ("*X-Cobalt*", "*Custom-Header*") \| stats count by src_ip, header \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "HTTP" and AdditionalFields.Header has_any ("X-Cobalt", "Custom-Header") \| summarize count() by DeviceIP, AdditionalFields.Header \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE http.header : ("*X-Cobalt*" OR "*Custom-Header*") \| STATS COUNT() BY source.ip, http.header HAVING COUNT() > 5`. |
| 6. Bidirectional C2 via Web Sockets | Bidirectional C2 via WebSockets, as in 2025 trends. | - Network Traffic (DS0003: Zeek WebSocket)<br>- Proxy Logs | - **Splunk**: `index=network sourcetype=zeek_websocket opcode=1 AND src_ip NOT IN (known_clients) \| stats count by src_ip, dest_ip \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "WebSocket" and AdditionalFields.OpCode == 1 and DeviceIP !in (knownClients) \| summarize count() by DeviceIP, RemoteIP \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.websocket-* \| WHERE websocket.opcode = 1 AND source.ip NOT IN ['known_clients'] \| STATS COUNT() BY source.ip, destination.ip HAVING COUNT() > 5`. |
| 7. Bidirectional C2 with Encrypted Payloads | Encrypted payloads in bidirectional C2, as in APT41. | - Network Traffic (DS0003: Zeek HTTP)<br>- Packet Analysis | - **Splunk**: `index=network sourcetype=zeek_http method="POST" AND payload_entropy > 7 \| stats count by src_ip, uri \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "HTTP" and AdditionalFields.Method == "POST" and AdditionalFields.PayloadEntropy > 7 \| summarize count() by DeviceIP, RemoteUrl \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE http.method = 'POST' AND http.payload.entropy > 7 \| STATS COUNT() BY source.ip, http.uri HAVING COUNT() > 5`. |
| 8. Bidirectional C2 via Non-Standard Ports | Bidirectional C2 on non-standard ports, as in FIN7. | - Network Traffic (DS0003: Zeek Conn)<br>- Firewall Logs | - **Splunk**: `index=network sourcetype=zeek_conn dest_port NOT IN (80, 443) \| stats count by src_ip, dest_port \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where RemotePort !in (80, 443) \| summarize count() by DeviceIP, RemotePort \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.conn-* \| WHERE destination.port NOT IN [80, 443] \| STATS COUNT() BY source.ip, destination.port HAVING COUNT() > 5`. |
| 9. Bidirectional C2 with Anomalous User Agents | Bidirectional C2 with unusual user agents, as in Cobalt Strike. | - Network Traffic (DS0003: Zeek HTTP)<br>- Proxy Logs | - **Splunk**: `index=network sourcetype=zeek_http user_agent NOT IN (known_agents) \| stats count by src_ip, user_agent \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "HTTP" and AdditionalFields.UserAgent !in (knownAgents) \| summarize count() by DeviceIP, AdditionalFields.UserAgent \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE http.user_agent NOT IN ['known_agents'] \| STATS COUNT() BY source.ip, http.user_agent HAVING COUNT() > 5`. |
| 10. Bidirectional C2 via Cloud Services | Bidirectional C2 via cloud, as in APT41. | - Cloud Audit Logs (AWS CloudTrail)<br>- Network Traffic | - **Splunk**: `index=cloud sourcetype=aws:cloudtrail eventName="Invoke" AND userIdentity NOT IN (authorized_users) \| stats count by userIdentity, src_ip \| where count > 5`.<br>- **KQL**: `AWSCloudTrail \| where EventName == "Invoke" and Caller !in (authorizedUsers) \| summarize count() by Caller, SourceIP \| where count_ > 5`.<br>- **ELK**: `FROM logs-aws.cloudtrail-* \| WHERE event.action = 'Invoke' AND user.identity NOT IN ['authorized_users'] \| STATS COUNT() BY user.identity, source.ip HAVING COUNT() > 5`. |
| 11. Bidirectional C2 with Suspicious Headers | Bidirectional C2 with custom headers, as in Cobalt Strike. | - Network Traffic (DS0003: Zeek HTTP)<br>- Proxy Logs | - **Splunk**: `index=network sourcetype=zeek_http header IN ("*X-Cobalt*", "*Custom-Header*") \| stats count by src_ip, header \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "HTTP" and AdditionalFields.Header has_any ("X-Cobalt", "Custom-Header") \| summarize count() by DeviceIP, AdditionalFields.Header \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE http.header : ("*X-Cobalt*" OR "*Custom-Header*") \| STATS COUNT() BY source.ip, http.header HAVING COUNT() > 5`. |
| 12. Bidirectional C2 via Web Sockets | Bidirectional C2 via WebSockets, as in 2025 trends. | - Network Traffic (DS0003: Zeek WebSocket)<br>- Proxy Logs | - **Splunk**: `index=network sourcetype=zeek_websocket opcode=1 AND src_ip NOT IN (known_clients) \| stats count by src_ip, dest_ip \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "WebSocket" and AdditionalFields.OpCode == 1 and DeviceIP !in (knownClients) \| summarize count() by DeviceIP, RemoteIP \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.websocket-* \| WHERE websocket.opcode = 1 AND source.ip NOT IN ['known_clients'] \| STATS COUNT() BY source.ip, destination.ip HAVING COUNT() > 5`. |
| 13. Bidirectional C2 with Encrypted Payloads | Encrypted payloads in bidirectional C2, as in APT41. | - Network Traffic (DS0003: Zeek HTTP)<br>- Packet Analysis | - **Splunk**: `index=network sourcetype=zeek_http method="POST" AND payload_entropy > 7 \| stats count by src_ip, uri \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "HTTP" and AdditionalFields.Method == "POST" and AdditionalFields.PayloadEntropy > 7 \| summarize count() by DeviceIP, RemoteUrl \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE http.method = 'POST' AND http.payload.entropy > 7 \| STATS COUNT() BY source.ip, http.uri HAVING COUNT() > 5`. |
| 14. Bidirectional C2 via Non-Standard Ports | Bidirectional C2 on non-standard ports, as in FIN7. | - Network Traffic (DS0003: Zeek Conn)<br>- Firewall Logs | - **Splunk**: `index=network sourcetype=zeek_conn dest_port NOT IN (80, 443) \| stats count by src_ip, dest_port \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where RemotePort !in (80, 443) \| summarize count() by DeviceIP, RemotePort \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.conn-* \| WHERE destination.port NOT IN [80, 443] \| STATS COUNT() BY source.ip, destination.port HAVING COUNT() > 5`. |
| 15. Bidirectional C2 with Anomalous User Agents | Bidirectional C2 with unusual user agents, as in Cobalt Strike. | - Network Traffic (DS0003: Zeek HTTP)<br>- Proxy Logs | - **Splunk**: `index=network sourcetype=zeek_http user_agent NOT IN (known_agents) \| stats count by src_ip, user_agent \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "HTTP" and AdditionalFields.UserAgent !in (knownAgents) \| summarize count() by DeviceIP, AdditionalFields.UserAgent \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE http.user_agent NOT IN ['known_agents'] \| STATS COUNT() BY source.ip, http.user_agent HAVING COUNT() > 5`.

### Commonly Used Port (T1571)

| Hypothesis | Description | Data Sources | Hunting Queries |
|------------|-------------|--------------|-----------------|
| 1. C2 Over Common Ports | Adversaries use common ports (e.g., 80, 443) for C2 to blend with legitimate traffic, as in APT41 campaigns. High risk in environments with limited traffic inspection. | - Network Traffic (DS0003: Zeek Conn)<br>- Firewall Logs | - **Splunk**: `index=network sourcetype=zeek_conn dest_port IN (80, 443) AND bytes_out > 100000 AND src_ip NOT IN (known_servers) \| stats count by src_ip, dest_port \| where count > 5` (Detects high-volume outbound traffic on common ports).<br>- **KQL**: `DeviceNetworkEvents \| where RemotePort in (80, 443) and OutboundBytes > 100000 and RemoteIP !in (knownServers) \| summarize count() by DeviceIP, RemotePort \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.conn-* \| WHERE destination.port IN [80, 443] AND network.bytes_out > 100000 AND destination.ip NOT IN ['known_servers'] \| STATS COUNT() BY source.ip, destination.port HAVING COUNT() > 5`. |
| 2. C2 on Non-Standard Ports | Adversaries use non-standard ports for C2 to evade detection, as in Turla attacks. | - Network Traffic (DS0003: Zeek Conn)<br>- Firewall Logs | - **Splunk**: `index=network sourcetype=zeek_conn dest_port NOT IN (80, 443, 53) AND bytes > 10000 \| stats count by src_ip, dest_port \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where RemotePort !in (80, 443, 53) and TotalBytes > 10000 \| summarize count() by DeviceIP, RemotePort \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.conn-* \| WHERE destination.port NOT IN [80, 443, 53] AND network.bytes > 10000 \| STATS COUNT() BY source.ip, destination.port HAVING COUNT() > 5`. |
| 3. C2 on Well-Known Ports with Anomalous Traffic | Traffic on common ports (e.g., 80) with non-HTTP protocol, indicating masquerading, as in APT41. | - Network Traffic (DS0003: Zeek Conn)<br>- Protocol Analysis | - **Splunk**: `index=network sourcetype=zeek_conn dest_port=80 AND protocol!="http" \| stats count by src_ip, dest_ip \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where RemotePort == 80 and Protocol != "HTTP" \| summarize count() by DeviceIP, RemoteIP \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.conn-* \| WHERE destination.port = 80 AND network.protocol != 'http' \| STATS COUNT() BY source.ip, destination.ip HAVING COUNT() > 5`. |
| 4. C2 on Common Ports with High Frequency | High-frequency connections on common ports, indicating beaconing, as in Cobalt Strike. | - Network Traffic (DS0003: Zeek Conn)<br>- Metrics | - **Splunk**: `index=network sourcetype=zeek_conn dest_port IN (80, 443) \| timechart span=60s count by src_ip \| where count > avg(count)*4`.<br>- **KQL**: `DeviceNetworkEvents \| where RemotePort in (80, 443) \| summarize HourlyCount=count() by bin(Timestamp, 60s), DeviceIP \| where HourlyCount > avg(HourlyCount) * 4`.<br>- **ELK**: `FROM logs-zeek.conn-* \| WHERE destination.port IN [80, 443] \| STATS COUNT() BY date_histogram(@timestamp, '60s'), source.ip \| WHERE COUNT() > AVG(COUNT()) * 4`. |
| 5. C2 on Common Ports with Suspicious User Agents | C2 traffic on common ports with unusual user agents, as in APT41. | - Network Traffic (DS0003: Zeek HTTP)<br>- Proxy Logs | - **Splunk**: `index=network sourcetype=zeek_http dest_port IN (80, 443) AND user_agent NOT IN (known_agents) \| stats count by src_ip, user_agent \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where RemotePort in (80, 443) and AdditionalFields.UserAgent !in (knownAgents) \| summarize count() by DeviceIP, AdditionalFields.UserAgent \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE destination.port IN [80, 443] AND http.user_agent NOT IN ['known_agents'] \| STATS COUNT() BY source.ip, http.user_agent HAVING COUNT() > 5`. |
| 6. C2 on Common Ports from Compromised Endpoints | C2 traffic on common ports from endpoints with suspicious processes, as in FIN7. | - Process Creation (DS0009: Sysmon ID 1)<br>- Network Traffic | - **Splunk**: `index=endpoint sourcetype=sysmon EventCode=1 CommandLine="*c2*" \| join host [search index=network sourcetype=zeek_conn dest_port IN (80, 443)] \| stats count by host, CommandLine, dest_ip \| where count > 3`.<br>- **KQL**: `DeviceProcessEvents \| where ProcessCommandLine contains "c2" \| join kind=inner (DeviceNetworkEvents \| where RemotePort in (80, 443)) on DeviceName \| summarize count() by DeviceName, ProcessCommandLine, RemoteIP \| where count_ > 3`.<br>- **ELK**: `FROM logs-endpoint.process-* \| WHERE process.command_line : "*c2*" \| JOIN logs-zeek.conn-* ON host.name WHERE destination.port IN [80, 443] \| STATS COUNT() BY host.name, process.command_line, destination.ip HAVING COUNT() > 3`. |
| 7. C2 on Common Ports with Encrypted Payloads | Encrypted payloads on common ports, as in 2025 trends. | - Network Traffic (DS0003: Zeek HTTP)<br>- Packet Analysis | - **Splunk**: `index=network sourcetype=zeek_http dest_port IN (80, 443) AND payload_entropy > 7 \| stats count by src_ip, uri \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where RemotePort in (80, 443) and AdditionalFields.PayloadEntropy > 7 \| summarize count() by DeviceIP, RemoteUrl \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE destination.port IN [80, 443] AND http.payload.entropy > 7 \| STATS COUNT() BY source.ip, http.uri HAVING COUNT() > 5`. |
| 8. C2 on Common Ports in Linux Environments | C2 on common ports in Linux, as in Turla. | - Network Traffic (DS0003: Zeek Conn)<br>- Linux Logs | - **Splunk**: `index=linux sourcetype=auditd syscall="connect" AND dest_port IN (80, 443) AND exe NOT IN (known_apps) \| stats count by exe, dest_ip \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where RemotePort in (80, 443) and InitiatingProcessName !in (knownApps) \| summarize count() by InitiatingProcessName, RemoteIP \| where count_ > 5`.<br>- **ELK**: `FROM logs-auditd-* \| WHERE syscall.name = "connect" AND destination.port IN [80, 443] AND process.exe NOT IN ['known_apps'] \| STATS COUNT() BY process.exe, destination.ip HAVING COUNT() > 5`. |
| 9. C2 on Common Ports with Anomalous Timing | C2 on common ports with unusual timing, as in 2025 trends. | - Network Traffic (DS0003: Zeek Conn)<br>- Metrics | - **Splunk**: `index=network sourcetype=zeek_conn dest_port IN (80, 443) \| timechart span=1h count \| where count > avg(count)*4`.<br>- **KQL**: `DeviceNetworkEvents \| where RemotePort in (80, 443) \| summarize HourlyCount=count() by bin(Timestamp, 1h) \| where HourlyCount > avg(HourlyCount) * 4`.<br>- **ELK**: `FROM logs-zeek.conn-* \| WHERE destination.port IN [80, 443] \| STATS COUNT() BY date_histogram(@timestamp, '1h') \| WHERE COUNT() > AVG(COUNT()) * 4`. |
| 10. C2 on Common Ports with Suspicious Headers | C2 on common ports with custom headers, as in Cobalt Strike. | - Network Traffic (DS0003: Zeek HTTP)<br>- Proxy Logs | - **Splunk**: `index=network sourcetype=zeek_http dest_port IN (80, 443) AND header IN ("*X-Cobalt*", "*Custom-Header*") \| stats count by src_ip, header \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where RemotePort in (80, 443) and AdditionalFields.Header has_any ("X-Cobalt", "Custom-Header") \| summarize count() by DeviceIP, AdditionalFields.Header \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE destination.port IN [80, 443] AND http.header : ("*X-Cobalt*" OR "*Custom-Header*") \| STATS COUNT() BY source.ip, http.header HAVING COUNT() > 5`. |
| 11. C2 on Common Ports with Encrypted Payloads | Encrypted payloads on common ports, as in APT41. | - Network Traffic (DS0003: Zeek HTTP)<br>- Packet Analysis | - **Splunk**: `index=network sourcetype=zeek_http dest_port IN (80, 443) AND payload_entropy > 7 \| stats count by src_ip, uri \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where RemotePort in (80, 443) and AdditionalFields.PayloadEntropy > 7 \| summarize count() by DeviceIP, RemoteUrl \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE destination.port IN [80, 443] AND http.payload.entropy > 7 \| STATS COUNT() BY source.ip, http.uri HAVING COUNT() > 5`. |
| 12. C2 on Common Ports in Cloud Environments | C2 on common ports in cloud, as in 2025 trends. | - Cloud Audit Logs (AWS CloudTrail)<br>- Network Traffic | - **Splunk**: `index=cloud sourcetype=aws:cloudtrail eventName="Invoke" AND userIdentity NOT IN (authorized_users) \| stats count by userIdentity, src_ip \| where count > 5`.<br>- **KQL**: `AWSCloudTrail \| where EventName == "Invoke" and Caller !in (authorizedUsers) \| summarize count() by Caller, SourceIP \| where count_ > 5`.<br>- **ELK**: `FROM logs-aws.cloudtrail-* \| WHERE event.action = 'Invoke' AND user.identity NOT IN ['authorized_users'] \| STATS COUNT() BY user.identity, source.ip HAVING COUNT() > 5`. |
| 13. C2 on Common Ports with Anomalous User Agents | C2 with unusual user agents on common ports, as in Cobalt Strike. | - Network Traffic (DS0003: Zeek HTTP)<br>- Proxy Logs | - **Splunk**: `index=network sourcetype=zeek_http dest_port IN (80, 443) AND user_agent NOT IN (known_agents) \| stats count by src_ip, user_agent \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where RemotePort in (80, 443) and AdditionalFields.UserAgent !in (knownAgents) \| summarize count() by DeviceIP, AdditionalFields.UserAgent \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE destination.port IN [80, 443] AND http.user_agent NOT IN ['known_agents'] \| STATS COUNT() BY source.ip, http.user_agent HAVING COUNT() > 5`. |
| 14. C2 on Common Ports with Multi-Stage Redirects | C2 with redirects on common ports, as in APT41. | - Network Traffic (DS0003: Zeek HTTP)<br>- Redirect Analysis | - **Splunk**: `index=network sourcetype=zeek_http dest_port IN (80, 443) AND status_code=302 \| stats count by src_ip, uri \| where count > 3`.<br>- **KQL**: `DeviceNetworkEvents \| where RemotePort in (80, 443) and AdditionalFields.StatusCode == 302 \| summarize count() by DeviceIP, RemoteUrl \| where count_ > 3`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE destination.port IN [80, 443] AND http.status = 302 \| STATS COUNT() BY source.ip, http.uri HAVING COUNT() > 3`. |
| 15. C2 on Common Ports with Anomalous Timing | C2 with unusual timing on common ports, as in 2025 trends. | - Network Traffic (DS0003: Zeek Conn)<br>- Metrics | - **Splunk**: `index=network sourcetype=zeek_conn dest_port IN (80, 443) \| timechart span=1h count \| where count > avg(count)*4`.<br>- **KQL**: `DeviceNetworkEvents \| where RemotePort in (80, 443) \| summarize HourlyCount=count() by bin(Timestamp, 1h) \| where HourlyCount > avg(HourlyCount) * 4`.<br>- **ELK**: `FROM logs-zeek.conn-* \| WHERE destination.port IN [80, 443] \| STATS COUNT() BY date_histogram(@timestamp, '1h') \| WHERE COUNT() > AVG(COUNT()) * 4`. |

### Communication Through Removable Media (T1092)

| Hypothesis | Description | Data Sources | Hunting Queries |
|------------|-------------|--------------|-----------------|
| 1. Suspicious Removable Media Insertion | Adversaries use removable media for C2, as in APT41. High risk in environments with USB devices. | - Device Insertion (DS0001: Windows Event ID 2003)<br>- File Access | - **Splunk**: `index=windows EventID=2003 DriveType="Removable" AND NOT User IN (authorized_users) \| stats count by DriveLetter, User, host \| where count > 3`.<br>- **KQL**: `DeviceEvents \| where ActionType == "UsbDriveMounted" and AdditionalFields.DriveType == "Removable" and AccountName !in (authorizedUsers) \| summarize count() by AdditionalFields.DriveLetter, AccountName, DeviceName \| where count_ > 3`.<br>- **ELK**: `FROM logs-windows-* \| WHERE winlog.event_id = 2003 AND drive.type = 'Removable' AND user.name NOT IN ['authorized_users'] \| STATS COUNT() BY drive.letter, user.name, host.name HAVING COUNT() > 3`. |
| 2. C2 via USB Data Channels | C2 through USB data channels, as in FIN7. | - File Access (DS0022: Sysmon ID 11)<br>- Network Traffic | - **Splunk**: `index=endpoint sourcetype=sysmon EventCode=11 TargetFilename IN ("D:\\*", "E:\\*") AND ProcessImage="*c2*" \| stats count by TargetFilename, ProcessImage, host \| where count > 3`.<br>- **KQL**: `DeviceFileEvents \| where ActionType == "FileAccessed" and FolderPath has_any ("D:\\", "E:\\") and InitiatingProcessFolderPath contains "c2" \| summarize count() by FileName, InitiatingProcessFolderPath, DeviceName \| where count_ > 3`.<br>- **ELK**: `FROM logs-endpoint.file-* \| WHERE event.action = "access" AND file.path : ("D:\\*" OR "E:\\*") AND process.executable : "*c2*" \| STATS COUNT() BY file.name, process.executable, host.name HAVING COUNT() > 3`. |
| 3. C2 with Removable Media in Linux | C2 via removable media in Linux, as in Turla. | - File Access (DS0022: auditd openat)<br>- Device Logs | - **Splunk**: `index=linux sourcetype=auditd syscall="openat" path="/media/*" AND exe="*c2*" \| stats count by path, exe, host \| where count > 3`.<br>- **KQL**: `DeviceFileEvents \| where ActionType == "FileAccessed" and FolderPath contains "/media/" and InitiatingProcessFolderPath contains "c2" \| summarize count() by FileName, InitiatingProcessFolderPath, DeviceName \| where count_ > 3`.<br>- **ELK**: `FROM logs-auditd-* \| WHERE syscall.name = "openat" AND file.path : "/media/*" AND process.exe : "*c2*" \| STATS COUNT() BY file.path, process.exe, host.name HAVING COUNT() > 3`. |
| 4. C2 with Removable Media Exfil | Data exfil via removable media, as in 2025 trends. | - File Creation (DS0022: Sysmon ID 11)<br>- Device Logs | - **Splunk**: `index=endpoint sourcetype=sysmon EventCode=11 TargetFilename IN ("D:\\*", "E:\\*") AND TargetFilename="*exfil*" \| stats count by TargetFilename, host \| where count > 3`.<br>- **KQL**: `DeviceFileEvents \| where ActionType == "FileCreated" and FolderPath has_any ("D:\\", "E:\\") and FileName contains "exfil" \| summarize count() by FileName, DeviceName \| where count_ > 3`.<br>- **ELK**: `FROM logs-endpoint.file-* \| WHERE event.action = "creation" AND file.path : ("D:\\*" OR "E:\\*") AND file.name : "*exfil*" \| STATS COUNT() BY file.name, host.name HAVING COUNT() > 3`. |
| 5. C2 via Removable Media in Cloud | C2 via removable media in cloud VMs, as in APT41. | - Cloud Audit Logs (AWS CloudTrail)<br>- Device Logs | - **Splunk**: `index=cloud sourcetype=aws:cloudtrail eventName="AttachVolume" AND userIdentity NOT IN (authorized_users) \| stats count by userIdentity, volumeId \| where count > 3`.<br>- **KQL**: `AWSCloudTrail \| where EventName == "AttachVolume" and Caller !in (authorizedUsers) \| summarize count() by Caller, VolumeId \| where count_ > 3`.<br>- **ELK**: `FROM logs-aws.cloudtrail-* \| WHERE event.action = 'AttachVolume' AND user.identity NOT IN ['authorized_users'] \| STATS COUNT() BY user.identity, volume.id HAVING COUNT() > 3`. |
| 6. C2 with Removable Media with Anomalous Timing | Removable media C2 with unusual timing, as in 2025 trends. | - Device Logs (DS0001: Windows Event ID 2003)<br>- Time Analysis | - **Splunk**: `index=windows EventID=2003 \| timechart span=1h count \| where count > avg(count)*4`.<br>- **KQL**: `DeviceEvents \| where ActionType == "UsbDriveMounted" \| summarize HourlyCount=count() by bin(Timestamp, 1h) \| where HourlyCount > avg(HourlyCount) * 4`.<br>- **ELK**: `FROM logs-windows-* \| WHERE winlog.event_id = 2003 \| STATS COUNT() BY date_histogram(@timestamp, '1h') \| WHERE COUNT() > AVG(COUNT()) * 4`. |
| 7. C2 via Removable Media with Encrypted Data | Encrypted data on removable media for C2, as in Turla. | - File Creation (DS0022: Sysmon ID 11)<br>- File Metadata | - **Splunk**: `index=endpoint sourcetype=sysmon EventCode=11 TargetFilename IN ("D:\\*", "E:\\*") AND FileSize>100000 \| stats count by TargetFilename, host \| where count > 3`.<br>- **KQL**: `DeviceFileEvents \| where ActionType == "FileCreated" and FolderPath has_any ("D:\\", "E:\\") and AdditionalFields.FileSize > 100000 \| summarize count() by FileName, DeviceName \| where count_ > 3`.<br>- **ELK**: `FROM logs-endpoint.file-* \| WHERE event.action = "creation" AND file.path : ("D:\\*" OR "E:\\*") AND file.size > 100000 \| STATS COUNT() BY file.name, host.name HAVING COUNT() > 3`. |
| 8. C2 via Removable Media in Non-Standard Environments | Removable media C2 in Linux, as in Turla. | - File Access (DS0022: auditd openat)<br>- Device Logs | - **Splunk**: `index=linux sourcetype=auditd syscall="openat" path="/media/*" \| stats count by path, exe, host \| where count > 5`.<br>- **KQL**: `DeviceFileEvents \| where ActionType == "FileAccessed" and FolderPath contains "/media/" \| summarize count() by FileName, InitiatingProcessFolderPath, DeviceName \| where count_ > 5`.<br>- **ELK**: `FROM logs-auditd-* \| WHERE syscall.name = "openat" AND file.path : "/media/*" \| STATS COUNT() BY file.path, process.exe, host.name HAVING COUNT() > 5`. |
| 9. C2 via Removable Media with Anomalous User Behavior | Removable media C2 with unusual user patterns, as in 2025 trends. | - User Behavior Analytics (UBA)<br>- Device Logs | - **Splunk**: `index=security sourcetype=uba:anomaly event_type="device_access" AND user NOT IN (known_users) \| join user [search index=windows EventID=2003] \| stats count by user, host \| where count > 3`.<br>- **KQL**: `UbaAnomalies \| where EventType == "device_access" and User !in (knownUsers) \| join kind=inner (DeviceEvents \| where ActionType == "UsbDriveMounted") on UserId \| summarize count() by UserId, DeviceName \| where count_ > 3`.<br>- **ELK**: `FROM logs-uba.anomaly-* \| WHERE event.type = "device_access" AND user.name NOT IN ['known_users'] \| JOIN logs-windows-* ON user.id WHERE winlog.event_id = 2003 \| STATS COUNT() BY user.id, host.name HAVING COUNT() > 3`. |
| 10. C2 via Removable Media with File Creation | Files created on removable media for C2, as in FIN7. | - File Creation (DS0022: Sysmon ID 11)<br>- Device Logs | - **Splunk**: `index=endpoint sourcetype=sysmon EventCode=11 TargetFilename IN ("D:\\*", "E:\\*") AND TargetFilename="*c2*" \| stats count by TargetFilename, host \| where count > 3`.<br>- **KQL**: `DeviceFileEvents \| where ActionType == "FileCreated" and FolderPath has_any ("D:\\", "E:\\") and FileName contains "c2" \| summarize count() by FileName, DeviceName \| where count_ > 3`.<br>- **ELK**: `FROM logs-endpoint.file-* \| WHERE event.action = "creation" AND file.path : ("D:\\*" OR "E:\\*") AND file.name : "*c2*" \| STATS COUNT() BY file.name, host.name HAVING COUNT() > 3`. |
| 11. C2 via Removable Media with Encrypted Payloads | Encrypted payloads on removable media, as in Turla. | - File Creation (DS0022: Sysmon ID 11)<br>- File Metadata | - **Splunk**: `index=endpoint sourcetype=sysmon EventCode=11 TargetFilename IN ("D:\\*", "E:\\*") AND payload_entropy > 7 \| stats count by TargetFilename, host \| where count > 3`.<br>- **KQL**: `DeviceFileEvents \| where ActionType == "FileCreated" and FolderPath has_any ("D:\\", "E:\\") and AdditionalFields.PayloadEntropy > 7 \| summarize count() by FileName, DeviceName \| where count_ > 3`.<br>- **ELK**: `FROM logs-endpoint.file-* \| WHERE event.action = "creation" AND file.path : ("D:\\*" OR "E:\\*") AND file.payload.entropy > 7 \| STATS COUNT() BY file.name, host.name HAVING COUNT() > 3`. |
| 12. C2 via Removable Media in Non-Standard Environments | Removable media C2 in cloud VMs, as in APT41. | - Cloud Audit Logs (AWS CloudTrail)<br>- Device Logs | - **Splunk**: `index=cloud sourcetype=aws:cloudtrail eventName="AttachVolume" AND userIdentity NOT IN (authorized_users) \| stats count by userIdentity, volumeId \| where count > 3`.<br>- **KQL**: `AWSCloudTrail \| where EventName == "AttachVolume" and Caller !in (authorizedUsers) \| summarize count() by Caller, VolumeId \| where count_ > 3`.<br>- **ELK**: `FROM logs-aws.cloudtrail-* \| WHERE event.action = 'AttachVolume' AND user.identity NOT IN ['authorized_users'] \| STATS COUNT() BY user.identity, volume.id HAVING COUNT() > 3`. |
| 13. C2 via Removable Media with Anomalous Timing | Removable media C2 with unusual timing, as in 2025 trends. | - Device Logs (DS0001: Windows Event ID 2003)<br>- Time Analysis | - **Splunk**: `index=windows EventID=2003 \| timechart span=1h count \| where count > avg(count)*4`.<br>- **KQL**: `DeviceEvents \| where ActionType == "UsbDriveMounted" \| summarize HourlyCount=count() by bin(Timestamp, 1h) \| where HourlyCount > avg(HourlyCount) * 4`.<br>- **ELK**: `FROM logs-windows-* \| WHERE winlog.event_id = 2003 \| STATS COUNT() BY date_histogram(@timestamp, '1h') \| WHERE COUNT() > AVG(COUNT()) * 4`. |
| 14. C2 via Removable Media with File Creation | Files created on removable media for C2, as in FIN7. | - File Creation (DS0022: Sysmon ID 11)<br>- Device Logs | - **Splunk**: `index=endpoint sourcetype=sysmon EventCode=11 TargetFilename IN ("D:\\*", "E:\\*") AND TargetFilename="*c2*" \| stats count by TargetFilename, host \| where count > 3`.<br>- **KQL**: `DeviceFileEvents \| where ActionType == "FileCreated" and FolderPath has_any ("D:\\", "E:\\") and FileName contains "c2" \| summarize count() by FileName, DeviceName \| where count_ > 3`.<br>- **ELK**: `FROM logs-endpoint.file-* \| WHERE event.action = "creation" AND file.path : ("D:\\*" OR "E:\\*") AND file.name : "*c2*" \| STATS COUNT() BY file.name, host.name HAVING COUNT() > 3`. |
| 15. C2 via Removable Media with Encrypted Payloads | Encrypted payloads on removable media, as in Turla. | - File Creation (DS0022: Sysmon ID 11)<br>- File Metadata | - **Splunk**: `index=endpoint sourcetype=sysmon EventCode=11 TargetFilename IN ("D:\\*", "E:\\*") AND payload_entropy > 7 \| stats count by TargetFilename, host \| where count > 3`.<br>- **KQL**: `DeviceFileEvents \| where ActionType == "FileCreated" and FolderPath has_any ("D:\\", "E:\\") and AdditionalFields.PayloadEntropy > 7 \| summarize count() by FileName, DeviceName \| where count_ > 3`.<br>- **ELK**: `FROM logs-endpoint.file-* \| WHERE event.action = "creation" AND file.path : ("D:\\*" OR "E:\\*") AND file.payload.entropy > 7 \| STATS COUNT() BY file.name, host.name HAVING COUNT() > 3`. |

### Content Injection (T1659)

| Hypothesis | Description | Data Sources | Hunting Queries |
|------------|-------------|--------------|-----------------|
| 1. Suspicious Content Injection in Web Traffic | Adversaries inject malicious content into web responses, as in Man-in-the-Browser attacks. High risk in environments with limited web traffic inspection. | - Network Traffic (DS0003: Zeek HTTP)<br>- Proxy Logs | - **Splunk**: `index=network sourcetype=zeek_http uri="*inject*" \| stats count by src_ip, uri \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "HTTP" and RemoteUrl contains "inject" \| summarize count() by DeviceIP, RemoteUrl \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE http.uri : "*inject*" \| STATS COUNT() BY source.ip, http.uri HAVING COUNT() > 5`. |
| 2. Content Injection in DNS Responses | Adversaries inject malicious content into DNS responses, as in DNS hijacking. | - DNS Logs (DS0003: Zeek DNS)<br>- Network Traffic | - **Splunk**: `index=network sourcetype=zeek_dns answer NOT IN (known_ips) \| stats count by src_ip, answer \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "DNS" and AdditionalFields.Answer !in (knownIPs) \| summarize count() by DeviceIP, AdditionalFields.Answer \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.dns-* \| WHERE dns.answer NOT IN ['known_ips'] \| STATS COUNT() BY source.ip, dns.answer HAVING COUNT() > 5`. |
| 3. Content Injection in HTTP Responses | Adversaries inject scripts in HTTP responses, as in MITM attacks. | - Network Traffic (DS0003: Zeek HTTP)<br>- Packet Analysis | - **Splunk**: `index=network sourcetype=zeek_http status_code=200 AND response_body_length > 1000 \| stats count by src_ip, uri \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "HTTP" and AdditionalFields.StatusCode == 200 and AdditionalFields.ResponseBodyLength > 1000 \| summarize count() by DeviceIP, RemoteUrl \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE http.status = 200 AND http.response.body.length > 1000 \| STATS COUNT() BY source.ip, http.uri HAVING COUNT() > 5`. |
| 4. Content Injection with Anomalous Timing | Content injection during unusual times, as in 2025 trends. | - Network Traffic (DS0003: Zeek HTTP)<br>- Metrics | - **Splunk**: `index=network sourcetype=zeek_http \| timechart span=1h count \| where count > avg(count)*4`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "HTTP" \| summarize HourlyCount=count() by bin(Timestamp, 1h) \| where HourlyCount > avg(HourlyCount) * 4`.<br>- **ELK**: `FROM logs-zeek.http-* \| STATS COUNT() BY date_histogram(@timestamp, '1h') \| WHERE COUNT() > AVG(COUNT()) * 4`. |
| 5. Content Injection via Compromised Endpoints | Compromised endpoints inject content, as in Turla. | - Process Creation (DS0009: Sysmon ID 1)<br>- Network Traffic | - **Splunk**: `index=endpoint sourcetype=sysmon EventCode=1 CommandLine="*inject*" \| join host [search index=network sourcetype=zeek_http uri="*inject*"] \| stats count by host, CommandLine, uri \| where count > 3`.<br>- **KQL**: `DeviceProcessEvents \| where ProcessCommandLine contains "inject" \| join kind=inner (DeviceNetworkEvents \| where RemoteUrl contains "inject") on DeviceName \| summarize count() by DeviceName, ProcessCommandLine, RemoteUrl \| where count_ > 3`.<br>- **ELK**: `FROM logs-endpoint.process-* \| WHERE process.command_line : "*inject*" \| JOIN logs-zeek.http-* ON host.name WHERE http.uri : "*inject*" \| STATS COUNT() BY host.name, process.command_line, http.uri HAVING COUNT() > 3`. |
| 6. Content Injection in Cloud Environments | Content injection in cloud, as in 2025 trends. | - Cloud Audit Logs (AWS CloudTrail)<br>- Network Traffic | - **Splunk**: `index=cloud sourcetype=aws:cloudtrail eventName="PutObject" AND userIdentity NOT IN (authorized_users) \| stats count by userIdentity, src_ip \| where count > 5`.<br>- **KQL**: `AWSCloudTrail \| where EventName == "PutObject" and Caller !in (authorizedUsers) \| summarize count() by Caller, SourceIP \| where count_ > 5`.<br>- **ELK**: `FROM logs-aws.cloudtrail-* \| WHERE event.action = 'PutObject' AND user.identity NOT IN ['authorized_users'] \| STATS COUNT() BY user.identity, source.ip HAVING COUNT() > 5`. |
| 7. Content Injection with Encrypted Payloads | Encrypted payloads in injected content, as in APT41. | - Network Traffic (DS0003: Zeek HTTP)<br>- Packet Analysis | - **Splunk**: `index=network sourcetype=zeek_http payload_entropy > 7 \| stats count by src_ip, uri \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "HTTP" and AdditionalFields.PayloadEntropy > 7 \| summarize count() by DeviceIP, RemoteUrl \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE http.payload.entropy > 7 \| STATS COUNT() BY source.ip, http.uri HAVING COUNT() > 5`. |
| 8. Content Injection in Non-Standard Environments | Content injection in Linux, as in Turla. | - Network Traffic (DS0003: Zeek HTTP)<br>- Linux Logs | - **Splunk**: `index=linux sourcetype=auditd syscall="sendto" AND dest_port IN (80, 443) AND exe NOT IN (known_apps) \| stats count by exe, dest_ip \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where RemotePort in (80, 443) and InitiatingProcessName !in (knownApps) \| summarize count() by InitiatingProcessName, RemoteIP \| where count_ > 5`.<br>- **ELK**: `FROM logs-auditd-* \| WHERE syscall.name = "sendto" AND destination.port IN [80, 443] AND process.exe NOT IN ['known_apps'] \| STATS COUNT() BY process.exe, destination.ip HAVING COUNT() > 5`. |
| 9. Content Injection with Anomalous Timing | Content injection with unusual timing, as in 2025 trends. | - Network Traffic (DS0003: Zeek HTTP)<br>- Metrics | - **Splunk**: `index=network sourcetype=zeek_http \| timechart span=1h count \| where count > avg(count)*4`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "HTTP" \| summarize HourlyCount=count() by bin(Timestamp, 1h) \| where HourlyCount > avg(HourlyCount) * 4`.<br>- **ELK**: `FROM logs-zeek.http-* \| STATS COUNT() BY date_histogram(@timestamp, '1h') \| WHERE COUNT() > AVG(COUNT()) * 4`. |
| 10. Content Injection with Suspicious Headers | Content injection with custom headers, as in Cobalt Strike. | - Network Traffic (DS0003: Zeek HTTP)<br>- Proxy Logs | - **Splunk**: `index=network sourcetype=zeek_http header IN ("*X-Cobalt*", "*Custom-Header*") \| stats count by src_ip, header \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "HTTP" and AdditionalFields.Header has_any ("X-Cobalt", "Custom-Header") \| summarize count() by DeviceIP, AdditionalFields.Header \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE http.header : ("*X-Cobalt*" OR "*Custom-Header*") \| STATS COUNT() BY source.ip, http.header HAVING COUNT() > 5`. |
| 11. Content Injection with Encrypted Payloads | Encrypted payloads in injected content, as in APT41. | - Network Traffic (DS0003: Zeek HTTP)<br>- Packet Analysis | - **Splunk**: `index=network sourcetype=zeek_http payload_entropy > 7 \| stats count by src_ip, uri \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "HTTP" and AdditionalFields.PayloadEntropy > 7 \| summarize count() by DeviceIP, RemoteUrl \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE http.payload.entropy > 7 \| STATS COUNT() BY source.ip, http.uri HAVING COUNT() > 5`. |
| 12. Content Injection in Non-Standard Environments | Content injection in Linux, as in Turla. | - Network Traffic (DS0003: Zeek HTTP)<br>- Linux Logs | - **Splunk**: `index=linux sourcetype=auditd syscall="sendto" AND dest_port IN (80, 443) AND exe NOT IN (known_apps) \| stats count by exe, dest_ip \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where RemotePort in (80, 443) and InitiatingProcessName !in (knownApps) \| summarize count() by InitiatingProcessName, RemoteIP \| where count_ > 5`.<br>- **ELK**: `FROM logs-auditd-* \| WHERE syscall.name = "sendto" AND destination.port IN [80, 443] AND process.exe NOT IN ['known_apps'] \| STATS COUNT() BY process.exe, destination.ip HAVING COUNT() > 5`. |
| 13. Content Injection with Anomalous Timing | Content injection with unusual timing, as in 2025 trends. | - Network Traffic (DS0003: Zeek HTTP)<br>- Metrics | - **Splunk**: `index=network sourcetype=zeek_http \| timechart span=1h count \| where count > avg(count)*4`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "HTTP" \| summarize HourlyCount=count() by bin(Timestamp, 1h) \| where HourlyCount > avg(HourlyCount) * 4`.<br>- **ELK**: `FROM logs-zeek.http-* \| STATS COUNT() BY date_histogram(@timestamp, '1h') \| WHERE COUNT() > AVG(COUNT()) * 4`. |
| 14. Content Injection with Suspicious Headers | Content injection with custom headers, as in Cobalt Strike. | - Network Traffic (DS0003: Zeek HTTP)<br>- Proxy Logs | - **Splunk**: `index=network sourcetype=zeek_http header IN ("*X-Cobalt*", "*Custom-Header*") \| stats count by src_ip, header \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "HTTP" and AdditionalFields.Header has_any ("X-Cobalt", "Custom-Header") \| summarize count() by DeviceIP, AdditionalFields.Header \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE http.header : ("*X-Cobalt*" OR "*Custom-Header*") \| STATS COUNT() BY source.ip, http.header HAVING COUNT() > 5`. |
| 15. Content Injection with Encrypted Payloads | Encrypted payloads in injected content, as in APT41. | - Network Traffic (DS0003: Zeek HTTP)<br>- Packet Analysis | - **Splunk**: `index=network sourcetype=zeek_http payload_entropy > 7 \| stats count by src_ip, uri \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "HTTP" and AdditionalFields.PayloadEntropy > 7 \| summarize count() by DeviceIP, RemoteUrl \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE http.payload.entropy > 7 \| STATS COUNT() BY source.ip, http.uri HAVING COUNT() > 5`. |

### Custom Command and Control Protocol (T1094)

| Hypothesis | Description | Data Sources | Hunting Queries |
|------------|-------------|--------------|-----------------|
| 1. Custom Protocol Traffic Anomalies | Adversaries use custom protocols for C2, as in APT41. High risk in environments with limited protocol inspection. | - Network Traffic (DS0003: Zeek Conn)<br>- Firewall Logs | - **Splunk**: `index=network sourcetype=zeek_conn protocol NOT IN ("tcp", "udp", "icmp") \| stats count by src_ip, protocol \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol !in ("TCP", "UDP", "ICMP") \| summarize count() by DeviceIP, Protocol \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.conn-* \| WHERE network.protocol NOT IN ['tcp', 'udp', 'icmp'] \| STATS COUNT() BY source.ip, network.protocol HAVING COUNT() > 5`. |
| 2. Custom C2 with Encrypted Payloads | Encrypted custom C2 payloads, as in Turla. | - Network Traffic (DS0003: Zeek Conn)<br>- Packet Analysis | - **Splunk**: `index=network sourcetype=zeek_conn payload_entropy > 7 \| stats count by src_ip \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where AdditionalFields.PayloadEntropy > 7 \| summarize count() by DeviceIP \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.conn-* \| WHERE network.payload.entropy > 7 \| STATS COUNT() BY source.ip HAVING COUNT() > 5`. |
| 3. Custom C2 with Anomalous Timing | Custom C2 with unusual timing, as in 2025 trends. | - Network Traffic (DS0003: Zeek Conn)<br>- Metrics | - **Splunk**: `index=network sourcetype=zeek_conn \| timechart span=1h count \| where count > avg(count)*4`.<br>- **KQL**: `DeviceNetworkEvents \| summarize HourlyCount=count() by bin(Timestamp, 1h) \| where HourlyCount > avg(HourlyCount) * 4`.<br>- **ELK**: `FROM logs-zeek.conn-* \| STATS COUNT() BY date_histogram(@timestamp, '1h') \| WHERE COUNT() > AVG(COUNT()) * 4`. |
| 4. Custom C2 from Compromised Endpoints | Compromised endpoints initiate custom C2, as in FIN7. | - Process Creation (DS0009: Sysmon ID 1)<br>- Network Traffic | - **Splunk**: `index=endpoint sourcetype=sysmon EventCode=1 CommandLine="*c2*" \| join host [search index=network sourcetype=zeek_conn protocol NOT IN ("tcp", "udp")] \| stats count by host, CommandLine, protocol \| where count > 3`.<br>- **KQL**: `DeviceProcessEvents \| where ProcessCommandLine contains "c2" \| join kind=inner (DeviceNetworkEvents \| where Protocol !in ("TCP", "UDP")) on DeviceName \| summarize count() by DeviceName, ProcessCommandLine, Protocol \| where count_ > 3`.<br>- **ELK**: `FROM logs-endpoint.process-* \| WHERE process.command_line : "*c2*" \| JOIN logs-zeek.conn-* ON host.name WHERE network.protocol NOT IN ['tcp', 'udp'] \| STATS COUNT() BY host.name, process.command_line, network.protocol HAVING COUNT() > 3`. |
| 5. Custom C2 with High Packet Frequency | High-frequency custom C2 traffic, as in APT41. | - Network Traffic (DS0003: Zeek Conn)<br>- Metrics | - **Splunk**: `index=network sourcetype=zeek_conn protocol NOT IN ("tcp", "udp") \| timechart span=5m count by src_ip \| where count > avg(count)*4`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol !in ("TCP", "UDP") \| summarize PacketCount=count() by bin(Timestamp, 5m), DeviceIP \| where PacketCount > avg(PacketCount) * 4`.<br>- **ELK**: `FROM logs-zeek.conn-* \| WHERE network.protocol NOT IN ['tcp', 'udp'] \| STATS COUNT() BY date_histogram(@timestamp, '5m'), source.ip \| WHERE COUNT() > AVG(COUNT()) * 4`. |
| 6. Custom C2 in Cloud Environments | Custom C2 in cloud, as in 2025 trends. | - Cloud Audit Logs (AWS CloudTrail)<br>- Network Traffic | - **Splunk**: `index=cloud sourcetype=aws:cloudtrail eventName="Invoke" AND userIdentity NOT IN (authorized_users) \| stats count by userIdentity, src_ip \| where count > 5`.<br>- **KQL**: `AWSCloudTrail \| where EventName == "Invoke" and Caller !in (authorizedUsers) \| summarize count() by Caller, SourceIP \| where count_ > 5`.<br>- **ELK**: `FROM logs-aws.cloudtrail-* \| WHERE event.action = 'Invoke' AND user.identity NOT IN ['authorized_users'] \| STATS COUNT() BY user.identity, source.ip HAVING COUNT() > 5`. |
| 7. Custom C2 with Encrypted Payloads | Encrypted payloads in custom C2, as in APT41. | - Network Traffic (DS0003: Zeek Conn)<br>- Packet Analysis | - **Splunk**: `index=network sourcetype=zeek_conn payload_entropy > 7 \| stats count by src_ip \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where AdditionalFields.PayloadEntropy > 7 \| summarize count() by DeviceIP \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.conn-* \| WHERE network.payload.entropy > 7 \| STATS COUNT() BY source.ip HAVING COUNT() > 5`. |
| 8. Custom C2 in Non-Standard Environments | Custom C2 in Linux, as in Turla. | - Network Traffic (DS0003: Zeek Conn)<br>- Linux Logs | - **Splunk**: `index=linux sourcetype=auditd syscall="sendto" AND dest_port NOT IN (80, 443) AND exe NOT IN (known_apps) \| stats count by exe, dest_ip \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where RemotePort !in (80, 443) and InitiatingProcessName !in (knownApps) \| summarize count() by InitiatingProcessName, RemoteIP \| where count_ > 5`.<br>- **ELK**: `FROM logs-auditd-* \| WHERE syscall.name = "sendto" AND destination.port NOT IN [80, 443] AND process.exe NOT IN ['known_apps'] \| STATS COUNT() BY process.exe, destination.ip HAVING COUNT() > 5`. |
| 9. Custom C2 with Anomalous Timing | Custom C2 with unusual timing, as in 2025 trends. | - Network Traffic (DS0003: Zeek Conn)<br>- Metrics | - **Splunk**: `index=network sourcetype=zeek_conn protocol NOT IN ("tcp", "udp") \| timechart span=1h count \| where count > avg(count)*4`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol !in ("TCP", "UDP") \| summarize HourlyCount=count() by bin(Timestamp, 1h) \| where HourlyCount > avg(HourlyCount) * 4`.<br>- **ELK**: `FROM logs-zeek.conn-* \| WHERE network.protocol NOT IN ['tcp', 'udp'] \| STATS COUNT() BY date_histogram(@timestamp, '1h') \| WHERE COUNT() > AVG(COUNT()) * 4`. |
| 10. Custom C2 with Suspicious Headers | Custom C2 with custom headers, as in Cobalt Strike. | - Network Traffic (DS0003: Zeek HTTP)<br>- Proxy Logs | - **Splunk**: `index=network sourcetype=zeek_http header IN ("*X-Cobalt*", "*Custom-Header*") \| stats count by src_ip, header \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "HTTP" and AdditionalFields.Header has_any ("X-Cobalt", "Custom-Header") \| summarize count() by DeviceIP, AdditionalFields.Header \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE http.header : ("*X-Cobalt*" OR "*Custom-Header*") \| STATS COUNT() BY source.ip, http.header HAVING COUNT() > 5`. |
| 11. Custom C2 with Encrypted Payloads | Encrypted payloads in custom C2, as in APT41. | - Network Traffic (DS0003: Zeek Conn)<br>- Packet Analysis | - **Splunk**: `index=network sourcetype=zeek_conn payload_entropy > 7 \| stats count by src_ip \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where AdditionalFields.PayloadEntropy > 7 \| summarize count() by DeviceIP \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.conn-* \| WHERE network.payload.entropy > 7 \| STATS COUNT() BY source.ip HAVING COUNT() > 5`. |
| 12. Custom C2 in Non-Standard Environments | Custom C2 in cloud, as in 2025 trends. | - Cloud Audit Logs (AWS CloudTrail)<br>- Network Traffic | - **Splunk**: `index=cloud sourcetype=aws:cloudtrail eventName="Invoke" AND userIdentity NOT IN (authorized_users) \| stats count by userIdentity, src_ip \| where count > 5`.<br>- **KQL**: `AWSCloudTrail \| where EventName == "Invoke" and Caller !in (authorizedUsers) \| summarize count() by Caller, SourceIP \| where count_ > 5`.<br>- **ELK**: `FROM logs-aws.cloudtrail-* \| WHERE event.action = 'Invoke' AND user.identity NOT IN ['authorized_users'] \| STATS COUNT() BY user.identity, source.ip HAVING COUNT() > 5`. |
| 13. Custom C2 with Anomalous Timing | Custom C2 with unusual timing, as in 2025 trends. | - Network Traffic (DS0003: Zeek Conn)<br>- Metrics | - **Splunk**: `index=network sourcetype=zeek_conn \| timechart span=1h count \| where count > avg(count)*4`.<br>- **KQL**: `DeviceNetworkEvents \| summarize HourlyCount=count() by bin(Timestamp, 1h) \| where HourlyCount > avg(HourlyCount) * 4`.<br>- **ELK**: `FROM logs-zeek.conn-* \| STATS COUNT() BY date_histogram(@timestamp, '1h') \| WHERE COUNT() > AVG(COUNT()) * 4`. |
| 14. Custom C2 with Suspicious Headers | Custom C2 with custom headers, as in Cobalt Strike. | - Network Traffic (DS0003: Zeek HTTP)<br>- Proxy Logs | - **Splunk**: `index=network sourcetype=zeek_http header IN ("*X-Cobalt*", "*Custom-Header*") \| stats count by src_ip, header \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "HTTP" and AdditionalFields.Header has_any ("X-Cobalt", "Custom-Header") \| summarize count() by DeviceIP, AdditionalFields.Header \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE http.header : ("*X-Cobalt*" OR "*Custom-Header*") \| STATS COUNT() BY source.ip, http.header HAVING COUNT() > 5`. |
| 15. Custom C2 with Encrypted Payloads | Encrypted payloads in custom C2, as in APT41. | - Network Traffic (DS0003: Zeek Conn)<br>- Packet Analysis | - **Splunk**: `index=network sourcetype=zeek_conn payload_entropy > 7 \| stats count by src_ip \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where AdditionalFields.PayloadEntropy > 7 \| summarize count() by DeviceIP \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.conn-* \| WHERE network.payload.entropy > 7 \| STATS COUNT() BY source.ip HAVING COUNT() > 5`.

### DNS (T1071.004)

| Hypothesis | Description | Data Sources | Hunting Queries |
|------------|-------------|--------------|-----------------|
| 1. Anomalous DNS Query Volume for C2 | Adversaries use DNS for C2 communication with high query volumes to evade detection, as in APT41 campaigns. High risk in environments with limited DNS monitoring. | - DNS Logs (DS0003: Zeek DNS)<br>- Network Traffic | - **Splunk**: `index=network sourcetype=zeek_dns \| timechart span=1h count by src_ip \| where count > avg(count)*4` (Detects spikes in DNS queries).<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "DNS" \| summarize HourlyCount=count() by bin(Timestamp, 1h), DeviceIP \| where HourlyCount > avg(HourlyCount) * 4`.<br>- **ELK**: `FROM logs-zeek.dns-* \| STATS COUNT() BY date_histogram(@timestamp, '1h'), source.ip \| WHERE COUNT() > AVG(COUNT()) * 4`. |
| 2. DNS Tunneling with Long Queries | Adversaries tunnel data over DNS with unusually long queries, as in FIN7 attacks. | - DNS Logs (DS0003: Zeek DNS)<br>- Network Traffic | - **Splunk**: `index=network sourcetype=zeek_dns query_length > 200 AND NOT query IN (known_domains) \| stats count by src_ip, query \| where count > 10`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "DNS" and AdditionalFields.QueryLength > 200 and AdditionalFields.Query !in (knownDomains) \| summarize count() by DeviceIP, AdditionalFields.Query \| where count_ > 10`.<br>- **ELK**: `FROM logs-zeek.dns-* \| WHERE dns.query.length > 200 AND dns.query NOT IN ['known_domains'] \| STATS COUNT() BY source.ip, dns.query HAVING COUNT() > 10`. |
| 3. DNS C2 with Base64 Encoded Queries | DNS queries with encoded payloads for C2, as in APT29. | - DNS Logs (DS0003: Zeek DNS)<br>- Packet Analysis | - **Splunk**: `index=network sourcetype=zeek_dns query="*base64*" \| stats count by src_ip, query \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "DNS" and AdditionalFields.Query contains "base64" \| summarize count() by DeviceIP, AdditionalFields.Query \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.dns-* \| WHERE dns.query : "*base64*" \| STATS COUNT() BY source.ip, dns.query HAVING COUNT() > 5`. |
| 4. DNS C2 from Compromised Endpoints | Compromised endpoints initiate DNS C2, as in Turla. | - Process Creation (DS0009: Sysmon ID 1)<br>- DNS Logs | - **Splunk**: `index=endpoint sourcetype=sysmon EventCode=1 CommandLine="*dns*" \| join host [search index=network sourcetype=zeek_dns query_length > 200] \| stats count by host, CommandLine, query \| where count > 3`.<br>- **KQL**: `DeviceProcessEvents \| where ProcessCommandLine contains "dns" \| join kind=inner (DeviceNetworkEvents \| where Protocol == "DNS" and AdditionalFields.QueryLength > 200) on DeviceName \| summarize count() by DeviceName, ProcessCommandLine, AdditionalFields.Query \| where count_ > 3`.<br>- **ELK**: `FROM logs-endpoint.process-* \| WHERE process.command_line : "*dns*" \| JOIN logs-zeek.dns-* ON host.name WHERE dns.query.length > 200 \| STATS COUNT() BY host.name, process.command_line, dns.query HAVING COUNT() > 3`. |
| 5. DNS C2 with Anomalous Timing | DNS C2 with unusual timing, as in 2025 trends. | - DNS Logs (DS0003: Zeek DNS)<br>- Metrics | - **Splunk**: `index=network sourcetype=zeek_dns \| timechart span=1h count \| where count > avg(count)*4`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "DNS" \| summarize HourlyCount=count() by bin(Timestamp, 1h) \| where HourlyCount > avg(HourlyCount) * 4`.<br>- **ELK**: `FROM logs-zeek.dns-* \| STATS COUNT() BY date_histogram(@timestamp, '1h') \| WHERE COUNT() > AVG(COUNT()) * 4`. |
| 6. DNS C2 with Encrypted Payloads | Encrypted payloads in DNS queries for C2, as in APT41. | - DNS Logs (DS0003: Zeek DNS)<br>- Packet Analysis | - **Splunk**: `index=network sourcetype=zeek_dns payload_entropy > 7 \| stats count by src_ip, query \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "DNS" and AdditionalFields.PayloadEntropy > 7 \| summarize count() by DeviceIP, RemoteUrl \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.dns-* \| WHERE dns.payload.entropy > 7 \| STATS COUNT() BY source.ip, dns.query HAVING COUNT() > 5`. |
| 7. DNS C2 in Cloud Environments | DNS C2 in cloud, as in 2025 trends. | - Cloud Audit Logs (AWS CloudTrail)<br>- DNS Logs | - **Splunk**: `index=cloud sourcetype=aws:cloudtrail eventName="Resolve" AND userIdentity NOT IN (authorized_users) \| stats count by userIdentity, src_ip \| where count > 5`.<br>- **KQL**: `AWSCloudTrail \| where EventName == "Resolve" and Caller !in (authorizedUsers) \| summarize count() by Caller, SourceIP \| where count_ > 5`.<br>- **ELK**: `FROM logs-aws.cloudtrail-* \| WHERE event.action = 'Resolve' AND user.identity NOT IN ['authorized_users'] \| STATS COUNT() BY user.identity, source.ip HAVING COUNT() > 5`. |
| 8. DNS C2 with Suspicious Headers | DNS C2 with custom headers, as in Cobalt Strike. | - DNS Logs (DS0003: Zeek DNS)<br>- Proxy Logs | - **Splunk**: `index=network sourcetype=zeek_dns header IN ("*X-Cobalt*", "*Custom-Header*") \| stats count by src_ip, header \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "DNS" and AdditionalFields.Header has_any ("X-Cobalt", "Custom-Header") \| summarize count() by DeviceIP, AdditionalFields.Header \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.dns-* \| WHERE dns.header : ("*X-Cobalt*" OR "*Custom-Header*") \| STATS COUNT() BY source.ip, dns.header HAVING COUNT() > 5`. |
| 9. DNS C2 in Non-Standard Environments | DNS C2 in Linux, as in Turla. | - DNS Logs (DS0003: Zeek DNS)<br>- Linux Logs | - **Splunk**: `index=linux sourcetype=auditd syscall="sendto" AND dest_port=53 AND exe NOT IN (known_apps) \| stats count by exe, dest_ip \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where RemotePort == 53 and InitiatingProcessName !in (knownApps) \| summarize count() by InitiatingProcessName, RemoteIP \| where count_ > 5`.<br>- **ELK**: `FROM logs-auditd-* \| WHERE syscall.name = "sendto" AND destination.port = 53 AND process.exe NOT IN ['known_apps'] \| STATS COUNT() BY process.exe, destination.ip HAVING COUNT() > 5`. |
| 10. DNS C2 with Multi-Stage Redirects | DNS C2 with redirects, as in APT41. | - DNS Logs (DS0003: Zeek DNS)<br>- Redirect Analysis | - **Splunk**: `index=network sourcetype=zeek_dns status_code=302 \| stats count by src_ip, query \| where count > 3`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "DNS" and AdditionalFields.StatusCode == 302 \| summarize count() by DeviceIP, AdditionalFields.Query \| where count_ > 3`.<br>- **ELK**: `FROM logs-zeek.dns-* \| WHERE dns.status = 302 \| STATS COUNT() BY source.ip, dns.query HAVING COUNT() > 3`. |
| 11. DNS C2 with Anomalous User Agents | DNS C2 with unusual user agents, as in Cobalt Strike. | - DNS Logs (DS0003: Zeek DNS)<br>- Proxy Logs | - **Splunk**: `index=network sourcetype=zeek_dns user_agent NOT IN (known_agents) \| stats count by src_ip, user_agent \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "DNS" and AdditionalFields.UserAgent !in (knownAgents) \| summarize count() by DeviceIP, AdditionalFields.UserAgent \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.dns-* \| WHERE dns.user_agent NOT IN ['known_agents'] \| STATS COUNT() BY source.ip, dns.user_agent HAVING COUNT() > 5`. |
| 12. DNS C2 in Cloud Environments | DNS C2 in cloud, as in 2025 trends. | - Cloud Audit Logs (AWS CloudTrail)<br>- DNS Logs | - **Splunk**: `index=cloud sourcetype=aws:cloudtrail eventName="Resolve" AND userIdentity NOT IN (authorized_users) \| stats count by userIdentity, src_ip \| where count > 5`.<br>- **KQL**: `AWSCloudTrail \| where EventName == "Resolve" and Caller !in (authorizedUsers) \| summarize count() by Caller, SourceIP \| where count_ > 5`.<br>- **ELK**: `FROM logs-aws.cloudtrail-* \| WHERE event.action = 'Resolve' AND user.identity NOT IN ['authorized_users'] \| STATS COUNT() BY user.identity, source.ip HAVING COUNT() > 5`. |
| 13. DNS C2 with Anomalous Timing | DNS C2 with unusual timing, as in 2025 trends. | - DNS Logs (DS0003: Zeek DNS)<br>- Metrics | - **Splunk**: `index=network sourcetype=zeek_dns \| timechart span=1h count \| where count > avg(count)*4`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "DNS" \| summarize HourlyCount=count() by bin(Timestamp, 1h) \| where HourlyCount > avg(HourlyCount) * 4`.<br>- **ELK**: `FROM logs-zeek.dns-* \| STATS COUNT() BY date_histogram(@timestamp, '1h') \| WHERE COUNT() > AVG(COUNT()) * 4`. |
| 14. DNS C2 with Suspicious Headers | DNS C2 with custom headers, as in Cobalt Strike. | - DNS Logs (DS0003: Zeek DNS)<br>- Proxy Logs | - **Splunk**: `index=network sourcetype=zeek_dns header IN ("*X-Cobalt*", "*Custom-Header*") \| stats count by src_ip, header \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "DNS" and AdditionalFields.Header has_any ("X-Cobalt", "Custom-Header") \| summarize count() by DeviceIP, AdditionalFields.Header \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.dns-* \| WHERE dns.header : ("*X-Cobalt*" OR "*Custom-Header*") \| STATS COUNT() BY source.ip, dns.header HAVING COUNT() > 5`. |
| 15. DNS C2 with Encrypted Payloads | Encrypted payloads in DNS C2, as in APT41. | - DNS Logs (DS0003: Zeek DNS)<br>- Packet Analysis | - **Splunk**: `index=network sourcetype=zeek_dns payload_entropy > 7 \| stats count by src_ip, query \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "DNS" and AdditionalFields.PayloadEntropy > 7 \| summarize count() by DeviceIP, AdditionalFields.Query \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.dns-* \| WHERE dns.payload.entropy > 7 \| STATS COUNT() BY source.ip, dns.query HAVING COUNT() > 5`. |

### DNS Calculation (T1568.002)

| Hypothesis | Description | Data Sources | Hunting Queries |
|------------|-------------|--------------|-----------------|
| 1. Domain Generation Algorithm (DGA) Traffic | Adversaries use DGA for DNS C2, generating many domains, as in APT41. High risk in environments with limited DNS monitoring. | - DNS Logs (DS0003: Zeek DNS)<br>- Network Traffic | - **Splunk**: `index=network sourcetype=zeek_dns query NOT IN (known_domains) AND query_entropy > 3 \| stats count by src_ip, query \| where count > 10`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "DNS" and AdditionalFields.Query !in (knownDomains) and AdditionalFields.QueryEntropy > 3 \| summarize count() by DeviceIP, AdditionalFields.Query \| where count_ > 10`.<br>- **ELK**: `FROM logs-zeek.dns-* \| WHERE dns.query NOT IN ['known_domains'] AND dns.query.entropy > 3 \| STATS COUNT() BY source.ip, dns.query HAVING COUNT() > 10`. |
| 2. DGA with Failed Resolutions | High failed DNS resolutions, indicating DGA C2, as in Turla. | - DNS Logs (DS0003: Zeek DNS)<br>- Network Traffic | - **Splunk**: `index=network sourcetype=zeek_dns rcode_name="NXDOMAIN" \| stats count by src_ip, query \| where count > 10`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "DNS" and AdditionalFields.RCodeName == "NXDOMAIN" \| summarize count() by DeviceIP, AdditionalFields.Query \| where count_ > 10`.<br>- **ELK**: `FROM logs-zeek.dns-* \| WHERE dns.rcode.name = "NXDOMAIN" \| STATS COUNT() BY source.ip, dns.query HAVING COUNT() > 10`. |
| 3. DGA with Random Domain Patterns | DNS queries with random-like domains, as in APT29. | - DNS Logs (DS0003: Zeek DNS)<br>- Packet Analysis | - **Splunk**: `index=network sourcetype=zeek_dns query="*random*" \| stats count by src_ip, query \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "DNS" and AdditionalFields.Query contains "random" \| summarize count() by DeviceIP, AdditionalFields.Query \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.dns-* \| WHERE dns.query : "*random*" \| STATS COUNT() BY source.ip, dns.query HAVING COUNT() > 5`. |
| 4. DGA from Compromised Endpoints | Compromised endpoints generate DGA DNS queries, as in Turla. | - Process Creation (DS0009: Sysmon ID 1)<br>- DNS Logs | - **Splunk**: `index=endpoint sourcetype=sysmon EventCode=1 CommandLine="*dns*" \| join host [search index=network sourcetype=zeek_dns rcode_name="NXDOMAIN"] \| stats count by host, CommandLine, query \| where count > 3`.<br>- **KQL**: `DeviceProcessEvents \| where ProcessCommandLine contains "dns" \| join kind=inner (DeviceNetworkEvents \| where Protocol == "DNS" and AdditionalFields.RCodeName == "NXDOMAIN") on DeviceName \| summarize count() by DeviceName, ProcessCommandLine, AdditionalFields.Query \| where count_ > 3`.<br>- **ELK**: `FROM logs-endpoint.process-* \| WHERE process.command_line : "*dns*" \| JOIN logs-zeek.dns-* ON host.name WHERE dns.rcode.name = "NXDOMAIN" \| STATS COUNT() BY host.name, process.command_line, dns.query HAVING COUNT() > 3`. |
| 5. DGA with Anomalous Timing | DGA DNS C2 with unusual timing, as in 2025 trends. | - DNS Logs (DS0003: Zeek DNS)<br>- Metrics | - **Splunk**: `index=network sourcetype=zeek_dns \| timechart span=1h count \| where count > avg(count)*4`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "DNS" \| summarize HourlyCount=count() by bin(Timestamp, 1h) \| where HourlyCount > avg(HourlyCount) * 4`.<br>- **ELK**: `FROM logs-zeek.dns-* \| STATS COUNT() BY date_histogram(@timestamp, '1h') \| WHERE COUNT() > AVG(COUNT()) * 4`. |
| 6. DGA with Encrypted Payloads | Encrypted payloads in DGA DNS queries, as in APT41. | - DNS Logs (DS0003: Zeek DNS)<br>- Packet Analysis | - **Splunk**: `index=network sourcetype=zeek_dns payload_entropy > 7 \| stats count by src_ip, query \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "DNS" and AdditionalFields.PayloadEntropy > 7 \| summarize count() by DeviceIP, AdditionalFields.Query \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.dns-* \| WHERE dns.payload.entropy > 7 \| STATS COUNT() BY source.ip, dns.query HAVING COUNT() > 5`. |
| 7. DGA in Cloud Environments | DGA DNS C2 in cloud, as in 2025 trends. | - Cloud Audit Logs (AWS CloudTrail)<br>- DNS Logs | - **Splunk**: `index=cloud sourcetype=aws:cloudtrail eventName="Resolve" AND userIdentity NOT IN (authorized_users) \| stats count by userIdentity, src_ip \| where count > 5`.<br>- **KQL**: `AWSCloudTrail \| where EventName == "Resolve" and Caller !in (authorizedUsers) \| summarize count() by Caller, SourceIP \| where count_ > 5`.<br>- **ELK**: `FROM logs-aws.cloudtrail-* \| WHERE event.action = 'Resolve' AND user.identity NOT IN ['authorized_users'] \| STATS COUNT() BY user.identity, source.ip HAVING COUNT() > 5`. |
| 8. DGA with Suspicious Headers | DGA DNS C2 with custom headers, as in Cobalt Strike. | - DNS Logs (DS0003: Zeek DNS)<br>- Proxy Logs | - **Splunk**: `index=network sourcetype=zeek_dns header IN ("*X-Cobalt*", "*Custom-Header*") \| stats count by src_ip, header \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "DNS" and AdditionalFields.Header has_any ("X-Cobalt", "Custom-Header") \| summarize count() by DeviceIP, AdditionalFields.Header \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.dns-* \| WHERE dns.header : ("*X-Cobalt*" OR "*Custom-Header*") \| STATS COUNT() BY source.ip, dns.header HAVING COUNT() > 5`. |
| 9. DGA in Non-Standard Environments | DGA DNS C2 in Linux, as in Turla. | - DNS Logs (DS0003: Zeek DNS)<br>- Linux Logs | - **Splunk**: `index=linux sourcetype=auditd syscall="sendto" AND dest_port=53 AND exe NOT IN (known_apps) \| stats count by exe, dest_ip \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where RemotePort == 53 and InitiatingProcessName !in (knownApps) \| summarize count() by InitiatingProcessName, RemoteIP \| where count_ > 5`.<br>- **ELK**: `FROM logs-auditd-* \| WHERE syscall.name = "sendto" AND destination.port = 53 AND process.exe NOT IN ['known_apps'] \| STATS COUNT() BY process.exe, destination.ip HAVING COUNT() > 5`. |
| 10. DGA with Multi-Stage Redirects | DGA DNS C2 with redirects, as in APT41. | - DNS Logs (DS0003: Zeek DNS)<br>- Redirect Analysis | - **Splunk**: `index=network sourcetype=zeek_dns status_code=302 \| stats count by src_ip, query \| where count > 3`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "DNS" and AdditionalFields.StatusCode == 302 \| summarize count() by DeviceIP, AdditionalFields.Query \| where count_ > 3`.<br>- **ELK**: `FROM logs-zeek.dns-* \| WHERE dns.status = 302 \| STATS COUNT() BY source.ip, dns.query HAVING COUNT() > 3`. |
| 11. DGA with Anomalous User Agents | DGA DNS C2 with unusual user agents, as in Cobalt Strike. | - DNS Logs (DS0003: Zeek DNS)<br>- Proxy Logs | - **Splunk**: `index=network sourcetype=zeek_dns user_agent NOT IN (known_agents) \| stats count by src_ip, user_agent \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "DNS" and AdditionalFields.UserAgent !in (knownAgents) \| summarize count() by DeviceIP, AdditionalFields.UserAgent \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.dns-* \| WHERE dns.user_agent NOT IN ['known_agents'] \| STATS COUNT() BY source.ip, dns.user_agent HAVING COUNT() > 5`. |
| 12. DGA in Cloud Environments | DGA DNS C2 in cloud, as in 2025 trends. | - Cloud Audit Logs (AWS CloudTrail)<br>- DNS Logs | - **Splunk**: `index=cloud sourcetype=aws:cloudtrail eventName="Resolve" AND userIdentity NOT IN (authorized_users) \| stats count by userIdentity, src_ip \| where count > 5`.<br>- **KQL**: `AWSCloudTrail \| where EventName == "Resolve" and Caller !in (authorizedUsers) \| summarize count() by Caller, SourceIP \| where count_ > 5`.<br>- **ELK**: `FROM logs-aws.cloudtrail-* \| WHERE event.action = 'Resolve' AND user.identity NOT IN ['authorized_users'] \| STATS COUNT() BY user.identity, source.ip HAVING COUNT() > 5`. |
| 13. DGA with Anomalous Timing | DGA DNS C2 with unusual timing, as in 2025 trends. | - DNS Logs (DS0003: Zeek DNS)<br>- Metrics | - **Splunk**: `index=network sourcetype=zeek_dns \| timechart span=1h count \| where count > avg(count)*4`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "DNS" \| summarize HourlyCount=count() by bin(Timestamp, 1h) \| where HourlyCount > avg(HourlyCount) * 4`.<br>- **ELK**: `FROM logs-zeek.dns-* \| STATS COUNT() BY date_histogram(@timestamp, '1h') \| WHERE COUNT() > AVG(COUNT()) * 4`. |
| 14. DGA with Suspicious Headers | DGA DNS C2 with custom headers, as in Cobalt Strike. | - DNS Logs (DS0003: Zeek DNS)<br>- Proxy Logs | - **Splunk**: `index=network sourcetype=zeek_dns header IN ("*X-Cobalt*", "*Custom-Header*") \| stats count by src_ip, header \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "DNS" and AdditionalFields.Header has_any ("X-Cobalt", "Custom-Header") \| summarize count() by DeviceIP, AdditionalFields.Header \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.dns-* \| WHERE dns.header : ("*X-Cobalt*" OR "*Custom-Header*") \| STATS COUNT() BY source.ip, dns.header HAVING COUNT() > 5`. |
| 15. DGA with Encrypted Payloads | Encrypted payloads in DGA DNS C2, as in APT41. | - DNS Logs (DS0003: Zeek DNS)<br>- Packet Analysis | - **Splunk**: `index=network sourcetype=zeek_dns payload_entropy > 7 \| stats count by src_ip, query \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "DNS" and AdditionalFields.PayloadEntropy > 7 \| summarize count() by DeviceIP, AdditionalFields.Query \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.dns-* \| WHERE dns.payload.entropy > 7 \| STATS COUNT() BY source.ip, dns.query HAVING COUNT() > 5`. |

### Data Encoding (T1132)

| Hypothesis | Description | Data Sources | Hunting Queries |
|------------|-------------|--------------|-----------------|
| 1. Base64 Encoded Payloads in Traffic | Adversaries use Base64 encoding for C2 data, as in APT41. High risk in environments with limited payload inspection. | - Network Traffic (DS0003: Zeek HTTP)<br>- Packet Analysis | - **Splunk**: `index=network sourcetype=zeek_http payload="*base64*" \| stats count by src_ip, uri \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "HTTP" and AdditionalFields.Payload contains "base64" \| summarize count() by DeviceIP, RemoteUrl \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE http.payload : "*base64*" \| STATS COUNT() BY source.ip, http.uri HAVING COUNT() > 5`. |
| 2. URL Encoded Data in C2 | URL encoding in C2 payloads, as in Turla. | - Network Traffic (DS0003: Zeek HTTP)<br>- Proxy Logs | - **Splunk**: `index=network sourcetype=zeek_http uri="*%20*" \| stats count by src_ip, uri \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "HTTP" and RemoteUrl contains "%20" \| summarize count() by DeviceIP, RemoteUrl \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE http.uri : "*%20*" \| STATS COUNT() BY source.ip, http.uri HAVING COUNT() > 5`. |
| 3. Data Encoding in DNS Queries | Encoded data in DNS queries for C2, as in APT29. | - DNS Logs (DS0003: Zeek DNS)<br>- Network Traffic | - **Splunk**: `index=network sourcetype=zeek_dns query="*base64*" \| stats count by src_ip, query \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "DNS" and AdditionalFields.Query contains "base64" \| summarize count() by DeviceIP, AdditionalFields.Query \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.dns-* \| WHERE dns.query : "*base64*" \| STATS COUNT() BY source.ip, dns.query HAVING COUNT() > 5`. |
| 4. Data Encoding with Anomalous Timing | Encoded data transfers with unusual timing, as in 2025 trends. | - Network Traffic (DS0003: Zeek HTTP)<br>- Metrics | - **Splunk**: `index=network sourcetype=zeek_http payload="*base64*" \| timechart span=1h count \| where count > avg(count)*4`.<br>- **KQL**: `DeviceNetworkEvents \| where AdditionalFields.Payload contains "base64" \| summarize HourlyCount=count() by bin(Timestamp, 1h) \| where HourlyCount > avg(HourlyCount) * 4`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE http.payload : "*base64*" \| STATS COUNT() BY date_histogram(@timestamp, '1h') \| WHERE COUNT() > AVG(COUNT()) * 4`. |
| 5. Data Encoding via Compromised Endpoints | Compromised endpoints encode data for C2, as in Turla. | - Process Creation (DS0009: Sysmon ID 1)<br>- Network Traffic | - **Splunk**: `index=endpoint sourcetype=sysmon EventCode=1 CommandLine="*base64*" \| join host [search index=network sourcetype=zeek_http payload="*base64*"] \| stats count by host, CommandLine, uri \| where count > 3`.<br>- **KQL**: `DeviceProcessEvents \| where ProcessCommandLine contains "base64" \| join kind=inner (DeviceNetworkEvents \| where AdditionalFields.Payload contains "base64") on DeviceName \| summarize count() by DeviceName, ProcessCommandLine, RemoteUrl \| where count_ > 3`.<br>- **ELK**: `FROM logs-endpoint.process-* \| WHERE process.command_line : "*base64*" \| JOIN logs-zeek.http-* ON host.name WHERE http.payload : "*base64*" \| STATS COUNT() BY host.name, process.command_line, http.uri HAVING COUNT() > 3`. |
| 6. Data Encoding in Cloud Environments | Encoded data in cloud C2, as in 2025 trends. | - Cloud Audit Logs (AWS CloudTrail)<br>- Network Traffic | - **Splunk**: `index=cloud sourcetype=aws:cloudtrail eventName="Invoke" AND userIdentity NOT IN (authorized_users) \| stats count by userIdentity, src_ip \| where count > 5`.<br>- **KQL**: `AWSCloudTrail \| where EventName == "Invoke" and Caller !in (authorizedUsers) \| summarize count() by Caller, SourceIP \| where count_ > 5`.<br>- **ELK**: `FROM logs-aws.cloudtrail-* \| WHERE event.action = 'Invoke' AND user.identity NOT IN ['authorized_users'] \| STATS COUNT() BY user.identity, source.ip HAVING COUNT() > 5`. |
| 7. Data Encoding with Encrypted Payloads | Encoded and encrypted payloads, as in APT41. | - Network Traffic (DS0003: Zeek HTTP)<br>- Packet Analysis | - **Splunk**: `index=network sourcetype=zeek_http payload_entropy > 7 \| stats count by src_ip, uri \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "HTTP" and AdditionalFields.PayloadEntropy > 7 \| summarize count() by DeviceIP, RemoteUrl \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE http.payload.entropy > 7 \| STATS COUNT() BY source.ip, http.uri HAVING COUNT() > 5`. |
| 8. Data Encoding in Non-Standard Environments | Data encoding in Linux, as in Turla. | - Network Traffic (DS0003: Zeek HTTP)<br>- Linux Logs | - **Splunk**: `index=linux sourcetype=auditd syscall="sendto" AND dest_port IN (80, 443) AND exe NOT IN (known_apps) \| stats count by exe, dest_ip \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where RemotePort in (80, 443) and InitiatingProcessName !in (knownApps) \| summarize count() by InitiatingProcessName, RemoteIP \| where count_ > 5`.<br>- **ELK**: `FROM logs-auditd-* \| WHERE syscall.name = "sendto" AND destination.port IN [80, 443] AND process.exe NOT IN ['known_apps'] \| STATS COUNT() BY process.exe, destination.ip HAVING COUNT() > 5`. |
| 9. Data Encoding with Anomalous Timing | Data encoding with unusual timing, as in 2025 trends. | - Network Traffic (DS0003: Zeek HTTP)<br>- Metrics | - **Splunk**: `index=network sourcetype=zeek_http \| timechart span=1h count \| where count > avg(count)*4`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "HTTP" \| summarize HourlyCount=count() by bin(Timestamp, 1h) \| where HourlyCount > avg(HourlyCount) * 4`.<br>- **ELK**: `FROM logs-zeek.http-* \| STATS COUNT() BY date_histogram(@timestamp, '1h') \| WHERE COUNT() > AVG(COUNT()) * 4`. |
| 10. Data Encoding with Suspicious Headers | Data encoding with custom headers, as in Cobalt Strike. | - Network Traffic (DS0003: Zeek HTTP)<br>- Proxy Logs | - **Splunk**: `index=network sourcetype=zeek_http header IN ("*X-Cobalt*", "*Custom-Header*") \| stats count by src_ip, header \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "HTTP" and AdditionalFields.Header has_any ("X-Cobalt", "Custom-Header") \| summarize count() by DeviceIP, AdditionalFields.Header \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE http.header : ("*X-Cobalt*" OR "*Custom-Header*") \| STATS COUNT() BY source.ip, http.header HAVING COUNT() > 5`. |
| 11. Data Encoding with Encrypted Payloads | Encrypted payloads in encoded data, as in APT41. | - Network Traffic (DS0003: Zeek HTTP)<br>- Packet Analysis | - **Splunk**: `index=network sourcetype=zeek_http payload_entropy > 7 \| stats count by src_ip, uri \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "HTTP" and AdditionalFields.PayloadEntropy > 7 \| summarize count() by DeviceIP, RemoteUrl \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE http.payload.entropy > 7 \| STATS COUNT() BY source.ip, http.uri HAVING COUNT() > 5`. |
| 12. Data Encoding in Non-Standard Environments | Data encoding in Linux, as in Turla. | - Network Traffic (DS0003: Zeek HTTP)<br>- Linux Logs | - **Splunk**: `index=linux sourcetype=auditd syscall="sendto" AND dest_port IN (80, 443) AND exe NOT IN (known_apps) \| stats count by exe, dest_ip \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where RemotePort in (80, 443) and InitiatingProcessName !in (knownApps) \| summarize count() by InitiatingProcessName, RemoteIP \| where count_ > 5`.<br>- **ELK**: `FROM logs-auditd-* \| WHERE syscall.name = "sendto" AND destination.port IN [80, 443] AND process.exe NOT IN ['known_apps'] \| STATS COUNT() BY process.exe, destination.ip HAVING COUNT() > 5`. |
| 13. Data Encoding with Anomalous Timing | Data encoding with unusual timing, as in 2025 trends. | - Network Traffic (DS0003: Zeek HTTP)<br>- Metrics | - **Splunk**: `index=network sourcetype=zeek_http \| timechart span=1h count \| where count > avg(count)*4`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "HTTP" \| summarize HourlyCount=count() by bin(Timestamp, 1h) \| where HourlyCount > avg(HourlyCount) * 4`.<br>- **ELK**: `FROM logs-zeek.http-* \| STATS COUNT() BY date_histogram(@timestamp, '1h') \| WHERE COUNT() > AVG(COUNT()) * 4`. |
| 14. Data Encoding with Suspicious Headers | Data encoding with custom headers, as in Cobalt Strike. | - Network Traffic (DS0003: Zeek HTTP)<br>- Proxy Logs | - **Splunk**: `index=network sourcetype=zeek_http header IN ("*X-Cobalt*", "*Custom-Header*") \| stats count by src_ip, header \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "HTTP" and AdditionalFields.Header has_any ("X-Cobalt", "Custom-Header") \| summarize count() by DeviceIP, AdditionalFields.Header \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE http.header : ("*X-Cobalt*" OR "*Custom-Header*") \| STATS COUNT() BY source.ip, http.header HAVING COUNT() > 5`. |
| 15. Data Encoding with Encrypted Payloads | Encrypted payloads in encoded data, as in APT41. | - Network Traffic (DS0003: Zeek HTTP)<br>- Packet Analysis | - **Splunk**: `index=network sourcetype=zeek_http payload_entropy > 7 \| stats count by src_ip, uri \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "HTTP" and AdditionalFields.PayloadEntropy > 7 \| summarize count() by DeviceIP, RemoteUrl \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE http.payload.entropy > 7 \| STATS COUNT() BY source.ip, http.uri HAVING COUNT() > 5`. |

### Data Obfuscation (T1001)

| Hypothesis | Description | Data Sources | Hunting Queries |
|------------|-------------|--------------|-----------------|
| 1. Obfuscated Payloads in Traffic | Adversaries obfuscate C2 payloads, as in APT41. High risk in environments with limited payload inspection. | - Network Traffic (DS0003: Zeek HTTP)<br>- Packet Analysis | - **Splunk**: `index=network sourcetype=zeek_http payload_entropy > 7 \| stats count by src_ip, uri \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "HTTP" and AdditionalFields.PayloadEntropy > 7 \| summarize count() by DeviceIP, RemoteUrl \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE http.payload.entropy > 7 \| STATS COUNT() BY source.ip, http.uri HAVING COUNT() > 5`. |
| 2. Obfuscated Data in DNS Queries | Obfuscated data in DNS for C2, as in Turla. | - DNS Logs (DS0003: Zeek DNS)<br>- Network Traffic | - **Splunk**: `index=network sourcetype=zeek_dns query="*obfuscate*" \| stats count by src_ip, query \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "DNS" and AdditionalFields.Query contains "obfuscate" \| summarize count() by DeviceIP, AdditionalFields.Query \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.dns-* \| WHERE dns.query : "*obfuscate*" \| STATS COUNT() BY source.ip, dns.query HAVING COUNT() > 5`. |
| 3. Obfuscated Data with Anomalous Timing | Obfuscated data transfers with unusual timing, as in 2025 trends. | - Network Traffic (DS0003: Zeek HTTP)<br>- Metrics | - **Splunk**: `index=network sourcetype=zeek_http payload_entropy > 7 \| timechart span=1h count \| where count > avg(count)*4`.<br>- **KQL**: `DeviceNetworkEvents \| where AdditionalFields.PayloadEntropy > 7 \| summarize HourlyCount=count() by bin(Timestamp, 1h) \| where HourlyCount > avg(HourlyCount) * 4`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE http.payload.entropy > 7 \| STATS COUNT() BY date_histogram(@timestamp, '1h') \| WHERE COUNT() > AVG(COUNT()) * 4`. |
| 4. Obfuscated Data via Compromised Endpoints | Compromised endpoints obfuscate data for C2, as in Turla. | - Process Creation (DS0009: Sysmon ID 1)<br>- Network Traffic | - **Splunk**: `index=endpoint sourcetype=sysmon EventCode=1 CommandLine="*obfuscate*" \| join host [search index=network sourcetype=zeek_http payload_entropy > 7] \| stats count by host, CommandLine, uri \| where count > 3`.<br>- **KQL**: `DeviceProcessEvents \| where ProcessCommandLine contains "obfuscate" \| join kind=inner (DeviceNetworkEvents \| where AdditionalFields.PayloadEntropy > 7) on DeviceName \| summarize count() by DeviceName, ProcessCommandLine, RemoteUrl \| where count_ > 3`.<br>- **ELK**: `FROM logs-endpoint.process-* \| WHERE process.command_line : "*obfuscate*" \| JOIN logs-zeek.http-* ON host.name WHERE http.payload.entropy > 7 \| STATS COUNT() BY host.name, process.command_line, http.uri HAVING COUNT() > 3`. |
| 5. Obfuscated Data in Cloud Environments | Obfuscated data in cloud C2, as in 2025 trends. | - Cloud Audit Logs (AWS CloudTrail)<br>- Network Traffic | - **Splunk**: `index=cloud sourcetype=aws:cloudtrail eventName="Invoke" AND userIdentity NOT IN (authorized_users) \| stats count by userIdentity, src_ip \| where count > 5`.<br>- **KQL**: `AWSCloudTrail \| where EventName == "Invoke" and Caller !in (authorizedUsers) \| summarize count() by Caller, SourceIP \| where count_ > 5`.<br>- **ELK**: `FROM logs-aws.cloudtrail-* \| WHERE event.action = 'Invoke' AND user.identity NOT IN ['authorized_users'] \| STATS COUNT() BY user.identity, source.ip HAVING COUNT() > 5`. |
| 6. Obfuscated Data with Encrypted Payloads | Obfuscated and encrypted payloads, as in APT41. | - Network Traffic (DS0003: Zeek HTTP)<br>- Packet Analysis | - **Splunk**: `index=network sourcetype=zeek_http payload_entropy > 7 \| stats count by src_ip, uri \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "HTTP" and AdditionalFields.PayloadEntropy > 7 \| summarize count() by DeviceIP, RemoteUrl \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE http.payload.entropy > 7 \| STATS COUNT() BY source.ip, http.uri HAVING COUNT() > 5`. |
| 7. Obfuscated Data in Non-Standard Environments | Obfuscated data in Linux, as in Turla. | - Network Traffic (DS0003: Zeek HTTP)<br>- Linux Logs | - **Splunk**: `index=linux sourcetype=auditd syscall="sendto" AND dest_port IN (80, 443) AND exe NOT IN (known_apps) \| stats count by exe, dest_ip \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where RemotePort in (80, 443) and InitiatingProcessName !in (knownApps) \| summarize count() by InitiatingProcessName, RemoteIP \| where count_ > 5`.<br>- **ELK**: `FROM logs-auditd-* \| WHERE syscall.name = "sendto" AND destination.port IN [80, 443] AND process.exe NOT IN ['known_apps'] \| STATS COUNT() BY process.exe, destination.ip HAVING COUNT() > 5`. |
| 8. Obfuscated Data with Anomalous Timing | Obfuscated data with unusual timing, as in 2025 trends. | - Network Traffic (DS0003: Zeek HTTP)<br>- Metrics | - **Splunk**: `index=network sourcetype=zeek_http \| timechart span=1h count \| where count > avg(count)*4`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "HTTP" \| summarize HourlyCount=count() by bin(Timestamp, 1h) \| where HourlyCount > avg(HourlyCount) * 4`.<br>- **ELK**: `FROM logs-zeek.http-* \| STATS COUNT() BY date_histogram(@timestamp, '1h') \| WHERE COUNT() > AVG(COUNT()) * 4`. |
| 9. Obfuscated Data with Suspicious Headers | Obfuscated data with custom headers, as in Cobalt Strike. | - Network Traffic (DS0003: Zeek HTTP)<br>- Proxy Logs | - **Splunk**: `index=network sourcetype=zeek_http header IN ("*X-Cobalt*", "*Custom-Header*") \| stats count by src_ip, header \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "HTTP" and AdditionalFields.Header has_any ("X-Cobalt", "Custom-Header") \| summarize count() by DeviceIP, AdditionalFields.Header \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE http.header : ("*X-Cobalt*" OR "*Custom-Header*") \| STATS COUNT() BY source.ip, http.header HAVING COUNT() > 5`. |
| 10. Obfuscated Data with Encrypted Payloads | Encrypted payloads in obfuscated data, as in APT41. | - Network Traffic (DS0003: Zeek HTTP)<br>- Packet Analysis | - **Splunk**: `index=network sourcetype=zeek_http payload_entropy > 7 \| stats count by src_ip, uri \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "HTTP" and AdditionalFields.PayloadEntropy > 7 \| summarize count() by DeviceIP, RemoteUrl \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE http.payload.entropy > 7 \| STATS COUNT() BY source.ip, http.uri HAVING COUNT() > 5`. |
| 11. Obfuscated Data in Non-Standard Environments | Obfuscated data in Linux, as in Turla. | - Network Traffic (DS0003: Zeek HTTP)<br>- Linux Logs | - **Splunk**: `index=linux sourcetype=auditd syscall="sendto" AND dest_port IN (80, 443) AND exe NOT IN (known_apps) \| stats count by exe, dest_ip \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where RemotePort in (80, 443) and InitiatingProcessName !in (knownApps) \| summarize count() by InitiatingProcessName, RemoteIP \| where count_ > 5`.<br>- **ELK**: `FROM logs-auditd-* \| WHERE syscall.name = "sendto" AND destination.port IN [80, 443] AND process.exe NOT IN ['known_apps'] \| STATS COUNT() BY process.exe, destination.ip HAVING COUNT() > 5`. |
| 12. Obfuscated Data with Anomalous Timing | Obfuscated data with unusual timing, as in 2025 trends. | - Network Traffic (DS0003: Zeek HTTP)<br>- Metrics | - **Splunk**: `index=network sourcetype=zeek_http \| timechart span=1h count \| where count > avg(count)*4`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "HTTP" \| summarize HourlyCount=count() by bin(Timestamp, 1h) \| where HourlyCount > avg(HourlyCount) * 4`.<br>- **ELK**: `FROM logs-zeek.http-* \| STATS COUNT() BY date_histogram(@timestamp, '1h') \| WHERE COUNT() > AVG(COUNT()) * 4`. |
| 13. Obfuscated Data with Suspicious Headers | Obfuscated data with custom headers, as in Cobalt Strike. | - Network Traffic (DS0003: Zeek HTTP)<br>- Proxy Logs | - **Splunk**: `index=network sourcetype=zeek_http header IN ("*X-Cobalt*", "*Custom-Header*") \| stats count by src_ip, header \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "HTTP" and AdditionalFields.Header has_any ("X-Cobalt", "Custom-Header") \| summarize count() by DeviceIP, AdditionalFields.Header \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE http.header : ("*X-Cobalt*" OR "*Custom-Header*") \| STATS COUNT() BY source.ip, http.header HAVING COUNT() > 5`. |
| 14. Obfuscated Data with Encrypted Payloads | Encrypted payloads in obfuscated data, as in APT41. | - Network Traffic (DS0003: Zeek HTTP)<br>- Packet Analysis | - **Splunk**: `index=network sourcetype=zeek_http payload_entropy > 7 \| stats count by src_ip, uri \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "HTTP" and AdditionalFields.PayloadEntropy > 7 \| summarize count() by DeviceIP, RemoteUrl \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE http.payload.entropy > 7 \| STATS COUNT() BY source.ip, http.uri HAVING COUNT() > 5`. |
| 15. Obfuscated Data in Non-Standard Environments | Obfuscated data in Linux, as in Turla. | - Network Traffic (DS0003: Zeek HTTP)<br>- Linux Logs | - **Splunk**: `index=linux sourcetype=auditd syscall="sendto" AND dest_port IN (80, 443) AND exe NOT IN (known_apps) \| stats count by exe, dest_ip \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where RemotePort in (80, 443) and InitiatingProcessName !in (knownApps) \| summarize count() by InitiatingProcessName, RemoteIP \| where count_ > 5`.<br>- **ELK**: `FROM logs-auditd-* \| WHERE syscall.name = "sendto" AND destination.port IN [80, 443] AND process.exe NOT IN ['known_apps'] \| STATS COUNT() BY process.exe, destination.ip HAVING COUNT() > 5`.

### Dead Drop Resolver (T1102.003)

| Hypothesis | Description | Data Sources | Hunting Queries |
|------------|-------------|--------------|-----------------|
| 1. Suspicious Access to Dead Drop Sites | Adversaries use dead drop resolvers like pastebin or GitHub Gists for C2, as in APT41 campaigns. High risk in environments with limited web traffic monitoring. | - Network Traffic (DS0003: Zeek HTTP)<br>- Proxy Logs | - **Splunk**: `index=network sourcetype=zeek_http uri IN ("*pastebin.com*", "*gist.github.com*") AND method="GET" \| stats count by src_ip, uri \| where count > 5` (Detects frequent access to dead drop sites).<br>- **KQL**: `DeviceNetworkEvents \| where RemoteUrl has_any ("pastebin.com", "gist.github.com") and AdditionalFields.Method == "GET" \| summarize count() by DeviceIP, RemoteUrl \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE http.uri : ("*pastebin.com*" OR "*gist.github.com*") AND http.method = 'GET' \| STATS COUNT() BY source.ip, http.uri HAVING COUNT() > 5`. |
| 2. Dead Drop Resolver with Encoded Data | Encoded data retrieved from dead drop sites for C2, as in Turla. | - Network Traffic (DS0003: Zeek HTTP)<br>- Packet Analysis | - **Splunk**: `index=network sourcetype=zeek_http uri IN ("*pastebin.com*", "*gist.github.com*") AND payload_entropy > 7 \| stats count by src_ip, uri \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where RemoteUrl has_any ("pastebin.com", "gist.github.com") and AdditionalFields.PayloadEntropy > 7 \| summarize count() by DeviceIP, RemoteUrl \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE http.uri : ("*pastebin.com*" OR "*gist.github.com*") AND http.payload.entropy > 7 \| STATS COUNT() BY source.ip, http.uri HAVING COUNT() > 5`. |
| 3. Dead Drop Resolver Access from Compromised Endpoints | Compromised endpoints access dead drop sites, as in FIN7. | - Process Creation (DS0009: Sysmon ID 1)<br>- Network Traffic | - **Splunk**: `index=endpoint sourcetype=sysmon EventCode=1 CommandLine="*dead drop*" \| join host [search index=network sourcetype=zeek_http uri="*pastebin.com*"] \| stats count by host, CommandLine, uri \| where count > 3`.<br>- **KQL**: `DeviceProcessEvents \| where ProcessCommandLine contains "dead drop" \| join kind=inner (DeviceNetworkEvents \| where RemoteUrl contains "pastebin.com") on DeviceName \| summarize count() by DeviceName, ProcessCommandLine, RemoteUrl \| where count_ > 3`.<br>- **ELK**: `FROM logs-endpoint.process-* \| WHERE process.command_line : "*dead drop*" \| JOIN logs-zeek.http-* ON host.name WHERE http.uri : "*pastebin.com*" \| STATS COUNT() BY host.name, process.command_line, http.uri HAVING COUNT() > 3`. |
| 4. Dead Drop Resolver with Anomalous Timing | Dead drop access with unusual timing, as in 2025 trends. | - Network Traffic (DS0003: Zeek HTTP)<br>- Metrics | - **Splunk**: `index=network sourcetype=zeek_http uri IN ("*pastebin.com*", "*gist.github.com*") \| timechart span=1h count \| where count > avg(count)*4`.<br>- **KQL**: `DeviceNetworkEvents \| where RemoteUrl has_any ("pastebin.com", "gist.github.com") \| summarize HourlyCount=count() by bin(Timestamp, 1h) \| where HourlyCount > avg(HourlyCount) * 4`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE http.uri : ("*pastebin.com*" OR "*gist.github.com*") \| STATS COUNT() BY date_histogram(@timestamp, '1h') \| WHERE COUNT() > AVG(COUNT()) * 4`. |
| 5. Dead Drop Resolver with Encrypted Payloads | Encrypted payloads retrieved from dead drop sites, as in APT41. | - Network Traffic (DS0003: Zeek HTTP)<br>- Packet Analysis | - **Splunk**: `index=network sourcetype=zeek_http uri IN ("*pastebin.com*", "*gist.github.com*") AND payload_entropy > 7 \| stats count by src_ip, uri \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where RemoteUrl has_any ("pastebin.com", "gist.github.com") and AdditionalFields.PayloadEntropy > 7 \| summarize count() by DeviceIP, RemoteUrl \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE http.uri : ("*pastebin.com*" OR "*gist.github.com*") AND http.payload.entropy > 7 \| STATS COUNT() BY source.ip, http.uri HAVING COUNT() > 5`. |
| 6. Dead Drop Resolver in Cloud Environments | Dead drop access in cloud, as in 2025 trends. | - Cloud Audit Logs (AWS CloudTrail)<br>- Network Traffic | - **Splunk**: `index=cloud sourcetype=aws:cloudtrail eventName="Invoke" AND userIdentity NOT IN (authorized_users) \| stats count by userIdentity, src_ip \| where count > 5`.<br>- **KQL**: `AWSCloudTrail \| where EventName == "Invoke" and Caller !in (authorizedUsers) \| summarize count() by Caller, SourceIP \| where count_ > 5`.<br>- **ELK**: `FROM logs-aws.cloudtrail-* \| WHERE event.action = 'Invoke' AND user.identity NOT IN ['authorized_users'] \| STATS COUNT() BY user.identity, source.ip HAVING COUNT() > 5`. |
| 7. Dead Drop Resolver with Suspicious Headers | Dead drop access with custom headers, as in Cobalt Strike. | - Network Traffic (DS0003: Zeek HTTP)<br>- Proxy Logs | - **Splunk**: `index=network sourcetype=zeek_http uri IN ("*pastebin.com*", "*gist.github.com*") AND header IN ("*X-Cobalt*", "*Custom-Header*") \| stats count by src_ip, header \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where RemoteUrl has_any ("pastebin.com", "gist.github.com") and AdditionalFields.Header has_any ("X-Cobalt", "Custom-Header") \| summarize count() by DeviceIP, AdditionalFields.Header \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE http.uri : ("*pastebin.com*" OR "*gist.github.com*") AND http.header : ("*X-Cobalt*" OR "*Custom-Header*") \| STATS COUNT() BY source.ip, http.header HAVING COUNT() > 5`. |
| 8. Dead Drop Resolver in Non-Standard Environments | Dead drop access in Linux, as in Turla. | - Network Traffic (DS0003: Zeek HTTP)<br>- Linux Logs | - **Splunk**: `index=linux sourcetype=auditd syscall="sendto" AND dest_port IN (80, 443) AND exe NOT IN (known_apps) \| stats count by exe, dest_ip \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where RemotePort in (80, 443) and InitiatingProcessName !in (knownApps) \| summarize count() by InitiatingProcessName, RemoteIP \| where count_ > 5`.<br>- **ELK**: `FROM logs-auditd-* \| WHERE syscall.name = "sendto" AND destination.port IN [80, 443] AND process.exe NOT IN ['known_apps'] \| STATS COUNT() BY process.exe, destination.ip HAVING COUNT() > 5`. |
| 9. Dead Drop Resolver with Anomalous Timing | Dead drop access with unusual timing, as in 2025 trends. | - Network Traffic (DS0003: Zeek HTTP)<br>- Metrics | - **Splunk**: `index=network sourcetype=zeek_http uri IN ("*pastebin.com*", "*gist.github.com*") \| timechart span=1h count \| where count > avg(count)*4`.<br>- **KQL**: `DeviceNetworkEvents \| where RemoteUrl has_any ("pastebin.com", "gist.github.com") \| summarize HourlyCount=count() by bin(Timestamp, 1h) \| where HourlyCount > avg(HourlyCount) * 4`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE http.uri : ("*pastebin.com*" OR "*gist.github.com*") \| STATS COUNT() BY date_histogram(@timestamp, '1h') \| WHERE COUNT() > AVG(COUNT()) * 4`. |
| 10. Dead Drop Resolver with Suspicious Headers | Dead drop access with custom headers, as in Cobalt Strike. | - Network Traffic (DS0003: Zeek HTTP)<br>- Proxy Logs | - **Splunk**: `index=network sourcetype=zeek_http uri IN ("*pastebin.com*", "*gist.github.com*") AND header IN ("*X-Cobalt*", "*Custom-Header*") \| stats count by src_ip, header \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where RemoteUrl has_any ("pastebin.com", "gist.github.com") and AdditionalFields.Header has_any ("X-Cobalt", "Custom-Header") \| summarize count() by DeviceIP, AdditionalFields.Header \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE http.uri : ("*pastebin.com*" OR "*gist.github.com*") AND http.header : ("*X-Cobalt*" OR "*Custom-Header*") \| STATS COUNT() BY source.ip, http.header HAVING COUNT() > 5`. |
| 11. Dead Drop Resolver with Encrypted Payloads | Encrypted payloads retrieved from dead drop sites, as in APT41. | - Network Traffic (DS0003: Zeek HTTP)<br>- Packet Analysis | - **Splunk**: `index=network sourcetype=zeek_http uri IN ("*pastebin.com*", "*gist.github.com*") AND payload_entropy > 7 \| stats count by src_ip, uri \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where RemoteUrl has_any ("pastebin.com", "gist.github.com") and AdditionalFields.PayloadEntropy > 7 \| summarize count() by DeviceIP, RemoteUrl \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE http.uri : ("*pastebin.com*" OR "*gist.github.com*") AND http.payload.entropy > 7 \| STATS COUNT() BY source.ip, http.uri HAVING COUNT() > 5`. |
| 12. Dead Drop Resolver in Cloud Environments | Dead drop access in cloud, as in 2025 trends. | - Cloud Audit Logs (AWS CloudTrail)<br>- Network Traffic | - **Splunk**: `index=cloud sourcetype=aws:cloudtrail eventName="Invoke" AND userIdentity NOT IN (authorized_users) \| stats count by userIdentity, src_ip \| where count > 5`.<br>- **KQL**: `AWSCloudTrail \| where EventName == "Invoke" and Caller !in (authorizedUsers) \| summarize count() by Caller, SourceIP \| where count_ > 5`.<br>- **ELK**: `FROM logs-aws.cloudtrail-* \| WHERE event.action = 'Invoke' AND user.identity NOT IN ['authorized_users'] \| STATS COUNT() BY user.identity, source.ip HAVING COUNT() > 5`. |
| 13. Dead Drop Resolver with Anomalous Timing | Dead drop access with unusual timing, as in 2025 trends. | - Network Traffic (DS0003: Zeek HTTP)<br>- Metrics | - **Splunk**: `index=network sourcetype=zeek_http uri IN ("*pastebin.com*", "*gist.github.com*") \| timechart span=1h count \| where count > avg(count)*4`.<br>- **KQL**: `DeviceNetworkEvents \| where RemoteUrl has_any ("pastebin.com", "gist.github.com") \| summarize HourlyCount=count() by bin(Timestamp, 1h) \| where HourlyCount > avg(HourlyCount) * 4`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE http.uri : ("*pastebin.com*" OR "*gist.github.com*") \| STATS COUNT() BY date_histogram(@timestamp, '1h') \| WHERE COUNT() > AVG(COUNT()) * 4`. |
| 14. Dead Drop Resolver with Suspicious Headers | Dead drop access with custom headers, as in Cobalt Strike. | - Network Traffic (DS0003: Zeek HTTP)<br>- Proxy Logs | - **Splunk**: `index=network sourcetype=zeek_http uri IN ("*pastebin.com*", "*gist.github.com*") AND header IN ("*X-Cobalt*", "*Custom-Header*") \| stats count by src_ip, header \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where RemoteUrl has_any ("pastebin.com", "gist.github.com") and AdditionalFields.Header has_any ("X-Cobalt", "Custom-Header") \| summarize count() by DeviceIP, AdditionalFields.Header \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE http.uri : ("*pastebin.com*" OR "*gist.github.com*") AND http.header : ("*X-Cobalt*" OR "*Custom-Header*") \| STATS COUNT() BY source.ip, http.header HAVING COUNT() > 5`. |
| 15. Dead Drop Resolver with Encrypted Payloads | Encrypted payloads retrieved from dead drop sites, as in APT41. | - Network Traffic (DS0003: Zeek HTTP)<br>- Packet Analysis | - **Splunk**: `index=network sourcetype=zeek_http uri IN ("*pastebin.com*", "*gist.github.com*") AND payload_entropy > 7 \| stats count by src_ip, uri \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where RemoteUrl has_any ("pastebin.com", "gist.github.com") and AdditionalFields.PayloadEntropy > 7 \| summarize count() by DeviceIP, RemoteUrl \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE http.uri : ("*pastebin.com*" OR "*gist.github.com*") AND http.payload.entropy > 7 \| STATS COUNT() BY source.ip, http.uri HAVING COUNT() > 5`. |

### Domain Fronting (T1090.004)

| Hypothesis | Description | Data Sources | Hunting Queries |
|------------|-------------|--------------|-----------------|
| 1. Domain Fronting via CDN Traffic | Adversaries use domain fronting through CDNs for C2, as in APT41. High risk in environments with limited TLS inspection. | - Network Traffic (DS0003: Zeek SSL)<br>- Proxy Logs | - **Splunk**: `index=network sourcetype=zeek_ssl sni NOT IN (host) AND dest_ip IN (cdn_ips) \| stats count by src_ip, sni, host \| where count > 5` (Detects SNI mismatch in CDN traffic).<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "SSL" and AdditionalFields.SNI !in AdditionalFields.Host and RemoteIP in (cdnIPs) \| summarize count() by DeviceIP, AdditionalFields.SNI, AdditionalFields.Host \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.ssl-* \| WHERE ssl.sni NOT IN ssl.host AND destination.ip IN ['cdn_ips'] \| STATS COUNT() BY source.ip, ssl.sni, ssl.host HAVING COUNT() > 5`. |
| 2. Domain Fronting with High TLS Traffic | High TLS traffic to CDNs with mismatched SNI, as in Turla. | - Network Traffic (DS0003: Zeek SSL)<br>- Metrics | - **Splunk**: `index=network sourcetype=zeek_ssl dest_port=443 AND sni NOT IN (host) \| timechart span=1h count \| where count > avg(count)*4`.<br>- **KQL**: `DeviceNetworkEvents \| where RemotePort == 443 and AdditionalFields.SNI !in AdditionalFields.Host \| summarize HourlyCount=count() by bin(Timestamp, 1h) \| where HourlyCount > avg(HourlyCount) * 4`.<br>- **ELK**: `FROM logs-zeek.ssl-* \| WHERE destination.port = 443 AND ssl.sni NOT IN ssl.host \| STATS COUNT() BY date_histogram(@timestamp, '1h') \| WHERE COUNT() > AVG(COUNT()) * 4`. |
| 3. Domain Fronting from Compromised Endpoints | Compromised endpoints use domain fronting for C2, as in FIN7. | - Process Creation (DS0009: Sysmon ID 1)<br>- Network Traffic | - **Splunk**: `index=endpoint sourcetype=sysmon EventCode=1 CommandLine="*fronting*" \| join host [search index=network sourcetype=zeek_ssl sni NOT IN (host)] \| stats count by host, CommandLine, sni \| where count > 3`.<br>- **KQL**: `DeviceProcessEvents \| where ProcessCommandLine contains "fronting" \| join kind=inner (DeviceNetworkEvents \| where Protocol == "SSL" and AdditionalFields.SNI !in AdditionalFields.Host) on DeviceName \| summarize count() by DeviceName, ProcessCommandLine, AdditionalFields.SNI \| where count_ > 3`.<br>- **ELK**: `FROM logs-endpoint.process-* \| WHERE process.command_line : "*fronting*" \| JOIN logs-zeek.ssl-* ON host.name WHERE ssl.sni NOT IN ssl.host \| STATS COUNT() BY host.name, process.command_line, ssl.sni HAVING COUNT() > 3`. |
| 4. Domain Fronting with Anomalous Timing | Domain fronting with unusual timing, as in 2025 trends. | - Network Traffic (DS0003: Zeek SSL)<br>- Metrics | - **Splunk**: `index=network sourcetype=zeek_ssl sni NOT IN (host) \| timechart span=1h count \| where count > avg(count)*4`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "SSL" and AdditionalFields.SNI !in AdditionalFields.Host \| summarize HourlyCount=count() by bin(Timestamp, 1h) \| where HourlyCount > avg(HourlyCount) * 4`.<br>- **ELK**: `FROM logs-zeek.ssl-* \| WHERE ssl.sni NOT IN ssl.host \| STATS COUNT() BY date_histogram(@timestamp, '1h') \| WHERE COUNT() > AVG(COUNT()) * 4`. |
| 5. Domain Fronting with Encrypted Payloads | Encrypted payloads in domain fronting traffic, as in APT41. | - Network Traffic (DS0003: Zeek SSL)<br>- Packet Analysis | - **Splunk**: `index=network sourcetype=zeek_ssl sni NOT IN (host) AND payload_entropy > 7 \| stats count by src_ip, sni \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "SSL" and AdditionalFields.SNI !in AdditionalFields.Host and AdditionalFields.PayloadEntropy > 7 \| summarize count() by DeviceIP, AdditionalFields.SNI \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.ssl-* \| WHERE ssl.sni NOT IN ssl.host AND ssl.payload.entropy > 7 \| STATS COUNT() BY source.ip, ssl.sni HAVING COUNT() > 5`. |
| 6. Domain Fronting in Cloud Environments | Domain fronting in cloud, as in 2025 trends. | - Cloud Audit Logs (AWS CloudTrail)<br>- Network Traffic | - **Splunk**: `index=cloud sourcetype=aws:cloudtrail eventName="Invoke" AND userIdentity NOT IN (authorized_users) \| stats count by userIdentity, src_ip \| where count > 5`.<br>- **KQL**: `AWSCloudTrail \| where EventName == "Invoke" and Caller !in (authorizedUsers) \| summarize count() by Caller, SourceIP \| where count_ > 5`.<br>- **ELK**: `FROM logs-aws.cloudtrail-* \| WHERE event.action = 'Invoke' AND user.identity NOT IN ['authorized_users'] \| STATS COUNT() BY user.identity, source.ip HAVING COUNT() > 5`. |
| 7. Domain Fronting with Suspicious Headers | Domain fronting with custom headers, as in Cobalt Strike. | - Network Traffic (DS0003: Zeek HTTP)<br>- Proxy Logs | - **Splunk**: `index=network sourcetype=zeek_http header IN ("*X-Cobalt*", "*Custom-Header*") \| stats count by src_ip, header \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "HTTP" and AdditionalFields.Header has_any ("X-Cobalt", "Custom-Header") \| summarize count() by DeviceIP, AdditionalFields.Header \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE http.header : ("*X-Cobalt*" OR "*Custom-Header*") \| STATS COUNT() BY source.ip, http.header HAVING COUNT() > 5`. |
| 8. Domain Fronting in Non-Standard Environments | Domain fronting in Linux, as in Turla. | - Network Traffic (DS0003: Zeek SSL)<br>- Linux Logs | - **Splunk**: `index=linux sourcetype=auditd syscall="connect" AND dest_port=443 AND exe NOT IN (known_apps) \| stats count by exe, dest_ip \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where RemotePort == 443 and InitiatingProcessName !in (knownApps) \| summarize count() by InitiatingProcessName, RemoteIP \| where count_ > 5`.<br>- **ELK**: `FROM logs-auditd-* \| WHERE syscall.name = "connect" AND destination.port = 443 AND process.exe NOT IN ['known_apps'] \| STATS COUNT() BY process.exe, destination.ip HAVING COUNT() > 5`. |
| 9. Domain Fronting with Anomalous Timing | Domain fronting with unusual timing, as in 2025 trends. | - Network Traffic (DS0003: Zeek SSL)<br>- Metrics | - **Splunk**: `index=network sourcetype=zeek_ssl \| timechart span=1h count \| where count > avg(count)*4`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "SSL" \| summarize HourlyCount=count() by bin(Timestamp, 1h) \| where HourlyCount > avg(HourlyCount) * 4`.<br>- **ELK**: `FROM logs-zeek.ssl-* \| STATS COUNT() BY date_histogram(@timestamp, '1h') \| WHERE COUNT() > AVG(COUNT()) * 4`. |
| 10. Domain Fronting with Suspicious Headers | Domain fronting with custom headers, as in Cobalt Strike. | - Network Traffic (DS0003: Zeek HTTP)<br>- Proxy Logs | - **Splunk**: `index=network sourcetype=zeek_http header IN ("*X-Cobalt*", "*Custom-Header*") \| stats count by src_ip, header \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "HTTP" and AdditionalFields.Header has_any ("X-Cobalt", "Custom-Header") \| summarize count() by DeviceIP, AdditionalFields.Header \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE http.header : ("*X-Cobalt*" OR "*Custom-Header*") \| STATS COUNT() BY source.ip, http.header HAVING COUNT() > 5`. |
| 11. Domain Fronting with Encrypted Payloads | Encrypted payloads in domain fronting, as in APT41. | - Network Traffic (DS0003: Zeek SSL)<br>- Packet Analysis | - **Splunk**: `index=network sourcetype=zeek_ssl payload_entropy > 7 \| stats count by src_ip, sni \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "SSL" and AdditionalFields.PayloadEntropy > 7 \| summarize count() by DeviceIP, AdditionalFields.SNI \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.ssl-* \| WHERE ssl.payload.entropy > 7 \| STATS COUNT() BY source.ip, ssl.sni HAVING COUNT() > 5`. |
| 12. Domain Fronting in Non-Standard Environments | Domain fronting in Linux, as in Turla. | - Network Traffic (DS0003: Zeek SSL)<br>- Linux Logs | - **Splunk**: `index=linux sourcetype=auditd syscall="connect" AND dest_port=443 AND exe NOT IN (known_apps) \| stats count by exe, dest_ip \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where RemotePort == 443 and InitiatingProcessName !in (knownApps) \| summarize count() by InitiatingProcessName, RemoteIP \| where count_ > 5`.<br>- **ELK**: `FROM logs-auditd-* \| WHERE syscall.name = "connect" AND destination.port = 443 AND process.exe NOT IN ['known_apps'] \| STATS COUNT() BY process.exe, destination.ip HAVING COUNT() > 5`. |
| 13. Domain Fronting with Anomalous Timing | Domain fronting with unusual timing, as in 2025 trends. | - Network Traffic (DS0003: Zeek SSL)<br>- Metrics | - **Splunk**: `index=network sourcetype=zeek_ssl \| timechart span=1h count \| where count > avg(count)*4`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "SSL" \| summarize HourlyCount=count() by bin(Timestamp, 1h) \| where HourlyCount > avg(HourlyCount) * 4`.<br>- **ELK**: `FROM logs-zeek.ssl-* \| STATS COUNT() BY date_histogram(@timestamp, '1h') \| WHERE COUNT() > AVG(COUNT()) * 4`. |
| 14. Domain Fronting with Suspicious Headers | Domain fronting with custom headers, as in Cobalt Strike. | - Network Traffic (DS0003: Zeek HTTP)<br>- Proxy Logs | - **Splunk**: `index=network sourcetype=zeek_http header IN ("*X-Cobalt*", "*Custom-Header*") \| stats count by src_ip, header \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "HTTP" and AdditionalFields.Header has_any ("X-Cobalt", "Custom-Header") \| summarize count() by DeviceIP, AdditionalFields.Header \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE http.header : ("*X-Cobalt*" OR "*Custom-Header*") \| STATS COUNT() BY source.ip, http.header HAVING COUNT() > 5`. |
| 15. Domain Fronting with Encrypted Payloads | Encrypted payloads in domain fronting, as in APT41. | - Network Traffic (DS0003: Zeek SSL)<br>- Packet Analysis | - **Splunk**: `index=network sourcetype=zeek_ssl payload_entropy > 7 \| stats count by src_ip, sni \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "SSL" and AdditionalFields.PayloadEntropy > 7 \| summarize count() by DeviceIP, RemoteUrl \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.ssl-* \| WHERE ssl.payload.entropy > 7 \| STATS COUNT() BY source.ip, ssl.sni HAVING COUNT() > 5`. |

### Domain Generation Algorithms (T1568.002)

| Hypothesis | Description | Data Sources | Hunting Queries |
|------------|-------------|--------------|-----------------|
| 1. DGA Traffic with High Failed Resolutions | Adversaries use DGA for C2 with many NXDOMAIN responses, as in APT41. High risk in environments with limited DNS monitoring. | - DNS Logs (DS0003: Zeek DNS)<br>- Network Traffic | - **Splunk**: `index=network sourcetype=zeek_dns rcode_name="NXDOMAIN" \| stats count by src_ip, query \| where count > 10`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "DNS" and AdditionalFields.RCodeName == "NXDOMAIN" \| summarize count() by DeviceIP, AdditionalFields.Query \| where count_ > 10`.<br>- **ELK**: `FROM logs-zeek.dns-* \| WHERE dns.rcode.name = "NXDOMAIN" \| STATS COUNT() BY source.ip, dns.query HAVING COUNT() > 10`. |
| 2. DGA with Random Domain Patterns | DGA-generated domains with random strings, as in Turla. | - DNS Logs (DS0003: Zeek DNS)<br>- Network Traffic | - **Splunk**: `index=network sourcetype=zeek_dns query="*random*" \| stats count by src_ip, query \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "DNS" and AdditionalFields.Query contains "random" \| summarize count() by DeviceIP, AdditionalFields.Query \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.dns-* \| WHERE dns.query : "*random*" \| STATS COUNT() BY source.ip, dns.query HAVING COUNT() > 5`. |
| 3. DGA with High Entropy Queries | DGA queries with high entropy, as in APT29. | - DNS Logs (DS0003: Zeek DNS)<br>- Packet Analysis | - **Splunk**: `index=network sourcetype=zeek_dns query_entropy > 3 \| stats count by src_ip, query \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "DNS" and AdditionalFields.QueryEntropy > 3 \| summarize count() by DeviceIP, AdditionalFields.Query \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.dns-* \| WHERE dns.query.entropy > 3 \| STATS COUNT() BY source.ip, dns.query HAVING COUNT() > 5`. |
| 4. DGA from Compromised Endpoints | Compromised endpoints generate DGA queries, as in Turla. | - Process Creation (DS0009: Sysmon ID 1)<br>- DNS Logs | - **Splunk**: `index=endpoint sourcetype=sysmon EventCode=1 CommandLine="*dga*" \| join host [search index=network sourcetype=zeek_dns rcode_name="NXDOMAIN"] \| stats count by host, CommandLine, query \| where count > 3`.<br>- **KQL**: `DeviceProcessEvents \| where ProcessCommandLine contains "dga" \| join kind=inner (DeviceNetworkEvents \| where Protocol == "DNS" and AdditionalFields.RCodeName == "NXDOMAIN") on DeviceName \| summarize count() by DeviceName, ProcessCommandLine, AdditionalFields.Query \| where count_ > 3`.<br>- **ELK**: `FROM logs-endpoint.process-* \| WHERE process.command_line : "*dga*" \| JOIN logs-zeek.dns-* ON host.name WHERE dns.rcode.name = "NXDOMAIN" \| STATS COUNT() BY host.name, process.command_line, dns.query HAVING COUNT() > 3`. |
| 5. DGA with Anomalous Timing | DGA C2 with unusual timing, as in 2025 trends. | - DNS Logs (DS0003: Zeek DNS)<br>- Metrics | - **Splunk**: `index=network sourcetype=zeek_dns \| timechart span=1h count \| where count > avg(count)*4`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "DNS" \| summarize HourlyCount=count() by bin(Timestamp, 1h) \| where HourlyCount > avg(HourlyCount) * 4`.<br>- **ELK**: `FROM logs-zeek.dns-* \| STATS COUNT() BY date_histogram(@timestamp, '1h') \| WHERE COUNT() > AVG(COUNT()) * 4`. |
| 6. DGA with Encrypted Payloads | Encrypted payloads in DGA queries, as in APT41. | - DNS Logs (DS0003: Zeek DNS)<br>- Packet Analysis | - **Splunk**: `index=network sourcetype=zeek_dns payload_entropy > 7 \| stats count by src_ip, query \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "DNS" and AdditionalFields.PayloadEntropy > 7 \| summarize count() by DeviceIP, AdditionalFields.Query \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.dns-* \| WHERE dns.payload.entropy > 7 \| STATS COUNT() BY source.ip, dns.query HAVING COUNT() > 5`. |
| 7. DGA in Cloud Environments | DGA C2 in cloud, as in 2025 trends. | - Cloud Audit Logs (AWS CloudTrail)<br>- DNS Logs | - **Splunk**: `index=cloud sourcetype=aws:cloudtrail eventName="Resolve" AND userIdentity NOT IN (authorized_users) \| stats count by userIdentity, src_ip \| where count > 5`.<br>- **KQL**: `AWSCloudTrail \| where EventName == "Resolve" and Caller !in (authorizedUsers) \| summarize count() by Caller, SourceIP \| where count_ > 5`.<br>- **ELK**: `FROM logs-aws.cloudtrail-* \| WHERE event.action = 'Resolve' AND user.identity NOT IN ['authorized_users'] \| STATS COUNT() BY user.identity, source.ip HAVING COUNT() > 5`. |
| 8. DGA with Suspicious Headers | DGA C2 with custom headers, as in Cobalt Strike. | - DNS Logs (DS0003: Zeek DNS)<br>- Proxy Logs | - **Splunk**: `index=network sourcetype=zeek_dns header IN ("*X-Cobalt*", "*Custom-Header*") \| stats count by src_ip, header \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "DNS" and AdditionalFields.Header has_any ("X-Cobalt", "Custom-Header") \| summarize count() by DeviceIP, AdditionalFields.Header \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.dns-* \| WHERE dns.header : ("*X-Cobalt*" OR "*Custom-Header*") \| STATS COUNT() BY source.ip, dns.header HAVING COUNT() > 5`. |
| 9. DGA in Non-Standard Environments | DGA C2 in Linux, as in Turla. | - DNS Logs (DS0003: Zeek DNS)<br>- Linux Logs | - **Splunk**: `index=linux sourcetype=auditd syscall="sendto" AND dest_port=53 AND exe NOT IN (known_apps) \| stats count by exe, dest_ip \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where RemotePort == 53 and InitiatingProcessName !in (knownApps) \| summarize count() by InitiatingProcessName, RemoteIP \| where count_ > 5`.<br>- **ELK**: `FROM logs-auditd-* \| WHERE syscall.name = "sendto" AND destination.port = 53 AND process.exe NOT IN ['known_apps'] \| STATS COUNT() BY process.exe, destination.ip HAVING COUNT() > 5`. |
| 10. DGA with Multi-Stage Redirects | DGA C2 with redirects, as in APT41. | - DNS Logs (DS0003: Zeek DNS)<br>- Redirect Analysis | - **Splunk**: `index=network sourcetype=zeek_dns status_code=302 \| stats count by src_ip, query \| where count > 3`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "DNS" and AdditionalFields.StatusCode == 302 \| summarize count() by DeviceIP, AdditionalFields.Query \| where count_ > 3`.<br>- **ELK**: `FROM logs-zeek.dns-* \| WHERE dns.status = 302 \| STATS COUNT() BY source.ip, dns.query HAVING COUNT() > 3`. |
| 11. DGA with Anomalous User Agents | DGA C2 with unusual user agents, as in Cobalt Strike. | - DNS Logs (DS0003: Zeek DNS)<br>- Proxy Logs | - **Splunk**: `index=network sourcetype=zeek_dns user_agent NOT IN (known_agents) \| stats count by src_ip, user_agent \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "DNS" and AdditionalFields.UserAgent !in (knownAgents) \| summarize count() by DeviceIP, AdditionalFields.UserAgent \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.dns-* \| WHERE dns.user_agent NOT IN ['known_agents'] \| STATS COUNT() BY source.ip, dns.user_agent HAVING COUNT() > 5`. |
| 12. DGA in Cloud Environments | DGA C2 in cloud, as in 2025 trends. | - Cloud Audit Logs (AWS CloudTrail)<br>- DNS Logs | - **Splunk**: `index=cloud sourcetype=aws:cloudtrail eventName="Resolve" AND userIdentity NOT IN (authorized_users) \| stats count by userIdentity, src_ip \| where count > 5`.<br>- **KQL**: `AWSCloudTrail \| where EventName == "Resolve" and Caller !in (authorizedUsers) \| summarize count() by Caller, SourceIP \| where count_ > 5`.<br>- **ELK**: `FROM logs-aws.cloudtrail-* \| WHERE event.action = 'Resolve' AND user.identity NOT IN ['authorized_users'] \| STATS COUNT() BY user.identity, source.ip HAVING COUNT() > 5`. |
| 13. DGA with Anomalous Timing | DGA C2 with unusual timing, as in 2025 trends. | - DNS Logs (DS0003: Zeek DNS)<br>- Metrics | - **Splunk**: `index=network sourcetype=zeek_dns \| timechart span=1h count \| where count > avg(count)*4`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "DNS" \| summarize HourlyCount=count() by bin(Timestamp, 1h) \| where HourlyCount > avg(HourlyCount) * 4`.<br>- **ELK**: `FROM logs-zeek.dns-* \| STATS COUNT() BY date_histogram(@timestamp, '1h') \| WHERE COUNT() > AVG(COUNT()) * 4`. |
| 14. DGA with Suspicious Headers | DGA C2 with custom headers, as in Cobalt Strike. | - DNS Logs (DS0003: Zeek DNS)<br>- Proxy Logs | - **Splunk**: `index=network sourcetype=zeek_dns header IN ("*X-Cobalt*", "*Custom-Header*") \| stats count by src_ip, header \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "DNS" and AdditionalFields.Header has_any ("X-Cobalt", "Custom-Header") \| summarize count() by DeviceIP, AdditionalFields.Header \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.dns-* \| WHERE dns.header : ("*X-Cobalt*" OR "*Custom-Header*") \| STATS COUNT() BY source.ip, dns.header HAVING COUNT() > 5`. |
| 15. DGA with Encrypted Payloads | Encrypted payloads in DGA C2, as in APT41. | - DNS Logs (DS0003: Zeek DNS)<br>- Packet Analysis | - **Splunk**: `index=network sourcetype=zeek_dns payload_entropy > 7 \| stats count by src_ip, query \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "DNS" and AdditionalFields.PayloadEntropy > 7 \| summarize count() by DeviceIP, AdditionalFields.Query \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.dns-* \| WHERE dns.payload.entropy > 7 \| STATS COUNT() BY source.ip, dns.query HAVING COUNT() > 5`.

### Dynamic Resolution (T1568)

| Hypothesis | Description | Data Sources | Hunting Queries |
|------------|-------------|--------------|-----------------|
| 1. Suspicious DNS Query Patterns for DGA | Adversaries use Domain Generation Algorithms (DGA) for dynamic C2 resolution, as in APT41 campaigns. High risk in Windows and cloud environments with limited DNS inspection. | - DNS Logs (DS0003: Zeek DNS)<br>- Network Traffic | - **Splunk**: `index=network sourcetype=zeek_dns query_length > 200 AND NOT query IN (known_domains) \| stats count by src_ip, query \| where count > 10` (Detects long DNS queries indicative of DGA).<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "DNS" and AdditionalFields.QueryLength > 200 and AdditionalFields.Query !in (knownDomains) \| summarize count() by DeviceIP, AdditionalFields.Query \| where count_ > 10`.<br>- **ELK**: `FROM logs-zeek.dns-* \| WHERE dns.query.length > 200 AND dns.query NOT IN ['known_domains'] \| STATS COUNT() BY source.ip, dns.query HAVING COUNT() > 10`. |
| 2. Dynamic DNS Resolution with High Failure Rate | High NXDOMAIN responses indicating DGA attempts, as in Turla attacks. | - DNS Logs (DS0003: Zeek DNS)<br>- Network Traffic | - **Splunk**: `index=network sourcetype=zeek_dns rcode_name="NXDOMAIN" \| stats count by src_ip, query \| where count > 10`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "DNS" and AdditionalFields.RCodeName == "NXDOMAIN" \| summarize count() by DeviceIP, AdditionalFields.Query \| where count_ > 10`.<br>- **ELK**: `FROM logs-zeek.dns-* \| WHERE dns.rcode.name = "NXDOMAIN" \| STATS COUNT() BY source.ip, dns.query HAVING COUNT() > 10`. |
| 3. Fast Flux DNS for C2 Resolution | Fast Flux DNS where IP addresses change rapidly for a domain, as in APT29. | - DNS Logs (DS0003: Zeek DNS)<br>- IP Resolution | - **Splunk**: `index=network sourcetype=zeek_dns query IN (suspicious_domains) \| stats values(answer) by query \| where mvcount(answer) > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "DNS" and AdditionalFields.Query in (suspiciousDomains) \| summarize IPs=make_set(AdditionalFields.Answer) by AdditionalFields.Query \| where array_length(IPs) > 5`.<br>- **ELK**: `FROM logs-zeek.dns-* \| WHERE dns.query IN ['suspicious_domains'] \| STATS SET(dns.answer) BY dns.query \| WHERE CARDINALITY(dns.answer) > 5`. |
| 4. Dynamic Resolution from Compromised Endpoints | Compromised endpoints resolve dynamic C2 domains, as in FIN7. | - Process Creation (DS0009: Sysmon ID 1)<br>- DNS Logs | - **Splunk**: `index=endpoint sourcetype=sysmon EventCode=1 CommandLine="*dns*" \| join host [search index=network sourcetype=zeek_dns rcode_name="NXDOMAIN"] \| stats count by host, CommandLine, query \| where count > 3`.<br>- **KQL**: `DeviceProcessEvents \| where ProcessCommandLine contains "dns" \| join kind=inner (DeviceNetworkEvents \| where Protocol == "DNS" and AdditionalFields.RCodeName == "NXDOMAIN") on DeviceName \| summarize count() by DeviceName, ProcessCommandLine, AdditionalFields.Query \| where count_ > 3`.<br>- **ELK**: `FROM logs-endpoint.process-* \| WHERE process.command_line : "*dns*" \| JOIN logs-zeek.dns-* ON host.name WHERE dns.rcode.name = "NXDOMAIN" \| STATS COUNT() BY host.name, process.command_line, dns.query HAVING COUNT() > 3`. |
| 5. Dynamic Resolution with Anomalous Timing | Dynamic resolution with unusual timing, as in 2025 trends. | - DNS Logs (DS0003: Zeek DNS)<br>- Metrics | - **Splunk**: `index=network sourcetype=zeek_dns \| timechart span=1h count \| where count > avg(count)*4`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "DNS" \| summarize HourlyCount=count() by bin(Timestamp, 1h) \| where HourlyCount > avg(HourlyCount) * 4`.<br>- **ELK**: `FROM logs-zeek.dns-* \| STATS COUNT() BY date_histogram(@timestamp, '1h') \| WHERE COUNT() > AVG(COUNT()) * 4`. |
| 6. Dynamic Resolution with Encrypted Payloads | Encrypted payloads in dynamic resolution queries, as in APT41. | - DNS Logs (DS0003: Zeek DNS)<br>- Packet Analysis | - **Splunk**: `index=network sourcetype=zeek_dns payload_entropy > 7 \| stats count by src_ip, query \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "DNS" and AdditionalFields.PayloadEntropy > 7 \| summarize count() by DeviceIP, AdditionalFields.Query \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.dns-* \| WHERE dns.payload.entropy > 7 \| STATS COUNT() BY source.ip, dns.query HAVING COUNT() > 5`. |
| 7. Dynamic Resolution in Cloud Environments | Dynamic resolution in cloud, as in 2025 trends. | - Cloud Audit Logs (AWS CloudTrail)<br>- DNS Logs | - **Splunk**: `index=cloud sourcetype=aws:cloudtrail eventName="Resolve" AND userIdentity NOT IN (authorized_users) \| stats count by userIdentity, src_ip \| where count > 5`.<br>- **KQL**: `AWSCloudTrail \| where EventName == "Resolve" and Caller !in (authorizedUsers) \| summarize count() by Caller, SourceIP \| where count_ > 5`.<br>- **ELK**: `FROM logs-aws.cloudtrail-* \| WHERE event.action = 'Resolve' AND user.identity NOT IN ['authorized_users'] \| STATS COUNT() BY user.identity, source.ip HAVING COUNT() > 5`. |
| 8. Dynamic Resolution with Suspicious Headers | Dynamic resolution with custom headers, as in Cobalt Strike. | - DNS Logs (DS0003: Zeek DNS)<br>- Proxy Logs | - **Splunk**: `index=network sourcetype=zeek_dns header IN ("*X-Cobalt*", "*Custom-Header*") \| stats count by src_ip, header \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "DNS" and AdditionalFields.Header has_any ("X-Cobalt", "Custom-Header") \| summarize count() by DeviceIP, AdditionalFields.Header \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.dns-* \| WHERE dns.header : ("*X-Cobalt*" OR "*Custom-Header*") \| STATS COUNT() BY source.ip, dns.header HAVING COUNT() > 5`. |
| 9. Dynamic Resolution in Non-Standard Environments | Dynamic resolution in Linux, as in Turla. | - DNS Logs (DS0003: Zeek DNS)<br>- Linux Logs | - **Splunk**: `index=linux sourcetype=auditd syscall="sendto" AND dest_port=53 AND exe NOT IN (known_apps) \| stats count by exe, dest_ip \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where RemotePort == 53 and InitiatingProcessName !in (knownApps) \| summarize count() by InitiatingProcessName, RemoteIP \| where count_ > 5`.<br>- **ELK**: `FROM logs-auditd-* \| WHERE syscall.name = "sendto" AND destination.port = 53 AND process.exe NOT IN ['known_apps'] \| STATS COUNT() BY process.exe, destination.ip HAVING COUNT() > 5`. |
| 10. Dynamic Resolution with Multi-Stage Redirects | Dynamic resolution with redirects, as in APT41. | - DNS Logs (DS0003: Zeek DNS)<br>- Redirect Analysis | - **Splunk**: `index=network sourcetype=zeek_dns status_code=302 \| stats count by src_ip, query \| where count > 3`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "DNS" and AdditionalFields.StatusCode == 302 \| summarize count() by DeviceIP, AdditionalFields.Query \| where count_ > 3`.<br>- **ELK**: `FROM logs-zeek.dns-* \| WHERE dns.status = 302 \| STATS COUNT() BY source.ip, dns.query HAVING COUNT() > 3`. |
| 11. Dynamic Resolution with Anomalous User Agents | Dynamic resolution with unusual user agents, as in Cobalt Strike. | - DNS Logs (DS0003: Zeek DNS)<br>- Proxy Logs | - **Splunk**: `index=network sourcetype=zeek_dns user_agent NOT IN (known_agents) \| stats count by src_ip, user_agent \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "DNS" and AdditionalFields.UserAgent !in (knownAgents) \| summarize count() by DeviceIP, AdditionalFields.UserAgent \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.dns-* \| WHERE dns.user_agent NOT IN ['known_agents'] \| STATS COUNT() BY source.ip, dns.user_agent HAVING COUNT() > 5`. |
| 12. Dynamic Resolution in Cloud Environments | Dynamic resolution in cloud, as in 2025 trends. | - Cloud Audit Logs (AWS CloudTrail)<br>- DNS Logs | - **Splunk**: `index=cloud sourcetype=aws:cloudtrail eventName="Resolve" AND userIdentity NOT IN (authorized_users) \| stats count by userIdentity, src_ip \| where count > 5`.<br>- **KQL**: `AWSCloudTrail \| where EventName == "Resolve" and Caller !in (authorizedUsers) \| summarize count() by Caller, SourceIP \| where count_ > 5`.<br>- **ELK**: `FROM logs-aws.cloudtrail-* \| WHERE event.action = 'Resolve' AND user.identity NOT IN ['authorized_users'] \| STATS COUNT() BY user.identity, source.ip HAVING COUNT() > 5`. |
| 13. Dynamic Resolution with Anomalous Timing | Dynamic resolution with unusual timing, as in 2025 trends. | - DNS Logs (DS0003: Zeek DNS)<br>- Metrics | - **Splunk**: `index=network sourcetype=zeek_dns \| timechart span=1h count \| where count > avg(count)*4`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "DNS" \| summarize HourlyCount=count() by bin(Timestamp, 1h) \| where HourlyCount > avg(HourlyCount) * 4`.<br>- **ELK**: `FROM logs-zeek.dns-* \| STATS COUNT() BY date_histogram(@timestamp, '1h') \| WHERE COUNT() > AVG(COUNT()) * 4`. |
| 14. Dynamic Resolution with Suspicious Headers | Dynamic resolution with custom headers, as in Cobalt Strike. | - DNS Logs (DS0003: Zeek DNS)<br>- Proxy Logs | - **Splunk**: `index=network sourcetype=zeek_dns header IN ("*X-Cobalt*", "*Custom-Header*") \| stats count by src_ip, header \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "DNS" and AdditionalFields.Header has_any ("X-Cobalt", "Custom-Header") \| summarize count() by DeviceIP, AdditionalFields.Header \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.dns-* \| WHERE dns.header : ("*X-Cobalt*" OR "*Custom-Header*") \| STATS COUNT() BY source.ip, dns.header HAVING COUNT() > 5`. |
| 15. Dynamic Resolution with Encrypted Payloads | Encrypted payloads in dynamic resolution, as in APT41. | - DNS Logs (DS0003: Zeek DNS)<br>- Packet Analysis | - **Splunk**: `index=network sourcetype=zeek_dns payload_entropy > 7 \| stats count by src_ip, query \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "DNS" and AdditionalFields.PayloadEntropy > 7 \| summarize count() by DeviceIP, AdditionalFields.Query \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.dns-* \| WHERE dns.payload.entropy > 7 \| STATS COUNT() BY source.ip, dns.query HAVING COUNT() > 5`. | 

### Domain Fronting (T1090.004)

| Hypothesis | Description | Data Sources | Hunting Queries |
|------------|-------------|--------------|-----------------|
| 1. SNI Mismatch in TLS Traffic | Adversaries use domain fronting to hide C2 by mismatching SNI and HTTP Host headers, as in APT29 campaigns. High risk in environments with limited TLS inspection. | - Network Traffic (DS0003: Zeek SSL)<br>- Proxy Logs | - **Splunk**: `index=network sourcetype=zeek_ssl sni NOT IN (host) \| stats count by src_ip, sni, host \| where count > 5` (Detects SNI mismatch indicative of domain fronting).<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "SSL" and AdditionalFields.SNI !in AdditionalFields.Host \| summarize count() by DeviceIP, AdditionalFields.SNI, AdditionalFields.Host \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.ssl-* \| WHERE ssl.sni NOT IN ssl.host \| STATS COUNT() BY source.ip, ssl.sni, ssl.host HAVING COUNT() > 5`. |
| 2. Domain Fronting via CDNs | Domain fronting through CDNs like CloudFront, as in Turla. | - Network Traffic (DS0003: Zeek SSL)<br>- CDN Logs | - **Splunk**: `index=network sourcetype=zeek_ssl dest_ip IN (cdn_ips) AND sni NOT IN (host) \| stats count by src_ip, sni \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "SSL" and RemoteIP in (cdnIPs) and AdditionalFields.SNI !in AdditionalFields.Host \| summarize count() by DeviceIP, AdditionalFields.SNI \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.ssl-* \| WHERE destination.ip IN ['cdn_ips'] AND ssl.sni NOT IN ssl.host \| STATS COUNT() BY source.ip, ssl.sni HAVING COUNT() > 5`. |
| 3. Domain Fronting with High TLS Traffic | High TLS traffic with SNI mismatch, as in APT41. | - Network Traffic (DS0003: Zeek SSL)<br>- Metrics | - **Splunk**: `index=network sourcetype=zeek_ssl sni NOT IN (host) \| timechart span=1h count \| where count > avg(count)*4`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "SSL" and AdditionalFields.SNI !in AdditionalFields.Host \| summarize HourlyCount=count() by bin(Timestamp, 1h) \| where HourlyCount > avg(HourlyCount) * 4`.<br>- **ELK**: `FROM logs-zeek.ssl-* \| WHERE ssl.sni NOT IN ssl.host \| STATS COUNT() BY date_histogram(@timestamp, '1h') \| WHERE COUNT() > AVG(COUNT()) * 4`. |
| 4. Domain Fronting from Compromised Endpoints | Compromised endpoints use domain fronting for C2, as in FIN7. | - Process Creation (DS0009: Sysmon ID 1)<br>- Network Traffic | - **Splunk**: `index=endpoint sourcetype=sysmon EventCode=1 CommandLine="*fronting*" \| join host [search index=network sourcetype=zeek_ssl sni NOT IN (host)] \| stats count by host, CommandLine, sni \| where count > 3`.<br>- **KQL**: `DeviceProcessEvents \| where ProcessCommandLine contains "fronting" \| join kind=inner (DeviceNetworkEvents \| where Protocol == "SSL" and AdditionalFields.SNI !in AdditionalFields.Host) on DeviceName \| summarize count() by DeviceName, ProcessCommandLine, AdditionalFields.SNI \| where count_ > 3`.<br>- **ELK**: `FROM logs-endpoint.process-* \| WHERE process.command_line : "*fronting*" \| JOIN logs-zeek.ssl-* ON host.name WHERE ssl.sni NOT IN ssl.host \| STATS COUNT() BY host.name, process.command_line, ssl.sni HAVING COUNT() > 3`. |
| 5. Domain Fronting with Anomalous Timing | Domain fronting with unusual timing, as in 2025 trends. | - Network Traffic (DS0003: Zeek SSL)<br>- Metrics | - **Splunk**: `index=network sourcetype=zeek_ssl \| timechart span=1h count \| where count > avg(count)*4`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "SSL" \| summarize HourlyCount=count() by bin(Timestamp, 1h) \| where HourlyCount > avg(HourlyCount) * 4`.<br>- **ELK**: `FROM logs-zeek.ssl-* \| STATS COUNT() BY date_histogram(@timestamp, '1h') \| WHERE COUNT() > AVG(COUNT()) * 4`. |
| 6. Domain Fronting with Encrypted Payloads | Encrypted payloads in domain fronting traffic, as in APT41. | - Network Traffic (DS0003: Zeek SSL)<br>- Packet Analysis | - **Splunk**: `index=network sourcetype=zeek_ssl payload_entropy > 7 \| stats count by src_ip, sni \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "SSL" and AdditionalFields.PayloadEntropy > 7 \| summarize count() by DeviceIP, RemoteUrl \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.ssl-* \| WHERE ssl.payload.entropy > 7 \| STATS COUNT() BY source.ip, ssl.sni HAVING COUNT() > 5`. |
| 7. Domain Fronting with Suspicious Headers | Domain fronting with custom headers, as in Cobalt Strike. | - Network Traffic (DS0003: Zeek HTTP)<br>- Proxy Logs | - **Splunk**: `index=network sourcetype=zeek_http header IN ("*X-Cobalt*", "*Custom-Header*") \| stats count by src_ip, header \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "HTTP" and AdditionalFields.Header has_any ("X-Cobalt", "Custom-Header") \| summarize count() by DeviceIP, AdditionalFields.Header \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE http.header : ("*X-Cobalt*" OR "*Custom-Header*") \| STATS COUNT() BY source.ip, http.header HAVING COUNT() > 5`. |
| 8. Domain Fronting in Non-Standard Environments | Domain fronting in Linux, as in Turla. | - Network Traffic (DS0003: Zeek SSL)<br>- Linux Logs | - **Splunk**: `index=linux sourcetype=auditd syscall="connect" AND dest_port=443 AND exe NOT IN (known_apps) \| stats count by exe, dest_ip \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where RemotePort == 443 and InitiatingProcessName !in (knownApps) \| summarize count() by InitiatingProcessName, RemoteIP \| where count_ > 5`.<br>- **ELK**: `FROM logs-auditd-* \| WHERE syscall.name = "connect" AND destination.port = 443 AND process.exe NOT IN ['known_apps'] \| STATS COUNT() BY process.exe, destination.ip HAVING COUNT() > 5`. |
| 9. Domain Fronting with Anomalous Timing | Domain fronting with unusual timing, as in 2025 trends. | - Network Traffic (DS0003: Zeek SSL)<br>- Metrics | - **Splunk**: `index=network sourcetype=zeek_ssl \| timechart span=1h count \| where count > avg(count)*4`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "SSL" \| summarize HourlyCount=count() by bin(Timestamp, 1h) \| where HourlyCount > avg(HourlyCount) * 4`.<br>- **ELK**: `FROM logs-zeek.ssl-* \| STATS COUNT() BY date_histogram(@timestamp, '1h') \| WHERE COUNT() > AVG(COUNT()) * 4`. |
| 10. Domain Fronting with Suspicious Headers | Domain fronting with custom headers, as in Cobalt Strike. | - Network Traffic (DS0003: Zeek HTTP)<br>- Proxy Logs | - **Splunk**: `index=network sourcetype=zeek_http header IN ("*X-Cobalt*", "*Custom-Header*") \| stats count by src_ip, header \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "HTTP" and AdditionalFields.Header has_any ("X-Cobalt", "Custom-Header") \| summarize count() by DeviceIP, AdditionalFields.Header \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE http.header : ("*X-Cobalt*" OR "*Custom-Header*") \| STATS COUNT() BY source.ip, http.header HAVING COUNT() > 5`. |
| 11. Domain Fronting with Encrypted Payloads | Encrypted payloads in domain fronting, as in APT41. | - Network Traffic (DS0003: Zeek SSL)<br>- Packet Analysis | - **Splunk**: `index=network sourcetype=zeek_ssl payload_entropy > 7 \| stats count by src_ip, sni \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "SSL" and AdditionalFields.PayloadEntropy > 7 \| summarize count() by DeviceIP, RemoteUrl \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.ssl-* \| WHERE ssl.payload.entropy > 7 \| STATS COUNT() BY source.ip, ssl.sni HAVING COUNT() > 5`. |
| 12. Domain Fronting in Non-Standard Environments | Domain fronting in cloud, as in 2025 trends. | - Cloud Audit Logs (AWS CloudTrail)<br>- Network Traffic | - **Splunk**: `index=cloud sourcetype=aws:cloudtrail eventName="Invoke" AND userIdentity NOT IN (authorized_users) \| stats count by userIdentity, src_ip \| where count > 5`.<br>- **KQL**: `AWSCloudTrail \| where EventName == "Invoke" and Caller !in (authorizedUsers) \| summarize count() by Caller, SourceIP \| where count_ > 5`.<br>- **ELK**: `FROM logs-aws.cloudtrail-* \| WHERE event.action = 'Invoke' AND user.identity NOT IN ['authorized_users'] \| STATS COUNT() BY user.identity, source.ip HAVING COUNT() > 5`. |
| 13. Domain Fronting with Anomalous Timing | Domain fronting with unusual timing, as in 2025 trends. | - Network Traffic (DS0003: Zeek SSL)<br>- Metrics | - **Splunk**: `index=network sourcetype=zeek_ssl \| timechart span=1h count \| where count > avg(count)*4`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "SSL" \| summarize HourlyCount=count() by bin(Timestamp, 1h) \| where HourlyCount > avg(HourlyCount) * 4`.<br>- **ELK**: `FROM logs-zeek.ssl-* \| STATS COUNT() BY date_histogram(@timestamp, '1h') \| WHERE COUNT() > AVG(COUNT()) * 4`. |
| 14. Domain Fronting with Suspicious Headers | Domain fronting with custom headers, as in Cobalt Strike. | - Network Traffic (DS0003: Zeek HTTP)<br>- Proxy Logs | - **Splunk**: `index=network sourcetype=zeek_http header IN ("*X-Cobalt*", "*Custom-Header*") \| stats count by src_ip, header \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "HTTP" and AdditionalFields.Header has_any ("X-Cobalt", "Custom-Header") \| summarize count() by DeviceIP, AdditionalFields.Header \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE http.header : ("*X-Cobalt*" OR "*Custom-Header*") \| STATS COUNT() BY source.ip, http.header HAVING COUNT() > 5`. |
| 15. Domain Fronting with Encrypted Payloads | Encrypted payloads in domain fronting, as in APT41. | - Network Traffic (DS0003: Zeek SSL)<br>- Packet Analysis | - **Splunk**: `index=network sourcetype=zeek_ssl payload_entropy > 7 \| stats count by src_ip, sni \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "SSL" and AdditionalFields.PayloadEntropy > 7 \| summarize count() by DeviceIP, RemoteUrl \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.ssl-* \| WHERE ssl.payload.entropy > 7 \| STATS COUNT() BY source.ip, ssl.sni HAVING COUNT() > 5`. | 

### Fallback Channels (T1008)

| Hypothesis | Description | Data Sources | Hunting Queries |
|------------|-------------|--------------|-----------------|
| 1. Multiple C2 Channels for Fallback | Adversaries use fallback C2 channels, as in APT41. High risk in environments with limited traffic monitoring. | - Network Traffic (DS0003: Zeek Conn)<br>- Firewall Logs | - **Splunk**: `index=network sourcetype=zeek_conn dest_port IN (80, 443, 53) \| stats count by src_ip, dest_port \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where RemotePort in (80, 443, 53) \| summarize count() by DeviceIP, RemotePort \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.conn-* \| WHERE destination.port IN [80, 443, 53] \| STATS COUNT() BY source.ip, destination.port HAVING COUNT() > 5`. |
| 2. Fallback C2 with DNS Backup | Fallback to DNS C2, as in Turla. | - DNS Logs (DS0003: Zeek DNS)<br>- Network Traffic | - **Splunk**: `index=network sourcetype=zeek_dns query_length > 200 \| stats count by src_ip, query \| where count > 10`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "DNS" and AdditionalFields.QueryLength > 200 \| summarize count() by DeviceIP, AdditionalFields.Query \| where count_ > 10`.<br>- **ELK**: `FROM logs-zeek.dns-* \| WHERE dns.query.length > 200 \| STATS COUNT() BY source.ip, dns.query HAVING COUNT() > 10`. |
| 3. Fallback C2 with ICMP Backup | Fallback to ICMP C2, as in APT29. | - Network Traffic (DS0003: Zeek ICMP)<br>- Packet Analysis | - **Splunk**: `index=network sourcetype=zeek_icmp type="echo" AND payload_length>100 \| stats count by src_ip, dest_ip \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "ICMP" and AdditionalFields.Type == "echo" and AdditionalFields.PayloadLength > 100 \| summarize count() by DeviceIP, RemoteIP \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.icmp-* \| WHERE icmp.type = 'echo' AND icmp.payload.length > 100 \| STATS COUNT() BY source.ip, destination.ip HAVING COUNT() > 5`. |
| 4. Fallback C2 from Compromised Endpoints | Compromised endpoints switch C2 channels, as in FIN7. | - Process Creation (DS0009: Sysmon ID 1)<br>- Network Traffic | - **Splunk**: `index=endpoint sourcetype=sysmon EventCode=1 CommandLine="*c2*" \| join host [search index=network sourcetype=zeek_conn dest_port IN (80, 53)] \| stats count by host, CommandLine, dest_port \| where count > 3`.<br>- **KQL**: `DeviceProcessEvents \| where ProcessCommandLine contains "c2" \| join kind=inner (DeviceNetworkEvents \| where RemotePort in (80, 53)) on DeviceName \| summarize count() by DeviceName, ProcessCommandLine, RemotePort \| where count_ > 3`.<br>- **ELK**: `FROM logs-endpoint.process-* \| WHERE process.command_line : "*c2*" \| JOIN logs-zeek.conn-* ON host.name WHERE destination.port IN [80, 53] \| STATS COUNT() BY host.name, process.command_line, destination.port HAVING COUNT() > 3`. |
| 5. Fallback C2 with Anomalous Timing | Fallback C2 with unusual timing, as in 2025 trends. | - Network Traffic (DS0003: Zeek Conn)<br>- Metrics | - **Splunk**: `index=network sourcetype=zeek_conn \| timechart span=1h count \| where count > avg(count)*4`.<br>- **KQL**: `DeviceNetworkEvents \| summarize HourlyCount=count() by bin(Timestamp, 1h) \| where HourlyCount > avg(HourlyCount) * 4`.<br>- **ELK**: `FROM logs-zeek.conn-* \| STATS COUNT() BY date_histogram(@timestamp, '1h') \| WHERE COUNT() > AVG(COUNT()) * 4`. |
| 6. Fallback C2 with Encrypted Payloads | Encrypted payloads in fallback C2, as in APT41. | - Network Traffic (DS0003: Zeek HTTP)<br>- Packet Analysis | - **Splunk**: `index=network sourcetype=zeek_http payload_entropy > 7 \| stats count by src_ip, uri \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "HTTP" and AdditionalFields.PayloadEntropy > 7 \| summarize count() by DeviceIP, RemoteUrl \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE http.payload.entropy > 7 \| STATS COUNT() BY source.ip, http.uri HAVING COUNT() > 5`. |
| 7. Fallback C2 in Cloud Environments | Fallback C2 in cloud, as in 2025 trends. | - Cloud Audit Logs (AWS CloudTrail)<br>- Network Traffic | - **Splunk**: `index=cloud sourcetype=aws:cloudtrail eventName="Invoke" AND userIdentity NOT IN (authorized_users) \| stats count by userIdentity, src_ip \| where count > 5`.<br>- **KQL**: `AWSCloudTrail \| where EventName == "Invoke" and Caller !in (authorizedUsers) \| summarize count() by Caller, SourceIP \| where count_ > 5`.<br>- **ELK**: `FROM logs-aws.cloudtrail-* \| WHERE event.action = 'Invoke' AND user.identity NOT IN ['authorized_users'] \| STATS COUNT() BY user.identity, source.ip HAVING COUNT() > 5`. |
| 8. Fallback C2 with Suspicious Headers | Fallback C2 with custom headers, as in Cobalt Strike. | - Network Traffic (DS0003: Zeek HTTP)<br>- Proxy Logs | - **Splunk**: `index=network sourcetype=zeek_http header IN ("*X-Cobalt*", "*Custom-Header*") \| stats count by src_ip, header \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "HTTP" and AdditionalFields.Header has_any ("X-Cobalt", "Custom-Header") \| summarize count() by DeviceIP, AdditionalFields.Header \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE http.header : ("*X-Cobalt*" OR "*Custom-Header*") \| STATS COUNT() BY source.ip, http.header HAVING COUNT() > 5`. |
| 9. Fallback C2 in Non-Standard Environments | Fallback C2 in Linux, as in Turla. | - Network Traffic (DS0003: Zeek Conn)<br>- Linux Logs | - **Splunk**: `index=linux sourcetype=auditd syscall="connect" AND dest_port IN (80, 443) AND exe NOT IN (known_apps) \| stats count by exe, dest_ip \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where RemotePort in (80, 443) and InitiatingProcessName !in (knownApps) \| summarize count() by InitiatingProcessName, RemoteIP \| where count_ > 5`.<br>- **ELK**: `FROM logs-auditd-* \| WHERE syscall.name = "connect" AND destination.port IN [80, 443] AND process.exe NOT IN ['known_apps'] \| STATS COUNT() BY process.exe, destination.ip HAVING COUNT() > 5`. |
| 10. Fallback C2 with Multi-Stage Redirects | Fallback C2 with redirects, as in APT41. | - Network Traffic (DS0003: Zeek HTTP)<br>- Redirect Analysis | - **Splunk**: `index=network sourcetype=zeek_http status_code=302 \| stats count by src_ip, uri \| where count > 3`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "HTTP" and AdditionalFields.StatusCode == 302 \| summarize count() by DeviceIP, RemoteUrl \| where count_ > 3`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE http.status = 302 \| STATS COUNT() BY source.ip, http.uri HAVING COUNT() > 3`. |
| 11. Fallback C2 with Anomalous User Agents | Fallback C2 with unusual user agents, as in Cobalt Strike. | - Network Traffic (DS0003: Zeek HTTP)<br>- Proxy Logs | - **Splunk**: `index=network sourcetype=zeek_http user_agent NOT IN (known_agents) \| stats count by src_ip, user_agent \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "HTTP" and AdditionalFields.UserAgent !in (knownAgents) \| summarize count() by DeviceIP, AdditionalFields.UserAgent \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE http.user_agent NOT IN ['known_agents'] \| STATS COUNT() BY source.ip, http.user_agent HAVING COUNT() > 5`. |
| 12. Fallback C2 in Cloud Environments | Fallback C2 in cloud, as in 2025 trends. | - Cloud Audit Logs (AWS CloudTrail)<br>- Network Traffic | - **Splunk**: `index=cloud sourcetype=aws:cloudtrail eventName="Invoke" AND userIdentity NOT IN (authorized_users) \| stats count by userIdentity, src_ip \| where count > 5`.<br>- **KQL**: `AWSCloudTrail \| where EventName == "Invoke" and Caller !in (authorizedUsers) \| summarize count() by Caller, SourceIP \| where count_ > 5`.<br>- **ELK**: `FROM logs-aws.cloudtrail-* \| WHERE event.action = 'Invoke' AND user.identity NOT IN ['authorized_users'] \| STATS COUNT() BY user.identity, source.ip HAVING COUNT() > 5`. |
| 13. Fallback C2 with Anomalous Timing | Fallback C2 with unusual timing, as in 2025 trends. | - Network Traffic (DS0003: Zeek Conn)<br>- Metrics | - **Splunk**: `index=network sourcetype=zeek_conn \| timechart span=1h count \| where count > avg(count)*4`.<br>- **KQL**: `DeviceNetworkEvents \| summarize HourlyCount=count() by bin(Timestamp, 1h) \| where HourlyCount > avg(HourlyCount) * 4`.<br>- **ELK**: `FROM logs-zeek.conn-* \| STATS COUNT() BY date_histogram(@timestamp, '1h') \| WHERE COUNT() > AVG(COUNT()) * 4`. |
| 14. Fallback C2 with Suspicious Headers | Fallback C2 with custom headers, as in Cobalt Strike. | - Network Traffic (DS0003: Zeek HTTP)<br>- Proxy Logs | - **Splunk**: `index=network sourcetype=zeek_http header IN ("*X-Cobalt*", "*Custom-Header*") \| stats count by src_ip, header \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "HTTP" and AdditionalFields.Header has_any ("X-Cobalt", "Custom-Header") \| summarize count() by DeviceIP, AdditionalFields.Header \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE http.header : ("*X-Cobalt*" OR "*Custom-Header*") \| STATS COUNT() BY source.ip, http.header HAVING COUNT() > 5`. |
| 15. Fallback C2 with Encrypted Payloads | Encrypted payloads in fallback C2, as in APT41. | - Network Traffic (DS0003: Zeek HTTP)<br>- Packet Analysis | - **Splunk**: `index=network sourcetype=zeek_http payload_entropy > 7 \| stats count by src_ip, uri \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "HTTP" and AdditionalFields.PayloadEntropy > 7 \| summarize count() by DeviceIP, RemoteUrl \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE http.payload.entropy > 7 \| STATS COUNT() BY source.ip, http.uri HAVING COUNT() > 5`. |## Dynamic Resolution (T1568)

### Encrypted Channel (T1573)

| Hypothesis | Description | Data Sources | Hunting Queries |
|------------|-------------|--------------|-----------------|
| 1. Suspicious TLS Traffic for C2 | Adversaries use TLS for encrypted C2 channels, as in APT41 campaigns. High risk in environments with limited TLS inspection. | - Network Traffic (DS0003: Zeek SSL)<br>- Proxy Logs | - **Splunk**: `index=network sourcetype=zeek_ssl dest_port=443 AND cert_issuer NOT IN (known_issuers) \| stats count by src_ip, cert_issuer \| where count > 5` (Detects suspicious TLS certificates).<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "SSL" and RemotePort == 443 and AdditionalFields.CertIssuer !in (knownIssuers) \| summarize count() by DeviceIP, AdditionalFields.CertIssuer \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.ssl-* \| WHERE destination.port = 443 AND ssl.certificate.issuer NOT IN ['known_issuers'] \| STATS COUNT() BY source.ip, ssl.certificate.issuer HAVING COUNT() > 5`. |
| 2. Encrypted C2 with Self-Signed Certs | Self-signed certificates in encrypted C2, as in Turla. | - Network Traffic (DS0003: Zeek SSL)<br>- Certificate Logs | - **Splunk**: `index=network sourcetype=zeek_ssl cert_issuer=cert_subject \| stats count by src_ip, cert_issuer \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "SSL" and AdditionalFields.CertIssuer == AdditionalFields.CertSubject \| summarize count() by DeviceIP, AdditionalFields.CertIssuer \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.ssl-* \| WHERE ssl.certificate.issuer = ssl.certificate.subject \| STATS COUNT() BY source.ip, ssl.certificate.issuer HAVING COUNT() > 5`. |
| 3. Encrypted C2 with Anomalous Key Exchange | Anomalous key exchanges in encrypted C2, as in 2025 trends. | - Network Traffic (DS0003: Zeek SSL)<br>- Packet Analysis | - **Splunk**: `index=network sourcetype=zeek_ssl handshake_time < 100 AND src_ip NOT IN (known_clients) \| stats count by src_ip \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "SSL" and AdditionalFields.HandshakeTime < 100 and DeviceIP !in (knownClients) \| summarize count() by DeviceIP \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.ssl-* \| WHERE ssl.handshake.time < 100 AND source.ip NOT IN ['known_clients'] \| STATS COUNT() BY source.ip HAVING COUNT() > 5`. |
| 4. Encrypted C2 from Compromised Endpoints | Compromised endpoints initiate encrypted C2, as in FIN7. | - Process Creation (DS0009: Sysmon ID 1)<br>- Network Traffic | - **Splunk**: `index=endpoint sourcetype=sysmon EventCode=1 CommandLine="*encrypt*" \| join host [search index=network sourcetype=zeek_ssl dest_port=443] \| stats count by host, CommandLine, dest_ip \| where count > 3`.<br>- **KQL**: `DeviceProcessEvents \| where ProcessCommandLine contains "encrypt" \| join kind=inner (DeviceNetworkEvents \| where Protocol == "SSL" and RemotePort == 443) on DeviceName \| summarize count() by DeviceName, ProcessCommandLine, RemoteIP \| where count_ > 3`.<br>- **ELK**: `FROM logs-endpoint.process-* \| WHERE process.command_line : "*encrypt*" \| JOIN logs-zeek.ssl-* ON host.name WHERE destination.port = 443 \| STATS COUNT() BY host.name, process.command_line, destination.ip HAVING COUNT() > 3`. |
| 5. Encrypted C2 with Anomalous Timing | Encrypted C2 with unusual timing, as in 2025 trends. | - Network Traffic (DS0003: Zeek SSL)<br>- Metrics | - **Splunk**: `index=network sourcetype=zeek_ssl \| timechart span=1h count \| where count > avg(count)*4`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "SSL" \| summarize HourlyCount=count() by bin(Timestamp, 1h) \| where HourlyCount > avg(HourlyCount) * 4`.<br>- **ELK**: `FROM logs-zeek.ssl-* \| STATS COUNT() BY date_histogram(@timestamp, '1h') \| WHERE COUNT() > AVG(COUNT()) * 4`. |
| 6. Encrypted C2 with Suspicious Headers | Encrypted C2 with custom headers, as in Cobalt Strike. | - Network Traffic (DS0003: Zeek HTTP)<br>- Proxy Logs | - **Splunk**: `index=network sourcetype=zeek_http header IN ("*X-Cobalt*", "*Custom-Header*") \| stats count by src_ip, header \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "HTTP" and AdditionalFields.Header has_any ("X-Cobalt", "Custom-Header") \| summarize count() by DeviceIP, AdditionalFields.Header \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE http.header : ("*X-Cobalt*" OR "*Custom-Header*") \| STATS COUNT() BY source.ip, http.header HAVING COUNT() > 5`. |
| 7. Encrypted C2 in Cloud Environments | Encrypted C2 in cloud, as in 2025 trends. | - Cloud Audit Logs (AWS CloudTrail)<br>- Network Traffic | - **Splunk**: `index=cloud sourcetype=aws:cloudtrail eventName="Invoke" AND userIdentity NOT IN (authorized_users) \| stats count by userIdentity, src_ip \| where count > 5`.<br>- **KQL**: `AWSCloudTrail \| where EventName == "Invoke" and Caller !in (authorizedUsers) \| summarize count() by Caller, SourceIP \| where count_ > 5`.<br>- **ELK**: `FROM logs-aws.cloudtrail-* \| WHERE event.action = 'Invoke' AND user.identity NOT IN ['authorized_users'] \| STATS COUNT() BY user.identity, source.ip HAVING COUNT() > 5`. |
| 8. Encrypted C2 with Suspicious Headers | Encrypted C2 with custom headers, as in Cobalt Strike. | - Network Traffic (DS0003: Zeek HTTP)<br>- Proxy Logs | - **Splunk**: `index=network sourcetype=zeek_http header IN ("*X-Cobalt*", "*Custom-Header*") \| stats count by src_ip, header \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "HTTP" and AdditionalFields.Header has_any ("X-Cobalt", "Custom-Header") \| summarize count() by DeviceIP, AdditionalFields.Header \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE http.header : ("*X-Cobalt*" OR "*Custom-Header*") \| STATS COUNT() BY source.ip, http.header HAVING COUNT() > 5`. |
| 9. Encrypted C2 in Non-Standard Environments | Encrypted C2 in Linux, as in Turla. | - Network Traffic (DS0003: Zeek SSL)<br>- Linux Logs | - **Splunk**: `index=linux sourcetype=auditd syscall="connect" AND dest_port=443 AND exe NOT IN (known_apps) \| stats count by exe, dest_ip \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where RemotePort == 443 and InitiatingProcessName !in (knownApps) \| summarize count() by InitiatingProcessName, RemoteIP \| where count_ > 5`.<br>- **ELK**: `FROM logs-auditd-* \| WHERE syscall.name = "connect" AND destination.port = 443 AND process.exe NOT IN ['known_apps'] \| STATS COUNT() BY process.exe, destination.ip HAVING COUNT() > 5`. |
| 10. Encrypted C2 with Multi-Stage Redirects | Encrypted C2 with redirects, as in APT41. | - Network Traffic (DS0003: Zeek HTTP)<br>- Redirect Analysis | - **Splunk**: `index=network sourcetype=zeek_http status_code=302 \| stats count by src_ip, uri \| where count > 3`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "HTTP" and AdditionalFields.StatusCode == 302 \| summarize count() by DeviceIP, RemoteUrl \| where count_ > 3`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE http.status = 302 \| STATS COUNT() BY source.ip, http.uri HAVING COUNT() > 3`. |
| 11. Encrypted C2 with Anomalous User Agents | Encrypted C2 with unusual user agents, as in Cobalt Strike. | - Network Traffic (DS0003: Zeek HTTP)<br>- Proxy Logs | - **Splunk**: `index=network sourcetype=zeek_http user_agent NOT IN (known_agents) \| stats count by src_ip, user_agent \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "HTTP" and AdditionalFields.UserAgent !in (knownAgents) \| summarize count() by DeviceIP, AdditionalFields.UserAgent \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE http.user_agent NOT IN ['known_agents'] \| STATS COUNT() BY source.ip, http.user_agent HAVING COUNT() > 5`. |
| 12. Encrypted C2 in Cloud Environments | Encrypted C2 in cloud, as in 2025 trends. | - Cloud Audit Logs (AWS CloudTrail)<br>- Network Traffic | - **Splunk**: `index=cloud sourcetype=aws:cloudtrail eventName="Invoke" AND userIdentity NOT IN (authorized_users) \| stats count by userIdentity, src_ip \| where count > 5`.<br>- **KQL**: `AWSCloudTrail \| where EventName == "Invoke" and Caller !in (authorizedUsers) \| summarize count() by Caller, SourceIP \| where count_ > 5`.<br>- **ELK**: `FROM logs-aws.cloudtrail-* \| WHERE event.action = 'Invoke' AND user.identity NOT IN ['authorized_users'] \| STATS COUNT() BY user.identity, source.ip HAVING COUNT() > 5`. |
| 13. Encrypted C2 with Anomalous Timing | Encrypted C2 with unusual timing, as in 2025 trends. | - Network Traffic (DS0003: Zeek SSL)<br>- Metrics | - **Splunk**: `index=network sourcetype=zeek_ssl \| timechart span=1h count \| where count > avg(count)*4`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "SSL" \| summarize HourlyCount=count() by bin(Timestamp, 1h) \| where HourlyCount > avg(HourlyCount) * 4`.<br>- **ELK**: `FROM logs-zeek.ssl-* \| STATS COUNT() BY date_histogram(@timestamp, '1h') \| WHERE COUNT() > AVG(COUNT()) * 4`. |
| 14. Encrypted C2 with Suspicious Headers | Encrypted C2 with custom headers, as in Cobalt Strike. | - Network Traffic (DS0003: Zeek HTTP)<br>- Proxy Logs | - **Splunk**: `index=network sourcetype=zeek_http header IN ("*X-Cobalt*", "*Custom-Header*") \| stats count by src_ip, header \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "HTTP" and AdditionalFields.Header has_any ("X-Cobalt", "Custom-Header") \| summarize count() by DeviceIP, AdditionalFields.Header \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE http.header : ("*X-Cobalt*" OR "*Custom-Header*") \| STATS COUNT() BY source.ip, http.header HAVING COUNT() > 5`. |
| 15. Encrypted C2 with Encrypted Payloads | Encrypted payloads in encrypted C2, as in APT41. | - Network Traffic (DS0003: Zeek HTTP)<br>- Packet Analysis | - **Splunk**: `index=network sourcetype=zeek_http payload_entropy > 7 \| stats count by src_ip, uri \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "HTTP" and AdditionalFields.PayloadEntropy > 7 \| summarize count() by DeviceIP, RemoteUrl \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE http.payload.entropy > 7 \| STATS COUNT() BY source.ip, http.uri HAVING COUNT() > 5`. |

### External Proxy (T1090.002)

| Hypothesis | Description | Data Sources | Hunting Queries |
|------------|-------------|--------------|-----------------|
| 1. C2 via External Proxy Servers | Adversaries use external proxies for C2, as in APT41. High risk in environments with limited outbound traffic monitoring. | - Network Traffic (DS0003: Zeek Conn)<br>- Proxy Logs | - **Splunk**: `index=network sourcetype=zeek_conn dest_ip IN (proxy_ips) AND NOT src_ip IN (known_clients) \| stats count by src_ip, dest_ip \| where count > 5` (Detects connections to external proxies).<br>- **KQL**: `DeviceNetworkEvents \| where RemoteIP in (proxyIPs) and DeviceIP !in (knownClients) \| summarize count() by DeviceIP, RemoteIP \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.conn-* \| WHERE destination.ip IN ['proxy_ips'] AND source.ip NOT IN ['known_clients'] \| STATS COUNT() BY source.ip, destination.ip HAVING COUNT() > 5`. |
| 2. External Proxy with Encrypted Traffic | Encrypted traffic through external proxies, as in Turla. | - Network Traffic (DS0003: Zeek SSL)<br>- Proxy Logs | - **Splunk**: `index=network sourcetype=zeek_ssl dest_port=443 AND dest_ip IN (proxy_ips) \| stats count by src_ip, dest_ip \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where RemotePort == 443 and RemoteIP in (proxyIPs) \| summarize count() by DeviceIP, RemoteIP \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.ssl-* \| WHERE destination.port = 443 AND destination.ip IN ['proxy_ips'] \| STATS COUNT() BY source.ip, destination.ip HAVING COUNT() > 5`. |
| 3. External Proxy Access from Compromised Endpoints | Compromised endpoints access external proxies, as in FIN7. | - Process Creation (DS0009: Sysmon ID 1)<br>- Network Traffic | - **Splunk**: `index=endpoint sourcetype=sysmon EventCode=1 CommandLine="*proxy*" \| join host [search index=network sourcetype=zeek_conn dest_ip IN (proxy_ips)] \| stats count by host, CommandLine, dest_ip \| where count > 3`.<br>- **KQL**: `DeviceProcessEvents \| where ProcessCommandLine contains "proxy" \| join kind=inner (DeviceNetworkEvents \| where RemoteIP in (proxyIPs)) on DeviceName \| summarize count() by DeviceName, ProcessCommandLine, RemoteIP \| where count_ > 3`.<br>- **ELK**: `FROM logs-endpoint.process-* \| WHERE process.command_line : "*proxy*" \| JOIN logs-zeek.conn-* ON host.name WHERE destination.ip IN ['proxy_ips'] \| STATS COUNT() BY host.name, process.command_line, destination.ip HAVING COUNT() > 3`. |
| 4. External Proxy with Anomalous Timing | External proxy access with unusual timing, as in 2025 trends. | - Network Traffic (DS0003: Zeek Conn)<br>- Metrics | - **Splunk**: `index=network sourcetype=zeek_conn dest_ip IN (proxy_ips) \| timechart span=1h count \| where count > avg(count)*4`.<br>- **KQL**: `DeviceNetworkEvents \| where RemoteIP in (proxyIPs) \| summarize HourlyCount=count() by bin(Timestamp, 1h) \| where HourlyCount > avg(HourlyCount) * 4`.<br>- **ELK**: `FROM logs-zeek.conn-* \| WHERE destination.ip IN ['proxy_ips'] \| STATS COUNT() BY date_histogram(@timestamp, '1h') \| WHERE COUNT() > AVG(COUNT()) * 4`. |
| 5. External Proxy with Encrypted Payloads | Encrypted payloads through external proxies, as in APT41. | - Network Traffic (DS0003: Zeek HTTP)<br>- Packet Analysis | - **Splunk**: `index=network sourcetype=zeek_http dest_ip IN (proxy_ips) AND payload_entropy > 7 \| stats count by src_ip, uri \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where RemoteIP in (proxyIPs) and AdditionalFields.PayloadEntropy > 7 \| summarize count() by DeviceIP, RemoteUrl \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE destination.ip IN ['proxy_ips'] AND http.payload.entropy > 7 \| STATS COUNT() BY source.ip, http.uri HAVING COUNT() > 5`. |
| 6. External Proxy in Cloud Environments | External proxy access in cloud, as in 2025 trends. | - Cloud Audit Logs (AWS CloudTrail)<br>- Network Traffic | - **Splunk**: `index=cloud sourcetype=aws:cloudtrail eventName="Invoke" AND userIdentity NOT IN (authorized_users) \| stats count by userIdentity, src_ip \| where count > 5`.<br>- **KQL**: `AWSCloudTrail \| where EventName == "Invoke" and Caller !in (authorizedUsers) \| summarize count() by Caller, SourceIP \| where count_ > 5`.<br>- **ELK**: `FROM logs-aws.cloudtrail-* \| WHERE event.action = 'Invoke' AND user.identity NOT IN ['authorized_users'] \| STATS COUNT() BY user.identity, source.ip HAVING COUNT() > 5`. |
| 7. External Proxy with Suspicious Headers | External proxy with custom headers, as in Cobalt Strike. | - Network Traffic (DS0003: Zeek HTTP)<br>- Proxy Logs | - **Splunk**: `index=network sourcetype=zeek_http dest_ip IN (proxy_ips) AND header IN ("*X-Cobalt*", "*Custom-Header*") \| stats count by src_ip, header \| where count >

### Fast Flux DNS (T1568.001)

| Hypothesis | Description | Data Sources | Hunting Queries |
|------------|-------------|--------------|-----------------|
| 1. Rapid IP Changes for Domain Resolution | Adversaries use Fast Flux DNS to rotate IPs for C2 domains, as in APT41 campaigns. High risk in environments with limited DNS monitoring. | - DNS Logs (DS0003: Zeek DNS)<br>- Network Traffic | - **Splunk**: `index=network sourcetype=zeek_dns query IN (suspicious_domains) \| stats values(answer) by query \| where mvcount(answer) > 5` (Detects domains with multiple IP resolutions).<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "DNS" and AdditionalFields.Query in (suspiciousDomains) \| summarize IPs=make_set(AdditionalFields.Answer) by AdditionalFields.Query \| where array_length(IPs) > 5`.<br>- **ELK**: `FROM logs-zeek.dns-* \| WHERE dns.query IN ['suspicious_domains'] \| STATS SET(dns.answer) BY dns.query \| WHERE CARDINALITY(dns.answer) > 5`. |
| 2. Fast Flux DNS with Low TTL Values | Low Time-to-Live (TTL) in DNS responses indicating Fast Flux, as in Turla attacks. | - DNS Logs (DS0003: Zeek DNS)<br>- Network Traffic | - **Splunk**: `index=network sourcetype=zeek_dns ttl < 300 AND query IN (suspicious_domains) \| stats count by src_ip, query \| where count > 10`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "DNS" and AdditionalFields.TTL < 300 and AdditionalFields.Query in (suspiciousDomains) \| summarize count() by DeviceIP, AdditionalFields.Query \| where count_ > 10`.<br>- **ELK**: `FROM logs-zeek.dns-* \| WHERE dns.ttl < 300 AND dns.query IN ['suspicious_domains'] \| STATS COUNT() BY source.ip, dns.query HAVING COUNT() > 10`. |
| 3. Fast Flux DNS from Compromised Endpoints | Compromised endpoints resolve Fast Flux domains, as in FIN7. | - Process Creation (DS0009: Sysmon ID 1)<br>- DNS Logs | - **Splunk**: `index=endpoint sourcetype=sysmon EventCode=1 CommandLine="*dns*" \| join host [search index=network sourcetype=zeek_dns ttl < 300] \| stats count by host, CommandLine, query \| where count > 3`.<br>- **KQL**: `DeviceProcessEvents \| where ProcessCommandLine contains "dns" \| join kind=inner (DeviceNetworkEvents \| where Protocol == "DNS" and AdditionalFields.TTL < 300) on DeviceName \| summarize count() by DeviceName, ProcessCommandLine, AdditionalFields.Query \| where count_ > 3`.<br>- **ELK**: `FROM logs-endpoint.process-* \| WHERE process.command_line : "*dns*" \| JOIN logs-zeek.dns-* ON host.name WHERE dns.ttl < 300 \| STATS COUNT() BY host.name, process.command_line, dns.query HAVING COUNT() > 3`. |
| 4. Fast Flux DNS with Anomalous Timing | Fast Flux DNS with unusual timing, as in 2025 trends. | - DNS Logs (DS0003: Zeek DNS)<br>- Metrics | - **Splunk**: `index=network sourcetype=zeek_dns \| timechart span=1h count \| where count > avg(count)*4`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "DNS" \| summarize HourlyCount=count() by bin(Timestamp, 1h) \| where HourlyCount > avg(HourlyCount) * 4`.<br>- **ELK**: `FROM logs-zeek.dns-* \| STATS COUNT() BY date_histogram(@timestamp, '1h') \| WHERE COUNT() > AVG(COUNT()) * 4`. |
| 5. Fast Flux DNS with Encrypted Payloads | Encrypted payloads in Fast Flux DNS queries, as in APT41. | - DNS Logs (DS0003: Zeek DNS)<br>- Packet Analysis | - **Splunk**: `index=network sourcetype=zeek_dns payload_entropy > 7 \| stats count by src_ip, query \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "DNS" and AdditionalFields.PayloadEntropy > 7 \| summarize count() by DeviceIP, AdditionalFields.Query \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.dns-* \| WHERE dns.payload.entropy > 7 \| STATS COUNT() BY source.ip, dns.query HAVING COUNT() > 5`. |
| 6. Fast Flux DNS in Cloud Environments | Fast Flux DNS in cloud, as in 2025 trends. | - Cloud Audit Logs (AWS CloudTrail)<br>- DNS Logs | - **Splunk**: `index=cloud sourcetype=aws:cloudtrail eventName="Resolve" AND userIdentity NOT IN (authorized_users) \| stats count by userIdentity, src_ip \| where count > 5`.<br>- **KQL**: `AWSCloudTrail \| where EventName == "Resolve" and Caller !in (authorizedUsers) \| summarize count() by Caller, SourceIP \| where count_ > 5`.<br>- **ELK**: `FROM logs-aws.cloudtrail-* \| WHERE event.action = 'Resolve' AND user.identity NOT IN ['authorized_users'] \| STATS COUNT() BY user.identity, source.ip HAVING COUNT() > 5`. |
| 7. Fast Flux DNS with Suspicious Headers | Fast Flux DNS with custom headers, as in Cobalt Strike. | - DNS Logs (DS0003: Zeek DNS)<br>- Proxy Logs | - **Splunk**: `index=network sourcetype=zeek_dns header IN ("*X-Cobalt*", "*Custom-Header*") \| stats count by src_ip, header \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "DNS" and AdditionalFields.Header has_any ("X-Cobalt", "Custom-Header") \| summarize count() by DeviceIP, AdditionalFields.Header \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.dns-* \| WHERE dns.header : ("*X-Cobalt*" OR "*Custom-Header*") \| STATS COUNT() BY source.ip, dns.header HAVING COUNT() > 5`. |
| 8. Fast Flux DNS in Non-Standard Environments | Fast Flux DNS in Linux, as in Turla. | - DNS Logs (DS0003: Zeek DNS)<br>- Linux Logs | - **Splunk**: `index=linux sourcetype=auditd syscall="sendto" AND dest_port=53 AND exe NOT IN (known_apps) \| stats count by exe, dest_ip \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where RemotePort == 53 and InitiatingProcessName !in (knownApps) \| summarize count() by InitiatingProcessName, RemoteIP \| where count_ > 5`.<br>- **ELK**: `FROM logs-auditd-* \| WHERE syscall.name = "sendto" AND destination.port = 53 AND process.exe NOT IN ['known_apps'] \| STATS COUNT() BY process.exe, destination.ip HAVING COUNT() > 5`. |
| 9. Fast Flux DNS with Anomalous Timing | Fast Flux DNS with unusual timing, as in 2025 trends. | - DNS Logs (DS0003: Zeek DNS)<br>- Metrics | - **Splunk**: `index=network sourcetype=zeek_dns \| timechart span=1h count \| where count > avg(count)*4`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "DNS" \| summarize HourlyCount=count() by bin(Timestamp, 1h) \| where HourlyCount > avg(HourlyCount) * 4`.<br>- **ELK**: `FROM logs-zeek.dns-* \| STATS COUNT() BY date_histogram(@timestamp, '1h') \| WHERE COUNT() > AVG(COUNT()) * 4`. |
| 10. Fast Flux DNS with Suspicious Headers | Fast Flux DNS with custom headers, as in Cobalt Strike. | - DNS Logs (DS0003: Zeek DNS)<br>- Proxy Logs | - **Splunk**: `index=network sourcetype=zeek_dns header IN ("*X-Cobalt*", "*Custom-Header*") \| stats count by src_ip, header \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "DNS" and AdditionalFields.Header has_any ("X-Cobalt", "Custom-Header") \| summarize count() by DeviceIP, AdditionalFields.Header \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.dns-* \| WHERE dns.header : ("*X-Cobalt*" OR "*Custom-Header*") \| STATS COUNT() BY source.ip, dns.header HAVING COUNT() > 5`. |
| 11. Fast Flux DNS with Encrypted Payloads | Encrypted payloads in Fast Flux DNS, as in APT41. | - DNS Logs (DS0003: Zeek DNS)<br>- Packet Analysis | - **Splunk**: `index=network sourcetype=zeek_dns payload_entropy > 7 \| stats count by src_ip, query \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "DNS" and AdditionalFields.PayloadEntropy > 7 \| summarize count() by DeviceIP, AdditionalFields.Query \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.dns-* \| WHERE dns.payload.entropy > 7 \| STATS COUNT() BY source.ip, dns.query HAVING COUNT() > 5`. |
| 12. Fast Flux DNS in Cloud Environments | Fast Flux DNS in cloud, as in 2025 trends. | - Cloud Audit Logs (AWS CloudTrail)<br>- DNS Logs | - **Splunk**: `index=cloud sourcetype=aws:cloudtrail eventName="Resolve" AND userIdentity NOT IN (authorized_users) \| stats count by userIdentity, src_ip \| where count > 5`.<br>- **KQL**: `AWSCloudTrail \| where EventName == "Resolve" and Caller !in (authorizedUsers) \| summarize count() by Caller, SourceIP \| where count_ > 5`.<br>- **ELK**: `FROM logs-aws.cloudtrail-* \| WHERE event.action = 'Resolve' AND user.identity NOT IN ['authorized_users'] \| STATS COUNT() BY user.identity, source.ip HAVING COUNT() > 5`. |
| 14. Fast Flux DNS with Anomalous Timing | Fast Flux DNS with unusual timing, as in 2025 trends. | - DNS Logs (DS0003: Zeek DNS)<br>- Metrics | - **Splunk**: `index=network sourcetype=zeek_dns \| timechart span=1h count \| where count > avg(count)*4`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "DNS" \| summarize HourlyCount=count() by bin(Timestamp, 1h) \| where HourlyCount > avg(HourlyCount) * 4`.<br>- **ELK**: `FROM logs-zeek.dns-* \| STATS COUNT() BY date_histogram(@timestamp, '1h') \| WHERE COUNT() > AVG(COUNT()) * 4`. |
| 15. Fast Flux DNS with Suspicious Headers | Fast Flux DNS with custom headers, as in Cobalt Strike. | - DNS Logs (DS0003: Zeek DNS)<br>- Proxy Logs | - **Splunk**: `index=network sourcetype=zeek_dns header IN ("*X-Cobalt*", "*Custom-Header*") \| stats count by src_ip, header \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "DNS" and AdditionalFields.Header has_any ("X-Cobalt", "Custom-Header") \| summarize count() by DeviceIP, AdditionalFields.Header \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.dns-* \| WHERE dns.header : ("*X-Cobalt*" OR "*Custom-Header*") \| STATS COUNT() BY source.ip, dns.header HAVING COUNT() > 5`. |

### File Transfer Protocols (T1071.002)

| Hypothesis | Description | Data Sources | Hunting Queries |
|------------|-------------|--------------|-----------------|
| 1. FTP C2 Communication | Adversaries use FTP for C2, as in APT41. High risk in environments with limited file transfer monitoring. | - Network Traffic (DS0003: Zeek FTP)<br>- Firewall Logs | - **Splunk**: `index=network sourcetype=zeek_ftp command IN ("STOR", "RETR") AND dest_ip NOT IN (known_servers) \| stats count by src_ip, dest_ip \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "FTP" and AdditionalFields.Command in ("STOR", "RETR") and RemoteIP !in (knownServers) \| summarize count() by DeviceIP, RemoteIP \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.ftp-* \| WHERE ftp.command IN ['STOR', 'RETR'] AND destination.ip NOT IN ['known_servers'] \| STATS COUNT() BY source.ip, destination.ip HAVING COUNT() > 5`. |
| 2. SFTP C2 Communication | Adversaries use SFTP for secure C2, as in Turla. | - Network Traffic (DS0003: Zeek SFTP)<br>- Firewall Logs | - **Splunk**: `index=network sourcetype=zeek_sftp command IN ("PUT", "GET") AND dest_ip NOT IN (known_servers) \| stats count by src_ip, dest_ip \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "SFTP" and AdditionalFields.Command in ("PUT", "GET") and RemoteIP !in (knownServers) \| summarize count() by DeviceIP, RemoteIP \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.sftp-* \| WHERE sftp.command IN ['PUT', 'GET'] AND destination.ip NOT IN ['known_servers'] \| STATS COUNT() BY source.ip, destination.ip HAVING COUNT() > 5`. |
| 3. FTP C2 from Compromised Endpoints | Compromised endpoints use FTP for C2, as in FIN7. | - Process Creation (DS0009: Sysmon ID 1)<br>- Network Traffic | - **Splunk**: `index=endpoint sourcetype=sysmon EventCode=1 CommandLine="*ftp*" \| join host [search index=network sourcetype=zeek_ftp command="STOR"] \| stats count by host, CommandLine, dest_ip \| where count > 3`.<br>- **KQL**: `DeviceProcessEvents \| where ProcessCommandLine contains "ftp" \| join kind=inner (DeviceNetworkEvents \| where Protocol == "FTP" and AdditionalFields.Command == "STOR") on DeviceName \| summarize count() by DeviceName, ProcessCommandLine, RemoteIP \| where count_ > 3`.<br>- **ELK**: `FROM logs-endpoint.process-* \| WHERE process.command_line : "*ftp*" \| JOIN logs-zeek.ftp-* ON host.name WHERE ftp.command = 'STOR' \| STATS COUNT() BY host.name, process.command_line, destination.ip HAVING COUNT() > 3`. |
| 4. FTP C2 with Anomalous Timing | FTP C2 with unusual timing, as in 2025 trends. | - Network Traffic (DS0003: Zeek FTP)<br>- Metrics | - **Splunk**: `index=network sourcetype=zeek_ftp \| timechart span=1h count \| where count > avg(count)*4`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "FTP" \| summarize HourlyCount=count() by bin(Timestamp, 1h) \| where HourlyCount > avg(HourlyCount) * 4`.<br>- **ELK**: `FROM logs-zeek.ftp-* \| STATS COUNT() BY date_histogram(@timestamp, '1h') \| WHERE COUNT() > AVG(COUNT()) * 4`. |
| 5. FTP C2 with Encrypted Payloads | Encrypted payloads in FTP C2, as in APT41. | - Network Traffic (DS0003: Zeek FTP)<br>- Packet Analysis | - **Splunk**: `index=network sourcetype=zeek_ftp payload_entropy > 7 \| stats count by src_ip, command \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "FTP" and AdditionalFields.PayloadEntropy > 7 \| summarize count() by DeviceIP, AdditionalFields.Command \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.ftp-* \| WHERE ftp.payload.entropy > 7 \| STATS COUNT() BY source.ip, ftp.command HAVING COUNT() > 5`. |
| 7. FTP C2 in Cloud Environments | FTP C2 in cloud, as in 2025 trends. | - Cloud Audit Logs (AWS CloudTrail)<br>- Network Traffic | - **Splunk**: `index=cloud sourcetype=aws:cloudtrail eventName="Invoke" AND userIdentity NOT IN (authorized_users) \| stats count by userIdentity, src_ip \| where count > 5`.<br>- **KQL**: `AWSCloudTrail \| where EventName == "Invoke" and Caller !in (authorizedUsers) \| summarize count() by Caller, SourceIP \| where count_ > 5`.<br>- **ELK**: `FROM logs-aws.cloudtrail-* \| WHERE event.action = 'Invoke' AND user.identity NOT IN ['authorized_users'] \| STATS COUNT() BY user.identity, source.ip HAVING COUNT() > 5`. |
| 8. FTP C2 with Suspicious Headers | FTP C2 with custom headers, as in Cobalt Strike. | - Network Traffic (DS0003: Zeek FTP)<br>- Proxy Logs | - **Splunk**: `index=network sourcetype=zeek_ftp header IN ("*X-Cobalt*", "*Custom-Header*") \| stats count by src_ip, header \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "FTP" and AdditionalFields.Header has_any ("X-Cobalt", "Custom-Header") \| summarize count() by DeviceIP, AdditionalFields.Header \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.ftp-* \| WHERE ftp.header : ("*X-Cobalt*" OR "*Custom-Header*") \| STATS COUNT() BY source.ip, ftp.header HAVING COUNT() > 5`. |
| 9. FTP C2 in Non-Standard Environments | FTP C2 in Linux, as in Turla. | - Network Traffic (DS0003: Zeek FTP)<br>- Linux Logs | - **Splunk**: `index=linux sourcetype=auditd syscall="connect" AND dest_port=21 AND exe NOT IN (known_apps) \| stats count by exe, dest_ip \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where RemotePort == 21 and InitiatingProcessName !in (knownApps) \| summarize count() by InitiatingProcessName, RemoteIP \| where count_ > 5`.<br>- **ELK**: `FROM logs-auditd-* \| WHERE syscall.name = "connect" AND destination.port = 21 AND process.exe NOT IN ['known_apps'] \| STATS COUNT() BY process.exe, destination.ip HAVING COUNT() > 5`. |
| 10. FTP C2 with Multi-Stage Redirects | FTP C2 with redirects, as in APT41. | - Network Traffic (DS0003: Zeek FTP)<br>- Redirect Analysis | - **Splunk**: `index=network sourcetype=zeek_ftp status_code=302 \| stats count by src_ip, command \| where count > 3`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "FTP" and AdditionalFields.StatusCode == 302 \| summarize count() by DeviceIP, AdditionalFields.Command \| where count_ > 3`.<br>- **ELK**: `FROM logs-zeek.ftp-* \| WHERE ftp.status = 302 \| STATS COUNT() BY source.ip, ftp.command HAVING COUNT() > 3`. |
| 11. FTP C2 with Anomalous User Agents | FTP C2 with unusual user agents, as in Cobalt Strike. | - Network Traffic (DS0003: Zeek FTP)<br>- Proxy Logs | - **Splunk**: `index=network sourcetype=zeek_ftp user_agent NOT IN (known_agents) \| stats count by src_ip, user_agent \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "FTP" and AdditionalFields.UserAgent !in (knownAgents) \| summarize count() by DeviceIP, AdditionalFields.UserAgent \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.ftp-* \| WHERE ftp.user_agent NOT IN ['known_agents'] \| STATS COUNT() BY source.ip, ftp.user_agent HAVING COUNT() > 5`. |
| 12. FTP C2 in Cloud Environments | FTP C2 in cloud, as in 2025 trends. | - Cloud Audit Logs (AWS CloudTrail)<br>- Network Traffic | - **Splunk**: `index=cloud sourcetype=aws:cloudtrail eventName="Invoke" AND userIdentity NOT IN (authorized_users) \| stats count by userIdentity, src_ip \| where count > 5`.<br>- **KQL**: `AWSCloudTrail \| where EventName == "Invoke" and Caller !in (authorizedUsers) \| summarize count() by Caller, SourceIP \| where count_ > 5`.<br>- **ELK**: `FROM logs-aws.cloudtrail-* \| WHERE event.action = 'Invoke' AND user.identity NOT IN ['authorized_users'] \| STATS COUNT() BY user.identity, source.ip HAVING COUNT() > 5`. |
| 14. FTP C2 with Anomalous Timing | FTP C2 with unusual timing, as in 2025 trends. | - Network Traffic (DS0003: Zeek FTP)<br>- Metrics | - **Splunk**: `index=network sourcetype=zeek_ftp \| timechart span=1h count \| where count > avg(count)*4`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "FTP" \| summarize HourlyCount=count() by bin(Timestamp, 1h) \| where HourlyCount > avg(HourlyCount) * 4`.<br>- **ELK**: `FROM logs-zeek.ftp-* \| STATS COUNT() BY date_histogram(@timestamp, '1h') \| WHERE COUNT() > AVG(COUNT()) * 4`. |
| 14. FTP C2 with Suspicious Headers | FTP C2 with custom headers, as in Cobalt Strike. | - Network Traffic (DS0003: Zeek FTP)<br>- Proxy Logs | - **Splunk**: `index=network sourcetype=zeek_ftp header IN ("*X-Cobalt*", "*Custom-Header*") \| stats count by src_ip, header \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "FTP" and AdditionalFields.Header has_any ("X-Cobalt", "Custom-Header") \| summarize count() by DeviceIP, AdditionalFields.Header \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.ftp-* \| WHERE ftp.header : ("*X-Cobalt*" OR "*Custom-Header*") \| STATS COUNT() BY source.ip, ftp.header HAVING COUNT() > 5`. |
| 15. FTP C2 with Encrypted Payloads | Encrypted payloads in FTP C2, as in APT41. | - Network Traffic (DS0003: Zeek FTP)<br>- Packet Analysis | - **Splunk**: `index=network sourcetype=zeek_ftp payload_entropy > 7 \| stats count by src_ip, command \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "FTP" and AdditionalFields.PayloadEntropy > 7 \| summarize count() by DeviceIP, AdditionalFields.Command \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.ftp-* \| WHERE ftp.payload.entropy > 7 \| STATS COUNT() BY source.ip, ftp.command HAVING COUNT() > 5`. | 

### ICMP Tunneling (T1095)

| Hypothesis | Description | Data Sources | Hunting Queries |
|------------|-------------|--------------|-----------------|
| 1. ICMP Tunneling for C2 | Adversaries use ICMP for C2 tunneling, as in APT41. High risk in environments with limited ICMP monitoring. | - Network Traffic (DS0003: Zeek ICMP)<br>- Firewall Logs | - **Splunk**: `index=network sourcetype=zeek_icmp type="echo" AND payload_length > 100 \| stats count by src_ip, dest_ip \| where count > 5` (Detects large ICMP payloads indicative of tunneling).<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "ICMP" and AdditionalFields.Type == "echo" and AdditionalFields.PayloadLength > 100 \| summarize count() by DeviceIP, RemoteIP \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.icmp-* \| WHERE icmp.type = 'echo' AND icmp.payload.length > 100 \| STATS COUNT() BY source.ip, destination.ip HAVING COUNT() > 5`. |
| 2. ICMP Tunneling with Encrypted Payloads | Encrypted payloads in ICMP tunneling, as in Turla. | - Network Traffic (DS0003: Zeek ICMP)<br>- Packet Analysis | - **Splunk**: `index=network sourcetype=zeek_icmp payload_entropy > 7 \| stats count by src_ip \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "ICMP" and AdditionalFields.PayloadEntropy > 7 \| summarize count() by DeviceIP \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.icmp-* \| WHERE icmp.payload.entropy > 7 \| STATS COUNT() BY source.ip HAVING COUNT() > 5`. |
| 3. ICMP Tunneling from Compromised Endpoints | Compromised endpoints use ICMP for tunneling, as in FIN7. | - Process Creation (DS0009: Sysmon ID 1)<br>- Network Traffic | - **Splunk**: `index=endpoint sourcetype=sysmon EventCode=1 CommandLine="*icmp*" \| join host [search index=network sourcetype=zeek_icmp payload_length > 100] \| stats count by host, CommandLine, dest_ip \| where count > 3`.<br>- **KQL**: `DeviceProcessEvents \| where ProcessCommandLine contains "icmp" \| join kind=inner (DeviceNetworkEvents \| where Protocol == "ICMP" and AdditionalFields.PayloadLength > 100) on DeviceName \| summarize count() by DeviceName, ProcessCommandLine, RemoteIP \| where count_ > 3`.<br>- **ELK**: `FROM logs-endpoint.process-* \| WHERE process.command_line : "*icmp*" \| JOIN logs-zeek.icmp-* ON host.name WHERE icmp.payload.length > 100 \| STATS COUNT() BY host.name, process.command_line, destination.ip HAVING COUNT() > 3`. |
| 4. ICMP Tunneling with Anomalous Timing | ICMP tunneling with unusual timing, as in 2025 trends. | - Network Traffic (DS0003: Zeek ICMP)<br>- Metrics | - **Splunk**: `index=network sourcetype=zeek_icmp \| timechart span=1h count \| where count > avg(count)*4`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "ICMP" \| summarize HourlyCount=count() by bin(Timestamp, 1h) \| where HourlyCount > avg(HourlyCount) * 4`.<br>- **ELK**: `FROM logs-zeek.icmp-* \| STATS COUNT() BY date_histogram(@timestamp, '1h') \| WHERE COUNT() > AVG(COUNT()) * 4`. |
| 5. ICMP Tunneling with Encrypted Payloads | Encrypted payloads in ICMP tunneling, as in APT41. | - Network Traffic (DS0003: Zeek ICMP)<br>- Packet Analysis | - **Splunk**: `index=network sourcetype=zeek_icmp payload_entropy > 7 \| stats count by src_ip \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "ICMP" and AdditionalFields.PayloadEntropy > 7 \| summarize count() by DeviceIP \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.icmp-* \| WHERE icmp.payload.entropy > 7 \| STATS COUNT() BY source.ip HAVING COUNT() > 5`. |
| 6. ICMP Tunneling in Cloud Environments | ICMP tunneling in cloud, as in 2025 trends. | - Cloud Audit Logs (AWS CloudTrail)<br>- Network Traffic | - **Splunk**: `index=cloud sourcetype=aws:cloudtrail eventName="Invoke" AND userIdentity NOT IN (authorized_users) \| stats count by userIdentity, src_ip \| where count > 5`.<br>- **KQL**: `AWSCloudTrail \| where EventName == "Invoke" and Caller !in (authorizedUsers) \| summarize count() by Caller, SourceIP \| where count_ > 5`.<br>- **ELK**: `FROM logs-aws.cloudtrail-* \| WHERE event.action = 'Invoke' AND user.identity NOT IN ['authorized_users'] \| STATS COUNT() BY user.identity, source.ip HAVING COUNT() > 5`. |
| 7. ICMP Tunneling with Suspicious Headers | ICMP tunneling with custom headers, as in Cobalt Strike. | - Network Traffic (DS0003: Zeek ICMP)<br>- Proxy Logs | - **Splunk**: `index=network sourcetype=zeek_icmp header IN ("*X-Cobalt*", "*Custom-Header*") \| stats count by src_ip, header \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "ICMP" and AdditionalFields.Header has_any ("X-Cobalt", "Custom-Header") \| summarize count() by DeviceIP, AdditionalFields.Header \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.icmp-* \| WHERE icmp.header : ("*X-Cobalt*" OR "*Custom-Header*") \| STATS COUNT() BY source.ip, icmp.header HAVING COUNT() > 5`. |
| 8. ICMP Tunneling in Non-Standard Environments | ICMP tunneling in Linux, as in Turla. | - Network Traffic (DS0003: Zeek ICMP)<br>- Linux Logs | - **Splunk**: `index=linux sourcetype=auditd syscall="sendto" AND dest_port=0 AND exe NOT IN (known_apps) \| stats count by exe, dest_ip \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "ICMP" and InitiatingProcessName !in (knownApps) \| summarize count() by InitiatingProcessName, RemoteIP \| where count_ > 5`.<br>- **ELK**: `FROM logs-auditd-* \| WHERE syscall.name = "sendto" AND destination.port = 0 AND process.exe NOT IN ['known_apps'] \| STATS COUNT() BY process.exe, destination.ip HAVING COUNT() > 5`. |
| 9. ICMP Tunneling with Anomalous Timing | ICMP tunneling with unusual timing, as in 2025 trends. | - Network Traffic (DS0003: Zeek ICMP)<br>- Metrics | - **Splunk**: `index=network sourcetype=zeek_icmp \| timechart span=1h count \| where count > avg(count)*4`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "ICMP" \| summarize HourlyCount=count() by bin(Timestamp, 1h) \| where HourlyCount > avg(HourlyCount) * 4`.<br>- **ELK**: `FROM logs-zeek.icmp-* \| STATS COUNT() BY date_histogram(@timestamp, '1h') \| WHERE COUNT() > AVG(COUNT()) * 4`. |
| 10. ICMP Tunneling with Suspicious Headers | ICMP tunneling with custom headers, as in Cobalt Strike. | - Network Traffic (DS0003: Zeek ICMP)<br>- Proxy Logs | - **Splunk**: `index=network sourcetype=zeek_icmp header IN ("*X-Cobalt*", "*Custom-Header*") \| stats count by src_ip, header \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "ICMP" and AdditionalFields.Header has_any ("X-Cobalt", "Custom-Header") \| summarize count() by DeviceIP, AdditionalFields.Header \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.icmp-* \| WHERE icmp.header : ("*X-Cobalt*" OR "*Custom-Header*") \| STATS COUNT() BY source.ip, icmp.header HAVING COUNT() > 5`. |
| 14. ICMP Tunneling with Encrypted Payloads | Encrypted payloads in ICMP tunneling, as in APT41. | - Network Traffic (DS0003: Zeek ICMP)<br>- Packet Analysis | - **Splunk**: `index=network sourcetype=zeek_icmp payload_entropy > 7 \| stats count by src_ip \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "ICMP" and AdditionalFields.PayloadEntropy > 7 \| summarize count() by DeviceIP \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.icmp-* \| WHERE icmp.payload.entropy > 7 \| STATS COUNT() BY source.ip HAVING COUNT() > 5`. |
| 15. ICMP Tunneling in Cloud Environments | ICMP tunneling in cloud, as in 2025 trends. | - Cloud Audit Logs (AWS CloudTrail)<br>- Network Traffic | - **Splunk**: `index=cloud sourcetype=aws:cloudtrail eventName="Invoke" AND userIdentity NOT IN (authorized_users) \| stats count by userIdentity, src_ip \| where count > 5`.<br>- **KQL**: `AWSCloudTrail \| where EventName == "Invoke" and Caller !in (authorizedUsers) \| summarize count() by Caller, SourceIP \| where count_ > 5`.<br>- **ELK**: `FROM logs-aws.cloudtrail-* \| WHERE event.action = 'Invoke' AND user.identity NOT IN ['authorized_users'] \| STATS COUNT() BY user.identity, source.ip HAVING COUNT() > 5`. ## Fast Flux DNS (T1568.001)

### File Transfer Protocols (T1071.002)

| Hypothesis | Description | Data Sources | Hunting Queries |
|------------|-------------|--------------|-----------------|
| 1. FTP C2 Communication | Adversaries use FTP for C2, as in APT41. High risk in environments with limited file transfer monitoring. | - Network Traffic (DS0003: Zeek FTP)<br>- Firewall Logs | - **Splunk**: `index=network sourcetype=zeek_ftp command IN ("STOR", "RETR") AND dest_ip NOT IN (known_servers) \| stats count by src_ip, dest_ip \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "FTP" and AdditionalFields.Command in ("STOR", "RETR") and RemoteIP !in (knownServers) \| summarize count() by DeviceIP, RemoteIP \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.ftp-* \| WHERE ftp.command IN ['STOR', 'RETR'] AND destination.ip NOT IN ['known_servers'] \| STATS COUNT() BY source.ip, destination.ip HAVING COUNT() > 5`. |
| 2. SFTP C2 Communication | Adversaries use SFTP for secure C2, as in Turla. | - Network Traffic (DS0003: Zeek SFTP)<br>- Firewall Logs | - **Splunk**: `index=network sourcetype=zeek_sftp command IN ("PUT", "GET") AND dest_ip NOT IN (known_servers) \| stats count by src_ip, dest_ip \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "SFTP" and AdditionalFields.Command in ("PUT", "GET") and RemoteIP !in (knownServers) \| summarize count() by DeviceIP, RemoteIP \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.sftp-* \| WHERE sftp.command IN ['PUT', 'GET'] AND destination.ip NOT IN ['known_servers'] \| STATS COUNT() BY source.ip, destination.ip HAVING COUNT() > 5`. |
| 3. FTP C2 from Compromised Endpoints | Compromised endpoints use FTP for C2, as in FIN7. | - Process Creation (DS0009: Sysmon ID 1)<br>- Network Traffic | - **Splunk**: `index=endpoint sourcetype=sysmon EventCode=1 CommandLine="*ftp*" \| join host [search index=network sourcetype=zeek_ftp command="STOR"] \| stats count by host, CommandLine, dest_ip \| where count > 3`.<br>- **KQL**: `DeviceProcessEvents \| where ProcessCommandLine contains "ftp" \| join kind=inner (DeviceNetworkEvents \| where Protocol == "FTP" and AdditionalFields.Command == "STOR") on DeviceName \| summarize count() by DeviceName, ProcessCommandLine, RemoteIP \| where count_ > 3`.<br>- **ELK**: `FROM logs-endpoint.process-* \| WHERE process.command_line : "*ftp*" \| JOIN logs-zeek.ftp-* ON host.name WHERE ftp.command = 'STOR' \| STATS COUNT() BY host.name, process.command_line, destination.ip HAVING COUNT() > 3`. |
| 4. FTP C2 with Anomalous Timing | FTP C2 with unusual timing, as in 2025 trends. | - Network Traffic (DS0003: Zeek FTP)<br>- Metrics | - **Splunk**: `index=network sourcetype=zeek_ftp \| timechart span=1h count \| where count > avg(count)*4`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "FTP" \| summarize HourlyCount=count() by bin(Timestamp, 1h) \| where HourlyCount > avg(HourlyCount) * 4`.<br>- **ELK**: `FROM logs-zeek.ftp-* \| STATS COUNT() BY date_histogram(@timestamp, '1h') \| WHERE COUNT() > AVG(COUNT()) * 4`. |
| 5. FTP C2 with Encrypted Payloads | Encrypted payloads in FTP C2, as in APT41. | - Network Traffic (DS0003: Zeek FTP)<br>- Packet Analysis | - **Splunk**: `index=network sourcetype=zeek_ftp payload_entropy > 7 \| stats count by src_ip, command \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "FTP" and AdditionalFields.PayloadEntropy > 7 \| summarize count() by DeviceIP, AdditionalFields.Command \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.ftp-* \| WHERE ftp.payload.entropy > 7 \| STATS COUNT() BY source.ip, ftp.command HAVING COUNT() > 5`. |
| 6. FTP C2 in Cloud Environments | FTP C2 in cloud, as in 2025 trends. | - Cloud Audit Logs (AWS CloudTrail)<br>- Network Traffic | - **Splunk**: `index=cloud sourcetype=aws:cloudtrail eventName="Invoke" AND userIdentity NOT IN (authorized_users) \| stats count by userIdentity, src_ip \| where count > 5`.<br>- **KQL**: `AWSCloudTrail \| where EventName == "Invoke" and Caller !in (authorizedUsers) \| summarize count() by Caller, SourceIP \| where count_ > 5`.<br>- **ELK**: `FROM logs-aws.cloudtrail-* \| WHERE event.action = 'Invoke' AND user.identity NOT IN ['authorized_users'] \| STATS COUNT() BY user.identity, source.ip HAVING COUNT() > 5`. |
| 7. FTP C2 with Suspicious Headers | FTP C2 with custom headers, as in Cobalt Strike. | - Network Traffic (DS0003: Zeek FTP)<br>- Proxy Logs | - **Splunk**: `index=network sourcetype=zeek_ftp header IN ("*X-Cobalt*", "*Custom-Header*") \| stats count by src_ip, header \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "FTP" and AdditionalFields.Header has_any ("X-Cobalt", "Custom-Header") \| summarize count() by DeviceIP, AdditionalFields.Header \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.ftp-* \| WHERE ftp.header : ("*X-Cobalt*" OR "*Custom-Header*") \| STATS COUNT() BY source.ip, ftp.header HAVING COUNT() > 5`. |
| 8. FTP C2 in Non-Standard Environments | FTP C2 in Linux, as in Turla. | - Network Traffic (DS0003: Zeek FTP)<br>- Linux Logs | - **Splunk**: `index=linux sourcetype=auditd syscall="connect" AND dest_port=21 AND exe NOT IN (known_apps) \| stats count by exe, dest_ip \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where RemotePort == 21 and InitiatingProcessName !in (knownApps) \| summarize count() by InitiatingProcessName, RemoteIP \| where count_ > 5`.<br>- **ELK**: `FROM logs-auditd-* \| WHERE syscall.name = "connect" AND destination.port = 21 AND process.exe NOT IN ['known_apps'] \| STATS COUNT() BY process.exe, destination.ip HAVING COUNT() > 5`. |
| 9. FTP C2 with Multi-Stage Redirects | FTP C2 with redirects, as in APT41. | - Network Traffic (DS0003: Zeek FTP)<br>- Redirect Analysis | - **Splunk**: `index=network sourcetype=zeek_ftp status_code=302 \| stats count by src_ip, command \| where count > 3`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "FTP" and AdditionalFields.StatusCode == 302 \| summarize count() by DeviceIP, AdditionalFields.Command \| where count_ > 3`.<br>- **ELK**: `FROM logs-zeek.ftp-* \| WHERE ftp.status = 302 \| STATS COUNT() BY source.ip, ftp.command HAVING COUNT() > 3`. |
| 10. FTP C2 with Anomalous User Agents | FTP C2 with unusual user agents, as in Cobalt Strike. | - Network Traffic (DS0003: Zeek FTP)<br>- Proxy Logs | - **Splunk**: `index=network sourcetype=zeek_ftp user_agent NOT IN (known_agents) \| stats count by src_ip, user_agent \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "FTP" and AdditionalFields.UserAgent !in (knownAgents) \| summarize count() by DeviceIP, AdditionalFields.UserAgent \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.ftp-* \| WHERE ftp.user_agent NOT IN ['known_agents'] \| STATS COUNT() BY source.ip, ftp.user_agent HAVING COUNT() > 5`. |
| 11. FTP C2 in Cloud Environments | FTP C2 in cloud, as in 2025 trends. | - Cloud Audit Logs (AWS CloudTrail)<br>- Network Traffic | - **Splunk**: `index=cloud sourcetype=aws:cloudtrail eventName="Invoke" AND userIdentity NOT IN (authorized_users) \| stats count by userIdentity, src_ip \| where count > 5`.<br>- **KQL**: `AWSCloudTrail \| where EventName == "Invoke" and Caller !in (authorizedUsers) \| summarize count() by Caller, SourceIP \| where count_ > 5`.<br>- **ELK**: `FROM logs-aws.cloudtrail-* \| WHERE event.action = 'Invoke' AND user.identity NOT IN ['authorized_users'] \| STATS COUNT() BY user.identity, source.ip HAVING COUNT() > 5`. |
| 12. FTP C2 with Suspicious Headers | FTP C2 with custom headers, as in Cobalt Strike. | - Network Traffic (DS0003: Zeek FTP)<br>- Proxy Logs | - **Splunk**: `index=network sourcetype=zeek_ftp header IN ("*X-Cobalt*", "*Custom-Header*") \| stats count by src_ip, header \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "FTP" and AdditionalFields.Header has_any ("X-Cobalt", "Custom-Header") \| summarize count() by DeviceIP, AdditionalFields.Header \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.ftp-* \| WHERE ftp.header : ("*X-Cobalt*" OR "*Custom-Header*") \| STATS COUNT() BY source.ip, ftp.header HAVING COUNT() > 5`. |
| 13. FTP C2 in Non-Standard Environments | FTP C2 in Linux, as in Turla. | - Network Traffic (DS0003: Zeek FTP)<br>- Linux Logs | - **Splunk**: `index=linux sourcetype=auditd syscall="connect" AND dest_port=21 AND exe NOT IN (known_apps) \| stats count by exe, dest_ip \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where RemotePort == 21 and InitiatingProcessName !in (knownApps) \| summarize count() by InitiatingProcessName, RemoteIP \| where count_ > 5`.<br>- **ELK**: `FROM logs-auditd-* \| WHERE syscall.name = "connect" AND destination.port = 21 AND process.exe NOT IN ['known_apps'] \| STATS COUNT() BY process.exe, destination.ip HAVING COUNT() > 5`. |
| 14. FTP C2 with Multi-Stage Redirects | FTP C2 with redirects, as in APT41. | - Network Traffic (DS0003: Zeek FTP)<br>- Redirect Analysis | - **Splunk**: `index=network sourcetype=zeek_ftp status_code=302 \| stats count by src_ip, command \| where count > 3`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "FTP" and AdditionalFields.StatusCode == 302 \| summarize count() by DeviceIP, AdditionalFields.Command \| where count_ > 3`.<br>- **ELK**: `FROM logs-zeek.ftp-* \| WHERE ftp.status = 302 \| STATS COUNT() BY source.ip, ftp.command HAVING COUNT() > 3`. |
| 15. FTP C2 with Anomalous User Agents | FTP C2 with unusual user agents, as in Cobalt Strike. | - Network Traffic (DS0003: Zeek FTP)<br>- Proxy Logs | - **Splunk**: `index=network sourcetype=zeek_ftp user_agent NOT IN (known_agents) \| stats count by src_ip, user_agent \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "FTP" and AdditionalFields.UserAgent !in (knownAgents) \| summarize count() by DeviceIP, AdditionalFields.UserAgent \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.ftp-* \| WHERE ftp.user_agent NOT IN ['known_agents'] \| STATS COUNT() BY source.ip, ftp.user_agent HAVING COUNT() > 5`. | 

### Hide Infrastructure (T1564)

| Hypothesis | Description | Data Sources | Hunting Queries |
|------------|-------------|--------------|-----------------|
| 1. Hidden Files for C2 Infrastructure | Adversaries hide C2 files in hidden directories, as in APT41. High risk in Windows and Linux environments. | - File Creation (DS0022: Sysmon ID 11)<br>- File Metadata | - **Splunk**: `index=endpoint sourcetype=sysmon EventCode=11 FileAttributes="*hidden*" AND FilePath="*c2*" \| stats count by FilePath, host \| where count > 3`.<br>- **KQL**: `DeviceFileEvents \| where ActionType == "FileCreated" and AdditionalFields.FileAttributes contains "hidden" and FolderPath contains "c2" \| summarize count() by FileName, DeviceName \| where count_ > 3`.<br>- **ELK**: `FROM logs-endpoint.file-* \| WHERE event.action = "creation" AND file.attributes : "*hidden*" AND file.path : "*c2*" \| STATS COUNT() BY file.name, host.name HAVING COUNT() > 3`. |
| 2. Hidden C2 in Cloud Infrastructure | Hidden C2 in cloud, as in 2025 trends. | - Cloud Audit Logs (AWS CloudTrail)<br>- Network Traffic | - **Splunk**: `index=cloud sourcetype=aws:cloudtrail eventName="CreateInstance" AND userIdentity NOT IN (authorized_users) \| stats count by userIdentity, src_ip \| where count > 5`.<br>- **KQL**: `AWSCloudTrail \| where EventName == "CreateInstance" and Caller !in (authorizedUsers) \| summarize count() by Caller, SourceIP \| where count_ > 5`.<br>- **ELK**: `FROM logs-aws.cloudtrail-* \| WHERE event.action = 'CreateInstance' AND user.identity NOT IN ['authorized_users'] \| STATS COUNT() BY user.identity, source.ip HAVING COUNT() > 5`. |
| 3. Hidden C2 with Anomalous Timing | Hidden C2 with unusual timing, as in 2025 trends. | - Network Traffic (DS0003: Zeek Conn)<br>- Metrics | - **Splunk**: `index=network sourcetype=zeek_conn \| timechart span=1h count \| where count > avg(count)*4`.<br>- **KQL**: `DeviceNetworkEvents \| summarize HourlyCount=count() by bin(Timestamp, 1h) \| where HourlyCount > avg(HourlyCount) * 4`.<br>- **ELK**: `FROM logs-zeek.conn-* \| STATS COUNT() BY date_histogram(@timestamp, '1h') \| WHERE COUNT() > AVG(COUNT()) * 4`. |
| 4. Hidden C2 from Compromised Endpoints | Compromised endpoints hide C2 infrastructure, as in FIN7. | - Process Creation (DS0009: Sysmon ID 1)<br>- Network Traffic | - **Splunk**: `index=endpoint sourcetype=sysmon EventCode=1 CommandLine="*hide*" \| join host [search index=network sourcetype=zeek_conn dest_port=443] \| stats count by host, CommandLine, dest_ip \| where count > 3`.<br>- **KQL**: `DeviceProcessEvents \| where ProcessCommandLine contains "hide" \| join kind=inner (DeviceNetworkEvents \| where RemotePort == 443) on DeviceName \| summarize count() by DeviceName, ProcessCommandLine, RemoteIP \| where count_ > 3`.<br>- **ELK**: `FROM logs-endpoint.process-* \| WHERE process.command_line : "*hide*" \| JOIN logs-zeek.conn-* ON host.name WHERE destination.port = 443 \| STATS COUNT() BY host.name, process.command_line, destination.ip HAVING COUNT() > 3`. |
| 5. Hidden C2 with Encrypted Payloads | Encrypted payloads in hidden C2, as in APT41. | - Network Traffic (DS0003: Zeek HTTP)<br>- Packet Analysis | - **Splunk**: `index=network sourcetype=zeek_http payload_entropy > 7 \| stats count by src_ip, uri \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "HTTP" and AdditionalFields.PayloadEntropy > 7 \| summarize count() by DeviceIP, RemoteUrl \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE http.payload.entropy > 7 \| STATS COUNT() BY source.ip, http.uri HAVING COUNT() > 5`. |
| 6. Hidden C2 in Cloud Environments | Hidden C2 in cloud, as in 2025 trends. | - Cloud Audit Logs (AWS CloudTrail)<br>- Network Traffic | - **Splunk**: `index=cloud sourcetype=aws:cloudtrail eventName="Invoke" AND userIdentity NOT IN (authorized_users) \| stats count by userIdentity, src_ip \| where count > 5`.<br>- **KQL**: `AWSCloudTrail \| where EventName == "Invoke" and Caller !in (authorizedUsers) \| summarize count() by Caller, SourceIP \| where count_ > 5`.<br>- **ELK**: `FROM logs-aws.cloudtrail-* \| WHERE event.action = 'Invoke' AND user.identity NOT IN ['authorized_users'] \| STATS COUNT() BY user.identity, source.ip HAVING COUNT() > 5`. |
| 8. Hidden C2 with Suspicious Headers | Hidden C2 with custom headers, as in Cobalt Strike. | - Network Traffic (DS0003: Zeek HTTP)<br>- Proxy Logs | - **Splunk**: `index=network sourcetype=zeek_http header IN ("*X-Cobalt*", "*Custom-Header*") \| stats count by src_ip, header \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "HTTP" and AdditionalFields.Header has_any ("X-Cobalt", "Custom-Header") \| summarize count() by DeviceIP, AdditionalFields.Header \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE http.header : ("*X-Cobalt*" OR "*Custom-Header*") \| STATS COUNT() BY source.ip, http.header HAVING COUNT() > 5`. |
| 9. Hidden C2 in Non-Standard Environments | Hidden C2 in Linux, as in Turla. | - Network Traffic (DS0003: Zeek Conn)<br>- Linux Logs | - **Splunk**: `index=linux sourcetype=auditd syscall="connect" AND dest_port=443 AND exe NOT IN (known_apps) \| stats count by exe, dest_ip \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where RemotePort == 443 and InitiatingProcessName !in (knownApps) \| summarize count() by InitiatingProcessName, RemoteIP \| where count_ > 5`.<br>- **ELK**: `FROM logs-auditd-* \| WHERE syscall.name = "connect" AND destination.port = 443 AND process.exe NOT IN ['known_apps'] \| STATS COUNT() BY process.exe, destination.ip HAVING COUNT() > 5`. |
| 10. Hidden C2 with Multi-Stage Redirects | Hidden C2 with redirects, as in APT41. | - Network Traffic (DS0003: Zeek HTTP)<br>- Redirect Analysis | - **Splunk**: `index=network sourcetype=zeek_http status_code=302 \| stats count by src_ip, uri \| where count > 3`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "HTTP" and AdditionalFields.StatusCode == 302 \| summarize count() by DeviceIP, RemoteUrl \| where count_ > 3`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE http.status = 302 \| STATS COUNT() BY source.ip, http.uri HAVING COUNT() > 3`. |
| 11. Hidden C2 with Anomalous User Agents | Hidden C2 with unusual user agents, as in Cobalt Strike. | - Network Traffic (DS0003: Zeek HTTP)<br>- Proxy Logs | - **Splunk**: `index=network sourcetype=zeek_http user_agent NOT IN (known_agents) \| stats count by src_ip, user_agent \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "HTTP" and AdditionalFields.UserAgent !in (knownAgents) \| summarize count() by DeviceIP, AdditionalFields.UserAgent \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE http.user_agent NOT IN ['known_agents'] \| STATS COUNT() BY source.ip, http.user_agent HAVING COUNT() > 5`. |
| 12. Hidden C2 in Cloud Environments | Hidden C2 in cloud, as in 2025 trends. | - Cloud Audit Logs (AWS CloudTrail)<br>- Network Traffic | - **Splunk**: `index=cloud sourcetype=aws:cloudtrail eventName="Invoke" AND userIdentity NOT IN (authorized_users) \| stats count by userIdentity, src_ip \| where count > 5`.<br>- **KQL**: `AWSCloudTrail \| where EventName == "Invoke" and Caller !in (authorizedUsers) \| summarize count() by Caller, SourceIP \| where count_ > 5`.<br>- **ELK**: `FROM logs-aws.cloudtrail-* \| WHERE event.action = 'Invoke' AND user.identity NOT IN ['authorized_users'] \| STATS COUNT() BY user.identity, source.ip HAVING COUNT() > 5`. |
| 13. Hidden C2 with Anomalous Timing | Hidden C2 with unusual timing, as in 2025 trends. | - Network Traffic (DS0003: Zeek Conn)<br>- Metrics | - **Splunk**: `index=network sourcetype=zeek_conn \| timechart span=1h count \| where count > avg(count)*4`.<br>- **KQL**: `DeviceNetworkEvents \| summarize HourlyCount=count() by bin(Timestamp, 1h) \| where HourlyCount > avg(HourlyCount) * 4`.<br>- **ELK**: `FROM logs-zeek.conn-* \| STATS COUNT() BY date_histogram(@timestamp, '1h') \| WHERE COUNT() > AVG(COUNT()) * 4`. |
| 14. Hidden C2 with Suspicious Headers | Hidden C2 with custom headers, as in Cobalt Strike. | - Network Traffic (DS0003: Zeek HTTP)<br>- Proxy Logs | - **Splunk**: `index=network sourcetype=zeek_http header IN ("*X-Cobalt*", "*Custom-Header*") \| stats count by src_ip, header \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "HTTP" and AdditionalFields.Header has_any ("X-Cobalt", "Custom-Header") \| summarize count() by DeviceIP, AdditionalFields.Header \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE http.header : ("*X-Cobalt*" OR "*Custom-Header*") \| STATS COUNT() BY source.ip, http.header HAVING COUNT() > 5`. |
| 15. Hidden C2 with Encrypted Payloads | Encrypted payloads in hidden C2, as in APT41. | - Network Traffic (DS0003: Zeek HTTP)<br>- Packet Analysis | - **Splunk**: `index=network sourcetype=zeek_http payload_entropy > 7 \| stats count by src_ip, uri \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "HTTP" and AdditionalFields.PayloadEntropy > 7 \| summarize count() by DeviceIP, RemoteUrl \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE http.payload.entropy > 7 \| STATS COUNT() BY source.ip, http.uri HAVING COUNT() > 5`. ## Fast Flux DNS (T1568.001)


### IDE Tunneling (T1572)

| Hypothesis | Description | Data Sources | Hunting Queries |
|------------|-------------|--------------|-----------------|
| 1. ICMP Tunneling for C2 | Adversaries use ICMP tunneling for C2, as in APT41. High risk in environments with limited ICMP monitoring. | - Network Traffic (DS0003: Zeek ICMP)<br>- Firewall Logs | - **Splunk**: `index=network sourcetype=zeek_icmp type="echo" AND payload_length > 100 \| stats count by src_ip, dest_ip \| where count > 5` (Detects large ICMP payloads indicative of tunneling).<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "ICMP" and AdditionalFields.Type == "echo" and AdditionalFields.PayloadLength > 100 \| summarize count() by DeviceIP, RemoteIP \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.icmp-* \| WHERE icmp.type = 'echo' AND icmp.payload.length > 100 \| STATS COUNT() BY source.ip, destination.ip HAVING COUNT() > 5`. |
| 2. ICMP Tunneling with Encrypted Payloads | Encrypted payloads in ICMP tunneling, as in Turla. | - Network Traffic (DS0003: Zeek ICMP)<br>- Packet Analysis | - **Splunk**: `index=network sourcetype=zeek_icmp payload_entropy > 7 \| stats count by src_ip \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "ICMP" and AdditionalFields.PayloadEntropy > 7 \| summarize count() by DeviceIP \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.icmp-* \| WHERE icmp.payload.entropy > 7 \| STATS COUNT() BY source.ip HAVING COUNT() > 5`. |
| 3. ICMP Tunneling from Compromised Endpoints | Compromised endpoints use ICMP tunneling, as in FIN7. | - Process Creation (DS0009: Sysmon ID 1)<br>- Network Traffic | - **Splunk**: `index=endpoint sourcetype=sysmon EventCode=1 CommandLine="*icmp*" \| join host [search index=network sourcetype=zeek_icmp payload_length > 100] \| stats count by host, CommandLine, dest_ip \| where count > 3`.<br>- **KQL**: `DeviceProcessEvents \| where ProcessCommandLine contains "icmp" \| join kind=inner (DeviceNetworkEvents \| where Protocol == "ICMP" and AdditionalFields.PayloadLength > 100) on DeviceName \| summarize count() by DeviceName, ProcessCommandLine, RemoteIP \| where count_ > 3`.<br>- **ELK**: `FROM logs-endpoint.process-* \| WHERE process.command_line : "*icmp*" \| JOIN logs-zeek.icmp-* ON host.name WHERE icmp.payload.length > 100 \| STATS COUNT() BY host.name, process.command_line, destination.ip HAVING COUNT() > 3`. |
| 4. ICMP Tunneling with Anomalous Timing | ICMP tunneling with unusual timing, as in 2025 trends. | - Network Traffic (DS0003: Zeek ICMP)<br>- Metrics | - **Splunk**: `index=network sourcetype=zeek_icmp \| timechart span=1h count \| where count > avg(count)*4`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "ICMP" \| summarize HourlyCount=count() by bin(Timestamp, 1h) \| where HourlyCount > avg(HourlyCount) * 4`.<br>- **ELK**: `FROM logs-zeek.icmp-* \| STATS COUNT() BY date_histogram(@timestamp, '1h') \| WHERE COUNT() > AVG(COUNT()) * 4`. |
| 5. ICMP Tunneling with Encrypted Payloads | Encrypted payloads in ICMP tunneling, as in APT41. | - Network Traffic (DS0003: Zeek ICMP)<br>- Packet Analysis | - **Splunk**: `index=network sourcetype=zeek_icmp payload_entropy > 7 \| stats count by src_ip \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "ICMP" and AdditionalFields.PayloadEntropy > 7 \| summarize count() by DeviceIP \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.icmp-* \| WHERE icmp.payload.entropy > 7 \| STATS COUNT() BY source.ip HAVING COUNT() > 5`. |
| 6. ICMP Tunneling in Cloud Environments | ICMP tunneling in cloud, as in 2025 trends. | - Cloud Audit Logs (AWS CloudTrail)<br>- Network Traffic | - **Splunk**: `index=cloud sourcetype=aws:cloudtrail eventName="Invoke" AND userIdentity NOT IN (authorized_users) \| stats count by userIdentity, src_ip \| where count > 5`.<br>- **KQL**: `AWSCloudTrail \| where EventName == "Invoke" and Caller !in (authorizedUsers) \| summarize count() by Caller, SourceIP \| where count_ > 5`.<br>- **ELK**: `FROM logs-aws.cloudtrail-* \| WHERE event.action = 'Invoke' AND user.identity NOT IN ['authorized_users'] \| STATS COUNT() BY user.identity, source.ip HAVING COUNT() > 5`. |
| 7. ICMP Tunneling with Suspicious Headers | ICMP tunneling with custom headers, as in Cobalt Strike. | - Network Traffic (DS0003: Zeek ICMP)<br>- Proxy Logs | - **Splunk**: `index=network sourcetype=zeek_icmp header IN ("*X-Cobalt*", "*Custom-Header*") \| stats count by src_ip, header \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "ICMP" and AdditionalFields.Header has_any ("X-Cobalt", "Custom-Header") \| summarize count() by DeviceIP, AdditionalFields.Header \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.icmp-* \| WHERE icmp.header : ("*X-Cobalt*" OR "*Custom-Header*") \| STATS COUNT() BY source.ip, icmp.header HAVING COUNT() > 5`. |
| 8. ICMP Tunneling in Non-Standard Environments | ICMP tunneling in Linux, as in Turla. | - Network Traffic (DS0003: Zeek ICMP)<br>- Linux Logs | - **Splunk**: `index=linux sourcetype=auditd syscall="sendto" AND dest_port=0 AND exe NOT IN (known_apps) \| stats count by exe, dest_ip \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "ICMP" and InitiatingProcessName !in (knownApps) \| summarize count() by InitiatingProcessName, RemoteIP \| where count_ > 5`.<br>- **ELK**: `FROM logs-auditd-* \| WHERE syscall.name = "sendto" AND destination.port = 0 AND process.exe NOT IN ['known_apps'] \| STATS COUNT() BY process.exe, destination.ip HAVING COUNT() > 5`. |
| 9. ICMP Tunneling with Anomalous Timing | ICMP tunneling with unusual timing, as in 2025 trends. | - Network Traffic (DS0003: Zeek ICMP)<br>- Metrics | - **Splunk**: `index=network sourcetype=zeek_icmp \| timechart span=1h count \| where count > avg(count)*4`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "ICMP" \| summarize HourlyCount=count() by bin(Timestamp, 1h) \| where HourlyCount > avg(HourlyCount) * 4`.<br>- **ELK**: `FROM logs-zeek.icmp-* \| STATS COUNT() BY date_histogram(@timestamp, '1h') \| WHERE COUNT() > AVG(COUNT()) * 4`. |
| 10. ICMP Tunneling with Suspicious Headers | ICMP tunneling with custom headers, as in Cobalt Strike. | - Network Traffic (DS0003: Zeek ICMP)<br>- Proxy Logs | - **Splunk**: `index=network sourcetype=zeek_icmp header IN ("*X-Cobalt*", "*Custom-Header*") \| stats count by src_ip, header \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "ICMP" and AdditionalFields.Header has_any ("X-Cobalt", "Custom-Header") \| summarize count() by DeviceIP, AdditionalFields.Header \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.icmp-* \| WHERE icmp.header : ("*X-Cobalt*" OR "*Custom-Header*") \| STATS COUNT() BY source.ip, icmp.header HAVING COUNT() > 5`. |
| 11. ICMP Tunneling with Encrypted Payloads | Encrypted payloads in ICMP tunneling, as in APT41. | - Network Traffic (DS0003: Zeek ICMP)<br>- Packet Analysis | - **Splunk**: `index=network sourcetype=zeek_icmp payload_entropy > 7 \| stats count by src_ip \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "ICMP" and AdditionalFields.PayloadEntropy > 7 \| summarize count() by DeviceIP \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.icmp-* \| WHERE icmp.payload.entropy > 7 \| STATS COUNT() BY source.ip HAVING COUNT() > 5`. |
| 12. ICMP Tunneling in Cloud Environments | ICMP tunneling in cloud, as in 2025 trends. | - Cloud Audit Logs (AWS CloudTrail)<br>- Network Traffic | - **Splunk**: `index=cloud sourcetype=aws:cloudtrail eventName="Invoke" AND userIdentity NOT IN (authorized_users) \| stats count by userIdentity, src_ip \| where count > 5`.<br>- **KQL**: `AWSCloudTrail \| where EventName == "Invoke" and Caller !in (authorizedUsers) \| summarize count() by Caller, SourceIP \| where count_ > 5`.<br>- **ELK**: `FROM logs-aws.cloudtrail-* \| WHERE event.action = 'Invoke' AND user.identity NOT IN ['authorized_users'] \| STATS COUNT() BY user.identity, source.ip HAVING COUNT() > 5`. |
| 13. ICMP Tunneling with Anomalous Timing | ICMP tunneling with unusual timing, as in 2025 trends. | - Network Traffic (DS0003: Zeek ICMP)<br>- Metrics | - **Splunk**: `index=network sourcetype=zeek_icmp \| timechart span=1h count \| where count > avg(count)*4`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "ICMP" \| summarize HourlyCount=count() by bin(Timestamp, 1h) \| where HourlyCount > avg(HourlyCount) * 4`.<br>- **ELK**: `FROM logs-zeek.icmp-* \| STATS COUNT() BY date_histogram(@timestamp, '1h') \| WHERE COUNT() > AVG(COUNT()) * 4`. |
| 14. ICMP Tunneling with Suspicious Headers | ICMP tunneling with custom headers, as in Cobalt Strike. | - Network Traffic (DS0003: Zeek ICMP)<br>- Proxy Logs | - **Splunk**: `index=network sourcetype=zeek_icmp header IN ("*X-Cobalt*", "*Custom-Header*") \| stats count by src_ip, header \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "ICMP" and AdditionalFields.Header has_any ("X-Cobalt", "Custom-Header") \| summarize count() by DeviceIP, AdditionalFields.Header \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.icmp-* \| WHERE icmp.header : ("*X-Cobalt*" OR "*Custom-Header*") \| STATS COUNT() BY source.ip, icmp.header HAVING COUNT() > 5`. |
| 15. ICMP Tunneling with Encrypted Payloads | Encrypted payloads in ICMP tunneling, as in APT41. | - Network Traffic (DS0003: Zeek ICMP)<br>- Packet Analysis | - **Splunk**: `index=network sourcetype=zeek_icmp payload_entropy > 7 \| stats count by src_ip \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "ICMP" and AdditionalFields.PayloadEntropy > 7 \| summarize count() by DeviceIP \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.icmp-* \| WHERE icmp.payload.entropy > 7 \| STATS COUNT() BY source.ip HAVING COUNT() > 5`.

### Ingress Tool Transfer (T1105)

| Hypothesis | Description | Data Sources | Hunting Queries |
|------------|-------------|--------------|-----------------|
| 1. Suspicious Download from Known C2 Domains | Adversaries transfer tools via HTTP/HTTPS from known C2 domains, as in Cobalt Strike campaigns. High risk in Windows environments with limited web filtering. | - Network Traffic (DS0003: Zeek HTTP)<br>- Endpoint Logs | - **Splunk**: `index=network sourcetype=zeek_http method="GET" AND uri="*tool.exe*" AND host IN (known_c2_domains) \| stats count by src_ip, host \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "HTTP" and AdditionalFields.Method == "GET" and RemoteUrl contains "tool.exe" and AdditionalFields.Host in (knownC2Domains) \| summarize count() by DeviceIP, AdditionalFields.Host \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE http.method = 'GET' AND http.uri : "*tool.exe*" AND http.host IN ['known_c2_domains'] \| STATS COUNT() BY source.ip, http.host HAVING COUNT() > 5`. |
| 2. Tool Transfer via FTP/SFTP | Adversaries use FTP for ingress tool transfer, as in APT41 attacks. | - Network Traffic (DS0003: Zeek FTP)<br>- Firewall Logs | - **Splunk**: `index=network sourcetype=zeek_ftp command="RETR" AND file_name="*tool.exe*" \| stats count by src_ip, file_name \| where count > 3`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "FTP" and AdditionalFields.Command == "RETR" and AdditionalFields.FileName contains "tool.exe" \| summarize count() by DeviceIP, AdditionalFields.FileName \| where count_ > 3`.<br>- **ELK**: `FROM logs-zeek.ftp-* \| WHERE ftp.command = 'RETR' AND ftp.file.name : "*tool.exe*" \| STATS COUNT() BY source.ip, ftp.file.name HAVING COUNT() > 3`. |
| 3. Ingress Tool Transfer from Compromised Endpoints | Compromised endpoints download tools from external sources, as in FIN7. | - Process Creation (DS0009: Sysmon ID 1)<br>- Network Traffic | - **Splunk**: `index=endpoint sourcetype=sysmon EventCode=1 CommandLine="*download*" \| join host [search index=network sourcetype=zeek_http method="GET"] \| stats count by host, CommandLine, uri \| where count > 3`.<br>- **KQL**: `DeviceProcessEvents \| where ProcessCommandLine contains "download" \| join kind=inner (DeviceNetworkEvents \| where Protocol == "HTTP" and AdditionalFields.Method == "GET") on DeviceName \| summarize count() by DeviceName, ProcessCommandLine, RemoteUrl \| where count_ > 3`.<br>- **ELK**: `FROM logs-endpoint.process-* \| WHERE process.command_line : "*download*" \| JOIN logs-zeek.http-* ON host.name WHERE http.method = 'GET' \| STATS COUNT() BY host.name, process.command_line, http.uri HAVING COUNT() > 3`. |
| 4. Ingress Tool Transfer with Anomalous Timing | Tool transfers during unusual times, as in 2025 trends. | - Network Traffic (DS0003: Zeek HTTP)<br>- Metrics | - **Splunk**: `index=network sourcetype=zeek_http method="GET" AND uri="*tool*" \| timechart span=1h count \| where count > avg(count)*4`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "HTTP" and AdditionalFields.Method == "GET" and RemoteUrl contains "tool" \| summarize HourlyCount=count() by bin(Timestamp, 1h) \| where HourlyCount > avg(HourlyCount) * 4`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE http.method = 'GET' AND http.uri : "*tool*" \| STATS COUNT() BY date_histogram(@timestamp, '1h') \| WHERE COUNT() > AVG(COUNT()) * 4`. |
| 5. Ingress Tool Transfer with Encrypted Payloads | Encrypted payloads in tool transfers, as in APT41. | - Network Traffic (DS0003: Zeek HTTP)<br>- Packet Analysis | - **Splunk**: `index=network sourcetype=zeek_http method="GET" AND payload_entropy > 7 \| stats count by src_ip, uri \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "HTTP" and AdditionalFields.Method == "GET" and AdditionalFields.PayloadEntropy > 7 \| summarize count() by DeviceIP, RemoteUrl \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE http.method = 'GET' AND http.payload.entropy > 7 \| STATS COUNT() BY source.ip, http.uri HAVING COUNT() > 5`. |
| 6. Ingress Tool Transfer in Cloud Environments | Tool transfers in cloud, as in 2025 trends. | - Cloud Audit Logs (AWS CloudTrail)<br>- Network Traffic | - **Splunk**: `index=cloud sourcetype=aws:cloudtrail eventName="GetObject" AND userIdentity NOT IN (authorized_users) \| stats count by userIdentity, src_ip \| where count > 5`.<br>- **KQL**: `AWSCloudTrail \| where EventName == "GetObject" and Caller !in (authorizedUsers) \| summarize count() by Caller, SourceIP \| where count_ > 5`.<br>- **ELK**: `FROM logs-aws.cloudtrail-* \| WHERE event.action = 'GetObject' AND user.identity NOT IN ['authorized_users'] \| STATS COUNT() BY user.identity, source.ip HAVING COUNT() > 5`. |
| 7. Ingress Tool Transfer with Suspicious Headers | Tool transfers with custom headers, as in Cobalt Strike. | - Network Traffic (DS0003: Zeek HTTP)<br>- Proxy Logs | - **Splunk**: `index=network sourcetype=zeek_http header IN ("*X-Cobalt*", "*Custom-Header*") \| stats count by src_ip, header \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "HTTP" and AdditionalFields.Header has_any ("X-Cobalt", "Custom-Header") \| summarize count() by DeviceIP, AdditionalFields.Header \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE http.header : ("*X-Cobalt*" OR "*Custom-Header*") \| STATS COUNT() BY source.ip, http.header HAVING COUNT() > 5`. |
| 8. Ingress Tool Transfer in Non-Standard Environments | Tool transfers in Linux, as in Turla. | - Network Traffic (DS0003: Zeek HTTP)<br>- Linux Logs | - **Splunk**: `index=linux sourcetype=auditd syscall="connect" AND dest_port IN (80, 443) AND exe NOT IN (known_apps) \| stats count by exe, dest_ip \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where RemotePort in (80, 443) and InitiatingProcessName !in (knownApps) \| summarize count() by InitiatingProcessName, RemoteIP \| where count_ > 5`.<br>- **ELK**: `FROM logs-auditd-* \| WHERE syscall.name = "connect" AND destination.port IN [80, 443] AND process.exe NOT IN ['known_apps'] \| STATS COUNT() BY process.exe, destination.ip HAVING COUNT() > 5`. |
| 9. Ingress Tool Transfer with Multi-Stage Redirects | Tool transfers with redirects, as in APT41. | - Network Traffic (DS0003: Zeek HTTP)<br>- Redirect Analysis | - **Splunk**: `index=network sourcetype=zeek_http status_code=302 \| stats count by src_ip, uri \| where count > 3`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "HTTP" and AdditionalFields.StatusCode == 302 \| summarize count() by DeviceIP, RemoteUrl \| where count_ > 3`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE http.status = 302 \| STATS COUNT() BY source.ip, http.uri HAVING COUNT() > 3`. |
| 10. Ingress Tool Transfer with Anomalous User Agents | Tool transfers with unusual user agents, as in Cobalt Strike. | - Network Traffic (DS0003: Zeek HTTP)<br>- Proxy Logs | - **Splunk**: `index=network sourcetype=zeek_http user_agent NOT IN (known_agents) \| stats count by src_ip, user_agent \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "HTTP" and AdditionalFields.UserAgent !in (knownAgents) \| summarize count() by DeviceIP, AdditionalFields.UserAgent \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE http.user_agent NOT IN ['known_agents'] \| STATS COUNT() BY source.ip, http.user_agent HAVING COUNT() > 5`. |
| 11. Ingress Tool Transfer in Cloud Environments | Tool transfers in cloud, as in 2025 trends. | - Cloud Audit Logs (AWS CloudTrail)<br>- Network Traffic | - **Splunk**: `index=cloud sourcetype=aws:cloudtrail eventName="GetObject" AND userIdentity NOT IN (authorized_users) \| stats count by userIdentity, src_ip \| where count > 5`.<br>- **KQL**: `AWSCloudTrail \| where EventName == "GetObject" and Caller !in (authorizedUsers) \| summarize count() by Caller, SourceIP \| where count_ > 5`.<br>- **ELK**: `FROM logs-aws.cloudtrail-* \| WHERE event.action = 'GetObject' AND user.identity NOT IN ['authorized_users'] \| STATS COUNT() BY user.identity, source.ip HAVING COUNT() > 5`. |
| 12. Ingress Tool Transfer with Suspicious Headers | Tool transfers with custom headers, as in Cobalt Strike. | - Network Traffic (DS0003: Zeek HTTP)<br>- Proxy Logs | - **Splunk**: `index=network sourcetype=zeek_http header IN ("*X-Cobalt*", "*Custom-Header*") \| stats count by src_ip, header \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "HTTP" and AdditionalFields.Header has_any ("X-Cobalt", "Custom-Header") \| summarize count() by DeviceIP, AdditionalFields.Header \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE http.header : ("*X-Cobalt*" OR "*Custom-Header*") \| STATS COUNT() BY source.ip, http.header HAVING COUNT() > 5`. |
| 13. Ingress Tool Transfer in Non-Standard Environments | Tool transfers in Linux, as in Turla. | - Network Traffic (DS0003: Zeek HTTP)<br>- Linux Logs | - **Splunk**: `index=linux sourcetype=auditd syscall="connect" AND dest_port IN (80, 443) AND exe NOT IN (known_apps) \| stats count by exe, dest_ip \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where RemotePort in (80, 443) and InitiatingProcessName !in (knownApps) \| summarize count() by InitiatingProcessName, RemoteIP \| where count_ > 5`.<br>- **ELK**: `FROM logs-auditd-* \| WHERE syscall.name = "connect" AND destination.port IN [80, 443] AND process.exe NOT IN ['known_apps'] \| STATS COUNT() BY process.exe, destination.ip HAVING COUNT() > 5`. |
| 14. Ingress Tool Transfer with Multi-Stage Redirects | Tool transfers with redirects, as in APT41. | - Network Traffic (DS0003: Zeek HTTP)<br>- Redirect Analysis | - **Splunk**: `index=network sourcetype=zeek_http status_code=302 \| stats count by src_ip, uri \| where count > 3`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "HTTP" and AdditionalFields.StatusCode == 302 \| summarize count() by DeviceIP, RemoteUrl \| where count_ > 3`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE http.status = 302 \| STATS COUNT() BY source.ip, http.uri HAVING COUNT() > 3`. |
| 15. Ingress Tool Transfer with Anomalous User Agents | Tool transfers with unusual user agents, as in Cobalt Strike. | - Network Traffic (DS0003: Zeek HTTP)<br>- Proxy Logs | - **Splunk**: `index=network sourcetype=zeek_http user_agent NOT IN (known_agents) \| stats count by src_ip, user_agent \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "HTTP" and AdditionalFields.UserAgent !in (knownAgents) \| summarize count() by DeviceIP, AdditionalFields.UserAgent \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE http.user_agent NOT IN ['known_agents'] \| STATS COUNT() BY source.ip, http.user_agent HAVING COUNT() > 5`. |

### Junk Data (T1001.001)

| Hypothesis | Description | Data Sources | Hunting Queries |
|------------|-------------|--------------|-----------------|
| 1. Junk Data in C2 Payloads | Adversaries use junk data to pad C2 payloads, as in APT41. High risk in environments with limited payload inspection. | - Network Traffic (DS0003: Zeek HTTP)<br>- Packet Analysis | - **Splunk**: `index=network sourcetype=zeek_http payload_entropy < 1 \| stats count by src_ip, uri \| where count > 5` (Detects low-entropy payloads indicative of junk data).<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "HTTP" and AdditionalFields.PayloadEntropy < 1 \| summarize count() by DeviceIP, RemoteUrl \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE http.payload.entropy < 1 \| STATS COUNT() BY source.ip, http.uri HAVING COUNT() > 5`. |
| 2. Junk Data in DNS Queries | Junk data in DNS queries for C2, as in Turla. | - DNS Logs (DS0003: Zeek DNS)<br>- Network Traffic | - **Splunk**: `index=network sourcetype=zeek_dns query_entropy < 1 \| stats count by src_ip, query \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "DNS" and AdditionalFields.QueryEntropy < 1 \| summarize count() by DeviceIP, AdditionalFields.Query \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.dns-* \| WHERE dns.query.entropy < 1 \| STATS COUNT() BY source.ip, dns.query HAVING COUNT() > 5`. |
| 3. Junk Data with Anomalous Timing | Junk data transfers with unusual timing, as in 2025 trends. | - Network Traffic (DS0003: Zeek HTTP)<br>- Metrics | - **Splunk**: `index=network sourcetype=zeek_http payload_entropy < 1 \| timechart span=1h count \| where count > avg(count)*4`.<br>- **KQL**: `DeviceNetworkEvents \| where AdditionalFields.PayloadEntropy < 1 \| summarize HourlyCount=count() by bin(Timestamp, 1h) \| where HourlyCount > avg(HourlyCount) * 4`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE http.payload.entropy < 1 \| STATS COUNT() BY date_histogram(@timestamp, '1h') \| WHERE COUNT() > AVG(COUNT()) * 4`. |
| 4. Junk Data via Compromised Endpoints | Compromised endpoints send junk data for C2, as in Turla. | - Process Creation (DS0009: Sysmon ID 1)<br>- Network Traffic | - **Splunk**: `index=endpoint sourcetype=sysmon EventCode=1 CommandLine="*junk*" \| join host [search index=network sourcetype=zeek_http payload_entropy < 1] \| stats count by host, CommandLine, uri \| where count > 3`.<br>- **KQL**: `DeviceProcessEvents \| where ProcessCommandLine contains "junk" \| join kind=inner (DeviceNetworkEvents \| where AdditionalFields.PayloadEntropy < 1) on DeviceName \| summarize count() by DeviceName, ProcessCommandLine, RemoteUrl \| where count_ > 3`.<br>- **ELK**: `FROM logs-endpoint.process-* \| WHERE process.command_line : "*junk*" \| JOIN logs-zeek.http-* ON host.name WHERE http.payload.entropy < 1 \| STATS COUNT() BY host.name, process.command_line, http.uri HAVING COUNT() > 3`. |
| 5. Junk Data in Cloud Environments | Junk data in cloud C2, as in 2025 trends. | - Cloud Audit Logs (AWS CloudTrail)<br>- Network Traffic | - **Splunk**: `index=cloud sourcetype=aws:cloudtrail eventName="Invoke" AND userIdentity NOT IN (authorized_users) \| stats count by userIdentity, src_ip \| where count > 5`.<br>- **KQL**: `AWSCloudTrail \| where EventName == "Invoke" and Caller !in (authorizedUsers) \| summarize count() by Caller, SourceIP \| where count_ > 5`.<br>- **ELK**: `FROM logs-aws.cloudtrail-* \| WHERE event.action = 'Invoke' AND user.identity NOT IN ['authorized_users'] \| STATS COUNT() BY user.identity, source.ip HAVING COUNT() > 5`. |
| 6. Junk Data with Encrypted Payloads | Encrypted junk data, as in APT41. | - Network Traffic (DS0003: Zeek HTTP)<br>- Packet Analysis | - **Splunk**: `index=network sourcetype=zeek_http payload_entropy > 7 \| stats count by src_ip, uri \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "HTTP" and AdditionalFields.PayloadEntropy > 7 \| summarize count() by DeviceIP, RemoteUrl \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE http.payload.entropy > 7 \| STATS COUNT() BY source.ip, http.uri HAVING COUNT() > 5`. |
| 7. Junk Data in Non-Standard Environments | Junk data in Linux, as in Turla. | - Network Traffic (DS0003: Zeek HTTP)<br>- Linux Logs | - **Splunk**: `index=linux sourcetype=auditd syscall="sendto" AND dest_port IN (80, 443) AND exe NOT IN (known_apps) \| stats count by exe, dest_ip \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where RemotePort in (80, 443) and InitiatingProcessName !in (knownApps) \| summarize count() by InitiatingProcessName, RemoteIP \| where count_ > 5`.<br>- **ELK**: `FROM logs-auditd-* \| WHERE syscall.name = "sendto" AND destination.port IN [80, 443] AND process.exe NOT IN ['known_apps'] \| STATS COUNT() BY process.exe, destination.ip HAVING COUNT() > 5`. |
| 8. Junk Data with Anomalous Timing | Junk data with unusual timing, as in 2025 trends. | - Network Traffic (DS0003: Zeek HTTP)<br>- Metrics | - **Splunk**: `index=network sourcetype=zeek_http \| timechart span=1h count \| where count > avg(count)*4`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "HTTP" \| summarize HourlyCount=count() by bin(Timestamp, 1h) \| where HourlyCount > avg(HourlyCount) * 4`.<br>- **ELK**: `FROM logs-zeek.http-* \| STATS COUNT() BY date_histogram(@timestamp, '1h') \| WHERE COUNT() > AVG(COUNT()) * 4`. |
| 9. Junk Data with Suspicious Headers | Junk data with custom headers, as in Cobalt Strike. | - Network Traffic (DS0003: Zeek HTTP)<br>- Proxy Logs | - **Splunk**: `index=network sourcetype=zeek_http header IN ("*X-Cobalt*", "*Custom-Header*") \| stats count by src_ip, header \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "HTTP" and AdditionalFields.Header has_any ("X-Cobalt", "Custom-Header") \| summarize count() by DeviceIP, AdditionalFields.Header \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE http.header : ("*X-Cobalt*" OR "*Custom-Header*") \| STATS COUNT() BY source.ip, http.header HAVING COUNT() > 5`. |
| 10. Junk Data with Encrypted Payloads | Encrypted junk data, as in APT41. | - Network Traffic (DS0003: Zeek HTTP)<br>- Packet Analysis | - **Splunk**: `index=network sourcetype=zeek_http payload_entropy > 7 \| stats count by src_ip, uri \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "HTTP" and AdditionalFields.PayloadEntropy > 7 \| summarize count() by DeviceIP, RemoteUrl \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE http.payload.entropy > 7 \| STATS COUNT() BY source.ip, http.uri HAVING COUNT() > 5`. |
| 11. Junk Data in Non-Standard Environments | Junk data in Linux, as in Turla. | - Network Traffic (DS0003: Zeek HTTP)<br>- Linux Logs | - **Splunk**: `index=linux sourcetype=auditd syscall="sendto" AND dest_port IN (80, 443) AND exe NOT IN (known_apps) \| stats count by exe, dest_ip \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where RemotePort in (80, 443) and InitiatingProcessName !in (knownApps) \| summarize count() by InitiatingProcessName, RemoteIP \| where count_ > 5`.<br>- **ELK**: `FROM logs-auditd-* \| WHERE syscall.name = "sendto" AND destination.port IN [80, 443] AND process.exe NOT IN ['known_apps'] \| STATS COUNT() BY process.exe, destination.ip HAVING COUNT() > 5`. |
| 12. Junk Data with Anomalous Timing | Junk data with unusual timing, as in 2025 trends. | - Network Traffic (DS0003: Zeek HTTP)<br>- Metrics | - **Splunk**: `index=network sourcetype=zeek_http \| timechart span=1h count \| where count > avg(count)*4`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "HTTP" \| summarize HourlyCount=count() by bin(Timestamp, 1h) \| where HourlyCount > avg(HourlyCount) * 4`.<br>- **ELK**: `FROM logs-zeek.http-* \| STATS COUNT() BY date_histogram(@timestamp, '1h') \| WHERE COUNT() > AVG(COUNT()) * 4`. |
| 13. Junk Data with Suspicious Headers | Junk data with custom headers, as in Cobalt Strike. | - Network Traffic (DS0003: Zeek HTTP)<br>- Proxy Logs | - **Splunk**: `index=network sourcetype=zeek_http header IN ("*X-Cobalt*", "*Custom-Header*") \| stats count by src_ip, header \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "HTTP" and AdditionalFields.Header has_any ("X-Cobalt", "Custom-Header") \| summarize count() by DeviceIP, AdditionalFields.Header \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE http.header : ("*X-Cobalt*" OR "*Custom-Header*") \| STATS COUNT() BY source.ip, http.header HAVING COUNT() > 5`. |
| 14. Junk Data with Encrypted Payloads | Encrypted junk data, as in APT41. | - Network Traffic (DS0003: Zeek HTTP)<br>- Packet Analysis | - **Splunk**: `index=network sourcetype=zeek_http payload_entropy > 7 \| stats count by src_ip, uri \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "HTTP" and AdditionalFields.PayloadEntropy > 7 \| summarize count() by DeviceIP, RemoteUrl \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE http.payload.entropy > 7 \| STATS COUNT() BY source.ip, http.uri HAVING COUNT() > 5`. |
| 15. Junk Data in Non-Standard Environments | Junk data in Linux, as in Turla. | - Network Traffic (DS0003: Zeek HTTP)<br>- Linux Logs | - **Splunk**: `index=linux sourcetype=auditd syscall="sendto" AND dest_port IN (80, 443) AND exe NOT IN (known_apps) \| stats count by exe, dest_ip \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where RemotePort in (80, 443) and InitiatingProcessName !in (knownApps) \| summarize count() by InitiatingProcessName, RemoteIP \| where count_ > 5`.<br>- **ELK**: `FROM logs-auditd-* \| WHERE syscall.name = "sendto" AND destination.port IN [80, 443] AND process.exe NOT IN ['known_apps'] \| STATS COUNT() BY process.exe, destination.ip HAVING COUNT() > 5`. |

### Mail Protocols (T1071.003)

| Hypothesis | Description | Data Sources | Hunting Queries |
|------------|-------------|--------------|-----------------|
| 1. SMTP C2 Communication | Adversaries use SMTP for C2, sending emails to exfil data, as in APT41. High risk in environments with limited email monitoring. | - Network Traffic (DS0003: Zeek SMTP)<br>- Email Logs | - **Splunk**: `index=network sourcetype=zeek_smtp attachment="*data*" AND src_ip NOT IN (known_clients) \| stats count by src_ip, recipient \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "SMTP" and AdditionalFields.Attachment contains "data" and DeviceIP !in (knownClients) \| summarize count() by DeviceIP, AdditionalFields.Recipient \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.smtp-* \| WHERE smtp.attachment : "*data*" AND source.ip NOT IN ['known_clients'] \| STATS COUNT() BY source.ip, smtp.recipient HAVING COUNT() > 5`. |
| 2. IMAP/POP3 C2 Communication | Adversaries use IMAP/POP3 for C2, as in Turla. | - Network Traffic (DS0003: Zeek IMAP)<br>- Email Logs | - **Splunk**: `index=network sourcetype=zeek_imap command IN ("FETCH", "STORE") \| stats count by src_ip, command \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "IMAP" and AdditionalFields.Command in ("FETCH", "STORE") \| summarize count() by DeviceIP, AdditionalFields.Command \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.imap-* \| WHERE imap.command IN ['FETCH', 'STORE'] \| STATS COUNT() BY source.ip, imap.command HAVING COUNT() > 5`. |
| 3. Mail Protocol C2 from Compromised Endpoints | Compromised endpoints use mail protocols for C2, as in FIN7. | - Process Creation (DS0009: Sysmon ID 1)<br>- Network Traffic | - **Splunk**: `index=endpoint sourcetype=sysmon EventCode=1 CommandLine="*smtp*" \| join host [search index=network sourcetype=zeek_smtp attachment="*data*"] \| stats count by host, CommandLine, uri \| where count > 3`.<br>- **KQL**: `DeviceProcessEvents \| where ProcessCommandLine contains "smtp" \| join kind=inner (DeviceNetworkEvents \| where Protocol == "SMTP" and AdditionalFields.Attachment contains "data") on DeviceName \| summarize count() by DeviceName, ProcessCommandLine, RemoteUrl \| where count_ > 3`.<br>- **ELK**: `FROM logs-endpoint.process-* \| WHERE process.command_line : "*smtp*" \| JOIN logs-zeek.smtp-* ON host.name WHERE smtp.attachment : "*data*" \| STATS COUNT() BY host.name, process.command_line, http.uri HAVING COUNT() > 3`. |
| 4. Mail Protocol C2 with Anomalous Timing | Mail protocol C2 with unusual timing, as in 2025 trends. | - Network Traffic (DS0003: Zeek SMTP)<br>- Metrics | - **Splunk**: `index=network sourcetype=zeek_smtp \| timechart span=1h count \| where count > avg(count)*4`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "SMTP" \| summarize HourlyCount=count() by bin(Timestamp, 1h) \| where HourlyCount > avg(HourlyCount) * 4`.<br>- **ELK**: `FROM logs-zeek.smtp-* \| STATS COUNT() BY date_histogram(@timestamp, '1h') \| WHERE COUNT() > AVG(COUNT()) * 4`. |
| 5. Mail Protocol C2 with Encrypted Payloads | Encrypted payloads in mail protocol C2, as in APT41. | - Network Traffic (DS0003: Zeek SMTP)<br>- Packet Analysis | - **Splunk**: `index=network sourcetype=zeek_smtp payload_entropy > 7 \| stats count by src_ip, recipient \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "SMTP" and AdditionalFields.PayloadEntropy > 7 \| summarize count() by DeviceIP, AdditionalFields.Recipient \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.smtp-* \| WHERE smtp.payload.entropy > 7 \| STATS COUNT() BY source.ip, smtp.recipient HAVING COUNT() > 5`. |
| 6. Mail Protocol C2 in Cloud Environments | Mail protocol C2 in cloud, as in 2025 trends. | - Cloud Audit Logs (AWS CloudTrail)<br>- Network Traffic | - **Splunk**: `index=cloud sourcetype=aws:cloudtrail eventName="Invoke" AND userIdentity NOT IN (authorized_users) \| stats count by userIdentity, src_ip \| where count > 5`.<br>- **KQL**: `AWSCloudTrail \| where EventName == "Invoke" and Caller !in (authorizedUsers) \| summarize count() by Caller, SourceIP \| where count_ > 5`.<br>- **ELK**: `FROM logs-aws.cloudtrail-* \| WHERE event.action = 'Invoke' AND user.identity NOT IN ['authorized_users'] \| STATS COUNT() BY user.identity, source.ip HAVING COUNT() > 5`. |
| 7. Mail Protocol C2 with Suspicious Headers | Mail protocol C2 with custom headers, as in Cobalt Strike. | - Network Traffic (DS0003: Zeek SMTP)<br>- Proxy Logs | - **Splunk**: `index=network sourcetype=zeek_smtp header IN ("*X-Cobalt*", "*Custom-Header*") \| stats count by src_ip, header \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "SMTP" and AdditionalFields.Header has_any ("X-Cobalt", "Custom-Header") \| summarize count() by DeviceIP, AdditionalFields.Header \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.smtp-* \| WHERE smtp.header : ("*X-Cobalt*" OR "*Custom-Header*") \| STATS COUNT() BY source.ip, smtp.header HAVING COUNT() > 5`. |
| 8. Mail Protocol C2 in Non-Standard Environments | Mail protocol C2 in Linux, as in Turla. | - Network Traffic (DS0003: Zeek SMTP)<br>- Linux Logs | - **Splunk**: `index=linux sourcetype=auditd syscall="connect" AND dest_port=25 AND exe NOT IN (known_apps) \| stats count by exe, dest_ip \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where RemotePort == 25 and InitiatingProcessName !in (knownApps) \| summarize count() by InitiatingProcessName, RemoteIP \| where count_ > 5`.<br>- **ELK**: `FROM logs-auditd-* \| WHERE syscall.name = "connect" AND destination.port = 25 AND process.exe NOT IN ['known_apps'] \| STATS COUNT() BY process.exe, destination.ip HAVING COUNT() > 5`. |
| 9. Mail Protocol C2 with Multi-Stage Redirects | Mail protocol C2 with redirects, as in APT41. | - Network Traffic (DS0003: Zeek SMTP)<br>- Redirect Analysis | - **Splunk**: `index=network sourcetype=zeek_smtp status_code=302 \| stats count by src_ip, recipient \| where count > 3`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "SMTP" and AdditionalFields.StatusCode == 302 \| summarize count() by DeviceIP, AdditionalFields.Recipient \| where count_ > 3`.<br>- **ELK**: `FROM logs-zeek.smtp-* \| WHERE smtp.status = 302 \| STATS COUNT() BY source.ip, smtp.recipient HAVING COUNT() > 3`. |
| 10. Mail Protocol C2 with Anomalous User Agents | Mail protocol C2 with unusual user agents, as in Cobalt Strike. | - Network Traffic (DS0003: Zeek SMTP)<br>- Proxy Logs | - **Splunk**: `index=network sourcetype=zeek_smtp user_agent NOT IN (known_agents) \| stats count by src_ip, user_agent \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "SMTP" and AdditionalFields.UserAgent !in (knownAgents) \| summarize count() by DeviceIP, AdditionalFields.UserAgent \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.smtp-* \| WHERE smtp.user_agent NOT IN ['known_agents'] \| STATS COUNT() BY source.ip, smtp.user_agent HAVING COUNT() > 5`. |
| 11. Mail Protocol C2 in Cloud Environments | Mail protocol C2 in cloud, as in 2025 trends. | - Cloud Audit Logs (AWS CloudTrail)<br>- Network Traffic | - **Splunk**: `index=cloud sourcetype=aws:cloudtrail eventName="Invoke" AND userIdentity NOT IN (authorized_users) \| stats count by userIdentity, src_ip \| where count > 5`.<br>- **KQL**: `AWSCloudTrail \| where EventName == "Invoke" and Caller !in (authorizedUsers) \| summarize count() by Caller, SourceIP \| where count_ > 5`.<br>- **ELK**: `FROM logs-aws.cloudtrail-* \| WHERE event.action = 'Invoke' AND user.identity NOT IN ['authorized_users'] \| STATS COUNT() BY user.identity, source.ip HAVING COUNT() > 5`. |
| 12. Mail Protocol C2 with Suspicious Headers | Mail protocol C2 with custom headers, as in Cobalt Strike. | - Network Traffic (DS0003: Zeek SMTP)<br>- Proxy Logs | - **Splunk**: `index=network sourcetype=zeek_smtp header IN ("*X-Cobalt*", "*Custom-Header*") \| stats count by src_ip, header \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "SMTP" and AdditionalFields.Header has_any ("X-Cobalt", "Custom-Header") \| summarize count() by DeviceIP, AdditionalFields.Header \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.smtp-* \| WHERE smtp.header : ("*X-Cobalt*" OR "*Custom-Header*") \| STATS COUNT() BY source.ip, smtp.header HAVING COUNT() > 5`. |
| 13. Mail Protocol C2 in Non-Standard Environments | Mail protocol C2 in Linux, as in Turla. | - Network Traffic (DS0003: Zeek SMTP)<br>- Linux Logs | - **Splunk**: `index=linux sourcetype=auditd syscall="connect" AND dest_port=25 AND exe NOT IN (known_apps) \| stats count by exe, dest_ip \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where RemotePort == 25 and InitiatingProcessName !in (knownApps) \| summarize count() by InitiatingProcessName, RemoteIP \| where count_ > 5`.<br>- **ELK**: `FROM logs-auditd-* \| WHERE syscall.name = "connect" AND destination.port = 25 AND process.exe NOT IN ['known_apps'] \| STATS COUNT() BY process.exe, destination.ip HAVING COUNT() > 5`. |
| 14. Mail Protocol C2 with Multi-Stage Redirects | Mail protocol C2 with redirects, as in APT41. | - Network Traffic (DS0003: Zeek SMTP)<br>- Redirect Analysis | - **Splunk**: `index=network sourcetype=zeek_smtp status_code=302 \| stats count by src_ip, recipient \| where count > 3`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "SMTP" and AdditionalFields.StatusCode == 302 \| summarize count() by DeviceIP, AdditionalFields.Recipient \| where count_ > 3`.<br>- **ELK**: `FROM logs-zeek.smtp-* \| WHERE smtp.status = 302 \| STATS COUNT() BY source.ip, smtp.recipient HAVING COUNT() > 3`. |
| 15. Mail Protocol C2 with Anomalous User Agents | Mail protocol C2 with unusual user agents, as in Cobalt Strike. | - Network Traffic (DS0003: Zeek SMTP)<br>- Proxy Logs | - **Splunk**: `index=network sourcetype=zeek_smtp user_agent NOT IN (known_agents) \| stats count by src_ip, user_agent \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "SMTP" and AdditionalFields.UserAgent !in (knownAgents) \| summarize count() by DeviceIP, AdditionalFields.UserAgent \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.smtp-* \| WHERE smtp.user_agent NOT IN ['known_agents'] \| STATS COUNT() BY source.ip, smtp.user_agent HAVING COUNT() > 5`. |## Ingress Tool Transfer (T1105)


### Internal Proxy (T1090.001)

| Hypothesis | Description | Data Sources | Hunting Queries |
|------------|-------------|--------------|-----------------|
| 1. Internal Proxy for C2 | Adversaries use internal proxies for C2, as in APT41. High risk in environments with limited internal traffic monitoring. | - Network Traffic (DS0003: Zeek Conn)<br>- Proxy Logs | - **Splunk**: `index=network sourcetype=zeek_conn dest_ip IN (internal_proxies) AND src_ip NOT IN (known_clients) \| stats count by src_ip, dest_ip \| where count > 5` (Detects connections to internal proxies).<br>- **KQL**: `DeviceNetworkEvents \| where RemoteIP in (internalProxies) and DeviceIP !in (knownClients) \| summarize count() by DeviceIP, RemoteIP \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.conn-* \| WHERE destination.ip IN ['internal_proxies'] AND source.ip NOT IN ['known_clients'] \| STATS COUNT() BY source.ip, destination.ip HAVING COUNT() > 5`. |
| 2. Internal Proxy with Encrypted Traffic | Encrypted traffic through internal proxies, as in Turla. | - Network Traffic (DS0003: Zeek SSL)<br>- Proxy Logs | - **Splunk**: `index=network sourcetype=zeek_ssl dest_port=443 AND dest_ip IN (internal_proxies) \| stats count by src_ip, dest_ip \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where RemotePort == 443 and RemoteIP in (internalProxies) \| summarize count() by DeviceIP, RemoteIP \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.ssl-* \| WHERE destination.port = 443 AND destination.ip IN ['internal_proxies'] \| STATS COUNT() BY source.ip, destination.ip HAVING COUNT() > 5`. |
| 3. Internal Proxy Access from Compromised Endpoints | Compromised endpoints access internal proxies, as in FIN7. | - Process Creation (DS0009: Sysmon ID 1)<br>- Network Traffic | - **Splunk**: `index=endpoint sourcetype=sysmon EventCode=1 CommandLine="*proxy*" \| join host [search index=network sourcetype=zeek_conn dest_ip IN (internal_proxies)] \| stats count by host, CommandLine, dest_ip \| where count > 3`.<br>- **KQL**: `DeviceProcessEvents \| where ProcessCommandLine contains "proxy" \| join kind=inner (DeviceNetworkEvents \| where RemoteIP in (internalProxies) ) on DeviceName \| summarize count() by DeviceName, ProcessCommandLine, RemoteIP \| where count_ > 3`.<br>- **ELK**: `FROM logs-endpoint.process-* \| WHERE process.command_line : "*proxy*" \| JOIN logs-zeek.conn-* ON host.name WHERE destination.ip IN ['internal_proxies'] \| STATS COUNT() BY host.name, process.command_line, destination.ip HAVING COUNT() > 3`. |
| 4. Internal Proxy with Anomalous Timing | Internal proxy access with unusual timing, as in 2025 trends. | - Network Traffic (DS0003: Zeek Conn)<br>- Metrics | - **Splunk**: `index=network sourcetype=zeek_conn dest_ip IN (internal_proxies) \| timechart span=1h count \| where count > avg(count)*4`.<br>- **KQL**: `DeviceNetworkEvents \| where RemoteIP in (internalProxies) \| summarize HourlyCount=count() by bin(Timestamp, 1h) \| where HourlyCount > avg(HourlyCount) * 4`.<br>- **ELK**: `FROM logs-zeek.conn-* \| WHERE destination.ip IN ['internal_proxies'] \| STATS COUNT() BY date_histogram(@timestamp, '1h') \| WHERE COUNT() > AVG(COUNT()) * 4`. |
| 5. Internal Proxy with Encrypted Payloads | Encrypted payloads through internal proxies, as in APT41. | - Network Traffic (DS0003: Zeek HTTP)<br>- Packet Analysis | - **Splunk**: `index=network sourcetype=zeek_http dest_ip IN (internal_proxies) AND payload_entropy > 7 \| stats count by src_ip, uri \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where RemoteIP in (internalProxies) and AdditionalFields.PayloadEntropy > 7 \| summarize count() by DeviceIP, RemoteUrl \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE destination.ip IN ['internal_proxies'] AND http.payload.entropy > 7 \| STATS COUNT() BY source.ip, http.uri HAVING COUNT() > 5`. |
| 6. Internal Proxy in Cloud Environments | Internal proxy access in cloud, as in 2025 trends. | - Cloud Audit Logs (AWS CloudTrail)<br>- Network Traffic | - **Splunk**: `index=cloud sourcetype=aws:cloudtrail eventName="Invoke" AND userIdentity NOT IN (authorized_users) \| stats count by userIdentity, src_ip \| where count > 5`.<br>- **KQL**: `AWSCloudTrail \| where EventName == "Invoke" and Caller !in (authorizedUsers) \| summarize count() by Caller, SourceIP \| where count_ > 5`.<br>- **ELK**: `FROM logs-aws.cloudtrail-* \| WHERE event.action = 'Invoke' AND user.identity NOT IN ['authorized_users'] \| STATS COUNT() BY user.identity, source.ip HAVING COUNT() > 5`. |
| 7. Internal Proxy with Suspicious Headers | Internal proxy with custom headers, as in Cobalt Strike. | - Network Traffic (DS0003: Zeek HTTP)<br>- Proxy Logs | - **Splunk**: `index=network sourcetype=zeek_http dest_ip IN (internal_proxies) AND header IN ("*X-Cobalt*", "*Custom-Header*") \| stats count by src_ip, header \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where RemoteIP in (internalProxies) and AdditionalFields.Header has_any ("X-Cobalt", "Custom-Header") \| summarize count() by DeviceIP, AdditionalFields.Header \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE destination.ip IN ['internal_proxies'] AND http.header : ("*X-Cobalt*" OR "*Custom-Header*") \| STATS COUNT() BY source.ip, http.header HAVING COUNT() > 5`. |
| 8. Internal Proxy in Non-Standard Environments | Internal proxy access in Linux, as in Turla. | - Network Traffic (DS0003: Zeek Conn)<br>- Linux Logs | - **Splunk**: `index=linux sourcetype=auditd syscall="connect" AND dest_ip IN (internal_proxies) AND exe NOT IN (known_apps) \| stats count by exe, dest_ip \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where RemoteIP in (internalProxies) and InitiatingProcessName !in (knownApps) \| summarize count() by InitiatingProcessName, RemoteIP \| where count_ > 5`.<br>- **ELK**: `FROM logs-auditd-* \| WHERE syscall.name = "connect" AND destination.ip IN ['internal_proxies'] AND process.exe NOT IN ['known_apps'] \| STATS COUNT() BY process.exe, destination.ip HAVING COUNT() > 5`. |
| 9. Internal Proxy with Multi-Stage Redirects | Internal proxy with redirects, as in APT41. | - Network Traffic (DS0003: Zeek HTTP)<br>- Redirect Analysis | - **Splunk**: `index=network sourcetype=zeek_http dest_ip IN (internal_proxies) AND status_code=302 \| stats count by src_ip, uri \| where count > 3`.<br>- **KQL**: `DeviceNetworkEvents \| where RemoteIP in (internalProxies) and AdditionalFields.StatusCode == 302 \| summarize count() by DeviceIP, RemoteUrl \| where count_ > 3`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE destination.ip IN ['internal_proxies'] AND http.status = 302 \| STATS COUNT() BY source.ip, http.uri HAVING COUNT() > 3`. |
| 10. Internal Proxy with Anomalous User Agents | Internal proxy with unusual user agents, as in Cobalt Strike. | - Network Traffic (DS0003: Zeek HTTP)<br>- Proxy Logs | - **Splunk**: `index=network sourcetype=zeek_http dest_ip IN (internal_proxies) AND user_agent NOT IN (known_agents) \| stats count by src_ip, user_agent \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where RemoteIP in (internalProxies) and AdditionalFields.UserAgent !in (knownAgents) \| summarize count() by DeviceIP, AdditionalFields.UserAgent \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE destination.ip IN ['internal_proxies'] AND http.user_agent NOT IN ['known_agents'] \| STATS COUNT() BY source.ip, http.user_agent HAVING COUNT() > 5`. |
| 11. Internal Proxy in Cloud Environments | Internal proxy access in cloud, as in 2025 trends. | - Cloud Audit Logs (AWS CloudTrail)<br>- Network Traffic | - **Splunk**: `index=cloud sourcetype=aws:cloudtrail eventName="Invoke" AND userIdentity NOT IN (authorized_users) \| stats count by userIdentity, src_ip \| where count > 5`.<br>- **KQL**: `AWSCloudTrail \| where EventName == "Invoke" and Caller !in (authorizedUsers) \| summarize count() by Caller, SourceIP \| where count_ > 5`.<br>- **ELK**: `FROM logs-aws.cloudtrail-* \| WHERE event.action = 'Invoke' AND user.identity NOT IN ['authorized_users'] \| STATS COUNT() BY user.identity, source.ip HAVING COUNT() > 5`. |
| 12. Internal Proxy with Suspicious Headers | Internal proxy with custom headers, as in Cobalt Strike. | - Network Traffic (DS0003: Zeek HTTP)<br>- Proxy Logs | - **Splunk**: `index=network sourcetype=zeek_http dest_ip IN (internal_proxies) AND header IN ("*X-Cobalt*", "*Custom-Header*") \| stats count by src_ip, header \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where RemoteIP in (internalProxies) and AdditionalFields.Header has_any ("X-Cobalt", "Custom-Header") \| summarize count() by DeviceIP, AdditionalFields.Header \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE destination.ip IN ['internal_proxies'] AND http.header : ("*X-Cobalt*" OR "*Custom-Header*") \| STATS COUNT() BY source.ip, http.header HAVING COUNT() > 5`. |
| 13. Internal Proxy in Non-Standard Environments | Internal proxy access in Linux, as in Turla. | - Network Traffic (DS0003: Zeek Conn)<br>- Linux Logs | - **Splunk**: `index=linux sourcetype=auditd syscall="connect" AND dest_ip IN (internal_proxies) AND exe NOT IN (known_apps) \| stats count by exe, dest_ip \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where RemoteIP in (internalProxies) and InitiatingProcessName !in (knownApps) \| summarize count() by InitiatingProcessName, RemoteIP \| where count_ > 5`.<br>- **ELK**: `FROM logs-auditd-* \| WHERE syscall.name = "connect" AND destination.ip IN ['internal_proxies'] AND process.exe NOT IN ['known_apps'] \| STATS COUNT() BY process.exe, destination.ip HAVING COUNT() > 5`. |
| 14. Internal Proxy with Multi-Stage Redirects | Internal proxy with redirects, as in APT41. | - Network Traffic (DS0003: Zeek HTTP)<br>- Redirect Analysis | - **Splunk**: `index=network sourcetype=zeek_http dest_ip IN (internal_proxies) AND status_code=302 \| stats count by src_ip, uri \| where count > 3`.<br>- **KQL**: `DeviceNetworkEvents \| where RemoteIP in (internalProxies) and AdditionalFields.StatusCode == 302 \| summarize count() by DeviceIP, RemoteUrl \| where count_ > 3`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE destination.ip IN ['internal_proxies'] AND http.status = 302 \| STATS COUNT() BY source.ip, http.uri HAVING COUNT() > 3`. |
| 15. Internal Proxy with Anomalous User Agents | Internal proxy with unusual user agents, as in Cobalt Strike. | - Network Traffic (DS0003: Zeek HTTP)<br>- Proxy Logs | - **Splunk**: `index=network sourcetype=zeek_http dest_ip IN (internal_proxies) AND user_agent NOT IN (known_agents) \| stats count by src_ip, user_agent \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where RemoteIP in (internalProxies) and AdditionalFields.UserAgent !in (knownAgents) \| summarize count() by DeviceIP, AdditionalFields.UserAgent \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE destination.ip IN ['internal_proxies'] AND http.user_agent NOT IN ['known_agents'] \| STATS COUNT() BY source.ip, http.user_agent HAVING COUNT() > 5`. | 

### Junk Data (T1001.001)

| Hypothesis | Description | Data Sources | Hunting Queries |
|------------|-------------|--------------|-----------------|
| 1. Junk Data in C2 Payloads | Adversaries use junk data to pad C2 payloads, as in APT41. High risk in environments with limited payload inspection. | - Network Traffic (DS0003: Zeek HTTP)<br>- Packet Analysis | - **Splunk**: `index=network sourcetype=zeek_http payload_entropy < 1 \| stats count by src_ip, uri \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "HTTP" and AdditionalFields.PayloadEntropy < 1 \| summarize count() by DeviceIP, RemoteUrl \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE http.payload.entropy < 1 \| STATS COUNT() BY source.ip, http.uri HAVING COUNT() > 5`. |
| 2. Junk Data in DNS Queries | Junk data in DNS queries for C2, as in Turla. | - DNS Logs (DS0003: Zeek DNS)<br>- Network Traffic | - **Splunk**: `index=network sourcetype=zeek_dns query_entropy < 1 \| stats count by src_ip, query \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "DNS" and AdditionalFields.QueryEntropy < 1 \| summarize count() by DeviceIP, AdditionalFields.Query \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.dns-* \| WHERE dns.query.entropy < 1 \| STATS COUNT() BY source.ip, dns.query HAVING COUNT() > 5`. |
| 3. Junk Data with Anomalous Timing | Junk data transfers with unusual timing, as in 2025 trends. | - Network Traffic (DS0003: Zeek HTTP)<br>- Metrics | - **Splunk**: `index=network sourcetype=zeek_http payload_entropy < 1 \| timechart span=1h count \| where count > avg(count)*4`.<br>- **KQL**: `DeviceNetworkEvents \| where AdditionalFields.PayloadEntropy < 1 \| summarize HourlyCount=count() by bin(Timestamp, 1h) \| where HourlyCount > avg(HourlyCount) * 4`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE http.payload.entropy < 1 \| STATS COUNT() BY date_histogram(@timestamp, '1h') \| WHERE COUNT() > AVG(COUNT()) * 4`. |
| 4. Junk Data via Compromised Endpoints | Compromised endpoints send junk data for C2, as in Turla. | - Process Creation (DS0009: Sysmon ID 1)<br>- Network Traffic | - **Splunk**: `index=endpoint sourcetype=sysmon EventCode=1 CommandLine="*junk*" \| join host [search index=network sourcetype=zeek_http payload_entropy < 1] \| stats count by host, CommandLine, uri \| where count > 3`.<br>- **KQL**: `DeviceProcessEvents \| where ProcessCommandLine contains "junk" \| join kind=inner (DeviceNetworkEvents \| where AdditionalFields.PayloadEntropy < 1) on DeviceName \| summarize count() by DeviceName, ProcessCommandLine, RemoteUrl \| where count_ > 3`.<br>- **ELK**: `FROM logs-endpoint.process-* \| WHERE process.command_line : "*junk*" \| JOIN logs-zeek.http-* ON host.name WHERE http.payload.entropy < 1 \| STATS COUNT() BY host.name, process.command_line, http.uri HAVING COUNT() > 3`. |
| 5. Junk Data in Cloud Environments | Junk data in cloud C2, as in 2025 trends. | - Cloud Audit Logs (AWS CloudTrail)<br>- Network Traffic | - **Splunk**: `index=cloud sourcetype=aws:cloudtrail eventName="Invoke" AND userIdentity NOT IN (authorized_users) \| stats count by userIdentity, src_ip \| where count > 5`.<br>- **KQL**: `AWSCloudTrail \| where EventName == "Invoke" and Caller !in (authorizedUsers) \| summarize count() by Caller, SourceIP \| where count_ > 5`.<br>- **ELK**: `FROM logs-aws.cloudtrail-* \| WHERE event.action = 'Invoke' AND user.identity NOT IN ['authorized_users'] \| STATS COUNT() BY user.identity, source.ip HAVING COUNT() > 5`. |
| 6. Junk Data with Encrypted Payloads | Encrypted junk data, as in APT41. | - Network Traffic (DS0003: Zeek HTTP)<br>- Packet Analysis | - **Splunk**: `index=network sourcetype=zeek_http payload_entropy > 7 \| stats count by src_ip, uri \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "HTTP" and AdditionalFields.PayloadEntropy > 7 \| summarize count() by DeviceIP, RemoteUrl \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE http.payload.entropy > 7 \| STATS COUNT() BY source.ip, http.uri HAVING COUNT() > 5`. |
| 7. Junk Data in Non-Standard Environments | Junk data in Linux, as in Turla. | - Network Traffic (DS0003: Zeek HTTP)<br>- Linux Logs | - **Splunk**: `index=linux sourcetype=auditd syscall="sendto" AND dest_port IN (80, 443) AND exe NOT IN (known_apps) \| stats count by exe, dest_ip \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where RemotePort in (80, 443) and InitiatingProcessName !in (knownApps) \| summarize count() by InitiatingProcessName, RemoteIP \| where count_ > 5`.<br>- **ELK**: `FROM logs-auditd-* \| WHERE syscall.name = "sendto" AND destination.port IN [80, 443] AND process.exe NOT IN ['known_apps'] \| STATS COUNT() BY process.exe, destination.ip HAVING COUNT() > 5`. |
| 8. Junk Data with Anomalous Timing | Junk data with unusual timing, as in 2025 trends. | - Network Traffic (DS0003: Zeek HTTP)<br>- Metrics | - **Splunk**: `index=network sourcetype=zeek_http \| timechart span=1h count \| where count > avg(count)*4`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "HTTP" \| summarize HourlyCount=count() by bin(Timestamp, 1h) \| where HourlyCount > avg(HourlyCount) * 4`.<br>- **ELK**: `FROM logs-zeek.http-* \| STATS COUNT() BY date_histogram(@timestamp, '1h') \| WHERE COUNT() > AVG(COUNT()) * 4`. |
| 9. Junk Data with Suspicious Headers | Junk data with custom headers, as in Cobalt Strike. | - Network Traffic (DS0003: Zeek HTTP)<br>- Proxy Logs | - **Splunk**: `index=network sourcetype=zeek_http header IN ("*X-Cobalt*", "*Custom-Header*") \| stats count by src_ip, header \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "HTTP" and AdditionalFields.Header has_any ("X-Cobalt", "Custom-Header") \| summarize count() by DeviceIP, AdditionalFields.Header \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE http.header : ("*X-Cobalt*" OR "*Custom-Header*") \| STATS COUNT() BY source.ip, http.header HAVING COUNT() > 5`. |
| 10. Junk Data with Encrypted Payloads | Encrypted junk data, as in APT41. | - Network Traffic (DS0003: Zeek HTTP)<br>- Packet Analysis | - **Splunk**: `index=network sourcetype=zeek_http payload_entropy > 7 \| stats count by src_ip, uri \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "HTTP" and AdditionalFields.PayloadEntropy > 7 \| summarize count() by DeviceIP, RemoteUrl \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE http.payload.entropy > 7 \| STATS COUNT() BY source.ip, http.uri HAVING COUNT() > 5`. |
| 11. Junk Data in Non-Standard Environments | Junk data in Linux, as in Turla. | - Network Traffic (DS0003: Zeek HTTP)<br>- Linux Logs | - **Splunk**: `index=linux sourcetype=auditd syscall="sendto" AND dest_port IN (80, 443) AND exe NOT IN (known_apps) \| stats count by exe, dest_ip \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where RemotePort in (80, 443) and InitiatingProcessName !in (knownApps) \| summarize count() by InitiatingProcessName, RemoteIP \| where count_ > 5`.<br>- **ELK**: `FROM logs-auditd-* \| WHERE syscall.name = "sendto" AND destination.port IN [80, 443] AND process.exe NOT IN ['known_apps'] \| STATS COUNT() BY process.exe, destination.ip HAVING COUNT() > 5`. |
| 12. Junk Data with Anomalous Timing | Junk data with unusual timing, as in 2025 trends. | - Network Traffic (DS0003: Zeek HTTP)<br>- Metrics | - **Splunk**: `index=network sourcetype=zeek_http \| timechart span=1h count \| where count > avg(count)*4`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "HTTP" \| summarize HourlyCount=count() by bin(Timestamp, 1h) \| where HourlyCount > avg(HourlyCount) * 4`.<br>- **ELK**: `FROM logs-zeek.http-* \| STATS COUNT() BY date_histogram(@timestamp, '1h') \| WHERE COUNT() > AVG(COUNT()) * 4`. |
| 13. Junk Data with Suspicious Headers | Junk data with custom headers, as in Cobalt Strike. | - Network Traffic (DS0003: Zeek HTTP)<br>- Proxy Logs | - **Splunk**: `index=network sourcetype=zeek_http header IN ("*X-Cobalt*", "*Custom-Header*") \| stats count by src_ip, header \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "HTTP" and AdditionalFields.Header has_any ("X-Cobalt", "Custom-Header") \| summarize count() by DeviceIP, AdditionalFields.Header \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE http.header : ("*X-Cobalt*" OR "*Custom-Header*") \| STATS COUNT() BY source.ip, http.header HAVING COUNT() > 5`. |
| 14. Junk Data with Encrypted Payloads | Encrypted junk data, as in APT41. | - Network Traffic (DS0003: Zeek HTTP)<br>- Packet Analysis | - **Splunk**: `index=network sourcetype=zeek_http payload_entropy > 7 \| stats count by src_ip, uri \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "HTTP" and AdditionalFields.PayloadEntropy > 7 \| summarize count() by DeviceIP, RemoteUrl \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE http.payload.entropy > 7 \| STATS COUNT() BY source.ip, http.uri HAVING COUNT() > 5`. |
| 15. Junk Data in Non-Standard Environments | Junk data in Linux, as in Turla. | - Network Traffic (DS0003: Zeek HTTP)<br>- Linux Logs | - **Splunk**: `index=linux sourcetype=auditd syscall="sendto" AND dest_port IN (80, 443) AND exe NOT IN (known_apps) \| stats count by exe, dest_ip \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where RemotePort in (80, 443) and InitiatingProcessName !in (knownApps) \| summarize count() by InitiatingProcessName, RemoteIP \| where count_ > 5`.<br>- **ELK**: `FROM logs-auditd-* \| WHERE syscall.name = "sendto" AND destination.port IN [80, 443] AND process

### Multi-Stage Channels (T1104)

| Hypothesis | Description | Data Sources | Hunting Queries |
|------------|-------------|--------------|-----------------|
| 1. Multi-Stage C2 Channels with Redirects | Adversaries use multi-stage channels with redirects for C2, as in APT41 campaigns. High risk in environments with limited web traffic monitoring. | - Network Traffic (DS0003: Zeek HTTP)<br>- Proxy Logs | - **Splunk**: `index=network sourcetype=zeek_http status_code=302 AND uri="*redirect*" \| stats count by src_ip, uri \| where count > 3` (Detects multi-stage redirects for C2).<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "HTTP" and AdditionalFields.StatusCode == 302 and RemoteUrl contains "redirect" \| summarize count() by DeviceIP, RemoteUrl \| where count_ > 3`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE http.status = 302 AND http.uri : "*redirect*" \| STATS COUNT() BY source.ip, http.uri HAVING COUNT() > 3`. |
| 2. Multi-Stage C2 with DNS Backup | Multi-stage C2 using DNS as fallback, as in Turla attacks. | - DNS Logs (DS0003: Zeek DNS)<br>- Network Traffic | - **Splunk**: `index=network sourcetype=zeek_dns query_length > 200 \| stats count by src_ip, query \| where count > 10`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "DNS" and AdditionalFields.QueryLength > 200 \| summarize count() by DeviceIP, AdditionalFields.Query \| where count_ > 10`.<br>- **ELK**: `FROM logs-zeek.dns-* \| WHERE dns.query.length > 200 \| STATS COUNT() BY source.ip, dns.query HAVING COUNT() > 10`. |
| 3. Multi-Stage C2 from Compromised Endpoints | Compromised endpoints use multi-stage C2 channels, as in FIN7. | - Process Creation (DS0009: Sysmon ID 1)<br>- Network Traffic | - **Splunk**: `index=endpoint sourcetype=sysmon EventCode=1 CommandLine="*c2*" \| join host [search index=network sourcetype=zeek_http status_code=302] \| stats count by host, CommandLine, uri \| where count > 3`.<br>- **KQL**: `DeviceProcessEvents \| where ProcessCommandLine contains "c2" \| join kind=inner (DeviceNetworkEvents \| where Protocol == "HTTP" and AdditionalFields.StatusCode == 302) on DeviceName \| summarize count() by DeviceName, ProcessCommandLine, RemoteUrl \| where count_ > 3`.<br>- **ELK**: `FROM logs-endpoint.process-* \| WHERE process.command_line : "*c2*" \| JOIN logs-zeek.http-* ON host.name WHERE http.status = 302 \| STATS COUNT() BY host.name, process.command_line, http.uri HAVING COUNT() > 3`. |
| 4. Multi-Stage C2 with Anomalous Timing | Multi-stage C2 with unusual timing, as in 2025 trends. | - Network Traffic (DS0003: Zeek HTTP)<br>- Metrics | - **Splunk**: `index=network sourcetype=zeek_http \| timechart span=1h count \| where count > avg(count)*4`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "HTTP" \| summarize HourlyCount=count() by bin(Timestamp, 1h) \| where HourlyCount > avg(HourlyCount) * 4`.<br>- **ELK**: `FROM logs-zeek.http-* \| STATS COUNT() BY date_histogram(@timestamp, '1h') \| WHERE COUNT() > AVG(COUNT()) * 4`. |
| 5. Multi-Stage C2 with Encrypted Payloads | Encrypted payloads in multi-stage C2, as in APT41. | - Network Traffic (DS0003: Zeek HTTP)<br>- Packet Analysis | - **Splunk**: `index=network sourcetype=zeek_http payload_entropy > 7 \| stats count by src_ip, uri \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "HTTP" and AdditionalFields.PayloadEntropy > 7 \| summarize count() by DeviceIP, RemoteUrl \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE http.payload.entropy > 7 \| STATS COUNT() BY source.ip, http.uri HAVING COUNT() > 5`. |
| 6. Multi-Stage C2 in Cloud Environments | Multi-stage C2 in cloud, as in 2025 trends. | - Cloud Audit Logs (AWS CloudTrail)<br>- Network Traffic | - **Splunk**: `index=cloud sourcetype=aws:cloudtrail eventName="Invoke" AND userIdentity NOT IN (authorized_users) \| stats count by userIdentity, src_ip \| where count > 5`.<br>- **KQL**: `AWSCloudTrail \| where EventName == "Invoke" and Caller !in (authorizedUsers) \| summarize count() by Caller, SourceIP \| where count_ > 5`.<br>- **ELK**: `FROM logs-aws.cloudtrail-* \| WHERE event.action = 'Invoke' AND user.identity NOT IN ['authorized_users'] \| STATS COUNT() BY user.identity, source.ip HAVING COUNT() > 5`. |
| 7. Multi-Stage C2 with Suspicious Headers | Multi-stage C2 with custom headers, as in Cobalt Strike. | - Network Traffic (DS0003: Zeek HTTP)<br>- Proxy Logs | - **Splunk**: `index=network sourcetype=zeek_http header IN ("*X-Cobalt*", "*Custom-Header*") \| stats count by src_ip, header \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "HTTP" and AdditionalFields.Header has_any ("X-Cobalt", "Custom-Header") \| summarize count() by DeviceIP, AdditionalFields.Header \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE http.header : ("*X-Cobalt*" OR "*Custom-Header*") \| STATS COUNT() BY source.ip, http.header HAVING COUNT() > 5`. |
| 8. Multi-Stage C2 in Non-Standard Environments | Multi-stage C2 in Linux, as in Turla. | - Network Traffic (DS0003: Zeek Conn)<br>- Linux Logs | - **Splunk**: `index=linux sourcetype=auditd syscall="connect" AND dest_port=443 AND exe NOT IN (known_apps) \| stats count by exe, dest_ip \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where RemotePort == 443 and InitiatingProcessName !in (knownApps) \| summarize count() by InitiatingProcessName, RemoteIP \| where count_ > 5`.<br>- **ELK**: `FROM logs-auditd-* \| WHERE syscall.name = "connect" AND destination.port = 443 AND process.exe NOT IN ['known_apps'] \| STATS COUNT() BY process.exe, destination.ip HAVING COUNT() > 5`. |
| 9. Multi-Stage C2 with Multi-Stage Redirects | Multi-stage C2 with redirects, as in APT41. | - Network Traffic (DS0003: Zeek HTTP)<br>- Redirect Analysis | - **Splunk**: `index=network sourcetype=zeek_http status_code=302 \| stats count by src_ip, uri \| where count > 3`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "HTTP" and AdditionalFields.StatusCode == 302 \| summarize count() by DeviceIP, RemoteUrl \| where count_ > 3`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE http.status = 302 \| STATS COUNT() BY source.ip, http.uri HAVING COUNT() > 3`. |
| 10. Multi-Stage C2 with Anomalous User Agents | Multi-stage C2 with unusual user agents, as in Cobalt Strike. | - Network Traffic (DS0003: Zeek HTTP)<br>- Proxy Logs | - **Splunk**: `index=network sourcetype=zeek_http user_agent NOT IN (known_agents) \| stats count by src_ip, user_agent \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "HTTP" and AdditionalFields.UserAgent !in (knownAgents) \| summarize count() by DeviceIP, AdditionalFields.UserAgent \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE http.user_agent NOT IN ['known_agents'] \| STATS COUNT() BY source.ip, http.user_agent HAVING COUNT() > 5`. |
| 11. Multi-Stage C2 in Cloud Environments | Multi-stage C2 in cloud, as in 2025 trends. | - Cloud Audit Logs (AWS CloudTrail)<br>- Network Traffic | - **Splunk**: `index=cloud sourcetype=aws:cloudtrail eventName="Invoke" AND userIdentity NOT IN (authorized_users) \| stats count by userIdentity, src_ip \| where count > 5`.<br>- **KQL**: `AWSCloudTrail \| where EventName == "Invoke" and Caller !in (authorizedUsers) \| summarize count() by Caller, SourceIP \| where count_ > 5`.<br>- **ELK**: `FROM logs-aws.cloudtrail-* \| WHERE event.action = 'Invoke' AND user.identity NOT IN ['authorized_users'] \| STATS COUNT() BY user.identity, source.ip HAVING COUNT() > 5`. |
| 12. Multi-Stage C2 with Suspicious Headers | Multi-stage C2 with custom headers, as in Cobalt Strike. | - Network Traffic (DS0003: Zeek HTTP)<br>- Proxy Logs | - **Splunk**: `index=network sourcetype=zeek_http header IN ("*X-Cobalt*", "*Custom-Header*") \| stats count by src_ip, header \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "HTTP" and AdditionalFields.Header has_any ("X-Cobalt", "Custom-Header") \| summarize count() by DeviceIP, AdditionalFields.Header \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE http.header : ("*X-Cobalt*" OR "*Custom-Header*") \| STATS COUNT() BY source.ip, http.header HAVING COUNT() > 5`. |
| 13. Multi-Stage C2 in Non-Standard Environments | Multi-stage C2 in Linux, as in Turla. | - Network Traffic (DS0003: Zeek Conn)<br>- Linux Logs | - **Splunk**: `index=linux sourcetype=auditd syscall="connect" AND dest_port=443 AND exe NOT IN (known_apps) \| stats count by exe, dest_ip \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where RemotePort == 443 and InitiatingProcessName !in (knownApps) \| summarize count() by InitiatingProcessName, RemoteIP \| where count_ > 5`.<br>- **ELK**: `FROM logs-auditd-* \| WHERE syscall.name = "connect" AND destination.port = 443 AND process.exe NOT IN ['known_apps'] \| STATS COUNT() BY process.exe, destination.ip HAVING COUNT() > 5`. |
| 14. Multi-Stage C2 with Multi-Stage Redirects | Multi-stage C2 with redirects, as in APT41. | - Network Traffic (DS0003: Zeek HTTP)<br>- Redirect Analysis | - **Splunk**: `index=network sourcetype=zeek_http status_code=302 \| stats count by src_ip, uri \| where count > 3`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "HTTP" and AdditionalFields.StatusCode == 302 \| summarize count() by DeviceIP, RemoteUrl \| where count_ > 3`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE http.status = 302 \| STATS COUNT() BY source.ip, http.uri HAVING COUNT() > 3`. |
| 15. Multi-Stage C2 with Anomalous User Agents | Multi-stage C2 with unusual user agents, as in Cobalt Strike. | - Network Traffic (DS0003: Zeek HTTP)<br>- Proxy Logs | - **Splunk**: `index=network sourcetype=zeek_http user_agent NOT IN (known_agents) \| stats count by src_ip, user_agent \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "HTTP" and AdditionalFields.UserAgent !in (knownAgents) \| summarize count() by DeviceIP, AdditionalFields.UserAgent \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE http.user_agent NOT IN ['known_agents'] \| STATS COUNT() BY source.ip, http.user_agent HAVING COUNT() > 5`. |

### Multiband Communication (T1026)

| Hypothesis | Description | Data Sources | Hunting Queries |
|------------|-------------|--------------|-----------------|
| 1. Multiband C2 Communication | Adversaries use multiband communication for C2, as in APT41. High risk in environments with limited frequency monitoring. | - Network Traffic (DS0003: Zeek Conn)<br>- Radio Logs | - **Splunk**: `index=network sourcetype=zeek_conn frequency_band NOT IN (known_bands) \| stats count by src_ip, frequency_band \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where AdditionalFields.FrequencyBand !in (knownBands) \| summarize count() by DeviceIP, AdditionalFields.FrequencyBand \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.conn-* \| WHERE network.frequency.band NOT IN ['known_bands'] \| STATS COUNT() BY source.ip, network.frequency.band HAVING COUNT() > 5`. |
| 2. Multiband C2 with Encrypted Payloads | Encrypted payloads in multiband C2, as in Turla. | - Network Traffic (DS0003: Zeek Conn)<br>- Packet Analysis | - **Splunk**: `index=network sourcetype=zeek_conn payload_entropy > 7 \| stats count by src_ip \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where AdditionalFields.PayloadEntropy > 7 \| summarize count() by DeviceIP \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.conn-* \| WHERE network.payload.entropy > 7 \| STATS COUNT() BY source.ip HAVING COUNT() > 5`. |
| 3. Multiband C2 from Compromised Endpoints | Compromised endpoints use multiband C2, as in FIN7. | - Process Creation (DS0009: Sysmon ID 1)<br>- Network Traffic | - **Splunk**: `index=endpoint sourcetype=sysmon EventCode=1 CommandLine="*multiband*" \| join host [search index=network sourcetype=zeek_conn frequency_band NOT IN (known_bands)] \| stats count by host, CommandLine, frequency_band \| where count > 3`.<br>- **KQL**: `DeviceProcessEvents \| where ProcessCommandLine contains "multiband" \| join kind=inner (DeviceNetworkEvents \| where AdditionalFields.FrequencyBand !in (knownBands)) on DeviceName \| summarize count() by DeviceName, ProcessCommandLine, AdditionalFields.FrequencyBand \| where count_ > 3`.<br>- **ELK**: `FROM logs-endpoint.process-* \| WHERE process.command_line : "*multiband*" \| JOIN logs-zeek.conn-* ON host.name WHERE network.frequency.band NOT IN ['known_bands'] \| STATS COUNT() BY host.name, process.command_line, network.frequency.band HAVING COUNT() > 3`. |
| 4. Multiband C2 with Anomalous Timing | Multiband C2 with unusual timing, as in 2025 trends. | - Network Traffic (DS0003: Zeek Conn)<br>- Metrics | - **Splunk**: `index=network sourcetype=zeek_conn \| timechart span=1h count \| where count > avg(count)*4`.<br>- **KQL**: `DeviceNetworkEvents \| summarize HourlyCount=count() by bin(Timestamp, 1h) \| where HourlyCount > avg(HourlyCount) * 4`.<br>- **ELK**: `FROM logs-zeek.conn-* \| STATS COUNT() BY date_histogram(@timestamp, '1h') \| WHERE COUNT() > AVG(COUNT()) * 4`. |
| 5. Multiband C2 with Encrypted Payloads | Encrypted payloads in multiband C2, as in APT41. | - Network Traffic (DS0003: Zeek Conn)<br>- Packet Analysis | - **Splunk**: `index=network sourcetype=zeek_conn payload_entropy > 7 \| stats count by src_ip \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where AdditionalFields.PayloadEntropy > 7 \| summarize count() by DeviceIP \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.conn-* \| WHERE network.payload.entropy > 7 \| STATS COUNT() BY source.ip HAVING COUNT() > 5`. |
| 6. Multiband C2 in Cloud Environments | Multiband C2 in cloud, as in 2025 trends. | - Cloud Audit Logs (AWS CloudTrail)<br>- Network Traffic | - **Splunk**: `index=cloud sourcetype=aws:cloudtrail eventName="Invoke" AND userIdentity NOT IN (authorized_users) \| stats count by userIdentity, src_ip \| where count > 5`.<br>- **KQL**: `AWSCloudTrail \| where EventName == "Invoke" and Caller !in (authorizedUsers) \| summarize count() by Caller, SourceIP \| where count_ > 5`.<br>- **ELK**: `FROM logs-aws.cloudtrail-* \| WHERE event.action = 'Invoke' AND user.identity NOT IN ['authorized_users'] \| STATS COUNT() BY user.identity, source.ip HAVING COUNT() > 5`. |
| 7. Multiband C2 with Suspicious Headers | Multiband C2 with custom headers, as in Cobalt Strike. | - Network Traffic (DS0003: Zeek HTTP)<br>- Proxy Logs | - **Splunk**: `index=network sourcetype=zeek_http header IN ("*X-Cobalt*", "*Custom-Header*") \| stats count by src_ip, header \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "HTTP" and AdditionalFields.Header has_any ("X-Cobalt", "Custom-Header") \| summarize count() by DeviceIP, AdditionalFields.Header \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE http.header : ("*X-Cobalt*" OR "*Custom-Header*") \| STATS COUNT() BY source.ip, http.header HAVING COUNT() > 5`. |
| 8. Multiband C2 in Non-Standard Environments | Multiband C2 in Linux, as in Turla. | - Network Traffic (DS0003: Zeek Conn)<br>- Linux Logs | - **Splunk**: `index=linux sourcetype=auditd syscall="connect" AND dest_port=443 AND exe NOT IN (known_apps) \| stats count by exe, dest_ip \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where RemotePort == 443 and InitiatingProcessName !in (knownApps) \| summarize count() by InitiatingProcessName, RemoteIP \| where count_ > 5`.<br>- **ELK**: `FROM logs-auditd-* \| WHERE syscall.name = "connect" AND destination.port = 443 AND process.exe NOT IN ['known_apps'] \| STATS COUNT() BY process.exe, destination.ip HAVING COUNT() > 5`. |
| 9. Multiband C2 with Multi-Stage Redirects | Multiband C2 with redirects, as in APT41. | - Network Traffic (DS0003: Zeek HTTP)<br>- Redirect Analysis | - **Splunk**: `index=network sourcetype=zeek_http status_code=302 \| stats count by src_ip, uri \| where count > 3`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "HTTP" and AdditionalFields.StatusCode == 302 \| summarize count() by DeviceIP, RemoteUrl \| where count_ > 3`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE http.status = 302 \| STATS COUNT() BY source.ip, http.uri HAVING COUNT() > 3`. |
| 10. Multiband C2 with Anomalous User Agents | Multiband C2 with unusual user agents, as in Cobalt Strike. | - Network Traffic (DS0003: Zeek HTTP)<br>- Proxy Logs | - **Splunk**: `index=network sourcetype=zeek_http user_agent NOT IN (known_agents) \| stats count by src_ip, user_agent \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "HTTP" and AdditionalFields.UserAgent !in (knownAgents) \| summarize count() by DeviceIP, AdditionalFields.UserAgent \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE http.user_agent NOT IN ['known_agents'] \| STATS COUNT() BY source.ip, http.user_agent HAVING COUNT() > 5`. |
| 11. Multiband C2 in Cloud Environments | Multiband C2 in cloud, as in 2025 trends. | - Cloud Audit Logs (AWS CloudTrail)<br>- Network Traffic | - **Splunk**: `index=cloud sourcetype=aws:cloudtrail eventName="Invoke" AND userIdentity NOT IN (authorized_users) \| stats count by userIdentity, src_ip \| where count > 5`.<br>- **KQL**: `AWSCloudTrail \| where EventName == "Invoke" and Caller !in (authorizedUsers) \| summarize count() by Caller, SourceIP \| where count_ > 5`.<br>- **ELK**: `FROM logs-aws.cloudtrail-* \| WHERE event.action = 'Invoke' AND user.identity NOT IN ['authorized_users'] \| STATS COUNT() BY user.identity, source.ip HAVING COUNT() > 5`. |
| 12. Multiband C2 with Suspicious Headers | Multiband C2 with custom headers, as in Cobalt Strike. | - Network Traffic (DS0003: Zeek HTTP)<br>- Proxy Logs | - **Splunk**: `index=network sourcetype=zeek_http header IN ("*X-Cobalt*", "*Custom-Header*") \| stats count by src_ip, header \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "HTTP" and AdditionalFields.Header has_any ("X-Cobalt", "Custom-Header") \| summarize count() by DeviceIP, AdditionalFields.Header \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE http.header : ("*X-Cobalt*" OR "*Custom-Header*") \| STATS COUNT() BY source.ip, http.header HAVING COUNT() > 5`. |
| 13. Multiband C2 in Non-Standard Environments | Multiband C2 in Linux, as in Turla. | - Network Traffic (DS0003: Zeek Conn)<br>- Linux Logs | - **Splunk**: `index=linux sourcetype=auditd syscall="connect" AND dest_port=443 AND exe NOT IN (known_apps) \| stats count by exe, dest_ip \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where RemotePort == 443 and InitiatingProcessName !in (knownApps) \| summarize count() by InitiatingProcessName, RemoteIP \| where count_ > 5`.<br>- **ELK**: `FROM logs-auditd-* \| WHERE syscall.name = "connect" AND destination.port = 443 AND process.exe NOT IN ['known_apps'] \| STATS COUNT() BY process.exe, destination.ip HAVING COUNT() > 5`. |
| 14. Multiband C2 with Multi-Stage Redirects | Multiband C2 with redirects, as in APT41. | - Network Traffic (DS0003: Zeek HTTP)<br>- Redirect Analysis | - **Splunk**: `index=network sourcetype=zeek_http status_code=302 \| stats count by src_ip, uri \| where count > 3`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "HTTP" and AdditionalFields.StatusCode == 302 \| summarize count() by DeviceIP, RemoteUrl \| where count_ > 3`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE http.status = 302 \| STATS COUNT() BY source.ip, http.uri HAVING COUNT() > 3`. |
| 15. Multiband C2 with Anomalous User Agents | Multiband C2 with unusual user agents, as in Cobalt Strike. | - Network Traffic (DS0003: Zeek HTTP)<br>- Proxy Logs | - **Splunk**: `index=network sourcetype=zeek_http user_agent NOT IN (known_agents) \| stats count by src_ip, user_agent \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "HTTP" and AdditionalFields.UserAgent !in (knownAgents) \| summarize count() by DeviceIP, AdditionalFields.UserAgent \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE http.user_agent NOT IN ['known_agents'] \| STATS COUNT() BY source.ip, http.user_agent HAVING COUNT() > 5`. |

### Multilayer Encryption (T1070.008)

| Hypothesis | Description | Data Sources | Hunting Queries |
|------------|-------------|--------------|-----------------|
| 1. Multilayer Encrypted C2 Traffic | Adversaries use multilayer encryption for C2, as in APT41. High risk in environments with limited decryption capabilities. | - Network Traffic (DS0003: Zeek SSL)<br>- Packet Analysis | - **Splunk**: `index=network sourcetype=zeek_ssl cert_algorithm IN ("AES", "RSA") AND cert_layers > 1 \| stats count by src_ip, cert_algorithm \| where count > 5` (Detects multilayer encryption).<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "SSL" and AdditionalFields.CertAlgorithm has_any ("AES", "RSA") and AdditionalFields.CertLayers > 1 \| summarize count() by DeviceIP, AdditionalFields.CertAlgorithm \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.ssl-* \| WHERE ssl.certificate.algorithm : ("AES" OR "RSA") AND ssl.certificate.layers > 1 \| STATS COUNT() BY source.ip, ssl.certificate.algorithm HAVING COUNT() > 5`. |
| 2. Multilayer Encryption with Anomalous Key Exchange | Anomalous key exchanges in multilayer C2, as in Turla. | - Network Traffic (DS0003: Zeek SSL)<br>- Packet Analysis | - **Splunk**: `index=network sourcetype=zeek_ssl handshake_time < 100 AND cert_layers > 1 \| stats count by src_ip \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "SSL" and AdditionalFields.HandshakeTime < 100 and AdditionalFields.CertLayers > 1 \| summarize count() by DeviceIP \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.ssl-* \| WHERE ssl.handshake.time < 100 AND ssl.certificate.layers > 1 \| STATS COUNT() BY source.ip HAVING COUNT() > 5`. |
| 3. Multilayer Encryption from Compromised Endpoints | Compromised endpoints use multilayer encryption for C2, as in FIN7. | - Process Creation (DS0009: Sysmon ID 1)<br>- Network Traffic | - **Splunk**: `index=endpoint sourcetype=sysmon EventCode=1 CommandLine="*encrypt*" \| join host [search index=network sourcetype=zeek_ssl cert_layers > 1] \| stats count by host, CommandLine, cert_algorithm \| where count > 3`.<br>- **KQL**: `DeviceProcessEvents \| where ProcessCommandLine contains "encrypt" \| join kind=inner (DeviceNetworkEvents \| where Protocol == "SSL" and AdditionalFields.CertLayers > 1) on DeviceName \| summarize count() by DeviceName, ProcessCommandLine, AdditionalFields.CertAlgorithm \| where count_ > 3`.<br>- **ELK**: `FROM logs-endpoint.process-* \| WHERE process.command_line : "*encrypt*" \| JOIN logs-zeek.ssl-* ON host.name WHERE ssl.certificate.layers > 1 \| STATS COUNT() BY host.name, process.command_line, ssl.certificate.algorithm HAVING COUNT() > 3`. |
| 4. Multilayer Encryption with Anomalous Timing | Multilayer encryption with unusual timing, as in 2025 trends. | - Network Traffic (DS0003: Zeek SSL)<br>- Metrics | - **Splunk**: `index=network sourcetype=zeek_ssl cert_layers > 1 \| timechart span=1h count \| where count > avg(count)*4`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "SSL" and AdditionalFields.CertLayers > 1 \| summarize HourlyCount=count() by bin(Timestamp, 1h) \| where HourlyCount > avg(HourlyCount) * 4`.<br>- **ELK**: `FROM logs-zeek.ssl-* \| WHERE ssl.certificate.layers > 1 \| STATS COUNT() BY date_histogram(@timestamp, '1h') \| WHERE COUNT() > AVG(COUNT()) * 4`. |
| 5. Multilayer Encryption with Encrypted Payloads | Encrypted payloads in multilayer C2, as in APT41. | - Network Traffic (DS0003: Zeek HTTP)<br>- Packet Analysis | - **Splunk**: `index=network sourcetype=zeek_http payload_entropy > 7 \| stats count by src_ip, uri \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "HTTP" and AdditionalFields.PayloadEntropy > 7 \| summarize count() by DeviceIP, RemoteUrl \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE http.payload.entropy > 7 \| STATS COUNT() BY source.ip, http.uri HAVING COUNT() > 5`. |
| 6. Multilayer Encryption in Cloud Environments | Multilayer encryption in cloud C2, as in 2025 trends. | - Cloud Audit Logs (AWS CloudTrail)<br>- Network Traffic | - **Splunk**: `index=cloud sourcetype=aws:cloudtrail eventName="Decrypt" AND userIdentity NOT IN (authorized_users) \| stats count by userIdentity, src_ip \| where count > 5`.<br>- **KQL**: `AWSCloudTrail \| where EventName == "Decrypt" and Caller !in (authorizedUsers) \| summarize count() by Caller, SourceIP \| where count_ > 5`.<br>- **ELK**: `FROM logs-aws.cloudtrail-* \| WHERE event.action = 'Decrypt' AND user.identity NOT IN ['authorized_users'] \| STATS COUNT() BY user.identity, source.ip HAVING COUNT() > 5`. |
| 7. Multilayer Encryption with Suspicious Headers | Multilayer encryption with custom headers, as in Cobalt Strike. | - Network Traffic (DS0003: Zeek HTTP)<br>- Proxy Logs | - **Splunk**: `index=network sourcetype=zeek_http header IN ("*X-Cobalt*", "*Custom-Header*") \| stats count by src_ip, header \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "HTTP" and AdditionalFields.Header has_any ("X-Cobalt", "Custom-Header") \| summarize count() by DeviceIP, AdditionalFields.Header \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE http.header : ("*X-Cobalt*" OR "*Custom-Header*") \| STATS COUNT() BY source.ip, http.header HAVING COUNT() > 5`. |
| 8. Multilayer Encryption in Non-Standard Environments | Multilayer encryption in Linux, as in Turla. | - Network Traffic (DS0003: Zeek SSL)<br>- Linux Logs | - **Splunk**: `index=linux sourcetype=auditd syscall="connect" AND dest_port=443 AND exe NOT IN (known_apps) \| stats count by exe, dest_ip \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where RemotePort == 443 and InitiatingProcessName !in (knownApps) \| summarize count() by InitiatingProcessName, RemoteIP \| where count_ > 5`.<br>- **ELK**: `FROM logs-auditd-* \| WHERE syscall.name = "connect" AND destination.port = 443 AND process.exe NOT IN ['known_apps'] \| STATS COUNT() BY process.exe, destination.ip HAVING COUNT() > 5`. |
| 9. Multilayer Encryption with Multi-Stage Redirects | Multilayer encryption with redirects, as in APT41. | - Network Traffic (DS0003: Zeek HTTP)<br>- Redirect Analysis | - **Splunk**: `index=network sourcetype=zeek_http status_code=302 \| stats count by src_ip, uri \| where count > 3`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "HTTP" and AdditionalFields.StatusCode == 302 \| summarize count() by DeviceIP, RemoteUrl \| where count_ > 3`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE http.status = 302 \| STATS COUNT() BY source.ip, http.uri HAVING COUNT() > 3`. |
| 10. Multilayer Encryption with Anomalous User Agents | Multilayer encryption with unusual user agents, as in Cobalt Strike. | - Network Traffic (DS0003: Zeek HTTP)<br>- Proxy Logs | - **Splunk**: `index=network sourcetype=zeek_http user_agent NOT IN (known_agents) \| stats count by src_ip, user_agent \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "HTTP" and AdditionalFields.UserAgent !in (knownAgents) \| summarize count() by DeviceIP, AdditionalFields.UserAgent \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE http.user_agent NOT IN ['known_agents'] \| STATS COUNT() BY source.ip, http.user_agent HAVING COUNT() > 5`. |
| 11. Multilayer Encryption in Cloud Environments | Multilayer encryption in cloud, as in 2025 trends. | - Cloud Audit Logs (AWS CloudTrail)<br>- Network Traffic | - **Splunk**: `index=cloud sourcetype=aws:cloudtrail eventName="Decrypt" AND userIdentity NOT IN (authorized_users) \| stats count by userIdentity, src_ip \| where count > 5`.<br>- **KQL**: `AWSCloudTrail \| where EventName == "Decrypt" and Caller !in (authorizedUsers) \| summarize count() by Caller, SourceIP \| where count_ > 5`.<br>- **ELK**: `FROM logs-aws.cloudtrail-* \| WHERE event.action = 'Decrypt' AND user.identity NOT IN ['authorized_users'] \| STATS COUNT() BY user.identity, source.ip HAVING COUNT() > 5`. |
| 12. Multilayer Encryption with Suspicious Headers | Multilayer encryption with custom headers, as in Cobalt Strike. | - Network Traffic (DS0003: Zeek HTTP)<br>- Proxy Logs | - **Splunk**: `index=network sourcetype=zeek_http header IN ("*X-Cobalt*", "*Custom-Header*") \| stats count by src_ip, header \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "HTTP" and AdditionalFields.Header has_any ("X-Cobalt", "Custom-Header") \| summarize count() by DeviceIP, AdditionalFields.Header \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE http.header : ("*X-Cobalt*" OR "*Custom-Header*") \| STATS COUNT() BY source.ip, http.header HAVING COUNT() > 5`. |
| 13. Multilayer Encryption in Non-Standard Environments | Multilayer encryption in Linux, as in Turla. | - Network Traffic (DS0003: Zeek SSL)<br>- Linux Logs | - **Splunk**: `index=linux sourcetype=auditd syscall="connect" AND dest_port=443 AND exe NOT IN (known_apps) \| stats count by exe, dest_ip \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where RemotePort == 443 and InitiatingProcessName !in (knownApps) \| summarize count() by InitiatingProcessName, RemoteIP \| where count_ > 5`.<br>- **ELK**: `FROM logs-auditd-* \| WHERE syscall.name = "connect" AND destination.port = 443 AND process.exe NOT IN ['known_apps'] \| STATS COUNT() BY process.exe, destination.ip HAVING COUNT() > 5`. |
| 14. Multilayer Encryption with Multi-Stage Redirects | Multilayer encryption with redirects, as in APT41. | - Network Traffic (DS0003: Zeek HTTP)<br>- Redirect Analysis | - **Splunk**: `index=network sourcetype=zeek_http status_code=302 \| stats count by src_ip, uri \| where count > 3`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "HTTP" and AdditionalFields.StatusCode == 302 \| summarize count() by DeviceIP, RemoteUrl \| where count_ > 3`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE http.status = 302 \| STATS COUNT() BY source.ip, http.uri HAVING COUNT() > 3`. |
| 15. Multilayer Encryption with Anomalous User Agents | Multilayer encryption with unusual user agents, as in Cobalt Strike. | - Network Traffic (DS0003: Zeek HTTP)<br>- Proxy Logs | - **Splunk**: `index=network sourcetype=zeek_http user_agent NOT IN (known_agents) \| stats count by src_ip, user_agent \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "HTTP" and AdditionalFields.UserAgent !in (knownAgents) \| summarize count() by DeviceIP, AdditionalFields.UserAgent \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE http.user_agent NOT IN ['known_agents'] \| STATS COUNT() BY source.ip, http.user_agent HAVING COUNT() > 5`. | 

### Multihop Proxy (T1090.003)

| Hypothesis | Description | Data Sources | Hunting Queries |
|------------|-------------|--------------|-----------------|
| 1. Multihop Proxy for C2 | Adversaries use multihop proxies for C2, as in APT41. High risk in environments with limited outbound traffic monitoring. | - Network Traffic (DS0003: Zeek Conn)<br>- Proxy Logs | - **Splunk**: `index=network sourcetype=zeek_conn dest_ip IN (proxy_ips) AND NOT src_ip IN (known_clients) \| stats count by src_ip, dest_ip \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where RemoteIP in (proxyIPs) and DeviceIP !in (knownClients) \| summarize count() by DeviceIP, RemoteIP \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.conn-* \| WHERE destination.ip IN ['proxy_ips'] AND source.ip NOT IN ['known_clients'] \| STATS COUNT() BY source.ip, destination.ip HAVING COUNT() > 5`. |
| 2. Multihop Proxy with Encrypted Traffic | Encrypted traffic through multihop proxies, as in Turla. | - Network Traffic (DS0003: Zeek SSL)<br>- Proxy Logs | - **Splunk**: `index=network sourcetype=zeek_ssl dest_port=443 AND dest_ip IN (proxy_ips) \| stats count by src_ip, dest_ip \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where RemotePort == 443 and RemoteIP in (proxyIPs) \| summarize count() by DeviceIP, RemoteIP \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.ssl-* \| WHERE destination.port = 443 AND destination.ip IN ['proxy_ips'] \| STATS COUNT() BY source.ip, destination.ip HAVING COUNT() > 5`. |
| 3. Multihop Proxy Access from Compromised Endpoints | Compromised endpoints access multihop proxies, as in FIN7. | - Process Creation (DS0009: Sysmon ID 1)<br>- Network Traffic | - **Splunk**: `index=endpoint sourcetype=sysmon EventCode=1 CommandLine="*proxy*" \| join host [search index=network sourcetype=zeek_conn dest_ip IN (proxy_ips)] \| stats count by host, CommandLine, dest_ip \| where count > 3`.<br>- **KQL**: `DeviceProcessEvents \| where ProcessCommandLine contains "proxy" \| join kind=inner (DeviceNetworkEvents \| where RemoteIP in (proxyIPs)) on DeviceName \| summarize count() by DeviceName, ProcessCommandLine, RemoteIP \| where count_ > 3`.<br>- **ELK**: `FROM logs-endpoint.process-* \| WHERE process.command_line : "*proxy*" \| JOIN logs-zeek.conn-* ON host.name WHERE destination.ip IN ['proxy_ips'] \| STATS COUNT() BY host.name, process.command_line, destination.ip HAVING COUNT() > 3`. |
| 4. Multihop Proxy with Anomalous Timing | Multihop proxy access with unusual timing, as in 2025 trends. | - Network Traffic (DS0003: Zeek Conn)<br>- Metrics | - **Splunk**: `index=network sourcetype=zeek_conn dest_ip IN (proxy_ips) \| timechart span=1h count \| where count > avg(count)*4`.<br>- **KQL**: `DeviceNetworkEvents \| where RemoteIP in (proxyIPs) \| summarize HourlyCount=count() by bin(Timestamp, 1h) \| where HourlyCount > avg(HourlyCount) * 4`.<br>- **ELK**: `FROM logs-zeek.conn-* \| WHERE destination.ip IN ['proxy_ips'] \| STATS COUNT() BY date_histogram(@timestamp, '1h') \| WHERE COUNT() > AVG(COUNT()) * 4`. |
| 5. Multihop Proxy with Encrypted Payloads | Encrypted payloads through multihop proxies, as in APT41. | - Network Traffic (DS0003: Zeek HTTP)<br>- Packet Analysis | - **Splunk**: `index=network sourcetype=zeek_http dest_ip IN (proxy_ips) AND payload_entropy > 7 \| stats count by src_ip, uri \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where RemoteIP in (proxyIPs) and AdditionalFields.PayloadEntropy > 7 \| summarize count() by DeviceIP, RemoteUrl \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE destination.ip IN ['proxy_ips'] AND http.payload.entropy > 7 \| STATS COUNT() BY source.ip, http.uri HAVING COUNT() > 5`. |
| 6. Multihop Proxy in Cloud Environments | Multihop proxy access in cloud, as in 2025 trends. | - Cloud Audit Logs (AWS CloudTrail)<br>- Network Traffic | - **Splunk**: `index=cloud sourcetype=aws:cloudtrail eventName="Invoke" AND userIdentity NOT IN (authorized_users) \| stats count by userIdentity, src_ip \| where count > 5`.<br>- **KQL**: `AWSCloudTrail \| where EventName == "Invoke" and Caller !in (authorizedUsers) \| summarize count() by Caller, SourceIP \| where count_ > 5`.<br>- **ELK**: `FROM logs-aws.cloudtrail-* \| WHERE event.action = 'Invoke' AND user.identity NOT IN ['authorized_users'] \| STATS COUNT() BY user.identity, source.ip HAVING COUNT() > 5`. |
| 7. Multihop Proxy with Suspicious Headers | Multihop proxy with custom headers, as in Cobalt Strike. | - Network Traffic (DS0003: Zeek HTTP)<br>- Proxy Logs | - **Splunk**: `index=network sourcetype=zeek_http dest_ip IN (proxy_ips) AND header IN ("*X-Cobalt*", "*Custom-Header*") \| stats count by src_ip, header \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where RemoteIP in (proxyIPs) and AdditionalFields.Header has_any ("X-Cobalt", "Custom-Header") \| summarize count() by DeviceIP, AdditionalFields.Header \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE destination.ip IN ['proxy_ips'] AND http.header : ("*X-Cobalt*" OR "*Custom-Header*") \| STATS COUNT() BY source.ip, http.header HAVING COUNT() > 5`. |
| 9. Multihop Proxy in Non-Standard Environments | Multihop proxy access in Linux, as in Turla. | - Network Traffic (DS0003: Zeek Conn)<br>- Linux Logs | - **Splunk**: `index=linux sourcetype=auditd syscall="connect" AND dest_ip IN (proxy_ips) AND exe NOT IN (known_apps) \| stats count by exe, dest_ip \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where RemoteIP in (proxyIPs) and InitiatingProcessName !in (knownApps) \| summarize count() by InitiatingProcessName, RemoteIP \| where count_ > 5`.<br>- **ELK**: `FROM logs-auditd-* \| WHERE syscall.name = "connect" AND destination.ip IN ['proxy_ips'] AND process.exe NOT IN ['known_apps'] \| STATS COUNT() BY process.exe, destination.ip HAVING COUNT() > 5`. |
| 10. Multihop Proxy with Multi-Stage Redirects | Multihop proxy with redirects, as in APT41. | - Network Traffic (DS0003: Zeek HTTP)<br>- Redirect Analysis | - **Splunk**: `index=network sourcetype=zeek_http status_code=302 \| stats count by src_ip, uri \| where count > 3`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "HTTP" and AdditionalFields.StatusCode == 302 \| summarize count() by DeviceIP, RemoteUrl \| where count_ > 3`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE http.status = 302 \| STATS COUNT() BY source.ip, http.uri HAVING COUNT() > 3`. |
| 11. Multihop Proxy with Anomalous User Agents | Multihop proxy with unusual user agents, as in Cobalt Strike. | - Network Traffic (DS0003: Zeek HTTP)<br>- Proxy Logs | - **Splunk**: `index=network sourcetype=zeek_http dest_ip IN (proxy_ips) AND user_agent NOT IN (known_agents) \| stats count by src_ip, user_agent \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where RemoteIP in (proxyIPs) and AdditionalFields.UserAgent !in (knownAgents) \| summarize count() by DeviceIP, AdditionalFields.UserAgent \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE destination.ip IN ['proxy_ips'] AND http.user_agent NOT IN ['known_agents'] \| STATS COUNT() BY source.ip, http.user_agent HAVING COUNT() > 5`. |
| 12. Multihop Proxy in Cloud Environments | Multihop proxy access in cloud, as in 2025 trends. | - Cloud Audit Logs (AWS CloudTrail)<br>- Network Traffic | - **Splunk**: `index=cloud sourcetype=aws:cloudtrail eventName="Invoke" AND userIdentity NOT IN (authorized_users) \| stats count by userIdentity, src_ip \| where count > 5`.<br>- **KQL**: `AWSCloudTrail \| where EventName == "Invoke" and Caller !in (authorizedUsers) \| summarize count() by Caller, SourceIP \| where count_ > 5`.<br>- **ELK**: `FROM logs-aws.cloudtrail-* \| WHERE event.action = 'Invoke' AND user.identity NOT IN ['authorized_users'] \| STATS COUNT() BY user.identity, source.ip HAVING COUNT() > 5`. |
| 13. Multihop Proxy with Anomalous Timing | Multihop proxy access with unusual timing, as in 2025 trends. | - Network Traffic (DS0003: Zeek Conn)<br>- Metrics | - **Splunk**: `index=network sourcetype=zeek_conn dest_ip IN (proxy_ips) \| timechart span=1h count \| where count > avg(count)*4`.<br>- **KQL**: `DeviceNetworkEvents \| where RemoteIP in (proxyIPs) \| summarize HourlyCount=count() by bin(Timestamp, 1h) \| where HourlyCount > avg(HourlyCount) * 4`.<br>- **ELK**: `FROM logs-zeek.conn-* \| WHERE destination.ip IN ['proxy_ips'] \| STATS COUNT() BY date_histogram(@timestamp, '1h') \| WHERE COUNT() > AVG(COUNT()) * 4`. |
| 14. Multihop Proxy with Multi-Stage Redirects | Multihop proxy with redirects, as in APT41. | - Network Traffic (DS0003: Zeek HTTP)<br>- Redirect Analysis | - **Splunk**: `index=network sourcetype=zeek_http status_code=302 \| stats count by src_ip, uri \| where count > 3`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "HTTP" and AdditionalFields.StatusCode == 302 \| summarize count() by DeviceIP, RemoteUrl \| where count_ > 3`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE http.status = 302 \| STATS COUNT() BY source.ip, http.uri HAVING COUNT() > 3`. |
| 15. Multihop Proxy with Anomalous User Agents | Multihop proxy with unusual user agents, as in Cobalt Strike. | - Network Traffic (DS0003: Zeek HTTP)<br>- Proxy Logs | - **Splunk**: `index=network sourcetype=zeek_http dest_ip IN (proxy_ips) AND user_agent NOT IN (known_agents) \| stats count by src_ip, user_agent \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where RemoteIP in (proxyIPs) and AdditionalFields.UserAgent !in (knownAgents) \| summarize count() by DeviceIP, AdditionalFields.UserAgent \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE destination.ip IN ['proxy_ips'] AND http.user_agent NOT IN ['known_agents'] \| STATS COUNT() BY source.ip, http.user_agent HAVING COUNT() > 5`. | 

### Multiband Communication (T1026)

| Hypothesis | Description | Data Sources | Hunting Queries |
|------------|-------------|--------------|-----------------|
| 1. Multiband C2 Communication | Adversaries use multiband communication for C2, as in APT41. High risk in environments with limited frequency monitoring. | - Network Traffic (DS0003: Zeek Conn)<br>- Radio Logs | - **Splunk**: `index=network sourcetype=zeek_conn frequency_band NOT IN (known_bands) \| stats count by src_ip, frequency_band \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where AdditionalFields.FrequencyBand !in (knownBands) \| summarize count() by DeviceIP, AdditionalFields.FrequencyBand \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.conn-* \| WHERE network.frequency.band NOT IN ['known_bands'] \| STATS COUNT() BY source.ip, network.frequency.band HAVING COUNT() > 5`. |
| 2. Multiband C2 with Encrypted Payloads | Encrypted payloads in multiband C2, as in Turla. | - Network Traffic (DS0003: Zeek Conn)<br>- Packet Analysis | - **Splunk**: `index=network sourcetype=zeek_conn payload_entropy > 7 \| stats count by src_ip \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where AdditionalFields.PayloadEntropy > 7 \| summarize count() by DeviceIP \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.conn-* \| WHERE network.payload.entropy > 7 \| STATS COUNT() BY source.ip HAVING COUNT() > 5`. |
| 3. Multiband C2 from Compromised Endpoints | Compromised endpoints use multiband C2, as in FIN7. | - Process Creation (DS0009: Sysmon ID 1)<br>- Network Traffic | - **Splunk**: `index=endpoint sourcetype=sysmon EventCode=1 CommandLine="*multiband*" \| join host [search index=network sourcetype=zeek_conn frequency_band NOT IN (known_bands)] \| stats count by host, CommandLine, frequency_band \| where count > 3`.<br>- **KQL**: `DeviceProcessEvents \| where ProcessCommandLine contains "multiband" \| join kind=inner (DeviceNetworkEvents \| where AdditionalFields.FrequencyBand !in (knownBands)) on DeviceName \| summarize count() by DeviceName, ProcessCommandLine, AdditionalFields.FrequencyBand \| where count_ > 3`.<br>- **ELK**: `FROM logs-endpoint.process-* \| WHERE process.command_line : "*multiband*" \| JOIN logs-zeek.conn-* ON host.name WHERE network.frequency.band NOT IN ['known_bands'] \| STATS COUNT() BY host.name, process.command_line, network.frequency.band HAVING COUNT() > 3`. |
| 4. Multiband C2 with Anomalous Timing | Multiband C2 with unusual timing, as in 2025 trends. | - Network Traffic (DS0003: Zeek Conn)<br>- Metrics | - **Splunk**: `index=network sourcetype=zeek_conn \| timechart span=1h count \| where count > avg(count)*4`.<br>- **KQL**: `DeviceNetworkEvents \| summarize HourlyCount=count() by bin(Timestamp, 1h) \| where HourlyCount > avg(HourlyCount) * 4`.<br>- **ELK**: `FROM logs-zeek.conn-* \| STATS COUNT() BY date_histogram(@timestamp, '1h') \| WHERE COUNT() > AVG(COUNT()) * 4`. |
| 5. Multiband C2 with Encrypted Payloads | Encrypted payloads in multiband C2, as in APT41. | - Network Traffic (DS0003: Zeek Conn)<br>- Packet Analysis | - **Splunk**: `index=network sourcetype=zeek_conn payload_entropy > 7 \| stats count by src_ip \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where AdditionalFields.PayloadEntropy > 7 \| summarize count() by DeviceIP \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.conn-* \| WHERE network.payload.entropy > 7 \| STATS COUNT() BY source.ip HAVING COUNT() > 5`. |
| 6. Multiband C2 in Cloud Environments | Multiband C2 in cloud, as in 2025 trends. | - Cloud Audit Logs (AWS CloudTrail)<br>- Network Traffic | - **Splunk**: `index=cloud sourcetype=aws:cloudtrail eventName="Invoke" AND userIdentity NOT IN (authorized_users) \| stats count by userIdentity, src_ip \| where count > 5`.<br>- **KQL**: `AWSCloudTrail \| where EventName == "Invoke" and Caller !in (authorizedUsers) \| summarize count() by Caller, SourceIP \| where count_ > 5`.<br>- **ELK**: `FROM logs-aws.cloudtrail-* \| WHERE event.action = 'Invoke' AND user.identity NOT IN ['authorized_users'] \| STATS COUNT() BY user.identity, source.ip HAVING COUNT() > 5`. |
| 7. Multiband C2 with Suspicious Headers | Multiband C2 with custom headers, as in Cobalt Strike. | - Network Traffic (DS0003: Zeek HTTP)<br>- Proxy Logs | - **Splunk**: `index=network sourcetype=zeek_http header IN ("*X-Cobalt*", "*Custom-Header*") \| stats count by src_ip, header \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "HTTP" and AdditionalFields.Header has_any ("X-Cobalt", "Custom-Header") \| summarize count() by DeviceIP, AdditionalFields.Header \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE http.header : ("*X-Cobalt*" OR "*Custom-Header*") \| STATS COUNT() BY source.ip, http.header HAVING COUNT() > 5`. |
| 8. Multiband C2 in Non-Standard Environments | Multiband C2 in Linux, as in Turla. | - Network Traffic (DS0003: Zeek Conn)<br>- Linux Logs | - **Splunk**: `index=linux sourcetype=auditd syscall="connect" AND dest_port=443 AND exe NOT IN (known_apps) \| stats count by exe, dest_ip \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where RemotePort == 443 and InitiatingProcessName !in (knownApps) \| summarize count() by InitiatingProcessName, RemoteIP \| where count_ > 5`.<br>- **ELK**: `FROM logs-auditd-* \| WHERE syscall.name = "connect" AND destination.port = 443 AND process.exe NOT IN ['known_apps'] \| STATS COUNT() BY process.exe, destination.ip HAVING COUNT() > 5`. |
| 9. Multiband C2 with Multi-Stage Redirects | Multiband C2 with redirects, as in APT41. | - Network Traffic (DS0003: Zeek HTTP)<br>- Redirect Analysis | - **Splunk**: `index=network sourcetype=zeek_http status_code=302 \| stats count by src_ip, uri \| where count > 3`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "HTTP" and AdditionalFields.StatusCode == 302 \| summarize count() by DeviceIP, RemoteUrl \| where count_ > 3`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE http.status = 302 \| STATS COUNT() BY source.ip, http.uri HAVING COUNT() > 3`. |
| 10. Multiband C2 with Anomalous User Agents | Multiband C2 with unusual user agents, as in Cobalt Strike. | - Network Traffic (DS0003: Zeek HTTP)<br>- Proxy Logs | - **Splunk**: `index=network sourcetype=zeek_http user_agent NOT IN (known_agents) \| stats count by src_ip, user_agent \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "HTTP" and AdditionalFields.UserAgent !in (knownAgents) \| summarize count() by DeviceIP, AdditionalFields.UserAgent \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE http.user_agent NOT IN ['known_agents'] \| STATS COUNT() BY source.ip, http.user_agent HAVING COUNT() > 5`. |
| 11. Multiband C2 in Cloud Environments | Multiband C2 in cloud, as in 2025 trends. | - Cloud Audit Logs (AWS CloudTrail)<br>- Network Traffic | - **Splunk**: `index=cloud sourcetype=aws:cloudtrail eventName="Invoke" AND userIdentity NOT IN (authorized_users) \| stats count by userIdentity, src_ip \| where count > 5`.<br>- **KQL**: `AWSCloudTrail \| where EventName == "Invoke" and Caller !in (authorizedUsers) \| summarize count() by Caller, SourceIP \| where count_ > 5`.<br>- **ELK**: `FROM logs-aws.cloudtrail-* \| WHERE event.action = 'Invoke' AND user.identity NOT IN ['authorized_users'] \| STATS COUNT() BY user.identity, source.ip HAVING COUNT() > 5`. |
| 12. Multiband C2 with Suspicious Headers | Multiband C2 with custom headers, as in Cobalt Strike. | - Network Traffic (DS0003: Zeek HTTP)<br>- Proxy Logs | - **Splunk**: `index=network sourcetype=zeek_http header IN ("*X-Cobalt*", "*Custom-Header*") \| stats count by src_ip, header \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "HTTP" and AdditionalFields.Header has_any ("X-Cobalt", "Custom-Header") \| summarize count() by DeviceIP, AdditionalFields.Header \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE http.header : ("*X-Cobalt*" OR "*Custom-Header*") \| STATS COUNT() BY source.ip, http.header HAVING COUNT() > 5`. |
| 13. Multiband C2 in Non-Standard Environments | Multiband C2 in Linux, as in Turla. | - Network Traffic (DS0003: Zeek Conn)<br>- Linux Logs | - **Splunk**: `index=linux sourcetype=auditd syscall="connect" AND dest_port=443 AND exe NOT IN (known_apps) \| stats count by exe, dest_ip \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where RemotePort == 443 and InitiatingProcessName !in (knownApps) \| summarize count() by InitiatingProcessName, RemoteIP \| where count_ > 5`.<br>- **ELK**: `FROM logs-auditd-* \| WHERE syscall.name = "connect" AND destination.port = 443 AND process.exe NOT IN ['known_apps'] \| STATS COUNT() BY process.exe, destination.ip HAVING COUNT() > 5`. |
| 14. Multiband C2 with Multi-Stage Redirects | Multiband C2 with redirects, as in APT41. | - Network Traffic (DS0003: Zeek HTTP)<br>- Redirect Analysis | - **Splunk**: `index=network sourcetype=zeek_http status_code=302 \| stats count by src_ip, uri \| where count > 3`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "HTTP" and AdditionalFields.StatusCode == 302 \| summarize count() by DeviceIP, RemoteUrl \| where count_ > 3`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE http.status = 302 \| STATS COUNT() BY source.ip, http.uri HAVING COUNT() > 3`. |
| 15. Multiband C2 with Anomalous User Agents | Multiband C2 with unusual user agents, as in Cobalt Strike. | - Network Traffic (DS0003: Zeek HTTP)<br>- Proxy Logs | - **Splunk**: `index=network sourcetype=zeek_http user_agent NOT IN (known_agents) \| stats count by src_ip, user_agent \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "HTTP" and AdditionalFields.UserAgent !in (knownAgents) \| summarize count() by DeviceIP, AdditionalFields.UserAgent \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE http.user_agent NOT IN ['known_agents'] \| STATS COUNT() BY source.ip, http.user_agent HAVING COUNT() > 5`. | 


### Non-Application Layer Protocol (T1095)

| Hypothesis | Description | Data Sources | Hunting Queries |
|------------|-------------|--------------|-----------------|
| 1. Custom Protocol C2 Communication | Adversaries use non-application layer protocols like ICMP for C2, as in APT41 campaigns. High risk in Windows and cloud environments with limited protocol inspection. | - Network Traffic (DS0003: Zeek Conn)<br>- Firewall Logs | - **Splunk**: `index=network sourcetype=zeek_conn protocol NOT IN ("tcp", "udp", "http", "dns") \| stats count by src_ip, protocol \| where count > 5` (Detects unusual protocols for C2).<br>- **KQL**: `DeviceNetworkEvents \| where Protocol !in ("TCP", "UDP", "HTTP", "DNS") \| summarize count() by DeviceIP, Protocol \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.conn-* \| WHERE network.protocol NOT IN ['tcp', 'udp', 'http', 'dns'] \| STATS COUNT() BY source.ip, network.protocol HAVING COUNT() > 5`. |
| 2. ICMP Tunneling for C2 | Adversaries tunnel C2 data over ICMP, as in Turla attacks. | - Network Traffic (DS0003: Zeek ICMP)<br>- Packet Analysis | - **Splunk**: `index=network sourcetype=zeek_icmp type="echo" AND payload_length > 100 \| stats count by src_ip, dest_ip \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "ICMP" and AdditionalFields.Type == "echo" and AdditionalFields.PayloadLength > 100 \| summarize count() by DeviceIP, RemoteIP \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.icmp-* \| WHERE icmp.type = 'echo' AND icmp.payload.length > 100 \| STATS COUNT() BY source.ip, destination.ip HAVING COUNT() > 5`. |
| 3. Raw Socket Protocols for C2 | Adversaries use raw sockets for custom protocols in C2, as in FIN7. | - Network Traffic (DS0003: Zeek Conn)<br>- Endpoint Logs | - **Splunk**: `index=network sourcetype=zeek_conn protocol="raw" \| stats count by src_ip \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "Raw" \| summarize count() by DeviceIP \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.conn-* \| WHERE network.protocol = 'raw' \| STATS COUNT() BY source.ip HAVING COUNT() > 5`. |
| 4. Non-Application Layer C2 from Compromised Endpoints | Compromised endpoints use non-application layer protocols for C2, as in Turla. | - Process Creation (DS0009: Sysmon ID 1)<br>- Network Traffic | - **Splunk**: `index=endpoint sourcetype=sysmon EventCode=1 CommandLine="*raw socket*" \| join host [search index=network sourcetype=zeek_conn protocol NOT IN ("tcp", "udp")] \| stats count by host, CommandLine, protocol \| where count > 3`.<br>- **KQL**: `DeviceProcessEvents \| where ProcessCommandLine contains "raw socket" \| join kind=inner (DeviceNetworkEvents \| where Protocol !in ("TCP", "UDP")) on DeviceName \| summarize count() by DeviceName, ProcessCommandLine, Protocol \| where count_ > 3`.<br>- **ELK**: `FROM logs-endpoint.process-* \| WHERE process.command_line : "*raw socket*" \| JOIN logs-zeek.conn-* ON host.name WHERE network.protocol NOT IN ['tcp', 'udp'] \| STATS COUNT() BY host.name, process.command_line, network.protocol HAVING COUNT() > 3`. |
| 5. Non-Application Layer C2 with Anomalous Timing | Non-application layer C2 with unusual timing, as in 2025 trends. | - Network Traffic (DS0003: Zeek Conn)<br>- Metrics | - **Splunk**: `index=network sourcetype=zeek_conn protocol NOT IN ("tcp", "udp") \| timechart span=1h count \| where count > avg(count)*4`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol !in ("TCP", "UDP") \| summarize HourlyCount=count() by bin(Timestamp, 1h) \| where HourlyCount > avg(HourlyCount) * 4`.<br>- **ELK**: `FROM logs-zeek.conn-* \| WHERE network.protocol NOT IN ['tcp', 'udp'] \| STATS COUNT() BY date_histogram(@timestamp, '1h') \| WHERE COUNT() > AVG(COUNT()) * 4`. |
| 6. Non-Application Layer C2 in Cloud Environments | Non-application layer C2 in cloud, as in 2025 trends. | - Cloud Audit Logs (AWS CloudTrail)<br>- Network Traffic | - **Splunk**: `index=cloud sourcetype=aws:cloudtrail eventName="Invoke" AND userIdentity NOT IN (authorized_users) \| stats count by userIdentity, src_ip \| where count > 5`.<br>- **KQL**: `AWSCloudTrail \| where EventName == "Invoke" and Caller !in (authorizedUsers) \| summarize count() by Caller, SourceIP \| where count_ > 5`.<br>- **ELK**: `FROM logs-aws.cloudtrail-* \| WHERE event.action = 'Invoke' AND user.identity NOT IN ['authorized_users'] \| STATS COUNT() BY user.identity, source.ip HAVING COUNT() > 5`. |
| 7. Non-Application Layer C2 with Suspicious Headers | Non-application layer C2 with custom headers, as in Cobalt Strike. | - Network Traffic (DS0003: Zeek Conn)<br>- Proxy Logs | - **Splunk**: `index=network sourcetype=zeek_conn header IN ("*X-Cobalt*", "*Custom-Header*") \| stats count by src_ip, header \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where AdditionalFields.Header has_any ("X-Cobalt", "Custom-Header") \| summarize count() by DeviceIP, AdditionalFields.Header \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.conn-* \| WHERE network.header : ("*X-Cobalt*" OR "*Custom-Header*") \| STATS COUNT() BY source.ip, network.header HAVING COUNT() > 5`. |
| 8. Non-Application Layer C2 in Non-Standard Environments | Non-application layer C2 in Linux, as in Turla. | - Network Traffic (DS0003: Zeek Conn)<br>- Linux Logs | - **Splunk**: `index=linux sourcetype=auditd syscall="connect" AND protocol NOT IN ("tcp", "udp") \| stats count by exe, dest_ip \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol !in ("TCP", "UDP") and InitiatingProcessName !in (knownApps) \| summarize count() by InitiatingProcessName, RemoteIP \| where count_ > 5`.<br>- **ELK**: `FROM logs-auditd-* \| WHERE syscall.name = "connect" AND network.protocol NOT IN ['tcp', 'udp'] \| STATS COUNT() BY process.exe, destination.ip HAVING COUNT() > 5`. |
| 9. Non-Application Layer C2 with Multi-Stage Redirects | Non-application layer C2 with redirects, as in APT41. | - Network Traffic (DS0003: Zeek Conn)<br>- Redirect Analysis | - **Splunk**: `index=network sourcetype=zeek_conn status_code=302 \| stats count by src_ip, protocol \| where count > 3`.<br>- **KQL**: `DeviceNetworkEvents \| where AdditionalFields.StatusCode == 302 \| summarize count() by DeviceIP, Protocol \| where count_ > 3`.<br>- **ELK**: `FROM logs-zeek.conn-* \| WHERE network.status = 302 \| STATS COUNT() BY source.ip, network.protocol HAVING COUNT() > 3`. |
| 10. Non-Application Layer C2 with Anomalous User Agents | Non-application layer C2 with unusual user agents, as in Cobalt Strike. | - Network Traffic (DS0003: Zeek Conn)<br>- Proxy Logs | - **Splunk**: `index=network sourcetype=zeek_conn user_agent NOT IN (known_agents) \| stats count by src_ip, user_agent \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where AdditionalFields.UserAgent !in (knownAgents) \| summarize count() by DeviceIP, AdditionalFields.UserAgent \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.conn-* \| WHERE network.user_agent NOT IN ['known_agents'] \| STATS COUNT() BY source.ip, network.user_agent HAVING COUNT() > 5`. |
| 11. Non-Application Layer C2 in Cloud Environments | Non-application layer C2 in cloud, as in 2025 trends. | - Cloud Audit Logs (AWS CloudTrail)<br>- Network Traffic | - **Splunk**: `index=cloud sourcetype=aws:cloudtrail eventName="Invoke" AND userIdentity NOT IN (authorized_users) \| stats count by userIdentity, src_ip \| where count > 5`.<br>- **KQL**: `AWSCloudTrail \| where EventName == "Invoke" and Caller !in (authorizedUsers) \| summarize count() by Caller, SourceIP \| where count_ > 5`.<br>- **ELK**: `FROM logs-aws.cloudtrail-* \| WHERE event.action = 'Invoke' AND user.identity NOT IN ['authorized_users'] \| STATS COUNT() BY user.identity, source.ip HAVING COUNT() > 5`. |
| 12. Non-Application Layer C2 with Suspicious Headers | Non-application layer C2 with custom headers, as in Cobalt Strike. | - Network Traffic (DS0003: Zeek Conn)<br>- Proxy Logs | - **Splunk**: `index=network sourcetype=zeek_conn header IN ("*X-Cobalt*", "*Custom-Header*") \| stats count by src_ip, header \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where AdditionalFields.Header has_any ("X-Cobalt", "Custom-Header") \| summarize count() by DeviceIP, AdditionalFields.Header \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.conn-* \| WHERE network.header : ("*X-Cobalt*" OR "*Custom-Header*") \| STATS COUNT() BY source.ip, network.header HAVING COUNT() > 5`. |
| 13. Non-Application Layer C2 in Non-Standard Environments | Non-application layer C2 in Linux, as in Turla. | - Network Traffic (DS0003: Zeek Conn)<br>- Linux Logs | - **Splunk**: `index=linux sourcetype=auditd syscall="connect" AND protocol NOT IN ("tcp", "udp") \| stats count by exe, dest_ip \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol !in ("TCP", "UDP") and InitiatingProcessName !in (knownApps) \| summarize count() by InitiatingProcessName, RemoteIP \| where count_ > 5`.<br>- **ELK**: `FROM logs-auditd-* \| WHERE syscall.name = "connect" AND network.protocol NOT IN ['tcp', 'udp'] \| STATS COUNT() BY process.exe, destination.ip HAVING COUNT() > 5`. |
| 14. Non-Application Layer C2 with Multi-Stage Redirects | Non-application layer C2 with redirects, as in APT41. | - Network Traffic (DS0003: Zeek Conn)<br>- Redirect Analysis | - **Splunk**: `index=network sourcetype=zeek_conn status_code=302 \| stats count by src_ip, protocol \| where count > 3`.<br>- **KQL**: `DeviceNetworkEvents \| where AdditionalFields.StatusCode == 302 \| summarize count() by DeviceIP, Protocol \| where count_ > 3`.<br>- **ELK**: `FROM logs-zeek.conn-* \| WHERE network.status = 302 \| STATS COUNT() BY source.ip, network.protocol HAVING COUNT() > 3`. |
| 15. Non-Application Layer C2 with Anomalous User Agents | Non-application layer C2 with unusual user agents, as in Cobalt Strike. | - Network Traffic (DS0003: Zeek Conn)<br>- Proxy Logs | - **Splunk**: `index=network sourcetype=zeek_conn user_agent NOT IN (known_agents) \| stats count by src_ip, user_agent \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where AdditionalFields.UserAgent !in (knownAgents) \| summarize count() by DeviceIP, AdditionalFields.UserAgent \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.conn-* \| WHERE network.user_agent NOT IN ['known_agents'] \| STATS COUNT() BY source.ip, network.user_agent HAVING COUNT() > 5`. |

### Non-Standard Encoding (T1132.002)

| Hypothesis | Description | Data Sources | Hunting Queries |
|------------|-------------|--------------|-----------------|
| 1. Non-Standard Encoding in C2 Payloads | Adversaries use non-standard encoding for C2 payloads, as in APT41. High risk in environments with limited payload inspection. | - Network Traffic (DS0003: Zeek HTTP)<br>- Packet Analysis | - **Splunk**: `index=network sourcetype=zeek_http payload_entropy > 7 \| stats count by src_ip, uri \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "HTTP" and AdditionalFields.PayloadEntropy > 7 \| summarize count() by DeviceIP, RemoteUrl \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE http.payload.entropy > 7 \| STATS COUNT() BY source.ip, http.uri HAVING COUNT() > 5`. |
| 2. Non-Standard Encoding in DNS Queries | Non-standard encoding in DNS queries for C2, as in Turla. | - DNS Logs (DS0003: Zeek DNS)<br>- Network Traffic | - **Splunk**: `index=network sourcetype=zeek_dns query_entropy > 3 \| stats count by src_ip, query \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "DNS" and AdditionalFields.QueryEntropy > 3 \| summarize count() by DeviceIP, AdditionalFields.Query \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.dns-* \| WHERE dns.query.entropy > 3 \| STATS COUNT() BY source.ip, dns.query HAVING COUNT() > 5`. |
| 3. Non-Standard Encoding with Anomalous Timing | Non-standard encoding with unusual timing, as in 2025 trends. | - Network Traffic (DS0003: Zeek HTTP)<br>- Metrics | - **Splunk**: `index=network sourcetype=zeek_http payload_entropy > 7 \| timechart span=1h count \| where count > avg(count)*4`.<br>- **KQL**: `DeviceNetworkEvents \| where AdditionalFields.PayloadEntropy > 7 \| summarize HourlyCount=count() by bin(Timestamp, 1h) \| where HourlyCount > avg(HourlyCount) * 4`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE http.payload.entropy > 7 \| STATS COUNT() BY date_histogram(@timestamp, '1h') \| WHERE COUNT() > AVG(COUNT()) * 4`. |
| 4. Non-Standard Encoding via Compromised Endpoints | Compromised endpoints use non-standard encoding for C2, as in Turla. | - Process Creation (DS0009: Sysmon ID 1)<br>- Network Traffic | - **Splunk**: `index=endpoint sourcetype=sysmon EventCode=1 CommandLine="*encode*" \| join host [search index=network sourcetype=zeek_http payload_entropy > 7] \| stats count by host, CommandLine, uri \| where count > 3`.<br>- **KQL**: `DeviceProcessEvents \| where ProcessCommandLine contains "encode" \| join kind=inner (DeviceNetworkEvents \| where AdditionalFields.PayloadEntropy > 7) on DeviceName \| summarize count() by DeviceName, ProcessCommandLine, RemoteUrl \| where count_ > 3`.<br>- **ELK**: `FROM logs-endpoint.process-* \| WHERE process.command_line : "*encode*" \| JOIN logs-zeek.http-* ON host.name WHERE http.payload.entropy > 7 \| STATS COUNT() BY host.name, process.command_line, http.uri HAVING COUNT() > 3`. |
| 5. Non-Standard Encoding in Cloud Environments | Non-standard encoding in cloud C2, as in 2025 trends. | - Cloud Audit Logs (AWS CloudTrail)<br>- Network Traffic | - **Splunk**: `index=cloud sourcetype=aws:cloudtrail eventName="Invoke" AND userIdentity NOT IN (authorized_users) \| stats count by userIdentity, src_ip \| where count > 5`.<br>- **KQL**: `AWSCloudTrail \| where EventName == "Invoke" and Caller !in (authorizedUsers) \| summarize count() by Caller, SourceIP \| where count_ > 5`.<br>- **ELK**: `FROM logs-aws.cloudtrail-* \| WHERE event.action = 'Invoke' AND user.identity NOT IN ['authorized_users'] \| STATS COUNT() BY user.identity, source.ip HAVING COUNT() > 5`. |
| 6. Non-Standard Encoding with Encrypted Payloads | Encrypted payloads in non-standard encoding, as in APT41. | - Network Traffic (DS0003: Zeek HTTP)<br>- Packet Analysis | - **Splunk**: `index=network sourcetype=zeek_http payload_entropy > 7 \| stats count by src_ip, uri \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "HTTP" and AdditionalFields.PayloadEntropy > 7 \| summarize count() by DeviceIP, RemoteUrl \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE http.payload.entropy > 7 \| STATS COUNT() BY source.ip, http.uri HAVING COUNT() > 5`. |
| 7. Non-Standard Encoding in Non-Standard Environments | Non-standard encoding in Linux, as in Turla. | - Network Traffic (DS0003: Zeek HTTP)<br>- Linux Logs | - **Splunk**: `index=linux sourcetype=auditd syscall="sendto" AND dest_port IN (80, 443) AND exe NOT IN (known_apps) \| stats count by exe, dest_ip \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where RemotePort in (80, 443) and InitiatingProcessName !in (knownApps) \| summarize count() by InitiatingProcessName, RemoteIP \| where count_ > 5`.<br>- **ELK**: `FROM logs-auditd-* \| WHERE syscall.name = "sendto" AND destination.port IN [80, 443] AND process.exe NOT IN ['known_apps'] \| STATS COUNT() BY process.exe, destination.ip HAVING COUNT() > 5`. |
| 8. Non-Standard Encoding with Anomalous Timing | Non-standard encoding with unusual timing, as in 2025 trends. | - Network Traffic (DS0003: Zeek HTTP)<br>- Metrics | - **Splunk**: `index=network sourcetype=zeek_http \| timechart span=1h count \| where count > avg(count)*4`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "HTTP" \| summarize HourlyCount=count() by bin(Timestamp, 1h) \| where HourlyCount > avg(HourlyCount) * 4`.<br>- **ELK**: `FROM logs-zeek.http-* \| STATS COUNT() BY date_histogram(@timestamp, '1h') \| WHERE COUNT() > AVG(COUNT()) * 4`. |
| 9. Non-Standard Encoding with Suspicious Headers | Non-standard encoding with custom headers, as in Cobalt Strike. | - Network Traffic (DS0003: Zeek HTTP)<br>- Proxy Logs | - **Splunk**: `index=network sourcetype=zeek_http header IN ("*X-Cobalt*", "*Custom-Header*") \| stats count by src_ip, header \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "HTTP" and AdditionalFields.Header has_any ("X-Cobalt", "Custom-Header") \| summarize count() by DeviceIP, AdditionalFields.Header \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE http.header : ("*X-Cobalt*" OR "*Custom-Header*") \| STATS COUNT() BY source.ip, http.header HAVING COUNT() > 5`. |
| 10. Non-Standard Encoding with Encrypted Payloads | Encrypted payloads in non-standard encoding, as in APT41. | - Network Traffic (DS0003: Zeek HTTP)<br>- Packet Analysis | - **Splunk**: `index=network sourcetype=zeek_http payload_entropy > 7 \| stats count by src_ip, uri \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "HTTP" and AdditionalFields.PayloadEntropy > 7 \| summarize count() by DeviceIP, RemoteUrl \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE http.payload.entropy > 7 \| STATS COUNT() BY source.ip, http.uri HAVING COUNT() > 5`. |
| 11. Non-Standard Encoding in Non-Standard Environments | Non-standard encoding in Linux, as in Turla. | - Network Traffic (DS0003: Zeek HTTP)<br>- Linux Logs | - **Splunk**: `index=linux sourcetype=auditd syscall="sendto" AND dest_port IN (80, 443) AND exe NOT IN (known_apps) \| stats count by exe, dest_ip \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where RemotePort in (80, 443) and InitiatingProcessName !in (knownApps) \| summarize count() by InitiatingProcessName, RemoteIP \| where count_ > 5`.<br>- **ELK**: `FROM logs-auditd-* \| WHERE syscall.name = "sendto" AND destination.port IN [80, 443] AND process.exe NOT IN ['known_apps'] \| STATS COUNT() BY process.exe, destination.ip HAVING COUNT() > 5`. |
| 12. Non-Standard Encoding with Anomalous Timing | Non-standard encoding with unusual timing, as in 2025 trends. | - Network Traffic (DS0003: Zeek HTTP)<br>- Metrics | - **Splunk**: `index=network sourcetype=zeek_http \| timechart span=1h count \| where count > avg(count)*4`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "HTTP" \| summarize HourlyCount=count() by bin(Timestamp, 1h) \| where HourlyCount > avg(HourlyCount) * 4`.<br>- **ELK**: `FROM logs-zeek.http-* \| STATS COUNT() BY date_histogram(@timestamp, '1h') \| WHERE COUNT() > AVG(COUNT()) * 4`. |
| 13. Non-Standard Encoding with Suspicious Headers | Non-standard encoding with custom headers, as in Cobalt Strike. | - Network Traffic (DS0003: Zeek HTTP)<br>- Proxy Logs | - **Splunk**: `index=network sourcetype=zeek_http header IN ("*X-Cobalt*", "*Custom-Header*") \| stats count by src_ip, header \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "HTTP" and AdditionalFields.Header has_any ("X-Cobalt", "Custom-Header") \| summarize count() by DeviceIP, AdditionalFields.Header \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE http.header : ("*X-Cobalt*" OR "*Custom-Header*") \| STATS COUNT() BY source.ip, http.header HAVING COUNT() > 5`. |
| 14. Non-Standard Encoding with Encrypted Payloads | Encrypted payloads in non-standard encoding, as in APT41. | - Network Traffic (DS0003: Zeek HTTP)<br>- Packet Analysis | - **Splunk**: `index=network sourcetype=zeek_http payload_entropy > 7 \| stats count by src_ip, uri \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "HTTP" and AdditionalFields.PayloadEntropy > 7 \| summarize count() by DeviceIP, RemoteUrl \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE http.payload.entropy > 7 \| STATS COUNT() BY source.ip, http.uri HAVING COUNT() > 5`. |
| 15. Non-Standard Encoding in Non-Standard Environments | Non-standard encoding in Linux, as in Turla. | - Network Traffic (DS0003: Zeek HTTP)<br>- Linux Logs | - **Splunk**: `index=linux sourcetype=auditd syscall="sendto" AND dest_port IN (80, 443) AND exe NOT IN (known_apps) \| stats count by exe, dest_ip \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where RemotePort in (80, 443) and InitiatingProcessName !in (knownApps) \| summarize count() by InitiatingProcessName, RemoteIP \| where count_ > 5`.<br>- **ELK**: `FROM logs-auditd-* \| WHERE syscall.name = "sendto" AND destination.port IN [80, 443] AND process.exe NOT IN ['known_apps'] \| STATS COUNT() BY process.exe, destination.ip HAVING COUNT() > 5`. |

### Non-Standard Port (T1571)

| Hypothesis | Description | Data Sources | Hunting Queries |
|------------|-------------|--------------|-----------------|
| 1. C2 on Non-Standard Ports | Adversaries use non-standard ports for C2 to evade detection, as in APT41 campaigns. High risk in environments with limited port monitoring. | - Network Traffic (DS0003: Zeek Conn)<br>- Firewall Logs | - **Splunk**: `index=network sourcetype=zeek_conn dest_port NOT IN (80, 443, 53) AND bytes > 10000 \| stats count by src_ip, dest_port \| where count > 5` (Detects high-volume traffic on non-standard ports).<br>- **KQL**: `DeviceNetworkEvents \| where RemotePort !in (80, 443, 53) and TotalBytes > 10000 \| summarize count() by DeviceIP, RemotePort \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.conn-* \| WHERE destination.port NOT IN [80, 443, 53] AND network.bytes > 10000 \| STATS COUNT() BY source.ip, destination.port HAVING COUNT() > 5`. |
| 2. Non-Standard Port C2 with Encrypted Traffic | Encrypted traffic on non-standard ports for C2, as in Turla attacks. | - Network Traffic (DS0003: Zeek SSL)<br>- Firewall Logs | - **Splunk**: `index=network sourcetype=zeek_ssl dest_port NOT IN (443) \| stats count by src_ip, dest_port \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "SSL" and RemotePort !in (443) \| summarize count() by DeviceIP, RemotePort \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.ssl-* \| WHERE destination.port NOT IN [443] \| STATS COUNT() BY source.ip, destination.port HAVING COUNT() > 5`. |
| 3. Non-Standard Port C2 from Compromised Endpoints | Compromised endpoints use non-standard ports for C2, as in FIN7. | - Process Creation (DS0009: Sysmon ID 1)<br>- Network Traffic | - **Splunk**: `index=endpoint sourcetype=sysmon EventCode=1 CommandLine="*port*" \| join host [search index=network sourcetype=zeek_conn dest_port NOT IN (80, 443)] \| stats count by host, CommandLine, dest_port \| where count > 3`.<br>- **KQL**: `DeviceProcessEvents \| where ProcessCommandLine contains "port" \| join kind=inner (DeviceNetworkEvents \| where RemotePort !in (80, 443)) on DeviceName \| summarize count() by DeviceName, ProcessCommandLine, RemotePort \| where count_ > 3`.<br>- **ELK**: `FROM logs-endpoint.process-* \| WHERE process.command_line : "*port*" \| JOIN logs-zeek.conn-* ON host.name WHERE destination.port NOT IN [80, 443] \| STATS COUNT() BY host.name, process.command_line, destination.port HAVING COUNT() > 3`. |
| 4. Non-Standard Port C2 with Anomalous Timing | Non-standard port C2 with unusual timing, as in 2025 trends. | - Network Traffic (DS0003: Zeek Conn)<br>- Metrics | - **Splunk**: `index=network sourcetype=zeek_conn dest_port NOT IN (80, 443) \| timechart span=1h count \| where count > avg(count)*4`.<br>- **KQL**: `DeviceNetworkEvents \| where RemotePort !in (80, 443) \| summarize HourlyCount=count() by bin(Timestamp, 1h) \| where HourlyCount > avg(HourlyCount) * 4`.<br>- **ELK**: `FROM logs-zeek.conn-* \| WHERE destination.port NOT IN [80, 443] \| STATS COUNT() BY date_histogram(@timestamp, '1h') \| WHERE COUNT() > AVG(COUNT()) * 4`. |
| 5. Non-Standard Port C2 with Encrypted Payloads | Encrypted payloads on non-standard ports, as in APT41. | - Network Traffic (DS0003: Zeek HTTP)<br>- Packet Analysis | - **Splunk**: `index=network sourcetype=zeek_http dest_port NOT IN (80, 443) AND payload_entropy > 7 \| stats count by src_ip, uri \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where RemotePort !in (80, 443) and AdditionalFields.PayloadEntropy > 7 \| summarize count() by DeviceIP, RemoteUrl \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE destination.port NOT IN [80, 443] AND http.payload.entropy > 7 \| STATS COUNT() BY source.ip, http.uri HAVING COUNT() > 5`. |
| 6. Non-Standard Port C2 in Cloud Environments | Non-standard port C2 in cloud, as in 2025 trends. | - Cloud Audit Logs (AWS CloudTrail)<br>- Network Traffic | - **Splunk**: `index=cloud sourcetype=aws:cloudtrail eventName="Invoke" AND userIdentity NOT IN (authorized_users) \| stats count by userIdentity, src_ip \| where count > 5`.<br>- **KQL**: `AWSCloudTrail \| where EventName == "Invoke" and Caller !in (authorizedUsers) \| summarize count() by Caller, SourceIP \| where count_ > 5`.<br>- **ELK**: `FROM logs-aws.cloudtrail-* \| WHERE event.action = 'Invoke' AND user.identity NOT IN ['authorized_users'] \| STATS COUNT() BY user.identity, source.ip HAVING COUNT() > 5`. |
| 7. Non-Standard Port C2 with Suspicious Headers | Non-standard port C2 with custom headers, as in Cobalt Strike. | - Network Traffic (DS0003: Zeek HTTP)<br>- Proxy Logs | - **Splunk**: `index=network sourcetype=zeek_http dest_port NOT IN (80, 443) AND header IN ("*X-Cobalt*", "*Custom-Header*") \| stats count by src_ip, header \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where RemotePort !in (80, 443) and AdditionalFields.Header has_any ("X-Cobalt", "Custom-Header") \| summarize count() by DeviceIP, AdditionalFields.Header \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE destination.port NOT IN [80, 443] AND http.header : ("*X-Cobalt*" OR "*Custom-Header*") \| STATS COUNT() BY source.ip, http.header HAVING COUNT() > 5`. |
| 8. Non-Standard Port C2 in Non-Standard Environments | Non-standard port C2 in Linux, as in Turla. | - Network Traffic (DS0003: Zeek Conn)<br>- Linux Logs | - **Splunk**: `index=linux sourcetype=auditd syscall="connect" AND dest_port NOT IN (80, 443) AND exe NOT IN (known_apps) \| stats count by exe, dest_ip \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where RemotePort !in (80, 443) and InitiatingProcessName !in (knownApps) \| summarize count() by InitiatingProcessName, RemoteIP \| where count_ > 5`.<br>- **ELK**: `FROM logs-auditd-* \| WHERE syscall.name = "connect" AND destination.port NOT IN [80, 443] AND process.exe NOT IN ['known_apps'] \| STATS COUNT() BY process.exe, destination.ip HAVING COUNT() > 5`. |
| 9. Non-Standard Port C2 with Multi-Stage Redirects | Non-standard port C2 with redirects, as in APT41. | - Network Traffic (DS0003: Zeek HTTP)<br>- Redirect Analysis | - **Splunk**: `index=network sourcetype=zeek_http status_code=302 \| stats count by src_ip, uri \| where count > 3`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "HTTP" and AdditionalFields.StatusCode == 302 \| summarize count() by DeviceIP, RemoteUrl \| where count_ > 3`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE http.status = 302 \| STATS COUNT() BY source.ip, http.uri HAVING COUNT() > 3`. |
| 10. Non-Standard Port C2 with Anomalous User Agents | Non-standard port C2 with unusual user agents, as in Cobalt Strike. | - Network Traffic (DS0003: Zeek HTTP)<br>- Proxy Logs | - **Splunk**: `index=network sourcetype=zeek_http dest_port NOT IN (80, 443) AND user_agent NOT IN (known_agents) \| stats count by src_ip, user_agent \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where RemotePort !in (80, 443) and AdditionalFields.UserAgent !in (knownAgents) \| summarize count() by DeviceIP, AdditionalFields.UserAgent \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE destination.port NOT IN [80, 443] AND http.user_agent NOT IN ['known_agents'] \| STATS COUNT() BY source.ip, http.user_agent HAVING COUNT() > 5`. |
| 11. Non-Standard Port C2 in Cloud Environments | Non-standard port C2 in cloud, as in 2025 trends. | - Cloud Audit Logs (AWS CloudTrail)<br>- Network Traffic | - **Splunk**: `index=cloud sourcetype=aws:cloudtrail eventName="Invoke" AND userIdentity NOT IN (authorized_users) \| stats count by userIdentity, src_ip \| where count > 5`.<br>- **KQL**: `AWSCloudTrail \| where EventName == "Invoke" and Caller !in (authorizedUsers) \| summarize count() by Caller, SourceIP \| where count_ > 5`.<br>- **ELK**: `FROM logs-aws.cloudtrail-* \| WHERE event.action = 'Invoke' AND user.identity NOT IN ['authorized_users'] \| STATS COUNT() BY user.identity, source.ip HAVING COUNT() > 5`. |
| 12. Non-Standard Port C2 with Suspicious Headers | Non-standard port C2 with custom headers, as in Cobalt Strike. | - Network Traffic (DS0003: Zeek HTTP)<br>- Proxy Logs | - **Splunk**: `index=network sourcetype=zeek_http dest_port NOT IN (80, 443) AND header IN ("*X-Cobalt*", "*Custom-Header*") \| stats count by src_ip, header \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where RemotePort !in (80, 443) and AdditionalFields.Header has_any ("X-Cobalt", "Custom-Header") \| summarize count() by DeviceIP, AdditionalFields.Header \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE destination.port NOT IN [80, 443] AND http.header : ("*X-Cobalt*" OR "*Custom-Header*") \| STATS COUNT() BY source.ip, http.header HAVING COUNT() > 5`. |
| 13. Non-Standard Port C2 in Non-Standard Environments | Non-standard port C2 in Linux, as in Turla. | - Network Traffic (DS0003: Zeek Conn)<br>- Linux Logs | - **Splunk**: `index=linux sourcetype=auditd syscall="connect" AND dest_port NOT IN (80, 443) AND exe NOT IN (known_apps) \| stats count by exe, dest_ip \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where RemotePort !in (80, 443) and InitiatingProcessName !in (knownApps) \| summarize count() by InitiatingProcessName, RemoteIP \| where count_ > 5`.<br>- **ELK**: `FROM logs-auditd-* \| WHERE syscall.name = "connect" AND destination.port NOT IN [80, 443] AND process.exe NOT IN ['known_apps'] \| STATS COUNT() BY process.exe, destination.ip HAVING COUNT() > 5`. |
| 14. Non-Standard Port C2 with Multi-Stage Redirects | Non-standard port C2 with redirects, as in APT41. | - Network Traffic (DS0003: Zeek HTTP)<br>- Redirect Analysis | - **Splunk**: `index=network sourcetype=zeek_http status_code=302 \| stats count by src_ip, uri \| where count > 3`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "HTTP" and AdditionalFields.StatusCode == 302 \| summarize count() by DeviceIP, RemoteUrl \| where count_ > 3`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE http.status = 302 \| STATS COUNT() BY source.ip, http.uri HAVING COUNT() > 3`. |
| 15. Non-Standard Port C2 with Anomalous User Agents | Non-standard port C2 with unusual user agents, as in Cobalt Strike. | - Network Traffic (DS0003: Zeek HTTP)<br>- Proxy Logs | - **Splunk**: `index=network sourcetype=zeek_http dest_port NOT IN (80, 443) AND user_agent NOT IN (known_agents) \| stats count by src_ip, user_agent \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where RemotePort !in (80, 443) and AdditionalFields.UserAgent !in (knownAgents) \| summarize count() by DeviceIP, AdditionalFields.UserAgent \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE destination.port NOT IN [80, 443] AND http.user_agent NOT IN ['known_agents'] \| STATS COUNT() BY source.ip, http.user_agent HAVING COUNT() > 5`. |

### One-Way Communication (T1102.001)

| Hypothesis | Description | Data Sources | Hunting Queries |
|------------|-------------|--------------|-----------------|
| 1. One-Way C2 Communication | Adversaries use one-way communication for C2, as in APT41. High risk in environments with limited traffic monitoring. | - Network Traffic (DS0003: Zeek Conn)<br>- Firewall Logs | - **Splunk**: `index=network sourcetype=zeek_conn bytes_in > 10000 AND bytes_out < 100 \| stats count by src_ip, dest_ip \| where count > 5` (Detects one-way outbound traffic).<br>- **KQL**: `DeviceNetworkEvents \| where InboundBytes > 10000 and OutboundBytes < 100 \| summarize count() by DeviceIP, RemoteIP \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.conn-* \| WHERE network.bytes_in > 10000 AND network.bytes_out < 100 \| STATS COUNT() BY source.ip, destination.ip HAVING COUNT() > 5`. |
| 2. One-Way C2 with Encrypted Payloads | Encrypted one-way C2 payloads, as in Turla. | - Network Traffic (DS0003: Zeek HTTP)<br>- Packet Analysis | - **Splunk**: `index=network sourcetype=zeek_http bytes_in > 10000 AND payload_entropy > 7 \| stats count by src_ip, uri \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where InboundBytes > 10000 and AdditionalFields.PayloadEntropy > 7 \| summarize count() by DeviceIP, RemoteUrl \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE network.bytes_in > 10000 AND http.payload.entropy > 7 \| STATS COUNT() BY source.ip, http.uri HAVING COUNT() > 5`. |
| 3. One-Way C2 from Compromised Endpoints | Compromised endpoints use one-way C2, as in FIN7. | - Process Creation (DS0009: Sysmon ID 1)<br>- Network Traffic | - **Splunk**: `index=endpoint sourcetype=sysmon EventCode=1 CommandLine="*one-way*" \| join host [search index=network sourcetype=zeek_conn bytes_in > 10000] \| stats count by host, CommandLine, dest_ip \| where count > 3`.<br>- **KQL**: `DeviceProcessEvents \| where ProcessCommandLine contains "one-way" \| join kind=inner (DeviceNetworkEvents \| where InboundBytes > 10000) on DeviceName \| summarize count() by DeviceName, ProcessCommandLine, RemoteIP \| where count_ > 3`.<br>- **ELK**: `FROM logs-endpoint.process-* \| WHERE process.command_line : "*one-way*" \| JOIN logs-zeek.conn-* ON host.name WHERE network.bytes_in > 10000 \| STATS COUNT() BY host.name, process.command_line, destination.ip HAVING COUNT() > 3`. |
| 4. One-Way C2 with Anomalous Timing | One-way C2 with unusual timing, as in 2025 trends. | - Network Traffic (DS0003: Zeek Conn)<br>- Metrics | - **Splunk**: `index=network sourcetype=zeek_conn bytes_in > 10000 \| timechart span=1h count \| where count > avg(count)*4`.<br>- **KQL**: `DeviceNetworkEvents \| where InboundBytes > 10000 \| summarize HourlyCount=count() by bin(Timestamp, 1h) \| where HourlyCount > avg(HourlyCount) * 4`.<br>- **ELK**: `FROM logs-zeek.conn-* \| WHERE network.bytes_in > 10000 \| STATS COUNT() BY date_histogram(@timestamp, '1h') \| WHERE COUNT() > AVG(COUNT()) * 4`. |
| 5. One-Way C2 with Encrypted Payloads | Encrypted payloads in one-way C2, as in APT41. | - Network Traffic (DS0003: Zeek HTTP)<br>- Packet Analysis | - **Splunk**: `index=network sourcetype=zeek_http payload_entropy > 7 \| stats count by src_ip, uri \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "HTTP" and AdditionalFields.PayloadEntropy > 7 \| summarize count() by DeviceIP, RemoteUrl \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE http.payload.entropy > 7 \| STATS COUNT() BY source.ip, http.uri HAVING COUNT() > 5`. |
| 6. One-Way C2 in Cloud Environments | One-way C2 in cloud, as in 2025 trends. | - Cloud Audit Logs (AWS CloudTrail)<br>- Network Traffic | - **Splunk**: `index=cloud sourcetype=aws:cloudtrail eventName="Invoke" AND userIdentity NOT IN (authorized_users) \| stats count by userIdentity, src_ip \| where count > 5`.<br>- **KQL**: `AWSCloudTrail \| where EventName == "Invoke" and Caller !in (authorizedUsers) \| summarize count() by Caller, SourceIP \| where count_ > 5`.<br>- **ELK**: `FROM logs-aws.cloudtrail-* \| WHERE event.action = 'Invoke' AND user.identity NOT IN ['authorized_users'] \| STATS COUNT() BY user.identity, source.ip HAVING COUNT() > 5`. |
| 7. One-Way C2 with Suspicious Headers | One-way C2 with custom headers, as in Cobalt Strike. | - Network Traffic (DS0003: Zeek HTTP)<br>- Proxy Logs | - **Splunk**: `index=network sourcetype=zeek_http header IN ("*X-Cobalt*", "*Custom-Header*") \| stats count by src_ip, header \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "HTTP" and AdditionalFields.Header has_any ("X-Cobalt", "Custom-Header") \| summarize count() by DeviceIP, AdditionalFields.Header \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE http.header : ("*X-Cobalt*" OR "*Custom-Header*") \| STATS COUNT() BY source.ip, http.header HAVING COUNT() > 5`. |
| 8. One-Way C2 in Non-Standard Environments | One-way C2 in Linux, as in Turla. | - Network Traffic (DS0003: Zeek Conn)<br>- Linux Logs | - **Splunk**: `index=linux sourcetype=auditd syscall="connect" AND dest_port=443 AND exe NOT IN (known_apps) \| stats count by exe, dest_ip \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where RemotePort == 443 and InitiatingProcessName !in (knownApps) \| summarize count() by InitiatingProcessName, RemoteIP \| where count_ > 5`.<br>- **ELK**: `FROM logs-auditd-* \| WHERE syscall.name = "connect" AND destination.port = 443 AND process.exe NOT IN ['known_apps'] \| STATS COUNT() BY process.exe, destination.ip HAVING COUNT() > 5`. |
| 9. One-Way C2 with Multi-Stage Redirects | One-way C2 with redirects, as in APT41. | - Network Traffic (DS0003: Zeek HTTP)<br>- Redirect Analysis | - **Splunk**: `index=network sourcetype=zeek_http status_code=302 \| stats count by src_ip, uri \| where count > 3`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "HTTP" and AdditionalFields.StatusCode == 302 \| summarize count() by DeviceIP, RemoteUrl \| where count_ > 3`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE http.status = 302 \| STATS COUNT() BY source.ip, http.uri HAVING COUNT() > 3`. |
| 10. One-Way C2 with Anomalous User Agents | One-way C2 with unusual user agents, as in Cobalt Strike. | - Network Traffic (DS0003: Zeek HTTP)<br>- Proxy Logs | - **Splunk**: `index=network sourcetype=zeek_http user_agent NOT IN (known_agents) \| stats count by src_ip, user_agent \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "HTTP" and AdditionalFields.UserAgent !in (knownAgents) \| summarize count() by DeviceIP, AdditionalFields.UserAgent \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE http.user_agent NOT IN ['known_agents'] \| STATS COUNT() BY source.ip, http.user_agent HAVING COUNT() > 5`. |
| 11. One-Way C2 in Cloud Environments | One-way C2 in cloud, as in 2025 trends. | - Cloud Audit Logs (AWS CloudTrail)<br>- Network Traffic | - **Splunk**: `index=cloud sourcetype=aws:cloudtrail eventName="Invoke" AND userIdentity NOT IN (authorized_users) \| stats count by userIdentity, src_ip \| where count > 5`.<br>- **KQL**: `AWSCloudTrail \| where EventName == "Invoke" and Caller !in (authorizedUsers) \| summarize count() by Caller, SourceIP \| where count_ > 5`.<br>- **ELK**: `FROM logs-aws.cloudtrail-* \| WHERE event.action = 'Invoke' AND user.identity NOT IN ['authorized_users'] \| STATS COUNT() BY user.identity, source.ip HAVING COUNT() > 5`. |
| 12. One-Way C2 with Suspicious Headers | One-way C2 with custom headers, as in Cobalt Strike. | - Network Traffic (DS0003: Zeek HTTP)<br>- Proxy Logs | - **Splunk**: `index=network sourcetype=zeek_http header IN ("*X-Cobalt*", "*Custom-Header*") \| stats count by src_ip, header \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "HTTP" and AdditionalFields.Header has_any ("X-Cobalt", "Custom-Header") \| summarize count() by DeviceIP, AdditionalFields.Header \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE http.header : ("*X-Cobalt*" OR "*Custom-Header*") \| STATS COUNT() BY source.ip, http.header HAVING COUNT() > 5`. |
| 13. One-Way C2 in Non-Standard Environments | One-way C2 in Linux, as in Turla. | - Network Traffic (DS0003: Zeek Conn)<br>- Linux Logs | - **Splunk**: `index=linux sourcetype=auditd syscall="connect" AND dest_port=443 AND exe NOT IN (known_apps) \| stats count by exe, dest_ip \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where RemotePort == 443 and InitiatingProcessName !in (knownApps) \| summarize count() by InitiatingProcessName, RemoteIP \| where count_ > 5`.<br>- **ELK**: `FROM logs-auditd-* \| WHERE syscall.name = "connect" AND destination.port = 443 AND process.exe NOT IN ['known_apps'] \| STATS COUNT() BY process.exe, destination.ip HAVING COUNT() > 5`. |
| 14. One-Way C2 with Multi-Stage Redirects | One-way C2 with redirects, as in APT41. | - Network Traffic (DS0003: Zeek HTTP)<br>- Redirect Analysis | - **Splunk**: `index=network sourcetype=zeek_http status_code=302 \| stats count by src_ip, uri \| where count > 3`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "HTTP" and AdditionalFields.StatusCode == 302 \| summarize count() by DeviceIP, RemoteUrl \| where count_ > 3`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE http.status = 302 \| STATS COUNT() BY source.ip, http.uri HAVING COUNT() > 3`. |
| 15. One-Way C2 with Anomalous User Agents | One-way C2 with unusual user agents, as in Cobalt Strike. | - Network Traffic (DS0003: Zeek HTTP)<br>- Proxy Logs | - **Splunk**: `index=network sourcetype=zeek_http user_agent NOT IN (known_agents) \| stats count by src_ip, user_agent \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "HTTP" and AdditionalFields.UserAgent !in (knownAgents) \| summarize count() by DeviceIP, AdditionalFields.UserAgent \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE http.user_agent NOT IN ['known_agents'] \| STATS COUNT() BY source.ip, http.user_agent HAVING COUNT() > 5`. | 


### Port Knocking (T1205.002)

Port knocking involves adversaries sending a sequence of connection attempts to specific ports to open a hidden port for C2 communication. It’s a stealthy technique used to evade detection, often seen in advanced persistent threats (APTs) like APT29.

| Hypothesis | Description | Data Sources | Hunting Queries |
|------------|-------------|--------------|-----------------|
| 1. Sequential Port Knocking Attempts | Adversaries attempt connections to a sequence of ports to trigger a port knock, as seen in APT29 campaigns. High risk in environments with limited network monitoring. | - Network Traffic (DS0003: Zeek Conn)<br>- Firewall Logs | - **Splunk**: `index=network sourcetype=zeek_conn dest_port IN (known_sequence_ports) \| transaction src_ip maxspan=30s \| where eventcount > 3 \| stats count by src_ip, dest_port \| where count > 5` (Detects sequential port connections).<br>- **KQL**: `DeviceNetworkEvents \| where RemotePort in (knownSequencePorts) \| summarize PortSequence=make_list(RemotePort), count() by DeviceIP, bin(Timestamp, 30s) \| where count_ > 3 \| summarize count() by DeviceIP, PortSequence \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.conn-* \| WHERE destination.port IN [known_sequence_ports] \| STATS event_count=COUNT() BY source.ip, date_histogram(@timestamp, '30s') HAVING event_count > 3 \| STATS COUNT() BY source.ip, destination.port HAVING COUNT() > 5`. |
| 2. Port Knocking with Failed Connections | Adversaries use failed connection attempts to specific ports as a knocking sequence, as in Turla. | - Network Traffic (DS0003: Zeek Conn)<br>- Firewall Logs | - **Splunk**: `index=network sourcetype=zeek_conn status="rejected" \| transaction src_ip maxspan=30s \| where eventcount > 3 \| stats count by src_ip, dest_port \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where ConnectionStatus == "Rejected" \| summarize PortSequence=make_list(RemotePort), count() by DeviceIP, bin(Timestamp, 30s) \| where count_ > 3 \| summarize count() by DeviceIP, PortSequence \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.conn-* \| WHERE network.status = 'rejected' \| STATS event_count=COUNT() BY source.ip, date_histogram(@timestamp, '30s') HAVING event_count > 3 \| STATS COUNT() BY source.ip, destination.port HAVING COUNT() > 5`. |
| 3. Port Knocking in Linux Environments | Port knocking initiated from compromised Linux hosts, as in Turla campaigns. | - Network Traffic (DS0003: Zeek Conn)<br>- Linux Logs (DS0016: Auditd) | - **Splunk**: `index=linux sourcetype=auditd syscall="connect" \| join host [search index=network sourcetype=zeek_conn status="rejected" dest_port IN (known_sequence_ports)] \| transaction host maxspan=30s \| where eventcount > 3 \| stats count by host, dest_port \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where ConnectionStatus == "Rejected" and RemotePort in (knownSequencePorts) \| join kind=inner (DeviceProcessEvents \| where ActionType == "connect") on DeviceName \| summarize PortSequence=make_list(RemotePort), count() by DeviceName, bin(Timestamp, 30s) \| where count_ > 3 \| summarize count() by DeviceName, PortSequence \| where count_ > 5`.<br>- **ELK**: `FROM logs-auditd-* \| WHERE syscall.name = "connect" \| JOIN logs-zeek.conn-* ON host.name WHERE network.status = 'rejected' AND destination.port IN [known_sequence_ports] \| STATS event_count=COUNT() BY host.name, date_histogram(@timestamp, '30s') HAVING event_count > 3 \| STATS COUNT() BY host.name, destination.port HAVING COUNT() > 5`. |
| 4. Port Knocking with Anomalous Timing | Port knocking attempts occur outside normal business hours, increasing risk in 2025 trends. | - Network Traffic (DS0003: Zeek Conn)<br>- Metrics | - **Splunk**: `index=network sourcetype=zeek_conn dest_port IN (known_sequence_ports) \| timechart span=1h count by src_ip \| where count > avg(count)*4 AND _time > relative_time(now(), "-24h")`.<br>- **KQL**: `DeviceNetworkEvents \| where RemotePort in (knownSequencePorts) \| summarize HourlyCount=count() by DeviceIP, bin(Timestamp, 1h) \| where HourlyCount > avg(HourlyCount) * 4 and Timestamp > ago(24h)`.<br>- **ELK**: `FROM logs-zeek.conn-* \| WHERE destination.port IN [known_sequence_ports] \| STATS COUNT() BY source.ip, date_histogram(@timestamp, '1h') \| WHERE COUNT() > AVG(COUNT()) * 4 AND @timestamp > NOW - 24 HOURS`. |
| 5. Port Knocking Followed by C2 Connection | Successful port knocking followed by C2 on a non-standard port, as in APT29. | - Network Traffic (DS0003: Zeek Conn)<br>- Firewall Logs | - **Splunk**: `index=network sourcetype=zeek_conn status="rejected" \| transaction src_ip maxspan=30s \| where eventcount > 3 \| join src_ip [search index=network sourcetype=zeek_conn dest_port NOT IN (80, 443)] \| stats count by src_ip, dest_port \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where ConnectionStatus == "Rejected" \| summarize PortSequence=make_list(RemotePort), count() by DeviceIP, bin(Timestamp, 30s) \| where count_ > 3 \| join kind=inner (DeviceNetworkEvents \| where RemotePort !in (80, 443)) on DeviceIP \| summarize count() by DeviceIP, RemotePort \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.conn-* \| WHERE network.status = 'rejected' \| STATS event_count=COUNT() BY source.ip, date_histogram(@timestamp, '30s') HAVING event_count > 3 \| JOIN logs-zeek.conn-* ON source.ip WHERE destination.port NOT IN [80, 443] \| STATS COUNT() BY source.ip, destination.port HAVING COUNT() > 5`. |
| 6. Port Knocking in Cloud Environments | Port knocking attempts targeting cloud infrastructure, as in 2025 trends. | - Cloud Audit Logs (AWS CloudTrail)<br>- Network Traffic | - **Splunk**: `index=cloud sourcetype=aws:cloudtrail eventName IN ("AuthorizeSecurityGroupIngress", "ModifyInstanceAttribute") AND sourceIPAddress NOT IN (known_ips) \| stats count by sourceIPAddress, eventName \| where count > 5`.<br>- **KQL**: `AWSCloudTrail \| where EventName in ("AuthorizeSecurityGroupIngress", "ModifyInstanceAttribute") and SourceIPAddress !in (knownIPs) \| summarize count() by SourceIPAddress, EventName \| where count_ > 5`.<br>- **ELK**: `FROM logs-aws.cloudtrail-* \| WHERE event.action IN ['AuthorizeSecurityGroupIngress', 'ModifyInstanceAttribute'] AND source.ip NOT IN ['known_ips'] \| STATS COUNT() BY source.ip, event.action HAVING COUNT() > 5`. |
| 7. Port Knocking with Suspicious Processes | Suspicious processes initiate port knocking, as in FIN7 campaigns. | - Process Creation (DS0009: Sysmon ID 1)<br>- Network Traffic | - **Splunk**: `index=endpoint sourcetype=sysmon EventCode=1 CommandLine NOT IN (known_apps) \| join host [search index=network sourcetype=zeek_conn status="rejected" dest_port IN (known_sequence_ports)] \| stats count by host, CommandLine, dest_port \| where count > 5`.<br>- **KQL**: `DeviceProcessEvents \| where ProcessCommandLine !in (knownApps) \| join kind=inner (DeviceNetworkEvents \| where ConnectionStatus == "Rejected" and RemotePort in (knownSequencePorts)) on DeviceName \| summarize count() by DeviceName, ProcessCommandLine, RemotePort \| where count_ > 5`.<br>- **ELK**: `FROM logs-endpoint.process-* \| WHERE process.command_line NOT IN ['known_apps'] \| JOIN logs-zeek.conn-* ON host.name WHERE network.status = 'rejected' AND destination.port IN [known_sequence_ports] \| STATS COUNT() BY host.name, process.command_line, destination.port HAVING COUNT() > 5`. |
| 8. Port Knocking with High Packet Rates | High packet rates to specific ports indicate port knocking, as in 2025 trends. | - Network Traffic (DS0003: Zeek Conn)<br>- Packet Analysis | - **Splunk**: `index=network sourcetype=zeek_conn dest_port IN (known_sequence_ports) \| timechart span=10s count by src_ip \| where count > 50`.<br>- **KQL**: `DeviceNetworkEvents \| where RemotePort in (knownSequencePorts) \| summarize PacketCount=count() by DeviceIP, bin(Timestamp, 10s) \| where PacketCount > 50`.<br>- **ELK**: `FROM logs-zeek.conn-* \| WHERE destination.port IN [known_sequence_ports] \| STATS COUNT() BY source.ip, date_histogram(@timestamp, '10s') \| WHERE COUNT() > 50`. |
| 9. Port Knocking with Anomalous User Agents | Port knocking followed by HTTP traffic with unusual user agents, as in Cobalt Strike. | - Network Traffic (DS0003: Zeek HTTP)<br>- Proxy Logs | - **Splunk**: `index=network sourcetype=zeek_conn status="rejected" \| transaction src_ip maxspan=30s \| where eventcount > 3 \| join src_ip [search index=network sourcetype=zeek_http user_agent NOT IN (known_agents)] \| stats count by src_ip, user_agent \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where ConnectionStatus == "Rejected" \| summarize PortSequence=make_list(RemotePort), count() by DeviceIP, bin(Timestamp, 30s) \| where count_ > 3 \| join kind=inner (DeviceNetworkEvents \| where AdditionalFields.UserAgent !in (knownAgents)) on DeviceIP \| summarize count() by DeviceIP, AdditionalFields.UserAgent \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.conn-* \| WHERE network.status = 'rejected' \| STATS event_count=COUNT() BY source.ip, date_histogram(@timestamp, '30s') HAVING event_count > 3 \| JOIN logs-zeek.http-* ON source.ip WHERE http.user_agent NOT IN ['known_agents'] \| STATS COUNT() BY source.ip, http.user_agent HAVING COUNT() > 5`. |
| 10. Port Knocking with Suspicious Headers | Port knocking followed by HTTP traffic with custom headers, as in Cobalt Strike. | - Network Traffic (DS0003: Zeek HTTP)<br>- Proxy Logs | - **Splunk**: `index=network sourcetype=zeek_conn status="rejected" \| transaction src_ip maxspan=30s \| where eventcount > 3 \| join src_ip [search index=network sourcetype=zeek_http header IN ("*X-Cobalt*", "*Custom-Header*")] \| stats count by src_ip, header \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where ConnectionStatus == "Rejected" \| summarize PortSequence=make_list(RemotePort), count() by DeviceIP, bin(Timestamp, 30s) \| where count_ > 3 \| join kind=inner (DeviceNetworkEvents \| where AdditionalFields.Header has_any ("X-Cobalt", "Custom-Header")) on DeviceIP \| summarize count() by DeviceIP, AdditionalFields.Header \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.conn-* \| WHERE network.status = 'rejected' \| STATS event_count=COUNT() BY source.ip, date_histogram(@timestamp, '30s') HAVING event_count > 3 \| JOIN logs-zeek.http-* ON source.ip WHERE http.header : ("*X-Cobalt*" OR "*Custom-Header*") \| STATS COUNT() BY source.ip, http.header HAVING COUNT() > 5`. |

### Protocol Tunneling (T1572)

Protocol tunneling involves encapsulating one protocol within another to hide C2 traffic, often used by adversaries like APT41 to bypass network controls.

| Hypothesis | Description | Data Sources | Hunting Queries |
|------------|-------------|--------------|-----------------|
| 1. Protocol Tunneling over DNS | Adversaries tunnel C2 data over DNS, as in APT41 campaigns. High risk in environments with limited DNS inspection. | - DNS Logs (DS0003: Zeek DNS)<br>- Network Traffic | - **Splunk**: `index=network sourcetype=zeek_dns query_length > 100 \| stats count by src_ip, query \| where count > 5` (Detects large DNS queries indicative of tunneling).<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "DNS" and AdditionalFields.QueryLength > 100 \| summarize count() by DeviceIP, AdditionalFields.Query \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.dns-* \| WHERE dns.query.length > 100 \| STATS COUNT() BY source.ip, dns.query HAVING COUNT() > 5`. |
| 2. Protocol Tunneling over HTTPS | Adversaries tunnel C2 over HTTPS, as in Turla campaigns. | - Network Traffic (DS0003: Zeek SSL)<br>- Proxy Logs | - **Splunk**: `index=network sourcetype=zeek_ssl payload_entropy > 7 AND dest_port=443 \| stats count by src_ip, dest_ip \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "SSL" and AdditionalFields.PayloadEntropy > 7 and RemotePort == 443 \| summarize count() by DeviceIP, RemoteIP \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.ssl-* \| WHERE ssl.payload.entropy > 7 AND destination.port = 443 \| STATS COUNT() BY source.ip, destination.ip HAVING COUNT() > 5`. |
| 3. Protocol Tunneling from Compromised Endpoints | Compromised endpoints initiate protocol tunneling, as in FIN7 campaigns. | - Process Creation (DS0009: Sysmon ID 1)<br>- Network Traffic | - **Splunk**: `index=endpoint sourcetype=sysmon EventCode=1 CommandLine="*tunnel*" \| join host [search index=network sourcetype=zeek_dns query_length > 100] \| stats count by host, CommandLine, query \| where count > 3`.<br>- **KQL**: `DeviceProcessEvents \| where ProcessCommandLine contains "tunnel" \| join kind=inner (DeviceNetworkEvents \| where Protocol == "DNS" and AdditionalFields.QueryLength > 100) on DeviceName \| summarize count() by DeviceName, ProcessCommandLine, AdditionalFields.Query \| where count_ > 3`.<br>- **ELK**: `FROM logs-endpoint.process-* \| WHERE process.command_line : "*tunnel*" \| JOIN logs-zeek.dns-* ON host.name WHERE dns.query.length > 100 \| STATS COUNT() BY host.name, process.command_line, dns.query HAVING COUNT() > 3`. |
| 4. Protocol Tunneling with Anomalous Timing | Protocol tunneling occurs outside normal business hours, as in 2025 trends. | - Network Traffic (DS0003: Zeek DNS)<br>- Metrics | - **Splunk**: `index=network sourcetype=zeek_dns query_length > 100 \| timechart span=1h count \| where count > avg(count)*4 AND _time > relative_time(now(), "-24h")`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "DNS" and AdditionalFields.QueryLength > 100 \| summarize HourlyCount=count() by bin(Timestamp, 1h) \| where HourlyCount > avg(HourlyCount) * 4 and Timestamp > ago(24h)`.<br>- **ELK**: `FROM logs-zeek.dns-* \| WHERE dns.query.length > 100 \| STATS COUNT() BY date_histogram(@timestamp, '1h') \| WHERE COUNT() > AVG(COUNT()) * 4 AND @timestamp > NOW - 24 HOURS`. |
| 5. Protocol Tunneling over SSH | Adversaries tunnel C2 over SSH, as in APT29 campaigns. | - Network Traffic (DS0003: Zeek Conn)<br>- SSH Logs | - **Splunk**: `index=network sourcetype=zeek_conn dest_port=22 AND bytes > 10000 \| stats count by src_ip, dest_ip \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where RemotePort == 22 and TotalBytes > 10000 \| summarize count() by DeviceIP, RemoteIP \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.conn-* \| WHERE destination.port = 22 AND network.bytes > 10000 \| STATS COUNT() BY source.ip, destination.ip HAVING COUNT() > 5`. |
| 6. Protocol Tunneling in Cloud Environments | Protocol tunneling in cloud infrastructure, as in 2025 trends. | - Cloud Audit Logs (AWS CloudTrail)<br>- Network Traffic | - **Splunk**: `index=cloud sourcetype=aws:cloudtrail eventName="CreateNetworkAclEntry" AND sourceIPAddress NOT IN (known_ips) \| stats count by sourceIPAddress, eventName \| where count > 5`.<br>- **KQL**: `AWSCloudTrail \| where EventName == "CreateNetworkAclEntry" and SourceIPAddress !in (knownIPs) \| summarize count() by SourceIPAddress, EventName \| where count_ > 5`.<br>- **ELK**: `FROM logs-aws.cloudtrail-* \| WHERE event.action = 'CreateNetworkAclEntry' AND source.ip NOT IN ['known_ips'] \| STATS COUNT() BY source.ip, event.action HAVING COUNT() > 5`. |
| 7. Protocol Tunneling with High Packet Rates | High packet rates in tunneled traffic, as in APT41 campaigns. | - Network Traffic (DS0003: Zeek DNS)<br>- Packet Analysis | - **Splunk**: `index=network sourcetype=zeek_dns query_length > 100 \| timechart span=10s count by src_ip \| where count > 50`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "DNS" and AdditionalFields.QueryLength > 100 \| summarize PacketCount=count() by DeviceIP, bin(Timestamp, 10s) \| where PacketCount > 50`.<br>- **ELK**: `FROM logs-zeek.dns-* \| WHERE dns.query.length > 100 \| STATS COUNT() BY source.ip, date_histogram(@timestamp, '10s') \| WHERE COUNT() > 50`. |
| 8. Protocol Tunneling with Suspicious Processes | Suspicious processes initiate protocol tunneling, as in FIN7 campaigns. | - Process Creation (DS0009: Sysmon ID 1)<br>- Network Traffic | - **Splunk**: `index=endpoint sourcetype=sysmon EventCode=1 CommandLine NOT IN (known_apps) \| join host [search index=network sourcetype=zeek_dns query_length > 100] \| stats count by host, CommandLine, query \| where count > 5`.<br>- **KQL**: `DeviceProcessEvents \| where ProcessCommandLine !in (knownApps) \| join kind=inner (DeviceNetworkEvents \| where Protocol == "DNS" and AdditionalFields.QueryLength > 100) on DeviceName \| summarize count() by DeviceName, ProcessCommandLine, AdditionalFields.Query \| where count_ > 5`.<br>- **ELK**: `FROM logs-endpoint.process-* \| WHERE process.command_line NOT IN ['known_apps'] \| JOIN logs-zeek.dns-* ON host.name WHERE dns.query.length > 100 \| STATS COUNT() BY host.name, process.command_line, dns.query HAVING COUNT() > 5`. |
| 9. Protocol Tunneling with Anomalous User Agents | Protocol tunneling with unusual HTTP user agents, as in Cobalt Strike. | - Network Traffic (DS0003: Zeek HTTP)<br>- Proxy Logs | - **Splunk**: `index=network sourcetype=zeek_http user_agent NOT IN (known_agents) AND payload_entropy > 7 \| stats count by src_ip, user_agent \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "HTTP" and AdditionalFields.UserAgent !in (knownAgents) and AdditionalFields.PayloadEntropy > 7 \| summarize count() by DeviceIP, AdditionalFields.UserAgent \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE http.user_agent NOT IN ['known_agents'] AND http.payload.entropy > 7 \| STATS COUNT() BY source.ip, http.user_agent HAVING COUNT() > 5`. |
| 10. Protocol Tunneling with Suspicious Headers | Protocol tunneling with custom HTTP headers, as in Cobalt Strike. | - Network Traffic (DS0003: Zeek HTTP)<br>- Proxy Logs | - **Splunk**: `index=network sourcetype=zeek_http header IN ("*X-Cobalt*", "*Custom-Header*") \| stats count by src_ip, header \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "HTTP" and AdditionalFields.Header has_any ("X-Cobalt", "Custom-Header") \| summarize count() by DeviceIP, AdditionalFields.Header \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE http.header : ("*X-Cobalt*" OR "*Custom-Header*") \| STATS COUNT() BY source.ip, http.header HAVING COUNT() > 5`. |

### Protocol or Service Impersonation (T1570)

Protocol or service impersonation involves adversaries mimicking legitimate protocols or services to blend C2 traffic with normal network activity, often seen in campaigns like APT29.

| Hypothesis | Description | Data Sources | Hunting Queries |
|------------|-------------|--------------|-----------------|
| 1. Protocol Impersonation of HTTPS | Adversaries impersonate HTTPS traffic for C2, as in APT29 campaigns. High risk in environments with limited SSL inspection. | - Network Traffic (DS0003: Zeek SSL)<br>- Proxy Logs | - **Splunk**: `index=network sourcetype=zeek_ssl cert_subject NOT IN (known_certs) AND dest_port=443 \| stats count by src_ip, cert_subject \| where count > 5` (Detects non-standard SSL certificates).<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "SSL" and AdditionalFields.CertSubject !in (knownCerts) and RemotePort == 443 \| summarize count() by DeviceIP, AdditionalFields.CertSubject \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.ssl-* \| WHERE ssl.certificate.subject NOT IN ['known_certs'] AND destination.port = 443 \| STATS COUNT() BY source.ip, ssl.certificate.subject HAVING COUNT() > 5`. |
| 2. Service Impersonation of DNS | Adversaries impersonate DNS traffic for C2, as in Turla campaigns. | - DNS Logs (DS0003: Zeek DNS)<br>- Network Traffic | - **Splunk**: `index=network sourcetype=zeek_dns query NOT IN (known_domains) AND query_entropy > 3 \| stats count by src_ip, query \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "DNS" and AdditionalFields.Query !in (knownDomains) and AdditionalFields.QueryEntropy > 3 \| summarize count() by DeviceIP, AdditionalFields.Query \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.dns-* \| WHERE dns.query NOT IN ['known_domains'] AND dns.query.entropy > 3 \| STATS COUNT() BY source.ip, dns.query HAVING COUNT() > 5`. |
| 3. Protocol Impersonation from Compromised Endpoints | Compromised endpoints impersonate legitimate protocols, as in FIN7 campaigns. | - Process Creation (DS0009: Sysmon ID 1)<br>- Network Traffic | - **Splunk**: `index=endpoint sourcetype=sysmon EventCode=1 CommandLine="*ssl*" \| join host [search index=network sourcetype=zeek_ssl cert_subject NOT IN (known_certs)] \| stats count by host, CommandLine, cert_subject \| where count > 3`.<br>- **KQL**: `DeviceProcessEvents \| where ProcessCommandLine contains "ssl" \| join kind=inner (DeviceNetworkEvents \| where Protocol == "SSL" and AdditionalFields.CertSubject !in (knownCerts)) on DeviceName \| summarize count() by DeviceName, ProcessCommandLine, AdditionalFields.CertSubject \| where count_ > 3`.<br>- **ELK**: `FROM logs-endpoint.process-* \| WHERE process.command_line : "*ssl*" \| JOIN logs-zeek.ssl-* ON host.name WHERE ssl.certificate.subject NOT IN ['known_certs'] \| STATS COUNT() BY host.name, process.command_line, ssl.certificate.subject HAVING COUNT() > 3`. |
| 4. Protocol Impersonation with Anomalous Timing | Protocol impersonation outside normal business hours, as in 2025 trends. | - Network Traffic (DS0003: Zeek SSL)<br>- Metrics | - **Splunk**: `index=network sourcetype=zeek_ssl cert_subject NOT IN (known_certs) \| timechart span=1h count \| where count > avg(count)*4 AND _time > relative_time(now(), "-24h")`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "SSL" and AdditionalFields.CertSubject !in (knownCerts) \| summarize HourlyCount=count() by bin(Timestamp, 1h) \| where HourlyCount > avg(HourlyCount) * 4 and Timestamp > ago(24h)`.<br>- **ELK**: `FROM logs-zeek.ssl-* \| WHERE ssl.certificate.subject NOT IN ['known_certs'] \| STATS COUNT() BY date_histogram(@timestamp, '1h') \| WHERE COUNT() > AVG(COUNT()) * 4 AND @timestamp > NOW - 24 HOURS`. |
| 5. Service Impersonation of Cloud Services | Adversaries impersonate cloud service traffic, as in 2025 trends. | - Cloud Audit Logs (AWS CloudTrail)<br>- Network Traffic | - **Splunk**: `index=cloud sourcetype=aws:cloudtrail eventName IN ("RunInstances", "StartInstances") AND userAgent NOT IN (known_agents) \| stats count by userAgent, sourceIPAddress \| where count > 5`.<br>- **KQL**: `AWSCloudTrail \| where EventName in ("RunInstances", "StartInstances") and UserAgent !in (knownAgents) \| summarize count() by UserAgent, SourceIPAddress \| where count_ > 5`.<br>- **ELK**: `FROM logs-aws.cloudtrail-* \| WHERE event.action IN ['RunInstances', 'StartInstances'] AND user.agent NOT IN ['known_agents'] \| STATS COUNT() BY user.agent, source.ip HAVING COUNT() > 5`. |
| 6. Protocol Impersonation with High Entropy Payloads | Impersonated protocols with high entropy payloads, as in APT41 campaigns. | - Network Traffic (DS0003: Zeek HTTP)<br>- Packet Analysis | - **Splunk**: `index=network sourcetype=zeek_http payload_entropy > 7 AND user_agent NOT IN (known_agents) \| stats count by src_ip, user_agent \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "HTTP" and AdditionalFields.PayloadEntropy > 7 and AdditionalFields.UserAgent !in (knownAgents) \| summarize count() by DeviceIP, AdditionalFields.UserAgent \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE http.payload.entropy > 7 AND http.user_agent NOT IN ['known_agents'] \| STATS COUNT() BY source.ip, http.user_agent HAVING COUNT() > 5`. |
| 7. Protocol Impersonation with Suspicious Processes | Suspicious processes impersonate legitimate protocols, as in FIN7 campaigns. | - Process Creation (DS0009: Sysmon ID 1)<br>- Network Traffic | - **Splunk**: `index=endpoint sourcetype=sysmon EventCode=1 CommandLine NOT IN (known_apps) \| join host [search index=network sourcetype=zeek_ssl cert_subject NOT IN (known_certs)] \| stats count by host, CommandLine, cert_subject \| where count > 5`.<br>- **KQL**: `DeviceProcessEvents \| where ProcessCommandLine !in (knownApps) \| join kind=inner (DeviceNetworkEvents \| where Protocol == "SSL" and AdditionalFields.CertSubject !in (knownCerts)) on DeviceName \| summarize count() by DeviceName, ProcessCommandLine, AdditionalFields.CertSubject \| where count_ > 5`.<br>- **ELK**: `FROM logs-endpoint.process-* \| WHERE process.command_line NOT IN ['known_apps'] \| JOIN logs-zeek.ssl-* ON host.name WHERE ssl.certificate.subject NOT IN ['known_certs'] \| STATS COUNT() BY host.name, process.command_line, ssl.certificate.subject HAVING COUNT() > 5`. |
| 8. Protocol Impersonation with Suspicious Headers | Impersonated protocols with custom HTTP headers, as in Cobalt Strike. | - Network Traffic (DS0003: Zeek HTTP)<br>- Proxy Logs | - **Splunk**: `index=network sourcetype=zeek_http header IN ("*X-Cobalt*", "*Custom-Header*") \| stats count by src_ip, header \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "HTTP" and AdditionalFields.Header has_any ("X-Cobalt", "Custom-Header") \| summarize count() by DeviceIP, AdditionalFields.Header \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE http.header : ("*X-Cobalt*" OR "*Custom-Header*") \| STATS COUNT() BY source.ip, http.header HAVING COUNT() > 5`. |
| 9. Protocol Impersonation in Linux Environments | Protocol impersonation in Linux hosts, as in Turla campaigns. | - Network Traffic (DS0003: Zeek SSL)<br>- Linux Logs | - **Splunk**: `index=linux sourcetype=auditd syscall="connect" AND dest_port=443 AND exe NOT IN (known_apps) \| join host [search index=network sourcetype=zeek_ssl cert_subject NOT IN (known_certs)] \| stats count by host, exe, cert_subject \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where RemotePort == 443 and InitiatingProcessName !in (knownApps) \| join kind=inner (DeviceProcessEvents \| where ActionType == "connect") on DeviceName \| summarize count() by DeviceName, InitiatingProcessName, AdditionalFields.CertSubject \| where count_ > 5`.<br>- **ELK**: `FROM logs-auditd-* \| WHERE syscall.name = "connect" AND destination.port = 443 AND process.exe NOT IN ['known_apps'] \| JOIN logs-zeek.ssl-* ON host.name WHERE ssl.certificate.subject NOT IN ['known_certs'] \| STATS COUNT() BY host.name, process.exe, ssl.certificate.subject HAVING COUNT() > 5`. |
| 10. Protocol Impersonation with Anomalous User Agents | Protocol impersonation with unusual user agents, as in Cobalt Strike. | - Network Traffic (DS0003: Zeek HTTP)<br>- Proxy Logs | - **Splunk**: `index=network sourcetype=zeek_http user_agent NOT IN (known_agents) \| stats count by src_ip, user_agent \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "HTTP" and AdditionalFields.UserAgent !in (knownAgents) \| summarize count() by DeviceIP, AdditionalFields.UserAgent \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE http.user_agent NOT IN ['known_agents'] \| STATS COUNT() BY source.ip, http.user_agent HAVING COUNT() > 5`. |

### Proxy (T1090)

Proxy techniques involve adversaries routing C2 traffic through proxy servers to obfuscate their origin, commonly used by groups like APT41.

| Hypothesis | Description | Data Sources | Hunting Queries |
|------------|-------------|--------------|-----------------|
| 1. Proxy Usage for C2 | Adversaries route C2 traffic through known proxy servers, as in APT41 campaigns. High risk in environments with limited outbound traffic monitoring. | - Network Traffic (DS0003: Zeek Conn)<br>- Proxy Logs | - **Splunk**: `index=network sourcetype=zeek_conn dest_ip IN (proxy_ips) AND NOT src_ip IN (known_clients) \| stats count by src_ip, dest_ip \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where RemoteIP in (proxyIPs) and DeviceIP !in (knownClients) \| summarize count() by DeviceIP, RemoteIP \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.conn-* \| WHERE destination.ip IN ['proxy_ips'] AND source.ip NOT IN ['known_clients'] \| STATS COUNT() BY source.ip, destination.ip HAVING COUNT() > 5`. |
| 2. Proxy Usage with Encrypted Traffic | Adversaries use proxies with encrypted traffic for C2, as in Turla campaigns. | - Network Traffic (DS0003: Zeek SSL)<br>- Proxy Logs | - **Splunk**: `index=network sourcetype=zeek_ssl dest_port=443 AND dest_ip IN (proxy_ips) \| stats count by src_ip, dest_ip \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where RemotePort == 443 and RemoteIP in (proxyIPs) \| summarize count() by DeviceIP, RemoteIP \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.ssl-* \| WHERE destination.port = 443 AND destination.ip IN ['proxy_ips'] \| STATS COUNT() BY source.ip, destination.ip HAVING COUNT() > 5`. |
| 3. Proxy Access from Compromised Endpoints | Compromised endpoints access proxy servers for C2, as in FIN7 campaigns. | - Process Creation (DS0009: Sysmon ID 1)<br>- Network Traffic | - **Splunk**: `index=endpoint sourcetype=sysmon EventCode=1 CommandLine="*proxy*" \| join host [search index=network sourcetype=zeek_conn dest_ip IN (proxy_ips)] \| stats count by host, CommandLine, dest_ip \| where count > 3`.<br>- **KQL**: `DeviceProcessEvents \| where ProcessCommandLine contains "proxy" \| join kind=inner (DeviceNetworkEvents \| where RemoteIP in (proxyIPs)) on DeviceName \| summarize count() by DeviceName, ProcessCommandLine, RemoteIP \| where count_ > 3`.<br>- **ELK**: `FROM logs-endpoint.process-* \| WHERE process.command_line : "*proxy*" \| JOIN logs-zeek.conn-* ON host.name WHERE destination.ip IN ['proxy_ips'] \| STATS COUNT() BY host.name, process.command_line, destination.ip HAVING COUNT() > 3`. |
| 4. Proxy Usage with Anomalous Timing | Proxy access occurs outside normal business hours, as in 2025 trends. | - Network Traffic (DS0003: Zeek Conn)<br>- Metrics | - **Splunk**: `index=network sourcetype=zeek_conn dest_ip IN (proxy_ips) \| timechart span=1h count \| where count > avg(count)*4 AND _time > relative_time(now(), "-24h")`.<br>- **KQL**: `DeviceNetworkEvents \| where RemoteIP in (proxyIPs) \| summarize HourlyCount=count() by bin(Timestamp, 1h) \| where HourlyCount > avg(HourlyCount) * 4 and Timestamp > ago(24h)`.<br>- **ELK**: `FROM logs-zeek.conn-* \| WHERE destination.ip IN ['proxy_ips'] \| STATS COUNT() BY date_histogram(@timestamp, '1h') \| WHERE COUNT() > AVG(COUNT()) * 4 AND @timestamp > NOW - 24 HOURS`. |
| 5. Proxy Usage with High Entropy Payloads | Proxy traffic with high entropy payloads, as in APT41 campaigns. | - Network Traffic (DS0003: Zeek HTTP)<br>- Packet Analysis | - **Splunk**: `index=network sourcetype=zeek_http dest_ip IN (proxy_ips) AND payload_entropy > 7 \| stats count by src_ip, uri \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where RemoteIP in (proxyIPs) and AdditionalFields.PayloadEntropy > 7 \| summarize count() by DeviceIP, RemoteUrl \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE destination.ip IN ['proxy_ips'] AND http.payload.entropy > 7 \| STATS COUNT() BY source.ip, http.uri HAVING COUNT() > 5`. |
| 6. Proxy Usage in Cloud Environments | Proxy access in cloud infrastructure, as in 2025 trends. | - Cloud Audit Logs (AWS CloudTrail)<br>- Network Traffic | - **Splunk**: `index=cloud sourcetype=aws:cloudtrail eventName="Invoke" AND userIdentity NOT IN (authorized_users) \| stats count by userIdentity, sourceIPAddress \| where count > 5`.<br>- **KQL**: `AWSCloudTrail \| where EventName == "Invoke" and Caller !in (authorizedUsers) \| summarize count() by Caller, SourceIPAddress \| where count_ > 5`.<br>- **ELK**: `FROM logs-aws.cloudtrail-* \| WHERE event.action = 'Invoke' AND user.identity NOT IN ['authorized_users'] \| STATS COUNT() BY user.identity, source.ip HAVING COUNT() > 5`. |
| 7. Proxy Usage with Suspicious Headers | Proxy traffic with custom HTTP headers, as in Cobalt Strike. | - Network Traffic (DS0003: Zeek HTTP)<br>- Proxy Logs | - **Splunk**: `index=network sourcetype=zeek_http dest_ip IN (proxy_ips) AND header IN ("*X-Cobalt*", "*Custom-Header*") \| stats count by src_ip, header \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where RemoteIP in (proxyIPs) and AdditionalFields.Header has_any ("X-Cobalt", "Custom-Header") \| summarize count() by DeviceIP, AdditionalFields.Header \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE destination.ip IN ['proxy_ips'] AND http.header : ("*X-Cobalt*" OR "*Custom-Header*") \| STATS COUNT() BY source.ip, http.header HAVING COUNT() > 5`. |
| 8. Proxy Usage in Linux Environments | Proxy access from Linux hosts, as in Turla campaigns. | - Network Traffic (DS0003: Zeek Conn)<br>- Linux Logs | - **Splunk**: `index=linux sourcetype=auditd syscall="connect" AND dest_ip IN (proxy_ips) AND exe NOT IN (known_apps) \| stats count by exe, dest_ip \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where RemoteIP in (proxyIPs) and InitiatingProcessName !in (knownApps) \| summarize count() by InitiatingProcessName, RemoteIP \| where count_ > 5`.<br>- **ELK**: `FROM logs-auditd-* \| WHERE syscall.name = "connect" AND destination.ip IN ['proxy_ips'] AND process.exe NOT IN ['known_apps'] \| STATS COUNT() BY process.exe, destination.ip HAVING COUNT() > 5`. |
| 9. Proxy Usage with Multi-Stage Redirects | Proxy traffic with HTTP redirects, as in APT41 campaigns. | - Network Traffic (DS0003: Zeek HTTP)<br>- Redirect Analysis | - **Splunk**: `index=network sourcetype=zeek_http dest_ip IN (proxy_ips) AND status_code=302 \| stats count by src_ip, uri \| where count > 3`.<br>- **KQL**: `DeviceNetworkEvents \| where RemoteIP in (proxyIPs) and AdditionalFields.StatusCode == 302 \| summarize count() by DeviceIP, RemoteUrl \| where count_ > 3`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE destination.ip IN ['proxy_ips'] AND http.status = 302 \| STATS COUNT() BY source.ip, http.uri HAVING COUNT() > 3`. |
| 10. Proxy Usage with Anomalous User Agents | Proxy traffic with unusual user agents, as in Cobalt Strike. | - Network Traffic (DS0003: Zeek HTTP)<br>- Proxy Logs | - **Splunk**: `index=network sourcetype=zeek_http dest_ip IN (proxy_ips) AND user_agent NOT IN (known_agents) \| stats count by src_ip, user_agent \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where RemoteIP in (proxyIPs) and AdditionalFields.UserAgent !in (knownAgents) \| summarize count() by DeviceIP, AdditionalFields.UserAgent \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE destination.ip IN ['proxy_ips'] AND http.user_agent NOT IN ['known_agents'] \| STATS COUNT() BY source.ip, http.user_agent HAVING COUNT() > 5`. |


### Publish/Subscribe Protocols (T1102.003)

Publish/Subscribe Protocols involve adversaries using protocols like MQTT or AMQP for C2 communication, often to blend with legitimate IoT or enterprise messaging traffic, as seen in campaigns like APT41.

| Hypothesis | Description | Data Sources | Hunting Queries |
|------------|-------------|--------------|-----------------|
| 1. MQTT-Based C2 Communication | Adversaries use MQTT for C2, as in APT41 campaigns. High risk in IoT-heavy environments with limited protocol inspection. | - Network Traffic (DS0003: Zeek Conn)<br>- Firewall Logs | - **Splunk**: `index=network sourcetype=zeek_conn protocol="mqtt" AND dest_port IN (1883, 8883) \| stats count by src_ip, dest_ip, dest_port \| where count > 5` (Detects MQTT traffic to unusual destinations).<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "MQTT" and RemotePort in (1883, 8883) \| summarize count() by DeviceIP, RemoteIP, RemotePort \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.conn-* \| WHERE network.protocol = 'mqtt' AND destination.port IN [1883, 8883] \| STATS COUNT() BY source.ip, destination.ip, destination.port HAVING COUNT() > 5`. |
| 2. AMQP-Based C2 Communication | Adversaries use AMQP for C2, as in 2025 trends for cloud environments. | - Network Traffic (DS0003: Zeek Conn)<br>- Cloud Logs | - **Splunk**: `index=network sourcetype=zeek_conn protocol="amqp" AND dest_port=5672 \| stats count by src_ip, dest_ip \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "AMQP" and RemotePort == 5672 \| summarize count() by DeviceIP, RemoteIP \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.conn-* \| WHERE network.protocol = 'amqp' AND destination.port = 5672 \| STATS COUNT() BY source.ip, destination.ip HAVING COUNT() > 5`. |
| 3. Pub/Sub C2 from Compromised Endpoints | Compromised endpoints use MQTT/AMQP for C2, as in IoT-focused attacks. | - Process Creation (DS0009: Sysmon ID 1)<br>- Network Traffic | - **Splunk**: `index=endpoint sourcetype=sysmon EventCode=1 CommandLine IN ("*mqtt*", "*amqp*") \| join host [search index=network sourcetype=zeek_conn protocol IN ("mqtt", "amqp")] \| stats count by host, CommandLine, protocol \| where count > 3`.<br>- **KQL**: `DeviceProcessEvents \| where ProcessCommandLine has_any ("mqtt", "amqp") \| join kind=inner (DeviceNetworkEvents \| where Protocol in ("MQTT", "AMQP")) on DeviceName \| summarize count() by DeviceName, ProcessCommandLine, Protocol \| where count_ > 3`.<br>- **ELK**: `FROM logs-endpoint.process-* \| WHERE process.command_line : ("*mqtt*" OR "*amqp*") \| JOIN logs-zeek.conn-* ON host.name WHERE network.protocol IN ['mqtt', 'amqp'] \| STATS COUNT() BY host.name, process.command_line, network.protocol HAVING COUNT() > 3`. |
| 4. Pub/Sub C2 with Anomalous Timing | MQTT/AMQP C2 traffic occurs outside normal business hours, as in 2025 trends. | - Network Traffic (DS0003: Zeek Conn)<br>- Metrics | - **Splunk**: `index=network sourcetype=zeek_conn protocol IN ("mqtt", "amqp") \| timechart span=1h count \| where count > avg(count)*4 AND _time > relative_time(now(), "-24h")`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol in ("MQTT", "AMQP") \| summarize HourlyCount=count() by bin(Timestamp, 1h) \| where HourlyCount > avg(HourlyCount) * 4 and Timestamp > ago(24h)`.<br>- **ELK**: `FROM logs-zeek.conn-* \| WHERE network.protocol IN ['mqtt', 'amqp'] \| STATS COUNT() BY date_histogram(@timestamp, '1h') \| WHERE COUNT() > AVG(COUNT()) * 4 AND @timestamp > NOW - 24 HOURS`. |
| 5. Pub/Sub C2 with High Entropy Payloads | MQTT/AMQP C2 with high entropy payloads, as in APT41 campaigns. | - Network Traffic (DS0003: Zeek Conn)<br>- Packet Analysis | - **Splunk**: `index=network sourcetype=zeek_conn protocol IN ("mqtt", "amqp") AND payload_entropy > 7 \| stats count by src_ip, dest_ip \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol in ("MQTT", "AMQP") and AdditionalFields.PayloadEntropy > 7 \| summarize count() by DeviceIP, RemoteIP \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.conn-* \| WHERE network.protocol IN ['mqtt', 'amqp'] AND network.payload.entropy > 7 \| STATS COUNT() BY source.ip, destination.ip HAVING COUNT() > 5`. |
| 6. Pub/Sub C2 in Cloud Environments | MQTT/AMQP C2 in cloud infrastructure, as in 2025 trends. | - Cloud Audit Logs (AWS CloudTrail)<br>- Network Traffic | - **Splunk**: `index=cloud sourcetype=aws:cloudtrail eventName IN ("RunInstances", "StartInstances") AND userAgent IN ("*mqtt*", "*amqp*") \| stats count by userAgent, sourceIPAddress \| where count > 5`.<br>- **KQL**: `AWSCloudTrail \| where EventName in ("RunInstances", "StartInstances") and UserAgent has_any ("mqtt", "amqp") \| summarize count() by UserAgent, SourceIPAddress \| where count_ > 5`.<br>- **ELK**: `FROM logs-aws.cloudtrail-* \| WHERE event.action IN ['RunInstances', 'StartInstances'] AND user.agent : ("*mqtt*" OR "*amqp*") \| STATS COUNT() BY user.agent, source.ip HAVING COUNT() > 5`. |
| 7. Pub/Sub C2 with Suspicious Processes | Suspicious processes initiate MQTT/AMQP C2, as in FIN7 campaigns. | - Process Creation (DS0009: Sysmon ID 1)<br>- Network Traffic | - **Splunk**: `index=endpoint sourcetype=sysmon EventCode=1 CommandLine NOT IN (known_apps) \| join host [search index=network sourcetype=zeek_conn protocol IN ("mqtt", "amqp")] \| stats count by host, CommandLine, protocol \| where count > 5`.<br>- **KQL**: `DeviceProcessEvents \| where ProcessCommandLine !in (knownApps) \| join kind=inner (DeviceNetworkEvents \| where Protocol in ("MQTT", "AMQP")) on DeviceName \| summarize count() by DeviceName, ProcessCommandLine, Protocol \| where count_ > 5`.<br>- **ELK**: `FROM logs-endpoint.process-* \| WHERE process.command_line NOT IN ['known_apps'] \| JOIN logs-zeek.conn-* ON host.name WHERE network.protocol IN ['mqtt', 'amqp'] \| STATS COUNT() BY host.name, process.command_line, network.protocol HAVING COUNT() > 5`. |
| 8. Pub/Sub C2 with High Packet Rates | High packet rates in MQTT/AMQP traffic, as in 2025 trends. | - Network Traffic (DS0003: Zeek Conn)<br>- Packet Analysis | - **Splunk**: `index=network sourcetype=zeek_conn protocol IN ("mqtt", "amqp") \| timechart span=10s count by src_ip \| where count > 50`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol in ("MQTT", "AMQP") \| summarize PacketCount=count() by DeviceIP, bin(Timestamp, 10s) \| where PacketCount > 50`.<br>- **ELK**: `FROM logs-zeek.conn-* \| WHERE network.protocol IN ['mqtt', 'amqp'] \| STATS COUNT() BY source.ip, date_histogram(@timestamp, '10s') \| WHERE COUNT() > 50`. |
| 9. Pub/Sub C2 with Suspicious Headers | MQTT/AMQP C2 with custom headers, as in Cobalt Strike-inspired campaigns. | - Network Traffic (DS0003: Zeek HTTP)<br>- Proxy Logs | - **Splunk**: `index=network sourcetype=zeek_http header IN ("*X-Cobalt*", "*Custom-Header*") AND protocol IN ("mqtt", "amqp") \| stats count by src_ip, header \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol in ("MQTT", "AMQP") and AdditionalFields.Header has_any ("X-Cobalt", "Custom-Header") \| summarize count() by DeviceIP, AdditionalFields.Header \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE network.protocol IN ['mqtt', 'amqp'] AND http.header : ("*X-Cobalt*" OR "*Custom-Header*") \| STATS COUNT() BY source.ip, http.header HAVING COUNT() > 5`. |
| 10. Pub/Sub C2 in Linux Environments | MQTT/AMQP C2 from Linux hosts, as in Turla campaigns. | - Network Traffic (DS0003: Zeek Conn)<br>- Linux Logs | - **Splunk**: `index=linux sourcetype=auditd syscall="connect" AND dest_port IN (1883, 8883, 5672) AND exe NOT IN (known_apps) \| stats count by exe, dest_ip \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where RemotePort in (1883, 8883, 5672) and InitiatingProcessName !in (knownApps) \| summarize count() by InitiatingProcessName, RemoteIP \| where count_ > 5`.<br>- **ELK**: `FROM logs-auditd-* \| WHERE syscall.name = "connect" AND destination.port IN [1883, 8883, 5672] AND process.exe NOT IN ['known_apps'] \| STATS COUNT() BY process.exe, destination.ip HAVING COUNT() > 5`. |

### Remote Access Hardware (T1219)

Remote Access Hardware involves adversaries using hardware-based remote access devices (e.g., rogue VPN appliances) to maintain persistent access, often seen in sophisticated attacks like APT29.

| Hypothesis | Description | Data Sources | Hunting Queries |
|------------|-------------|--------------|-----------------|
| 1. Rogue VPN Hardware Access | Adversaries use unauthorized VPN hardware for persistent access, as in APT29 campaigns. High risk in environments with limited hardware monitoring. | - Network Traffic (DS0003: Zeek Conn)<br>- VPN Logs | - **Splunk**: `index=network sourcetype=zeek_conn dest_port IN (1194, 500, 4500) AND src_ip NOT IN (known_vpn_ips) \| stats count by src_ip, dest_ip, dest_port \| where count > 5` (Detects VPN traffic from unknown IPs).<br>- **KQL**: `DeviceNetworkEvents \| where RemotePort in (1194, 500, 4500) and DeviceIP !in (knownVPNIPs) \| summarize count() by DeviceIP, RemoteIP, RemotePort \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.conn-* \| WHERE destination.port IN [1194, 500, 4500] AND source.ip NOT IN ['known_vpn_ips'] \| STATS COUNT() BY source.ip, destination.ip, destination.port HAVING COUNT() > 5`. |
| 2. Remote Access Hardware with Encrypted Traffic | Encrypted traffic from rogue hardware, as in Turla campaigns. | - Network Traffic (DS0003: Zeek SSL)<br>- VPN Logs | - **Splunk**: `index=network sourcetype=zeek_ssl dest_port IN (1194, 4500) AND cert_subject NOT IN (known_certs) \| stats count by src_ip, cert_subject \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "SSL" and RemotePort in (1194, 4500) and AdditionalFields.CertSubject !in (knownCerts) \| summarize count() by DeviceIP, AdditionalFields.CertSubject \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.ssl-* \| WHERE destination.port IN [1194, 4500] AND ssl.certificate.subject NOT IN ['known_certs'] \| STATS COUNT() BY source.ip, ssl.certificate.subject HAVING COUNT() > 5`. |
| 3. Rogue Hardware Access from Suspicious Endpoints | Compromised endpoints connect to rogue hardware, as in FIN7 campaigns. | - Process Creation (DS0009: Sysmon ID 1)<br>- Network Traffic | - **Splunk**: `index=endpoint sourcetype=sysmon EventCode=1 CommandLine="*vpn*" \| join host [search index=network sourcetype=zeek_conn dest_port IN (1194, 500, 4500) AND src_ip NOT IN (known_vpn_ips)] \| stats count by host, CommandLine, dest_ip \| where count > 3`.<br>- **KQL**: `DeviceProcessEvents \| where ProcessCommandLine contains "vpn" \| join kind=inner (DeviceNetworkEvents \| where RemotePort in (1194, 500, 4500) and DeviceIP !in (knownVPNIPs)) on DeviceName \| summarize count() by DeviceName, ProcessCommandLine, RemoteIP \| where count_ > 3`.<br>- **ELK**: `FROM logs-endpoint.process-* \| WHERE process.command_line : "*vpn*" \| JOIN logs-zeek.conn-* ON host.name WHERE destination.port IN [1194, 500, 4500] AND source.ip NOT IN ['known_vpn_ips'] \| STATS COUNT() BY host.name, process.command_line, destination.ip HAVING COUNT() > 3`. |
| 4. Rogue Hardware Access with Anomalous Timing | Rogue hardware access outside normal business hours, as in 2025 trends. | - Network Traffic (DS0003: Zeek Conn)<br>- Metrics | - **Splunk**: `index=network sourcetype=zeek_conn dest_port IN (1194, 500, 4500) \| timechart span=1h count \| where count > avg(count)*4 AND _time > relative_time(now(), "-24h")`.<br>- **KQL**: `DeviceNetworkEvents \| where RemotePort in (1194, 500, 4500) \| summarize HourlyCount=count() by bin(Timestamp, 1h) \| where HourlyCount > avg(HourlyCount) * 4 and Timestamp > ago(24h)`.<br>- **ELK**: `FROM logs-zeek.conn-* \| WHERE destination.port IN [1194, 500, 4500] \| STATS COUNT() BY date_histogram(@timestamp, '1h') \| WHERE COUNT() > AVG(COUNT()) * 4 AND @timestamp > NOW - 24 HOURS`. |
| 5. Rogue Hardware with High Entropy Payloads | Rogue hardware traffic with high entropy payloads, as in APT41 campaigns. | - Network Traffic (DS0003: Zeek Conn)<br>- Packet Analysis | - **Splunk**: `index=network sourcetype=zeek_conn dest_port IN (1194, 500, 4500) AND payload_entropy > 7 \| stats count by src_ip, dest_ip \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where RemotePort in (1194, 500, 4500) and AdditionalFields.PayloadEntropy > 7 \| summarize count() by DeviceIP, RemoteIP \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.conn-* \| WHERE destination.port IN [1194, 500, 4500] AND network.payload.entropy > 7 \| STATS COUNT() BY source.ip, destination.ip HAVING COUNT() > 5`. |
| 6. Rogue Hardware in Cloud Environments | Rogue hardware access in cloud infrastructure, as in 2025 trends. | - Cloud Audit Logs (AWS CloudTrail)<br>- Network Traffic | - **Splunk**: `index=cloud sourcetype=aws:cloudtrail eventName IN ("AuthorizeSecurityGroupIngress", "ModifyInstanceAttribute") AND sourceIPAddress NOT IN (known_ips) \| stats count by sourceIPAddress, eventName \| where count > 5`.<br>- **KQL**: `AWSCloudTrail \| where EventName in ("AuthorizeSecurityGroupIngress", "ModifyInstanceAttribute") and SourceIPAddress !in (knownIPs) \| summarize count() by SourceIPAddress, EventName \| where count_ > 5`.<br>- **ELK**: `FROM logs-aws.cloudtrail-* \| WHERE event.action IN ['AuthorizeSecurityGroupIngress', 'ModifyInstanceAttribute'] AND source.ip NOT IN ['known_ips'] \| STATS COUNT() BY source.ip, event.action HAVING COUNT() > 5`. |
| 7. Rogue Hardware with Suspicious Processes | Suspicious processes connect to rogue hardware, as in FIN7 campaigns. | - Process Creation (DS0009: Sysmon ID 1)<br>- Network Traffic | - **Splunk**: `index=endpoint sourcetype=sysmon EventCode=1 CommandLine NOT IN (known_apps) \| join host [search index=network sourcetype=zeek_conn dest_port IN (1194, 500, 4500)] \| stats count by host, CommandLine, dest_ip \| where count > 5`.<br>- **KQL**: `DeviceProcessEvents \| where ProcessCommandLine !in (knownApps) \| join kind=inner (DeviceNetworkEvents \| where RemotePort in (1194, 500, 4500)) on DeviceName \| summarize count() by DeviceName, ProcessCommandLine, RemoteIP \| where count_ > 5`.<br>- **ELK**: `FROM logs-endpoint.process-* \| WHERE process.command_line NOT IN ['known_apps'] \| JOIN logs-zeek.conn-* ON host.name WHERE destination.port IN [1194, 500, 4500] \| STATS COUNT() BY host.name, process.command_line, destination.ip HAVING COUNT() > 5`. |
| 8. Rogue Hardware with Suspicious Headers | Rogue hardware traffic with custom headers, as in Cobalt Strike-inspired campaigns. | - Network Traffic (DS0003: Zeek HTTP)<br>- Proxy Logs | - **Splunk**: `index=network sourcetype=zeek_http dest_port IN (1194, 500, 4500) AND header IN ("*X-Cobalt*", "*Custom-Header*") \| stats count by src_ip, header \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where RemotePort in (1194, 500, 4500) and AdditionalFields.Header has_any ("X-Cobalt", "Custom-Header") \| summarize count() by DeviceIP, AdditionalFields.Header \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE destination.port IN [1194, 500, 4500] AND http.header : ("*X-Cobalt*" OR "*Custom-Header*") \| STATS COUNT() BY source.ip, http.header HAVING COUNT() > 5`. |
| 9. Rogue Hardware with Multi-Stage Redirects | Rogue hardware traffic with HTTP redirects, as in APT41 campaigns. | - Network Traffic (DS0003: Zeek HTTP)<br>- Redirect Analysis | - **Splunk**: `index=network sourcetype=zeek_http dest_port IN (1194, 500, 4500) AND status_code=302 \| stats count by src_ip, uri \| where count > 3`.<br>- **KQL**: `DeviceNetworkEvents \| where RemotePort in (1194, 500, 4500) and AdditionalFields.StatusCode == 302 \| summarize count() by DeviceIP, RemoteUrl \| where count_ > 3`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE destination.port IN [1194, 500, 4500] AND http.status = 302 \| STATS COUNT() BY source.ip, http.uri HAVING COUNT() > 3`. |
| 10. Rogue Hardware with Anomalous User Agents | Rogue hardware traffic with unusual user agents, as in Cobalt Strike. | - Network Traffic (DS0003: Zeek HTTP)<br>- Proxy Logs | - **Splunk**: `index=network sourcetype=zeek_http dest_port IN (1194, 500, 4500) AND user_agent NOT IN (known_agents) \| stats count by src_ip, user_agent \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where RemotePort in (1194, 500, 4500) and AdditionalFields.UserAgent !in (knownAgents) \| summarize count() by DeviceIP, AdditionalFields.UserAgent \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE destination.port IN [1194, 500, 4500] AND http.user_agent NOT IN ['known_agents'] \| STATS COUNT() BY source.ip, http.user_agent HAVING COUNT() > 5`. |

### Remote Access Tools (T1219)

Remote Access Tools (RATs) involve adversaries using software like AnyDesk or TeamViewer for C2, often to maintain persistent access, as seen in campaigns like FIN7.

| Hypothesis | Description | Data Sources | Hunting Queries |
|------------|-------------|--------------|-----------------|
| 1. Unauthorized RAT Execution | Adversaries use RATs like AnyDesk for C2, as in FIN7 campaigns. High risk in Windows environments with limited application monitoring. | - Process Creation (DS0009: Sysmon ID 1)<br>- Endpoint Logs | - **Splunk**: `index=endpoint sourcetype=sysmon EventCode=1 Image IN ("*AnyDesk.exe*", "*TeamViewer.exe*") AND ParentImage NOT IN (known_apps) \| stats count by host, Image \| where count > 3` (Detects unauthorized RAT execution).<br>- **KQL**: `DeviceProcessEvents \| where FileName has_any ("AnyDesk.exe", "TeamViewer.exe") and ParentFileName !in (knownApps) \| summarize count() by DeviceName, FileName \| where count_ > 3`.<br>- **ELK**: `FROM logs-endpoint.process-* \| WHERE process.name : ("AnyDesk.exe" OR "TeamViewer.exe") AND process.parent.name NOT IN ['known_apps'] \| STATS COUNT() BY host.name, process.name HAVING COUNT() > 3`. |
| 2. RAT Network Activity | RATs generate network traffic to C2 servers, as in Cobalt Strike campaigns. | - Network Traffic (DS0003: Zeek Conn)<br>- Proxy Logs | - **Splunk**: `index=network sourcetype=zeek_conn dest_ip NOT IN (known_ips) AND process IN ("*AnyDesk*", "*TeamViewer*") \| stats count by src_ip, dest_ip \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where RemoteIP !in (knownIPs) and InitiatingProcessName has_any ("AnyDesk", "TeamViewer") \| summarize count() by DeviceIP, RemoteIP \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.conn-* \| WHERE destination.ip NOT IN ['known_ips'] AND process.name : ("*AnyDesk*" OR "*TeamViewer*") \| STATS COUNT() BY source.ip, destination.ip HAVING COUNT() > 5`. |
| 3. RAT with Anomalous Timing | RAT activity outside normal business hours, as in 2025 trends. | - Process Creation (DS0009: Sysmon ID 1)<br>- Metrics | - **Splunk**: `index=endpoint sourcetype=sysmon EventCode=1 Image IN ("*AnyDesk.exe*", "*TeamViewer.exe*") \| timechart span=1h count \| where count > avg(count)*4 AND _time > relative_time(now(), "-24h")`.<br>- **KQL**: `DeviceProcessEvents \| where FileName has_any ("AnyDesk.exe", "TeamViewer.exe") \| summarize HourlyCount=count() by bin(Timestamp, 1h) \| where HourlyCount > avg(HourlyCount) * 4 and Timestamp > ago(24h)`.<br>- **ELK**: `FROM logs-endpoint.process-* \| WHERE process.name : ("AnyDesk.exe" OR "TeamViewer.exe") \| STATS COUNT() BY date_histogram(@timestamp, '1h') \| WHERE COUNT() > AVG(COUNT()) * 4 AND @timestamp > NOW - 24 HOURS`. |
| 4. RAT with Suspicious Command Lines | Suspicious command-line arguments in RAT execution, as in FIN7 campaigns. | - Process Creation (DS0009: Sysmon ID 1)<br>- Endpoint Logs | - **Splunk**: `index=endpoint sourcetype=sysmon EventCode=1 Image IN ("*AnyDesk.exe*", "*TeamViewer.exe*") AND CommandLine NOT IN (known_commands) \| stats count by host, CommandLine \| where count > 3`.<br>- **KQL**: `DeviceProcessEvents \| where FileName has_any ("AnyDesk.exe", "TeamViewer.exe") and ProcessCommandLine !in (knownCommands) \| summarize count() by DeviceName, ProcessCommandLine \| where count_ > 3`.<br>- **ELK**: `FROM logs-endpoint.process-* \| WHERE process.name : ("AnyDesk.exe" OR "TeamViewer.exe") AND process.command_line NOT IN ['known_commands'] \| STATS COUNT() BY host.name, process.command_line HAVING COUNT() > 3`. |
| 5. RAT Network Activity with High Entropy | RAT traffic with high entropy payloads, as in APT41 campaigns. | - Network Traffic (DS0003: Zeek Conn)<br>- Packet Analysis | - **Splunk**: `index=network sourcetype=zeek_conn process IN ("*AnyDesk*", "*TeamViewer*") AND payload_entropy > 7 \| stats count by src_ip, dest_ip \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where InitiatingProcessName has_any ("AnyDesk", "TeamViewer") and AdditionalFields.PayloadEntropy > 7 \| summarize count() by DeviceIP, RemoteIP \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.conn-* \| WHERE process.name : ("*AnyDesk*" OR "*TeamViewer*") AND network.payload.entropy > 7 \| STATS COUNT() BY source.ip, destination.ip HAVING COUNT() > 5`. |
| 6. RAT in Cloud Environments | RAT activity in cloud infrastructure, as in 2025 trends. | - Cloud Audit Logs (AWS CloudTrail)<br>- Network Traffic | - **Splunk**: `index=cloud sourcetype=aws:cloudtrail eventName IN ("RunInstances", "StartInstances") AND userAgent IN ("*AnyDesk*", "*TeamViewer*") \| stats count by userAgent, sourceIPAddress \| where count > 5`.<br>- **KQL**: `AWSCloudTrail \| where EventName in ("RunInstances", "StartInstances") and UserAgent has_any ("AnyDesk", "TeamViewer") \| summarize count() by UserAgent, SourceIPAddress \| where count_ > 5`.<br>- **ELK**: `FROM logs-aws.cloudtrail-* \| WHERE event.action IN ['RunInstances', 'StartInstances'] AND user.agent : ("*AnyDesk*" OR "*TeamViewer*") \| STATS COUNT() BY user.agent, source.ip HAVING COUNT() > 5`. |
| 7. RAT with Suspicious Headers | RAT traffic with custom HTTP headers, as in Cobalt Strike-inspired campaigns. | - Network Traffic (DS0003: Zeek HTTP)<br>- Proxy Logs | - **Splunk**: `index=network sourcetype=zeek_http process IN ("*AnyDesk*", "*TeamViewer*") AND header IN ("*X-Cobalt*", "*Custom-Header*") \| stats count by src_ip, header \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where InitiatingProcessName has_any ("AnyDesk", "TeamViewer") and AdditionalFields.Header has_any ("X-Cobalt", "Custom-Header") \| summarize count() by DeviceIP, AdditionalFields.Header \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE process.name : ("*AnyDesk*" OR "*TeamViewer*") AND http.header : ("*X-Cobalt*" OR "*Custom-Header*") \| STATS COUNT() BY source.ip, http.header HAVING COUNT() > 5`. |
| 8. RAT in Linux Environments | RAT activity from Linux hosts, as in Turla campaigns. | - Process Creation (DS0017: Auditd)<br>- Network Traffic | - **Splunk**: `index=linux sourcetype=auditd type=EXECVE AND exe IN ("*anydesk*", "*teamviewer*") \| join host [search index=network sourcetype=zeek_conn dest_ip NOT IN (known_ips)] \| stats count by host, exe, dest_ip \| where count > 5`.<br>- **KQL**: `DeviceProcessEvents \| where ActionType == "EXECVE" and FileName has_any ("anydesk", "teamviewer") \| join kind=inner (DeviceNetworkEvents \| where RemoteIP !in (knownIPs)) on DeviceName \| summarize count() by DeviceName, FileName, RemoteIP \| where count_ > 5`.<br>- **ELK**: `FROM logs-auditd-* \| WHERE auditd.type = 'EXECVE' AND process.exe : ("*anydesk*" OR "*teamviewer*") \| JOIN logs-zeek.conn-* ON host.name WHERE destination.ip NOT IN ['known_ips'] \| STATS COUNT() BY host.name, process.exe, destination.ip HAVING COUNT() > 5`. |
| 9. RAT with Multi-Stage Redirects | RAT traffic with HTTP redirects, as in APT41 campaigns. | - Network Traffic (DS0003: Zeek HTTP)<br>- Redirect Analysis | - **Splunk**: `index=network sourcetype=zeek_http process IN ("*AnyDesk*", "*TeamViewer*") AND status_code=302 \| stats count by src_ip, uri \| where count > 3`.<br>- **KQL**: `DeviceNetworkEvents \| where InitiatingProcessName has_any ("AnyDesk", "TeamViewer") and AdditionalFields.StatusCode == 302 \| summarize count() by DeviceIP, RemoteUrl \| where count_ > 3`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE process.name : ("*AnyDesk*" OR "*TeamViewer*") AND http.status = 302 \| STATS COUNT() BY source.ip, http.uri HAVING COUNT() > 3`. |
| 10. RAT with Anomalous User Agents | RAT traffic with unusual user agents, as in Cobalt Strike. | - Network Traffic (DS0003: Zeek HTTP)<br>- Proxy Logs | - **Splunk**: `index=network sourcetype=zeek_http process IN ("*AnyDesk*", "*TeamViewer*") AND user_agent NOT IN (known_agents) \| stats count by src_ip, user_agent \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where InitiatingProcessName has_any ("AnyDesk", "TeamViewer") and AdditionalFields.UserAgent !in (knownAgents) \| summarize count() by DeviceIP, AdditionalFields.UserAgent \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE process.name : ("*AnyDesk*" OR "*TeamViewer*") AND http.user_agent NOT IN ['known_agents'] \| STATS COUNT() BY source.ip, http.user_agent HAVING COUNT() > 5`. |

### Remote Desktop Software (T1021)

Remote Desktop Software involves adversaries using tools like RDP or VNC for C2 or lateral movement, commonly seen in campaigns like FIN7 or APT29.

| Hypothesis | Description | Data Sources | Hunting Queries |
|------------|-------------|--------------|-----------------|
| 1. Unauthorized RDP Usage | Adversaries use RDP for C2 or lateral movement, as in FIN7 campaigns. High risk in Windows environments with limited session monitoring. | - Windows Event Logs (DS0009: Event ID 4624)<br>- Network Traffic | - **Splunk**: `index=windows sourcetype=WinEventLog:Security EventCode=4624 LogonType=10 AND src_ip NOT IN (known_ips) \| stats count by src_ip, dest_host \| where count > 5` (Detects remote desktop logons from unknown IPs).<br>- **KQL**: `SecurityEvent \| where EventID == 4624 and LogonType == 10 and SourceIP !in (knownIPs) \| summarize count() by SourceIP, TargetHost \| where count_ > 5`.<br>- **ELK**: `FROM logs-windows.security-* \| WHERE event.code = '4624' AND winlog.event_data.LogonType = '10' AND source.ip NOT IN ['known_ips'] \| STATS COUNT() BY source.ip, winlog.event_data.TargetHost HAVING COUNT() > 5`. |
| 2. VNC-Based Remote Access | Adversaries use VNC for C2, as in Turla campaigns. | - Process Creation (DS0009: Sysmon ID 1)<br>- Network Traffic | - **Splunk**: `index=endpoint sourcetype=sysmon EventCode=1 Image IN ("*vncviewer.exe*", "*tightvnc.exe*") \| join host [search index=network sourcetype=zeek_conn dest_port IN (5900, 5901)] \| stats count by host, Image, dest_ip \| where count > 3`.<br>- **KQL**: `DeviceProcessEvents \| where FileName has_any ("vncviewer.exe", "tightvnc.exe") \| join kind=inner (DeviceNetworkEvents \| where RemotePort in (5900, 5901)) on DeviceName \| summarize count() by DeviceName, FileName, RemoteIP \| where count_ > 3`.<br>- **ELK**: `FROM logs-endpoint.process-* \| WHERE process.name : ("vncviewer.exe" OR "tightvnc.exe") \| JOIN logs-zeek.conn-* ON host.name WHERE destination.port IN [5900, 5901] \| STATS COUNT() BY host.name, process.name, destination.ip HAVING COUNT() > 3`. |
| 3. RDP with Anomalous Timing | RDP sessions outside normal business hours, as in 2025 trends. | - Windows Event Logs (DS0009: Event ID 4624)<br>- Metrics | - **Splunk**: `index=windows sourcetype=WinEventLog:Security EventCode=4624 LogonType=10 \| timechart span=1h count \| where count > avg(count)*4 AND _time > relative_time(now(), "-24h")`.<br>- **KQL**: `SecurityEvent \| where EventID == 4624 and LogonType == 10 \| summarize HourlyCount=count() by bin(TimeGenerated, 1h) \| where HourlyCount > avg(HourlyCount) * 4 and TimeGenerated > ago(24h)`.<br>- **ELK**: `FROM logs-windows.security-* \| WHERE event.code = '4624' AND winlog.event_data.LogonType = '10' \| STATS COUNT() BY date_histogram(@timestamp, '1h') \| WHERE COUNT() > AVG(COUNT()) * 4 AND @timestamp > NOW - 24 HOURS`. |
| 4. Remote Desktop with Suspicious Processes | Suspicious processes initiate RDP/VNC sessions, as in FIN7 campaigns. | - Process Creation (DS0009: Sysmon ID 1)<br>- Windows Event Logs | - **Splunk**: `index=endpoint sourcetype=sysmon EventCode=1 Image NOT IN (known_apps) \| join host [search index=windows sourcetype=WinEventLog:Security EventCode=4624 LogonType=10] \| stats count by host, Image, src_ip \| where count > 5`.<br>- **KQL**: `DeviceProcessEvents \| where FileName !in (knownApps) \| join kind=inner (SecurityEvent \| where EventID == 4624 and LogonType == 10) on Computer \| summarize count() by Computer, FileName, SourceIP \| where count_ > 5`.<br>- **ELK**: `FROM logs-endpoint.process-* \| WHERE process.name NOT IN ['known_apps'] \| JOIN logs-windows.security-* ON host.name WHERE event.code = '4624' AND winlog.event_data.LogonType = '10' \| STATS COUNT() BY host.name, process.name, source.ip HAVING COUNT() > 5`. |
| 5. Remote Desktop with High Entropy Traffic | RDP/VNC traffic with high entropy payloads, as in APT41 campaigns. | - Network Traffic (DS0003: Zeek Conn)<br>- Packet Analysis | - **Splunk**: `index=network sourcetype=zeek_conn dest_port IN (3389, 5900, 5901) AND payload_entropy > 7 \| stats count by src_ip, dest_ip \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where RemotePort in (3389, 5900, 5901) and AdditionalFields.PayloadEntropy > 7 \| summarize count() by DeviceIP, RemoteIP \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.conn-* \| WHERE destination.port IN [3389, 5900, 5901] AND network.payload.entropy > 7 \| STATS COUNT() BY source.ip, destination.ip HAVING COUNT() > 5`. |
| 6. Remote Desktop in Cloud Environments | RDP/VNC activity in cloud infrastructure, as in 2025 trends. | - Cloud Audit Logs (AWS CloudTrail)<br>- Network Traffic | - **Splunk**: `index=cloud sourcetype=aws:cloudtrail eventName IN ("RunInstances", "StartInstances") AND userAgent IN ("*rdp*", "*vnc*") \| stats count by userAgent, sourceIPAddress \| where count > 5`.<br>- **KQL**: `AWSCloudTrail \| where EventName in ("RunInstances", "StartInstances") and UserAgent has_any ("rdp", "vnc") \| summarize count() by UserAgent, SourceIPAddress \| where count_ > 5`.<br>- **ELK**: `FROM logs-aws.cloudtrail-* \| WHERE event.action IN ['RunInstances', 'StartInstances'] AND user.agent : ("*rdp*" OR "*vnc*") \| STATS COUNT() BY user.agent, source.ip HAVING COUNT() > 5`. |
| 7. Remote Desktop with Suspicious Headers | RDP/VNC traffic with custom HTTP headers, as in Cobalt Strike-inspired campaigns. | - Network Traffic (DS0003: Zeek HTTP)<br>- Proxy Logs | - **Splunk**: `index=network sourcetype=zeek_http dest_port IN (3389, 5900, 5901) AND header IN ("*X-Cobalt*", "*Custom-Header*") \| stats count by src_ip, header \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where RemotePort in (3389, 5900, 5901) and AdditionalFields.Header has_any ("X-Cobalt", "Custom-Header") \| summarize count() by DeviceIP, AdditionalFields.Header \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE destination.port IN [3389, 5900, 5901] AND http.header : ("*X-Cobalt*" OR "*Custom-Header*") \| STATS COUNT() BY source.ip, http.header HAVING COUNT() > 5`. |
| 8. Remote Desktop in Linux Environments | RDP/VNC activity from Linux hosts, as in Turla campaigns. | - Network Traffic (DS0003: Zeek Conn)<br>- Linux Logs | - **Splunk**: `index=linux sourcetype=auditd syscall="connect" AND dest_port IN (3389, 5900, 5901) AND exe NOT IN (known_apps) \| stats count by exe, dest_ip \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where RemotePort in (3389, 5900, 5901) and InitiatingProcessName !in (knownApps) \| summarize count() by InitiatingProcessName, RemoteIP \| where count_ > 5`.<br>- **ELK**: `FROM logs-auditd-* \| WHERE syscall.name = "connect" AND destination.port IN [3389, 5900, 5901] AND process.exe NOT IN ['known_apps'] \| STATS COUNT() BY process.exe, destination.ip HAVING COUNT() > 5`. |
| 9. Remote Desktop with Multi-Stage Redirects | RDP/VNC traffic with HTTP redirects, as in APT41 campaigns. | - Network Traffic (DS0003: Zeek HTTP)<br>- Redirect Analysis | - **Splunk**: `index=network sourcetype=zeek_http dest_port IN (3389, 5900, 5901) AND status_code=302 \| stats count by src_ip, uri \| where count > 3`.<br>- **KQL**: `DeviceNetworkEvents \| where RemotePort in (3389, 5900, 5901) and AdditionalFields.StatusCode == 302 \| summarize count() by DeviceIP, RemoteUrl \| where count_ > 3`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE destination.port IN [3389, 5900, 5901] AND http.status = 302 \| STATS COUNT() BY source.ip, http.uri HAVING COUNT() > 3`. |
| 10. Remote Desktop with Anomalous User Agents | RDP/VNC traffic with unusual user agents, as in Cobalt Strike. | - Network Traffic (DS0003: Zeek HTTP)<br>- Proxy Logs | - **Splunk**: `index=network sourcetype=zeek_http dest_port IN (3389, 5900, 5901) AND user_agent NOT IN (known_agents) \| stats count by src_ip, user_agent \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where RemotePort in (3389, 5900, 5901) and AdditionalFields.UserAgent !in (knownAgents) \| summarize count() by DeviceIP, AdditionalFields.UserAgent \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE destination.port IN [3389, 5900, 5901] AND http.user_agent NOT IN ['known_agents'] \| STATS COUNT() BY source.ip, http.user_agent HAVING COUNT() > 5`. |


### Socket Filters (T1205.001)

Socket Filters involve adversaries using kernel-level network filters (e.g., iptables, Windows Filtering Platform) to manipulate network traffic for persistence or evasion, often seen in advanced campaigns like APT29.

| Hypothesis | Description | Data Sources | Hunting Queries |
|------------|-------------|--------------|-----------------|
| 1. Unauthorized iptables Rules in Linux | Adversaries add malicious iptables rules for persistence, as in Turla campaigns. High risk in Linux environments with limited auditing. | - Linux Logs (DS0016: Auditd)<br>- Network Traffic (DS0003: Zeek Conn) | - **Splunk**: `index=linux sourcetype=auditd type=RULE_ADD AND exe="/sbin/iptables" AND NOT src_ip IN (known_admins) \| stats count by host, a0 \| where count > 3` (Detects unauthorized iptables rule additions).<br>- **KQL**: `DeviceProcessEvents \| where ActionType == "RULE_ADD" and FileName == "iptables" and SourceIP !in (knownAdmins) \| summarize count() by DeviceName, ProcessCommandLine \| where count_ > 3`.<br>- **ELK**: `FROM logs-auditd-* \| WHERE auditd.type = 'RULE_ADD' AND process.exe = '/sbin/iptables' AND source.ip NOT IN ['known_admins'] \| STATS COUNT() BY host.name, process.args[0] HAVING COUNT() > 3`. |
| 2. Windows Filtering Platform (WFP) Modifications | Adversaries modify WFP rules for traffic manipulation, as in APT29 campaigns. | - Windows Event Logs (DS0009: Event ID 5150)<br>- Process Creation (DS0009: Sysmon ID 1) | - **Splunk**: `index=windows sourcetype=WinEventLog:Security EventCode=5150 AND NOT user IN (known_admins) \| join host [search index=endpoint sourcetype=sysmon EventCode=1 Image="*netsh.exe*"] \| stats count by host, user, Image \| where count > 3`.<br>- **KQL**: `SecurityEvent \| where EventID == 5150 and Account !in (knownAdmins) \| join kind=inner (DeviceProcessEvents \| where FileName == "netsh.exe") on Computer \| summarize count() by Computer, Account, FileName \| where count_ > 3`.<br>- **ELK**: `FROM logs-windows.security-* \| WHERE event.code = '5150' AND winlog.event_data.Account NOT IN ['known_admins'] \| JOIN logs-endpoint.process-* ON host.name WHERE process.name = 'netsh.exe' \| STATS COUNT() BY host.name, winlog.event_data.Account, process.name HAVING COUNT() > 3`. |
| 3. Socket Filters with Suspicious Processes | Suspicious processes modify socket filters, as in FIN7 campaigns. | - Process Creation (DS0009: Sysmon ID 1)<br>- Linux Logs (DS0016: Auditd) | - **Splunk**: `index=endpoint sourcetype=sysmon EventCode=1 CommandLine IN ("*iptables*", "*netsh*") AND Image NOT IN (known_apps) \| stats count by host, Image, CommandLine \| where count > 3`.<br>- **KQL**: `DeviceProcessEvents \| where ProcessCommandLine has_any ("iptables", "netsh") and FileName !in (knownApps) \| summarize count() by DeviceName, FileName, ProcessCommandLine \| where count_ > 3`.<br>- **ELK**: `FROM logs-endpoint.process-* \| WHERE process.command_line : ("*iptables*" OR "*netsh*") AND process.name NOT IN ['known_apps'] \| STATS COUNT() BY host.name, process.name, process.command_line HAVING COUNT() > 3`. |
| 4. Socket Filters with Anomalous Timing | Socket filter modifications outside normal business hours, as in 2025 trends. | - Linux Logs (DS0016: Auditd)<br>- Windows Event Logs | - **Splunk**: `index=linux sourcetype=auditd type=RULE_ADD AND exe="/sbin/iptables" \| timechart span=1h count \| where count > avg(count)*4 AND _time > relative_time(now(), "-24h")`.<br>- **KQL**: `DeviceProcessEvents \| where ActionType == "RULE_ADD" and FileName == "iptables" \| summarize HourlyCount=count() by bin(Timestamp, 1h) \| where HourlyCount > avg(HourlyCount) * 4 and Timestamp > ago(24h)`.<br>- **ELK**: `FROM logs-auditd-* \| WHERE auditd.type = 'RULE_ADD' AND process.exe = '/sbin/iptables' \| STATS COUNT() BY date_histogram(@timestamp, '1h') \| WHERE COUNT() > AVG(COUNT()) * 4 AND @timestamp > NOW - 24 HOURS`. |
| 5. Socket Filters in Cloud Environments | Adversaries modify network ACLs in cloud environments to mimic socket filters, as in 2025 trends. | - Cloud Audit Logs (AWS CloudTrail)<br>- Network Traffic | - **Splunk**: `index=cloud sourcetype=aws:cloudtrail eventName="CreateNetworkAclEntry" AND sourceIPAddress NOT IN (known_ips) \| stats count by sourceIPAddress, eventName \| where count > 5`.<br>- **KQL**: `AWSCloudTrail \| where EventName == "CreateNetworkAclEntry" and SourceIPAddress !in (knownIPs) \| summarize count() by SourceIPAddress, EventName \| where count_ > 5`.<br>- **ELK**: `FROM logs-aws.cloudtrail-* \| WHERE event.action = 'CreateNetworkAclEntry' AND source.ip NOT IN ['known_ips'] \| STATS COUNT() BY source.ip, event.action HAVING COUNT() > 5`. |
| 6. Socket Filters with High Network Activity | Socket filter modifications followed by high network activity, as in APT41 campaigns. | - Network Traffic (DS0003: Zeek Conn)<br>- Linux Logs | - **Splunk**: `index=linux sourcetype=auditd type=RULE_ADD AND exe="/sbin/iptables" \| join host [search index=network sourcetype=zeek_conn bytes > 10000] \| stats count by host, dest_ip \| where count > 5`.<br>- **KQL**: `DeviceProcessEvents \| where ActionType == "RULE_ADD" and FileName == "iptables" \| join kind=inner (DeviceNetworkEvents \| where TotalBytes > 10000) on DeviceName \| summarize count() by DeviceName, RemoteIP \| where count_ > 5`.<br>- **ELK**: `FROM logs-auditd-* \| WHERE auditd.type = 'RULE_ADD' AND process.exe = '/sbin/iptables' \| JOIN logs-zeek.conn-* ON host.name WHERE network.bytes > 10000 \| STATS COUNT() BY host.name, destination.ip HAVING COUNT() > 5`. |
| 7. Socket Filters with Suspicious Command Lines | Suspicious command-line arguments in socket filter modifications, as in FIN7 campaigns. | - Process Creation (DS0009: Sysmon ID 1)<br>- Linux Logs | - **Splunk**: `index=endpoint sourcetype=sysmon EventCode=1 CommandLine IN ("*iptables -A*", "*netsh advfirewall*") AND CommandLine NOT IN (known_commands) \| stats count by host, CommandLine \| where count > 3`.<br>- **KQL**: `DeviceProcessEvents \| where ProcessCommandLine has_any ("iptables -A", "netsh advfirewall") and ProcessCommandLine !in (knownCommands) \| summarize count() by DeviceName, ProcessCommandLine \| where count_ > 3`.<br>- **ELK**: `FROM logs-endpoint.process-* \| WHERE process.command_line : ("*iptables -A*" OR "*netsh advfirewall*") AND process.command_line NOT IN ['known_commands'] \| STATS COUNT() BY host.name, process.command_line HAVING COUNT() > 3`. |
| 8. Socket Filters with Anomalous User Agents | Socket filter traffic with unusual HTTP user agents, as in Cobalt Strike-inspired campaigns. | - Network Traffic (DS0003: Zeek HTTP)<br>- Proxy Logs | - **Splunk**: `index=network sourcetype=zeek_http user_agent NOT IN (known_agents) \| join src_ip [search index=linux sourcetype=auditd type=RULE_ADD] \| stats count by src_ip, user_agent \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where AdditionalFields.UserAgent !in (knownAgents) \| join kind=inner (DeviceProcessEvents \| where ActionType == "RULE_ADD") on DeviceIP \| summarize count() by DeviceIP, AdditionalFields.UserAgent \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE http.user_agent NOT IN ['known_agents'] \| JOIN logs-auditd-* ON source.ip WHERE auditd.type = 'RULE_ADD' \| STATS COUNT() BY source.ip, http.user_agent HAVING COUNT() > 5`. |
| 9. Socket Filters with High Entropy Traffic | Socket filter modifications followed by high entropy traffic, as in APT41 campaigns. | - Network Traffic (DS0003: Zeek Conn)<br>- Packet Analysis | - **Splunk**: `index=network sourcetype=zeek_conn payload_entropy > 7 \| join src_ip [search index=linux sourcetype=auditd type=RULE_ADD] \| stats count by src_ip, dest_ip \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where AdditionalFields.PayloadEntropy > 7 \| join kind=inner (DeviceProcessEvents \| where ActionType == "RULE_ADD") on DeviceIP \| summarize count() by DeviceIP, RemoteIP \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.conn-* \| WHERE network.payload.entropy > 7 \| JOIN logs-auditd-* ON source.ip WHERE auditd.type = 'RULE_ADD' \| STATS COUNT() BY source.ip, destination.ip HAVING COUNT() > 5`. |
| 10. Socket Filters with Suspicious Headers | Socket filter traffic with custom HTTP headers, as in Cobalt Strike. | - Network Traffic (DS0003: Zeek HTTP)<br>- Proxy Logs | - **Splunk**: `index=network sourcetype=zeek_http header IN ("*X-Cobalt*", "*Custom-Header*") \| join src_ip [search index=linux sourcetype=auditd type=RULE_ADD] \| stats count by src_ip, header \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where AdditionalFields.Header has_any ("X-Cobalt", "Custom-Header") \| join kind=inner (DeviceProcessEvents \| where ActionType == "RULE_ADD") on DeviceIP \| summarize count() by DeviceIP, AdditionalFields.Header \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE http.header : ("*X-Cobalt*" OR "*Custom-Header*") \| JOIN logs-auditd-* ON source.ip WHERE auditd.type = 'RULE_ADD' \| STATS COUNT() BY source.ip, http.header HAVING COUNT() > 5`. |

### Standard Cryptographic Protocol (T1573)

Standard Cryptographic Protocol involves adversaries using protocols like TLS or SSH for encrypted C2 communication to blend with legitimate traffic, as seen in campaigns like APT29.

| Hypothesis | Description | Data Sources | Hunting Queries |
|------------|-------------|--------------|-----------------|
| 1. TLS-Based C2 Communication | Adversaries use TLS for C2, as in APT29 campaigns. High risk in environments with limited SSL inspection. | - Network Traffic (DS0003: Zeek SSL)<br>- Proxy Logs | - **Splunk**: `index=network sourcetype=zeek_ssl cert_subject NOT IN (known_certs) AND dest_port=443 \| stats count by src_ip, cert_subject \| where count > 5` (Detects non-standard SSL certificates).<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "SSL" and AdditionalFields.CertSubject !in (knownCerts) and RemotePort == 443 \| summarize count() by DeviceIP, AdditionalFields.CertSubject \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.ssl-* \| WHERE ssl.certificate.subject NOT IN ['known_certs'] AND destination.port = 443 \| STATS COUNT() BY source.ip, ssl.certificate.subject HAVING COUNT() > 5`. |
| 2. SSH-Based C2 Communication | Adversaries use SSH for C2, as in Turla campaigns. | - Network Traffic (DS0003: Zeek Conn)<br>- SSH Logs | - **Splunk**: `index=network sourcetype=zeek_conn dest_port=22 AND src_ip NOT IN (known_ssh_clients) \| stats count by src_ip, dest_ip \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where RemotePort == 22 and DeviceIP !in (knownSSHClients) \| summarize count() by DeviceIP, RemoteIP \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.conn-* \| WHERE destination.port = 22 AND source.ip NOT IN ['known_ssh_clients'] \| STATS COUNT() BY source.ip, destination.ip HAVING COUNT() > 5`. |
| 3. Cryptographic Protocol with Suspicious Processes | Suspicious processes initiate encrypted C2, as in FIN7 campaigns. | - Process Creation (DS0009: Sysmon ID 1)<br>- Network Traffic | - **Splunk**: `index=endpoint sourcetype=sysmon EventCode=1 CommandLine NOT IN (known_apps) \| join host [search index=network sourcetype=zeek_ssl cert_subject NOT IN (known_certs)] \| stats count by host, CommandLine, cert_subject \| where count > 5`.<br>- **KQL**: `DeviceProcessEvents \| where ProcessCommandLine !in (knownApps) \| join kind=inner (DeviceNetworkEvents \| where Protocol == "SSL" and AdditionalFields.CertSubject !in (knownCerts)) on DeviceName \| summarize count() by DeviceName, ProcessCommandLine, AdditionalFields.CertSubject \| where count_ > 5`.<br>- **ELK**: `FROM logs-endpoint.process-* \| WHERE process.command_line NOT IN ['known_apps'] \| JOIN logs-zeek.ssl-* ON host.name WHERE ssl.certificate.subject NOT IN ['known_certs'] \| STATS COUNT() BY host.name, process.command_line, ssl.certificate.subject HAVING COUNT() > 5`. |
| 4. Cryptographic Protocol with Anomalous Timing | Encrypted C2 traffic outside normal business hours, as in 2025 trends. | - Network Traffic (DS0003: Zeek SSL)<br>- Metrics | - **Splunk**: `index=network sourcetype=zeek_ssl cert_subject NOT IN (known_certs) \| timechart span=1h count \| where count > avg(count)*4 AND _time > relative_time(now(), "-24h")`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "SSL" and AdditionalFields.CertSubject !in (knownCerts) \| summarize HourlyCount=count() by bin(Timestamp, 1h) \| where HourlyCount > avg(HourlyCount) * 4 and Timestamp > ago(24h)`.<br>- **ELK**: `FROM logs-zeek.ssl-* \| WHERE ssl.certificate.subject NOT IN ['known_certs'] \| STATS COUNT() BY date_histogram(@timestamp, '1h') \| WHERE COUNT() > AVG(COUNT()) * 4 AND @timestamp > NOW - 24 HOURS`. |
| 5. Cryptographic Protocol in Cloud Environments | Encrypted C2 in cloud infrastructure, as in 2025 trends. | - Cloud Audit Logs (AWS CloudTrail)<br>- Network Traffic | - **Splunk**: `index=cloud sourcetype=aws:cloudtrail eventName IN ("RunInstances", "StartInstances") AND userAgent IN ("*ssl*", "*ssh*") \| stats count by userAgent, sourceIPAddress \| where count > 5`.<br>- **KQL**: `AWSCloudTrail \| where EventName in ("RunInstances", "StartInstances") and UserAgent has_any ("ssl", "ssh") \| summarize count() by UserAgent, SourceIPAddress \| where count_ > 5`.<br>- **ELK**: `FROM logs-aws.cloudtrail-* \| WHERE event.action IN ['RunInstances', 'StartInstances'] AND user.agent : ("*ssl*" OR "*ssh*") \| STATS COUNT() BY user.agent, source.ip HAVING COUNT() > 5`. |
| 6. Cryptographic Protocol with High Entropy Payloads | Encrypted C2 with high entropy payloads, as in APT41 campaigns. | - Network Traffic (DS0003: Zeek SSL)<br>- Packet Analysis | - **Splunk**: `index=network sourcetype=zeek_ssl payload_entropy > 7 AND cert_subject NOT IN (known_certs) \| stats count by src_ip, cert_subject \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "SSL" and AdditionalFields.PayloadEntropy > 7 and AdditionalFields.CertSubject !in (knownCerts) \| summarize count() by DeviceIP, AdditionalFields.CertSubject \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.ssl-* \| WHERE ssl.payload.entropy > 7 AND ssl.certificate.subject NOT IN ['known_certs'] \| STATS COUNT() BY source.ip, ssl.certificate.subject HAVING COUNT() > 5`. |
| 7. Cryptographic Protocol in Linux Environments | Encrypted C2 from Linux hosts, as in Turla campaigns. | - Network Traffic (DS0003: Zeek Conn)<br>- Linux Logs | - **Splunk**: `index=linux sourcetype=auditd syscall="connect" AND dest_port IN (22, 443) AND exe NOT IN (known_apps) \| stats count by exe, dest_ip \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where RemotePort in (22, 443) and InitiatingProcessName !in (knownApps) \| summarize count() by InitiatingProcessName, RemoteIP \| where count_ > 5`.<br>- **ELK**: `FROM logs-auditd-* \| WHERE syscall.name = "connect" AND destination.port IN [22, 443] AND process.exe NOT IN ['known_apps'] \| STATS COUNT() BY process.exe, destination.ip HAVING COUNT() > 5`. |
| 8. Cryptographic Protocol with Suspicious Headers | Encrypted C2 with custom HTTP headers, as in Cobalt Strike. | - Network Traffic (DS0003: Zeek HTTP)<br>- Proxy Logs | - **Splunk**: `index=network sourcetype=zeek_http header IN ("*X-Cobalt*", "*Custom-Header*") AND dest_port=443 \| stats count by src_ip, header \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where RemotePort == 443 and AdditionalFields.Header has_any ("X-Cobalt", "Custom-Header") \| summarize count() by DeviceIP, AdditionalFields.Header \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE destination.port = 443 AND http.header : ("*X-Cobalt*" OR "*Custom-Header*") \| STATS COUNT() BY source.ip, http.header HAVING COUNT() > 5`. |
| 9. Cryptographic Protocol with Anomalous User Agents | Encrypted C2 with unusual user agents, as in Cobalt Strike. | - Network Traffic (DS0003: Zeek HTTP)<br>- Proxy Logs | - **Splunk**: `index=network sourcetype=zeek_http user_agent NOT IN (known_agents) AND dest_port=443 \| stats count by src_ip, user_agent \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where RemotePort == 443 and AdditionalFields.UserAgent !in (knownAgents) \| summarize count() by DeviceIP, AdditionalFields.UserAgent \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE destination.port = 443 AND http.user_agent NOT IN ['known_agents'] \| STATS COUNT() BY source.ip, http.user_agent HAVING COUNT() > 5`. |
| 10. Cryptographic Protocol with Multi-Stage Redirects | Encrypted C2 with HTTP redirects, as in APT41 campaigns. | - Network Traffic (DS0003: Zeek HTTP)<br>- Redirect Analysis | - **Splunk**: `index=network sourcetype=zeek_http dest_port=443 AND status_code=302 \| stats count by src_ip, uri \| where count > 3`.<br>- **KQL**: `DeviceNetworkEvents \| where RemotePort == 443 and AdditionalFields.StatusCode == 302 \| summarize count() by DeviceIP, RemoteUrl \| where count_ > 3`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE destination.port = 443 AND http.status = 302 \| STATS COUNT() BY source.ip, http.uri HAVING COUNT() > 3`. |

### Standard Encoding (T1132)

Standard Encoding involves adversaries using encoding schemes like Base64 or URL encoding for C2 communication or data obfuscation, as seen in campaigns like FIN7.

| Hypothesis | Description | Data Sources | Hunting Queries |
|------------|-------------|--------------|-----------------|
| 1. Base64 Encoded C2 Traffic | Adversaries use Base64-encoded payloads for C2, as in FIN7 campaigns. High risk in environments with limited payload inspection. | - Network Traffic (DS0003: Zeek HTTP)<br>- Proxy Logs | - **Splunk**: `index=network sourcetype=zeek_http uri="*base64*" OR post_body="*base64*" \| stats count by src_ip, uri \| where count > 5` (Detects Base64 in HTTP traffic).<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "HTTP" and (RemoteUrl contains "base64" or AdditionalFields.PostBody contains "base64") \| summarize count() by DeviceIP, RemoteUrl \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE http.uri : "*base64*" OR http.post_body : "*base64*" \| STATS COUNT() BY source.ip, http.uri HAVING COUNT() > 5`. |
| 2. URL Encoded C2 Traffic | Adversaries use URL encoding for C2, as in Cobalt Strike campaigns. | - Network Traffic (DS0003: Zeek HTTP)<br>- Proxy Logs | - **Splunk**: `index=network sourcetype=zeek_http uri="*%[0-9A-F][0-9A-F]*" \| stats count by src_ip, uri \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "HTTP" and RemoteUrl matches regex "%[0-9A-F][0-9A-F]" \| summarize count() by DeviceIP, RemoteUrl \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE http.uri : "*%[0-9A-F][0-9A-F]*" \| STATS COUNT() BY source.ip, http.uri HAVING COUNT() > 5`. |
| 3. Encoded C2 from Suspicious Processes | Suspicious processes generate encoded C2 traffic, as in FIN7 campaigns. | - Process Creation (DS0009: Sysmon ID 1)<br>- Network Traffic | - **Splunk**: `index=endpoint sourcetype=sysmon EventCode=1 CommandLine NOT IN (known_apps) \| join host [search index=network sourcetype=zeek_http uri="*base64*"] \| stats count by host, CommandLine, uri \| where count > 5`.<br>- **KQL**: `DeviceProcessEvents \| where ProcessCommandLine !in (knownApps) \| join kind=inner (DeviceNetworkEvents \| where Protocol == "HTTP" and RemoteUrl contains "base64") on DeviceName \| summarize count() by DeviceName, ProcessCommandLine, RemoteUrl \| where count_ > 5`.<br>- **ELK**: `FROM logs-endpoint.process-* \| WHERE process.command_line NOT IN ['known_apps'] \| JOIN logs-zeek.http-* ON host.name WHERE http.uri : "*base64*" \| STATS COUNT() BY host.name, process.command_line, http.uri HAVING COUNT() > 5`. |
| 4. Encoded C2 with Anomalous Timing | Encoded C2 traffic outside normal business hours, as in 2025 trends. | - Network Traffic (DS0003: Zeek HTTP)<br>- Metrics | - **Splunk**: `index=network sourcetype=zeek_http uri="*base64*" \| timechart span=1h count \| where count > avg(count)*4 AND _time > relative_time(now(), "-24h")`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "HTTP" and RemoteUrl contains "base64" \| summarize HourlyCount=count() by bin(Timestamp, 1h) \| where HourlyCount > avg(HourlyCount) * 4 and Timestamp > ago(24h)`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE http.uri : "*base64*" \| STATS COUNT() BY date_histogram(@timestamp, '1h') \| WHERE COUNT() > AVG(COUNT()) * 4 AND @timestamp > NOW - 24 HOURS`. |
| 5. Encoded C2 in Cloud Environments | Encoded C2 traffic in cloud infrastructure, as in 2025 trends. | - Cloud Audit Logs (AWS CloudTrail)<br>- Network Traffic | - **Splunk**: `index=cloud sourcetype=aws:cloudtrail eventName IN ("RunInstances", "StartInstances") AND userAgent="*base64*" \| stats count by userAgent, sourceIPAddress \| where count > 5`.<br>- **KQL**: `AWSCloudTrail \| where EventName in ("RunInstances", "StartInstances") and UserAgent contains "base64" \| summarize count() by UserAgent, SourceIPAddress \| where count_ > 5`.<br>- **ELK**: `FROM logs-aws.cloudtrail-* \| WHERE event.action IN ['RunInstances', 'StartInstances'] AND user.agent : "*base64*" \| STATS COUNT() BY user.agent, source.ip HAVING COUNT() > 5`. |
| 6. Encoded C2 with High Entropy Payloads | Encoded C2 with high entropy payloads, as in APT41 campaigns. | - Network Traffic (DS0003: Zeek HTTP)<br>- Packet Analysis | - **Splunk**: `index=network sourcetype=zeek_http uri="*base64*" AND payload_entropy > 7 \| stats count by src_ip, uri \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "HTTP" and RemoteUrl contains "base64" and AdditionalFields.PayloadEntropy > 7 \| summarize count() by DeviceIP, RemoteUrl \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE http.uri : "*base64*" AND http.payload.entropy > 7 \| STATS COUNT() BY source.ip, http.uri HAVING COUNT() > 5`. |
| 7. Encoded C2 with Suspicious Headers | Encoded C2 with custom HTTP headers, as in Cobalt Strike. | - Network Traffic (DS0003: Zeek HTTP)<br>- Proxy Logs | - **Splunk**: `index=network sourcetype=zeek_http uri="*base64*" AND header IN ("*X-Cobalt*", "*Custom-Header*") \| stats count by src_ip, header \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "HTTP" and RemoteUrl contains "base64" and AdditionalFields.Header has_any ("X-Cobalt", "Custom-Header") \| summarize count() by DeviceIP, AdditionalFields.Header \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE http.uri : "*base64*" AND http.header : ("*X-Cobalt*" OR "*Custom-Header*") \| STATS COUNT() BY source.ip, http.header HAVING COUNT() > 5`. |
| 8. Encoded C2 in Linux Environments | Encoded C2 from Linux hosts, as in Turla campaigns. | - Network Traffic (DS0003: Zeek HTTP)<br>- Linux Logs | - **Splunk**: `index=linux sourcetype=auditd syscall="connect" AND exe NOT IN (known_apps) \| join host [search index=network sourcetype=zeek_http uri="*base64*"] \| stats count by host, exe, uri \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "HTTP" and RemoteUrl contains "base64" \| join kind=inner (DeviceProcessEvents \| where ActionType == "connect" and FileName !in (knownApps)) on DeviceName \| summarize count() by DeviceName, FileName, RemoteUrl \| where count_ > 5`.<br>- **ELK**: `FROM logs-auditd-* \| WHERE syscall.name = "connect" AND process.exe NOT IN ['known_apps'] \| JOIN logs-zeek.http-* ON host.name WHERE http.uri : "*base64*" \| STATS COUNT() BY host.name, process.exe, http.uri HAVING COUNT() > 5`. |
| 9. Encoded C2 with Anomalous User Agents | Encoded C2 with unusual user agents, as in Cobalt Strike. | - Network Traffic (DS0003: Zeek HTTP)<br>- Proxy Logs | - **Splunk**: `index=network sourcetype=zeek_http uri="*base64*" AND user_agent NOT IN (known_agents) \| stats count by src_ip, user_agent \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "HTTP" and RemoteUrl contains "base64" and AdditionalFields.UserAgent !in (knownAgents) \| summarize count() by DeviceIP, AdditionalFields.UserAgent \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE http.uri : "*base64*" AND http.user_agent NOT IN ['known_agents'] \| STATS COUNT() BY source.ip, http.user_agent HAVING COUNT() > 5`. |
| 10. Encoded C2 with Multi-Stage Redirects | Encoded C2 with HTTP redirects, as in APT41 campaigns. | - Network Traffic (DS0003: Zeek HTTP)<br>- Redirect Analysis | - **Splunk**: `index=network sourcetype=zeek_http uri="*base64*" AND status_code=302 \| stats count by src_ip, uri \| where count > 3`.<br>- **KQL**: `DeviceNetworkEvents \| where Protocol == "HTTP" and RemoteUrl contains "base64" and AdditionalFields.StatusCode == 302 \| summarize count() by DeviceIP, RemoteUrl \| where count_ > 3`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE http.uri : "*base64*" AND http.status = 302 \| STATS COUNT() BY source.ip, http.uri HAVING COUNT() > 3`. |

### Steganography (T1027.003)

Steganography involves adversaries hiding data within images, audio, or other files to evade detection, often used in campaigns like APT41 for data exfiltration or C2.

| Hypothesis | Description | Data Sources | Hunting Queries |
|------------|-------------|--------------|-----------------|
| 1. Steganography in Image Files | Adversaries hide C2 data in image files, as in APT41 campaigns. High risk in environments with limited file inspection. | - File Access (DS0022: Sysmon ID 11)<br>- Network Traffic (DS0003: Zeek HTTP) | - **Splunk**: `index=endpoint sourcetype=sysmon EventCode=11 FileName IN ("*.png", "*.jpg", "*.bmp") AND FileSize > 1000000 \| join host [search index=network sourcetype=zeek_http uri="*upload*"] \| stats count by host, FileName, uri \| where count > 3` (Detects large image uploads).<br>- **KQL**: `DeviceFileEvents \| where FileName has_any (".png", ".jpg", ".bmp") and FileSize > 1000000 \| join kind=inner (DeviceNetworkEvents \| where RemoteUrl contains "upload") on DeviceName \| summarize count() by DeviceName, FileName, RemoteUrl \| where count_ > 3`.<br>- **ELK**: `FROM logs-endpoint.file-* \| WHERE file.name : ("*.png" OR "*.jpg" OR "*.bmp") AND file.size > 1000000 \| JOIN logs-zeek.http-* ON host.name WHERE http.uri : "*upload*" \| STATS COUNT() BY host.name, file.name, http.uri HAVING COUNT() > 3`. |
| 2. Steganography in Audio/Video Files | Adversaries hide C2 data in audio/video files, as in 2025 trends. | - File Access (DS0022: Sysmon ID 11)<br>- Network Traffic | - **Splunk**: `index=endpoint sourcetype=sysmon EventCode=11 FileName IN ("*.mp3", "*.mp4", "*.wav") AND FileSize > 1000000 \| join host [search index=network sourcetype=zeek_http uri="*upload*"] \| stats count by host, FileName, uri \| where count > 3`.<br>- **KQL**: `DeviceFileEvents \| where FileName has_any (".mp3", ".mp4", ".wav") and FileSize > 1000000 \| join kind=inner (DeviceNetworkEvents \| where RemoteUrl contains "upload") on DeviceName \| summarize count() by DeviceName, FileName, RemoteUrl \| where count_ > 3`.<br>- **ELK**: `FROM logs-endpoint.file-* \| WHERE file.name : ("*.mp3" OR "*.mp4" OR "*.wav") AND file.size > 1000000 \| JOIN logs-zeek.http-* ON host.name WHERE http.uri : "*upload*" \| STATS COUNT() BY host.name, file.name, http.uri HAVING COUNT() > 3`. |
| 3. Steganography with Suspicious Processes | Suspicious processes access steganographic files, as in FIN7 campaigns. | - Process Creation (DS0009: Sysmon ID 1)<br>- File Access | - **Splunk**: `index=endpoint sourcetype=sysmon EventCode=1 CommandLine NOT IN (known_apps) \| join host [search index=endpoint sourcetype=sysmon EventCode=11 FileName IN ("*.png", "*.jpg", "*.mp3")] \| stats count by host, CommandLine, FileName \| where count > 5`.<br>- **KQL**: `DeviceProcessEvents \| where ProcessCommandLine !in (knownApps) \| join kind=inner (DeviceFileEvents \| where FileName has_any (".png", ".jpg", ".mp3")) on DeviceName \| summarize count() by DeviceName, ProcessCommandLine, FileName \| where count_ > 5`.<br>- **ELK**: `FROM logs-endpoint.process-* \| WHERE process.command_line NOT IN ['known_apps'] \| JOIN logs-endpoint.file-* ON host.name WHERE file.name : ("*.png" OR "*.jpg" OR "*.mp3") \| STATS COUNT() BY host.name, process.command_line, file.name HAVING COUNT() > 5`. |
| 4. Steganography with Anomalous Timing | Steganographic file uploads outside normal business hours, as in 2025 trends. | - File Access (DS0022: Sysmon ID 11)<br>- Metrics | - **Splunk**: `index=endpoint sourcetype=sysmon EventCode=11 FileName IN ("*.png", "*.jpg", "*.mp3") AND FileSize > 1000000 \| timechart span=1h count \| where count > avg(count)*4 AND _time > relative_time(now(), "-24h")`.<br>- **KQL**: `DeviceFileEvents \| where FileName has_any (".png", ".jpg", ".mp3") and FileSize > 1000000 \| summarize HourlyCount=count() by bin(Timestamp, 1h) \| where HourlyCount > avg(HourlyCount) * 4 and Timestamp > ago(24h)`.<br>- **ELK**: `FROM logs-endpoint.file-* \| WHERE file.name : ("*.png" OR "*.jpg" OR "*.mp3") AND file.size > 1000000 \| STATS COUNT() BY date_histogram(@timestamp, '1h') \| WHERE COUNT() > AVG(COUNT()) * 4 AND @timestamp > NOW - 24 HOURS`. |
| 5. Steganography in Cloud Environments | Steganographic file uploads in cloud infrastructure, as in 2025 trends. | - Cloud Audit Logs (AWS CloudTrail)<br>- Network Traffic | - **Splunk**: `index=cloud sourcetype=aws:cloudtrail eventName="PutObject" AND object IN ("*.png", "*.jpg", "*.mp3") AND objectSize > 1000000 \| stats count by sourceIPAddress, object \| where count > 5`.<br>- **KQL**: `AWSCloudTrail \| where EventName == "PutObject" and AdditionalFields.Object has_any (".png", ".jpg", ".mp3") and AdditionalFields.ObjectSize > 1000000 \| summarize count() by SourceIPAddress, AdditionalFields.Object \| where count_ > 5`.<br>- **ELK**: `FROM logs-aws.cloudtrail-* \| WHERE event.action = 'PutObject' AND s3.object : ("*.png" OR "*.jpg" OR "*.mp3") AND s3.object.size > 1000000 \| STATS COUNT() BY source.ip, s3.object HAVING COUNT() > 5`. |
| 6. Steganography with High Entropy Files | Steganographic files with high entropy, as in APT41 campaigns. | - File Access (DS0022: Sysmon ID 11)<br>- File Analysis | - **Splunk**: `index=endpoint sourcetype=sysmon EventCode=11 FileName IN ("*.png", "*.jpg", "*.mp3") AND FileEntropy > 7 \| stats count by host, FileName \| where count > 5`.<br>- **KQL**: `DeviceFileEvents \| where FileName has_any (".png", ".jpg", ".mp3") and AdditionalFields.FileEntropy > 7 \| summarize count() by DeviceName, FileName \| where count_ > 5`.<br>- **ELK**: `FROM logs-endpoint.file-* \| WHERE file.name : ("*.png" OR "*.jpg" OR "*.mp3") AND file.entropy > 7 \| STATS COUNT() BY host.name, file.name HAVING COUNT() > 5`. |
| 7. Steganography with Suspicious Headers | Steganographic file uploads with custom HTTP headers, as in Cobalt Strike. | - Network Traffic (DS0003: Zeek HTTP)<br>- Proxy Logs | - **Splunk**: `index=network sourcetype=zeek_http uri="*upload*" AND header IN ("*X-Cobalt*", "*Custom-Header*") \| stats count by src_ip, header \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where RemoteUrl contains "upload" and AdditionalFields.Header has_any ("X-Cobalt", "Custom-Header") \| summarize count() by DeviceIP, AdditionalFields.Header \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE http.uri : "*upload*" AND http.header : ("*X-Cobalt*" OR "*Custom-Header*") \| STATS COUNT() BY source.ip, http.header HAVING COUNT() > 5`. |
| 8. Steganography in Linux Environments | Steganographic file activity from Linux hosts, as in Turla campaigns. | - File Access (DS0017: Auditd)<br>- Network Traffic | - **Splunk**: `index=linux sourcetype=auditd type=OPEN AND file IN ("*.png", "*.jpg", "*.mp3") AND file_size > 1000000 \| join host [search index=network sourcetype=zeek_http uri="*upload*"] \| stats count by host, file, uri \| where count > 5`.<br>- **KQL**: `DeviceFileEvents \| where ActionType == "OPEN" and FileName has_any (".png", ".jpg", ".mp3") and FileSize > 1000000 \| join kind=inner (DeviceNetworkEvents \| where RemoteUrl contains "upload") on DeviceName \| summarize count() by DeviceName, FileName, RemoteUrl \| where count_ > 5`.<br>- **ELK**: `FROM logs-auditd-* \| WHERE auditd.type = 'OPEN' AND file.name : ("*.png" OR "*.jpg" OR "*.mp3") AND file.size > 1000000 \| JOIN logs-zeek.http-* ON host.name WHERE http.uri : "*upload*" \| STATS COUNT() BY host.name, file.name, http.uri HAVING COUNT() > 5`. |
| 9. Steganography with Anomalous User Agents | Steganographic file uploads with unusual user agents, as in Cobalt Strike. | - Network Traffic (DS0003: Zeek HTTP)<br>- Proxy Logs | - **Splunk**: `index=network sourcetype=zeek_http uri="*upload*" AND user_agent NOT IN (known_agents) \| stats count by src_ip, user_agent \| where count > 5`.<br>- **KQL**: `DeviceNetworkEvents \| where RemoteUrl contains "upload" and AdditionalFields.UserAgent !in (knownAgents) \| summarize count() by DeviceIP, AdditionalFields.UserAgent \| where count_ > 5`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE http.uri : "*upload*" AND http.user_agent NOT IN ['known_agents'] \| STATS COUNT() BY source.ip, http.user_agent HAVING COUNT() > 5`. |
| 10. Steganography with Multi-Stage Redirects | Steganographic file uploads with HTTP redirects, as in APT41 campaigns. | - Network Traffic (DS0003: Zeek HTTP)<br>- Redirect Analysis | - **Splunk**: `index=network sourcetype=zeek_http uri="*upload*" AND status_code=302 \| stats count by src_ip, uri \| where count > 3`.<br>- **KQL**: `DeviceNetworkEvents \| where RemoteUrl contains "upload" and AdditionalFields.StatusCode == 302 \| summarize count() by DeviceIP, RemoteUrl \| where count_ > 3`.<br>- **ELK**: `FROM logs-zeek.http-* \| WHERE http.uri : "*upload*" AND http.status = 302 \| STATS COUNT() BY source.ip, http.uri HAVING COUNT() > 3`. |

### Symmetric Cryptography

### Traffic Signaling

### Uncommonly Used Port

### Web Protocols

### Web Service
