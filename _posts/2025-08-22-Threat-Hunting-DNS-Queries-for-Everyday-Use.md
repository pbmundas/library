---
layout: default
title: DNS Logs Queries - Top 50
category: Threat-Hunting-Queries  # This becomes a main topic in sidebar
---


### Essential Threat Hunting Hypotheses for DNS Logs

Threat hunting in DNS logs is critical for detecting reconnaissance, command and control (C2), data exfiltration, and other malicious activities. These hypotheses align with MITRE ATT&CK tactics like Command and Control (TA0011), Exfiltration (TA0010), and Reconnaissance (TA0007). Queries assume DNS logs from tools like Bind, PowerDNS, or SIEM platforms (e.g., Splunk, ELK Stack) with fields like `src_ip`, `query`, `response`, `qtype`, and `timestamp`. Each entry includes:

- **Hypothesis**: A testable assumption about malicious DNS activity.
- **Rationale**: Why itâ€™s relevant (e.g., C2 beaconing, tunneling).
- **Sample Query**: Splunk SPL query (adapt for your tool; assumes `index=dns`, `sourcetype=dns_logs`; adjust `earliest=-7d` for your timeframe).
- **Expected Indicators**: Anomalies to investigate.

Run these regularly to establish baselines, prioritizing high-risk zones (e.g., internal clients, DMZ servers). Queries assume a basic schema; customize for your environment (e.g., field names).

| #  | Hypothesis | Rationale | Sample Query | Expected Indicators |
|----|------------|-----------|------------------|---------------------|
| 1  | High-volume DNS queries to a single domain from one source (T1071.004). | Indicates potential C2 beaconing or DGA (Domain Generation Algorithm). | `index=dns earliest=-7d \| stats count by src_ip, query \| where count > 100 \| sort -count` | >100 queries/day to one domain; check for low TTL or random subdomains. |
| 2  | Queries to recently registered domains (T1071.004). | New domains often used for C2 or phishing to evade blacklists. | `index=dns earliest=-7d \| lookup domain_age query OUTPUT age \| where age < 30 \| stats count by query, src_ip` | Queries to domains <30 days old; correlate with threat intel. |
| 3  | Long or high-entropy subdomain queries (T1071.004). | Suggests DNS tunneling or encoded exfil (e.g., base64 subdomains). | `index=dns earliest=-7d \| eval len=len(query) \| where len > 50 \| stats count by query, src_ip \| sort -len` | Subdomains >50 chars or with random strings (e.g., x7z9q2.base64.malicious.com). |
| 4  | Excessive NXDOMAIN responses (T1595). | Indicates DGA or failed C2 attempts from compromised hosts. | `index=dns earliest=-7d response=NXDOMAIN \| stats count by src_ip, query \| where count > 50 \| sort -count` | >50 NXDOMAINs per src_ip; cluster for random domain patterns. |
| 5  | DNS queries over non-standard ports (T1571). | Tunneling or evasion bypassing port 53 monitoring. | `index=dns earliest=-7d dest_port!=53 \| stats count by src_ip, dest_port, query \| where count > 10` | Queries on TCP/443 or UDP >1024; high byte counts. |
| 6  | Anomalous query types (e.g., TXT, NULL) (T1071.004). | Used for tunneling or exfil due to large data payloads. | `index=dns earliest=-7d qtype IN ("TXT","NULL","ANY") \| stats count by src_ip, query, qtype \| where count > 20` | High TXT/NULL queries; encoded strings in responses. |
| 7  | Queries to known malicious domains or IPs (T1071.001). | C2 communication or malware downloads. | `index=dns earliest=-7d \| lookup threat_intel domain as query OUTPUT reputation \| where reputation="malicious" \| stats count by src_ip, query` | Queries to blacklisted domains; periodic patterns (e.g., 60s intervals). |
| 8  | High query volume to public DNS resolvers (T1071.004). | Bypassing internal DNS for exfil or C2. | `index=dns earliest=-7d dest_ip IN ("8.8.8.8","1.1.1.1","9.9.9.9") \| stats sum(response_size) by src_ip, dest_ip \| where sum(response_size) > 1000000` | Large data transfers to Google/Cloudflare/Quad9; unusual clients. |
| 9  | Rapid queries to multiple domains from single host (T1595). | Reconnaissance or DGA scanning for active C2 domains. | `index=dns earliest=-7d \| stats dc(query) by src_ip \| where dc(query) > 100 \| sort -dc(query)` | >100 unique domains in short window; random or similar TLDs. |
| 10 | Queries to rare or suspicious TLDs (T1071.004). | Malicious infrastructure often uses obscure TLDs (.xyz, .top). | `index=dns earliest=-7d \| eval tld=replace(query,".*\\.([^.]+)$","\\1") \| where tld IN ("xyz","top","cn","ru") \| stats count by src_ip, query` | High queries to uncommon TLDs; check domain reputation. |
| 11 | DNS queries from unusual processes or users (T1059). | Compromised apps (e.g., browsers) making unauthorized queries. | `index=dns earliest=-7d \| join src_ip [search index=endpoint sourcetype=process_logs \| stats values(process_name) by src_ip] \| where process_name NOT IN ("dnsmasq","systemd-resolved")` | Queries from non-DNS processes like curl or python. |
| 12 | Beacon-like query patterns to same domain (T1071.001). | Periodic DNS queries indicate C2 check-ins. | `index=dns earliest=-7d \| timechart span=5m count by query \| where count > 10 and stdev(count) < 1` | Regular query intervals (e.g., every 5min); low variance. |
| 13 | Excessive AAAA queries without IPv6 usage (T1071.004). | Possible tunneling or misconfiguration exploitation. | `index=dns earliest=-7d qtype=AAAA \| stats count by src_ip, query \| where count > 50 and src_ip NOT IN (ipv6_enabled_hosts)` | High AAAA from IPv4-only hosts; check network config. |
| 14 | Queries to internal domains from external IPs (T1595). | Recon or DNS spoofing targeting internal assets. | `index=dns earliest=-7d query LIKE "%.internal.domain%" src_ip NOT IN (internal_ips) \| stats count by src_ip, query` | External queries to *.corp or *.local; possible spoofing. |
| 15 | Large DNS response sizes (T1041). | Data exfiltration via DNS response payloads. | `index=dns earliest=-7d \| where response_size > 1000 \| stats count by src_ip, query, response_size \| sort -response_size` | Responses >1KB; encoded or binary data in answers. |
| 16 | Queries to dynamic DNS providers (T1071.001). | DDNS used for agile C2 infrastructure. | `index=dns earliest=-7d query LIKE "%.dyndns.org" OR query LIKE "%.no-ip.com" \| stats count by src_ip, query` | Frequent queries to DDNS; non-browser sources. |
| 17 | DNS queries with high subdomain depth (T1071.004). | Subdomain nesting for tunneling or C2 (e.g., a.b.c.d.e.mal.com). | `index=dns earliest=-7d \| eval depth=mvcount(split(query,".")) \| where depth > 5 \| stats count by src_ip, query` | >5 subdomains; random or encoded segments. |
| 18 | Anomalous DNS query timing (e.g., off-hours) (T1071). | C2 or exfil during low-monitoring periods. | `index=dns earliest="0:00" latest="6:00" \| stats count by src_ip, query \| where count > 50` | Spikes outside business hours; unusual src IPs. |
| 19 | Queries to known pastebin-like domains (T1102.002). | Data staging or script downloads via paste sites. | `index=dns earliest=-7d query IN ("*.pastebin.com","*.hastebin.com") \| stats count by src_ip, query` | Non-browser queries; correlate with HTTP logs. |
| 20 | Multiple DNS servers queried by single host (T1071.004). | Resolver hopping to evade detection or find live C2. | `index=dns earliest=-7d \| stats dc(dest_ip) by src_ip \| where dc(dest_ip) > 5 \| sort -dc(dest_ip)` | >5 DNS servers; external resolvers like 8.8.8.8. |
| 21 | Queries with encoded or unusual characters (T1027). | Obfuscation for exfil or C2 commands. | `index=dns earliest=-7d \| where query LIKE "%+%" OR query LIKE "%=%" \| stats count by src_ip, query` | Queries with base64-like strings or URL encoding. |
| 22 | Excessive SRV record queries (T1083). | Service discovery for lateral movement or targeting. | `index=dns earliest=-7d qtype=SRV \| stats count by src_ip, query \| where count > 20` | SRV queries for LDAP or Kerberos; internal domains. |
| 23 | Anomalous DNS traffic to cloud storage domains (T1102.002). | Exfil or payload retrieval via cloud services. | `index=dns earliest=-7d query IN ("*.dropbox.com","*.onedrive.com") \| stats sum(response_size) by src_ip \| where sum(response_size) > 500000` | Large responses; non-user traffic patterns. |
| 24 | Queries to domains with low TTL (T1071.001). | Fast-flux or C2 domains rotate IPs frequently. | `index=dns earliest=-7d \| where ttl < 300 \| stats count by query, src_ip \| sort -count` | TTL <5min; multiple IPs per domain. |
| 25 | DNS queries from non-standard clients (T1059). | Malware or scripts bypassing system resolvers. | `index=dns earliest=-7d \| join src_ip [search index=endpoint sourcetype=process_logs \| stats values(process_name) by src_ip] \| where process_name IN ("curl","wget","python")` | Queries from CLI tools; check command lines. |
| 26 | Repeated queries with no response (T1071). | Failed C2 or network issues from malware. | `index=dns earliest=-7d response="" \| stats count by src_ip, query \| where count > 50` | >50 unanswered queries; random domains. |
| 27 | CNAME chains to suspicious domains (T1071.004). | Redirection to hide malicious endpoints. | `index=dns earliest=-7d qtype=CNAME \| stats count by query, response \| where response LIKE "%.malicious%"` | CNAMEs pointing to known bad domains. |
| 28 | Queries to TOR or anonymity services (T1090.002). | C2 or exfil via onion routing. | `index=dns earliest=-7d query LIKE "%.torproject.org" OR query LIKE "%.onion" \| stats count by src_ip` | Onion routing queries; non-browser sources. |
| 29 | DNS queries from compromised hosts (T1071). | Known infected IPs making queries. | `index=dns earliest=-7d src_ip IN (compromised_ips_list) \| stats count by query, src_ip` | Queries to new domains; high volume post-infection. |
| 30 | High-frequency MX record queries (T1083). | Recon for email server targeting or phishing prep. | `index=dns earliest=-7d qtype=MX \| stats count by src_ip, query \| where count > 30` | >30 MX queries; internal email domains. |
| 31 | Queries to known phishing kit domains (T1566). | Phishing infrastructure setup or staging. | `index=dns earliest=-7d query IN (phishing_kit_domains) \| stats count by src_ip` | Queries from internal hosts; correlate with HTTP. |
| 32 | Anomalous PTR queries (T1016). | Reverse DNS for network mapping or recon. | `index=dns earliest=-7d qtype=PTR \| stats count by src_ip, query \| where count > 50` | High PTR queries; non-admin hosts. |
| 33 | Queries to internal domains with external resolvers (T1071.004). | Bypassing DNS controls for C2. | `index=dns earliest=-7d query LIKE "%.internal.domain%" dest_ip NOT IN (internal_dns) \| stats count by src_ip` | Internal domains to 8.8.8.8; check resolver configs. |
| 34 | DNS traffic during system downtime (T1071). | Activity during maintenance windows for stealth. | `index=dns earliest="maintenance_window" \| stats count by src_ip, query \| where count > 20` | Queries during scheduled outages; unusual sources. |
| 35 | Queries with homoglyphs or IDN domains (T1566). | Phishing or evasion via lookalike domains. | `index=dns earliest=-7d \| where query LIKE "%xn--%" \| stats count by src_ip, query` | IDN domains (e.g., xn--go0gle.com); user clicks. |
| 36 | Excessive NS record queries (T1083). | Recon for DNS infrastructure takeover. | `index=dns earliest=-7d qtype=NS \| stats count by src_ip, query \| where count > 20` | High NS queries; targeting authoritative servers. |
| 37 | Queries to domains with fast-flux IPs (T1071.001). | Multiple IPs per domain for C2 resilience. | `index=dns earliest=-7d \| stats dc(response_ip) by query \| where dc(response_ip) > 5` | >5 IPs per domain; short TTLs. |
| 38 | DNS queries from service accounts (T1078). | Compromised service accounts for C2 or recon. | `index=dns earliest=-7d src_ip IN (service_account_ips) \| stats count by src_ip, query` | Non-resolver queries from services; unusual domains. |
| 39 | Queries to cloudflare or similar CDN domains (T1102). | Payload delivery or exfil via trusted CDNs. | `index=dns earliest=-7d query LIKE "%.cloudflare.com" \| stats sum(response_size) by src_ip \| where sum(response_size) > 1000000` | Large responses; non-browser clients. |
| 40 | Repeated queries to same domain with different subdomains (T1071.004). | DGA or subdomain-based C2. | `index=dns earliest=-7d \| eval domain=replace(query,"^[^.]+\\.(.*)","\\1") \| stats dc(query) by src_ip, domain \| where dc(query) > 10` | >10 subdomains per base domain; random patterns. |
| 41 | Queries to domains with no HTTP traffic (T1071). | DNS-only C2 or exfil without web activity. | `index=dns earliest=-7d \| NOT [search index=http src_ip \| fields src_ip, query] \| stats count by src_ip, query` | DNS queries without corresponding HTTP; C2 likely. |
| 42 | Anomalous query volume from DMZ servers (T1071). | Compromised servers making external C2 calls. | `index=dns earliest=-7d src_ip IN (dmz_ips) \| stats count by src_ip, query \| where count > 100` | High query rates from DMZ; non-service domains. |
| 43 | Queries with repeated or malformed qtypes (T1071.004). | Malformed queries for protocol abuse. | `index=dns earliest=-7d qtype NOT IN ("A","AAAA","CNAME","MX","NS","TXT") \| stats count by src_ip, qtype` | Rare qtypes (e.g., TYPE255); high volume. |
| 44 | DNS queries to VPN or proxy domains (T1090). | Anonymization for C2 or exfil. | `index=dns earliest=-7d query IN ("*.nordvpn.com","*.expressvpn.com") \| stats count by src_ip` | Non-user queries; frequent connections. |
| 45 | Queries to domains with known typosquatting (T1566). | Phishing or brand impersonation. | `index=dns earliest=-7d query LIKE "%.g00gle.com" OR query LIKE "%.micr0soft.com" \| stats count by src_ip` | Typosquatted domains; user-driven queries. |
| 46 | High-frequency queries to single resolver (T1071.004). | Resolver overload or targeted exfil. | `index=dns earliest=-7d \| stats count by dest_ip, src_ip \| where count > 1000 \| sort -count` | >1000 queries to one resolver; unusual clients. |
| 47 | Queries to domains with no prior history (T1071). | New domains post-compromise for C2. | `index=dns earliest=-7d \| where NOT [search index=dns earliest=-30d latest=-7d \| fields query] \| stats count by query` | First-seen domains; check reputation. |
| 48 | DNS queries from IoT or non-standard devices (T1078). | Compromised devices for network access. | `index=dns earliest=-7d src_ip IN (iot_subnet) \| stats count by src_ip, query \| where count > 50` | IoT devices querying external domains; non-IoT traffic. |
| 49 | Queries with long response delays (T1071). | Slow C2 or resolver issues from malware. | `index=dns earliest=-7d \| eval delay=response_time-request_time \| where delay > 1000 \| stats count by src_ip, query` | Delays >1s; correlate with NXDOMAINs. |
| 50 | Queries to domains with known malware hosting (T1071.001). | Malware delivery or C2 endpoints. | `index=dns earliest=-7d query IN (malware_domains_list) \| stats count by src_ip, query` | Queries to IOC-listed domains; high frequency. |

These hypotheses cover core DNS-based threats, leveraging patterns like tunneling, DGA, and reconnaissance. Customize queries for your DNS log schema and baseline normal traffic. For additional rules, explore repositories like Sigma or ThreatHunting-Queries.
